<form _cs="Workflow (xtk)" created="2025-04-15 12:49:24.434Z" createdBy-id="0" entitySchema="xtk:form"
      img="xtk:form.png" label="Workflow" lastModified="2025-07-23 16:10:11.683Z"
      md5="CE7D50D9A1EB2732F87C56125EA55996" modifiedBy-id="5890" name="workflow"
      namespace="xtk" showIconsIf="!@isModel" type="iconbox" xtkschema="xtk:form">

  <enter>
    <!-- Reset temp schema references -->
    <set expr="''" xpath="/ignored/@writerSchema"/>
    <set expr="''" xpath="/ignored/@transitionSchema"/>
    <set expr="''" xpath="/ignored/@schema"/>
    <set expr="''" xpath="/ignored/@orgSchema"/>
    <set expr="''" xpath="/ignored/@targetExtension"/>
    <set expr="wkfUpdateSubWorkflow()" xpath="/ignored/@ignoredSchema"/>
    <set expr="wkfTargetSchema('*')" xpath="/ignored/@ignoredSchema"/>
    <set translatedExpr="'Dynamic link'" xpath="/ignored/@advancedJoinLinkLabel"/>
    <set translatedExpr="'All'" xpath="/ignored/@allLabel"/>
  </enter>
<!--[of]:lib - utility elements-->
  <container name="lib" type="visibleGroup" visibleIf="false">

<!--[of]:Palette-->
<!--[c]Fake container to describe the palette-->
<!--[c]-->
    <container name="palette">
      <container img="nms:miniatures/mini-union.png" label="Targeting" name="segmentation">
        <input img="nms:miniatures/mini-query.png" xpath="query"/>
        <input img="nms:miniatures/mini-prefill.png" xpath="readGroup"/>
        <input img="nms:miniatures/mini-union.png" xpath="union"/>
        <input img="nms:miniatures/mini-intersection.png" xpath="intersection"/>
        <input img="nms:miniatures/mini-exclusion.png" xpath="exclusion"/>
        <input img="nms:miniatures/mini-piechart.png" xpath="extract"/>
        <input img="nms:miniatures/mini-cells.png" label="Cells" xpath="extract">
          <enter>
            <set value="extractCells" xpath="@form"/>
            <set value="nms:activities/cells.png" xpath="@img"/>
            <set value="false" xpath="transitions/extractOutput/@enabled"/>
            <set value="true" xpath="transitions/done/@enabled"/>
            <set translatedExpr="Iif(@name!='extract','Cells ' + SubString(@name, StrLen('extract')),'Cells')"
                 xpath="@label"/>
          </enter>
        </input>
        <input applicableIf="HasPackage('nms:interaction') OR HasPackage('nms:campaign')"
               img="nms:miniatures/mini-offerCells.png" label="Offers by cell" xpath="extract">
          <enter>
            <set value="offerCells" xpath="@form"/>
            <set value="nms:activities/offerCells.png" xpath="@img"/>
            <set value="false" xpath="transitions/extractOutput/@enabled"/>
            <set value="true" xpath="transitions/done/@enabled"/>
            <set translatedExpr="'Choice of offers by cell'" xpath="@label"/>
          </enter>
        </input>
        <input img="nms:miniatures/mini-survey.png" xpath="readSurvey"/>
        <input img="nms:miniatures/mini-predictive-extract.png" xpath="predictiveExtract"/>
        <input applicableIf="$(entityPath)=='/operation'" img="nms:miniatures/mini-deliveryOutline.png"
               xpath="deliveryOutline"/>
        <input img="nms:miniatures/mini-enrich.png" xpath="enrich"/>
        <input img="nms:miniatures/mini-schemaEdit.png" xpath="schemaEdit"/>
        <input img="nms:miniatures/mini-incremental.png" xpath="incremental"/>
        <input img="nms:miniatures/mini-offerSelection.png" xpath="offerSelection"/>
        <input img="nms:miniatures/mini-dedup.png" xpath="dedup"/>
        <input img="nms:miniatures/mini-changeAxis.png" xpath="changeAxis"/>
        <input img="nms:miniatures/mini-setService.png" xpath="setOfService"/>
        <input img="nms:miniatures/mini-group.png" xpath="saveGroup"/>
        <input applicableIf="HasPackage('nms:aamIntegration') and IsIMSLoggedIn()"
               img="nms:miniatures/mini-exportToAAM.png" xpath="exportToAAM"/>
        <input img="nms:miniatures/mini-writer.png" xpath="writer"/>
        <input applicableIf="HasPackage('crm:connectors')" img="crm:crm/dataMgt/crmConnector_16x16.png"
               xpath="crmConnectorDataMgt"/>
        <input applicableIf="HasPackage('crm:webex')" img="crm:webex/webex_16x16.png"
               xpath="crmWebex"/>
        <input applicableIf="HasPackage('nms:federatedDataAccess')" img="nms:miniatures/mini-changeDataSource.png"
               xpath="changeDataSource"/>
      </container>
      <container applicableIf="$(entityPath)=='/operation'" img="nms:miniatures/mini-delivery.png"
                 label="Deliveries" name="delivery">
        <input img="nms:miniatures/mini-mail.png" label="Email delivery" xpath="deliveryEmail"/>
        <input img="nms:miniatures/mini-envelope.png" label="Direct mail delivery"
               xpath="deliveryPaper"/>
        <input img="nms:miniatures/mini-sms.png" label="Mobile delivery" xpath="deliveryMobile"/>
        <input img="nms:miniatures/mini-phone.png" label="Telephone delivery" xpath="deliveryPhone"/>
        <input img="nms:fax.png" label="Fax delivery" xpath="deliveryFax"/>
        <input img="nms:miniatures/mini-agency.png" label="Agency delivery" xpath="deliveryAgency"/>
        <input applicableIf="HasPackage('nms:social')" img="nms:miniatures/facebook.png"
               label="Facebook delivery" xpath="deliveryOperation">
          <enter>
            <set value="nms:activities/facebook.png" xpath="@img"/>
            <set value="20" xpath="@messageType"/>
          </enter>
        </input>
        <input applicableIf="HasPackage('nms:social')" img="nms:miniatures/twitter.png"
               label="Twitter delivery" xpath="deliveryOperation">
          <enter>
            <set value="nms:activities/twitter.png" xpath="@img"/>
            <set value="25" xpath="@messageType"/>
          </enter>
        </input>
        <input applicableIf="HasPackage('nms:line') OR HasPackage('nms:lineV2')"
               img="nms:miniatures/line.png" label="LINE delivery" xpath="deliveryOperation">
          <enter>
            <set value="nms:activities/line.png" xpath="@img"/>
            <set value="61" xpath="@messageType"/>
          </enter>
        </input>
        <input applicableIf="HasPackage('nms:mobileApp')" img="nms:ios.png" label="iOS delivery"
               xpath="deliveryOperation">
          <enter>
            <set value="nms:activities/ios.png" xpath="@img"/>
            <set value="41" xpath="@messageType"/>
          </enter>
        </input>
        <input applicableIf="HasPackage('nms:mobileApp')" img="nms:android.png" label="Android delivery"
               xpath="deliveryOperation">
          <enter>
            <set value="nms:activities/android.png" xpath="@img"/>
            <set value="42" xpath="@messageType"/>
          </enter>
        </input>
        <input img="nms:miniatures/other.png" label="Other delivery" xpath="deliveryOther"/>
        <input img="nms:miniatures/mini-recurring.png" label="Recurring delivery"
               xpath="deliveryRecurring"/>
      </container>
      <container img="xtk:miniatures/mini-start.png" label="Flow Control" name="base">
        <input img="xtk:miniatures/mini-start.png" xpath="start"/>
        <input img="xtk:miniatures/mini-end.png" xpath="end"/>
        <input img="xtk:miniatures/mini-stop.png" xpath="stop"/>
        <input img="xtk:miniatures/mini-fork.png" xpath="fork"/>
        <input img="xtk:miniatures/mini-andjoin.png" xpath="andjoin"/>
        <input img="xtk:miniatures/mini-clock.png" xpath="schedule"/>
        <input img="xtk:miniatures/mini-condition.png" xpath="jstest"/>
        <input img="xtk:miniatures/mini-hourglass.png" xpath="wait"/>
        <input img="xtk:miniatures/mini-hourglass.png" xpath="timefilter"/>
        <input img="xtk:miniatures/mini-workflowjob.png" xpath="subworkflow"/>
        <input img="xtk:miniatures/mini-jump-1.png" xpath="jumpin"/>
        <input img="xtk:miniatures/mini-jump-2.png" xpath="jumpout"/>
        <input img="xtk:miniatures/mini-signal.png" xpath="signal"/>
        <input img="nms:miniatures/mini-validation.png" xpath="validation"/>
        <input img="nms:miniatures/mini-alert.png" xpath="alert"/>
        <input img="nms:mini-slackalert.png" label="Slack alert" xpath="slackAlert"/>
        <input applicableIf="HasPackage('nms:mrm') and $(entityPath)=='/operation'"
               img="nms:miniatures/mini-task.png" xpath="task"/>
      </container>
      <container img="xtk:workflow16x16.png" label="Actions" name="tools">
        <input img="nms:miniatures/mini-delivery.png" xpath="delivery"/>
        <input img="nms:miniatures/mini-control-delivery.png" xpath="controlDelivery"/>
        <input img="nms:miniatures/mini-notification.png" xpath="notification"/>
        <input img="nms:miniatures/mini-localValidation.png" label="Local approval"
               xpath="localValidation"/>
        <input img="nms:miniatures/mini-content.png" xpath="content"/>
        <input applicableIf="HasPackage('nms:federatedDataAccess')" img="nms:miniatures/mini-dbImport.png"
               xpath="dbImport"/>
        <input applicableIf="HasPackage('nms:federatedDataAccess')" img="nms:miniatures/mini-soapImport.png"
               xpath="soapImport"/>
        <input img="nms:miniatures/mini-fileImport.png" xpath="fileImport"/>
        <input img="xtk:miniatures/mini-fileExport.png" xpath="fileExport"/>
        <input img="xtk:miniatures/mini-execsql.png" xpath="sql"/>
        <input applicableIf="HasPackage('nms:federatedDataAccess')" img="xtk:miniatures/mini-execsql.png"
               xpath="sqlDM"/>
        <input img="xtk:miniatures/mini-script.png" xpath="js"/>
        <input img="xtk:miniatures/mini-script.png" xpath="jsx"/>
        <input img="xtk:miniatures/mini-exec.png" xpath="nlmodule"/>
        <input img="xtk:miniatures/mini-import.png" xpath="import"/>
        <input img="xtk:miniatures/mini-export.png" xpath="export"/>
        <input img="xtk:miniatures/mini-buildAggregate.png" xpath="buildAggregate"/>
      </container>
      <container applicableIf="$(entityPath)=='/workflow'" img="xtk:miniatures/mini-txt.png"
                 label="Events" name="events">
        <input img="xtk:miniatures/mini-txt.png" xpath="directorywatcher"/>
        <input img="nms:miniatures/mini-ftp.png" xpath="fileTransfer"/>
        <input img="nms:miniatures/mini-http.png" xpath="httpTransfer"/>
        <input img="nms:miniatures/mini-inmail.png" xpath="inmail"/>
        <input img="nms:miniatures/mini-sms.png" xpath="inSms"/>
      </container>
    </container>
<!--[cf]-->
<!--[of]:Shared components-->
    <container name="tabs" xpath=".">

<!--[c]Tabs for activities:-->
  <!--[of]:  defaultActivityPage-->
  <!--[c]Advanced tab for activities-->
  <!--[c]-->
      <container colcount="2" img="xtk:properties.png" label="Advanced" name="advancedActivityPage"
                 propagateConstraints="false">

        <input xpath="@name"/>
        <input hideImage="true" schema="xtk:image" type="linkedit" xpath="@img"/>
        <input xpath="@mask"/>
        <input xpath="@affinity"/>
        <input xpath="@maxExecutionTime"/>
        <input xpath="@collision"/>
        <input xpath="@timezone"/>
        <static/>

        <static colspan="2" label="Error management" type="separator"/>
        <input xpath="@onError"/>
        <static/>
        <container colspan="2" type="visibleGroup" visibleIf="@onError=1">
          <input xpath="@errorLimit"/>
          <static type="help">If the number of consecutive errors is not equal to zero, the process will be suspended after this number of consecutive errors.</static>
        </container>

        <static colspan="2" label="Initialization script" type="separator"/>
        <input colspan="2" nolabel="true" xpath="initScript">
          <container>
            <input menuId="workflowMenuBuilder" options="notJst" type="customizeBtn"
                   xpath="/ignored/customizeBtnOut"/>
          </container>
        </input>

        <static colspan="2" label="Comment" type="separator"/>
        <input colspan="2" lineCount="4" nolabel="true" xpath="comment"/>

      </container>
  <!--[cf]-->
  <!--[of]:  lightActivityPage-->
  <!--[c]Advanced tab for start and end-->
  <!--[c]-->
      <container colcount="2" img="xtk:properties.png" label="Advanced" name="lightActivityPage"
                 propagateConstraints="false">

        <input xpath="@name"/>
        <input hideImage="true" schema="xtk:image" type="linkedit" xpath="@img"/>

        <static colspan="2" label="Initialization script" type="separator"/>
        <input colspan="2" nolabel="true" xpath="initScript">
          <container>
            <input menuId="workflowMenuBuilder" options="notJst" type="customizeBtn"
                   xpath="/ignored/customizeBtnOut"/>
          </container>
        </input>

        <static colspan="2" label="Comment" type="separator"/>
        <input colspan="2" lineCount="4" nolabel="true" xpath="comment"/>

      </container>
  <!--[cf]-->
  <!--[of]:  timeoutsActivityPage-->
  <!--[c]Timeout tab for activities-->
  <!--[c]-->
      <container img="xtk:miniatures/mini-clock.png" label="Expiration" name="timeoutsActivityPage"
                 propagateConstraints="false">

        <input nolabel="true" toolbarCaption="Delayed events" type="list" xpath="transitions/timeout"
               zoom="true">
          <form>
            <container ref="xtk:workflow:lib/tabs/timeoutTransitionPage"/>
          </form>
          <input xpath="@label"/>
          <input xpath="@type"/>
          <input xpath="@delay"/>
          <input xpath="@date"/>
        </input>

      </container>
  <!--[cf]-->
  <!--[of]:  planningActivityPage-->
  <!--[c]Scheduling tab for activities-->
  <!--[c]-->
      <container img="xtk:miniatures/mini-clock.png" label="Schedule" name="planningActivityPage">
        <input nolabel="true" xpath="@usePeriod"/>
        <container type="visibleGroup" visibleIf="@usePeriod">
          <input nolabel="true" useDesc="true" xpath="@stopAfterFirst"/>
          <container img="nms:calendar-large.png" label="Execution schedule" type="frame">
            <input type="scheduler" xpath="period"/>
          </container>
        </container>
      </container>
  <!--[cf]-->

<!--[c]Tabs for transitions:-->
  <!--[of]:  advancedTransitionPage-->
  <!--[c]Advanced tab for all transitions-->
  <!--[c]-->
      <container img="xtk:properties.png" label="Advanced" name="advancedTransitionPage">

        <input xpath="@name"/>
        <input xpath="@target"/>
        <input xpath="@enabled"/>
        <input xpath="comment"/>
      </container>

      <container img="xtk:properties.png" label="Advanced" name="advancedExtractOutputPage">

        <input xpath="@name"/>
        <input xpath="@target"/>
        <input readOnly="true" xpath="@enabled"/>
        <input xpath="@forExclusion"/>
        <input xpath="comment"/>
      </container>

      <container colcount="2" label="General" name="extractGene">

        <input colspan="2" xpath="@label"/>
        <container colspan="2" type="visibleGroup" visibleIf="@mainSet!=''">
          <input type="ExclusionMainSetEdit" xpath="@mainSet"/>
        </container>
        <container colspan="2">
          <static label="Filtering settings" type="separator"/>
          <input checkedValue="linkedData" label="Use data from the target and additional data"
                 nolabel="false" type="radioButton" xpath="/ignored/@splitType"/>
          <input checkedValue="targetData" label="Use the additional data only" nolabel="false"
                 type="radioButton" xpath="/ignored/@splitType"/>
          <input applicableIf="HasPackage('nms:federatedDataAccess')" checkedValue="extSharedData"
                 label="Use external data" nolabel="false" type="radioButton" xpath="/ignored/@splitType"/>
          <container type="visibleGroup" visibleIf="[/ignored/@splitType]='linkedData'">
            <container ref="xtk:workflow:lib/tabs/schemaSelector"/>
          </container>
          <container type="visibleGroup" visibleIf="[/ignored/@splitType]='targetData'">
            <input label="Targeting dimension" readOnly="true" type="schemaEdit"
                   xpath="@schema"/>
          </container>
          <input expr="Iif([/ignored/@splitType]='targetData', [/ignored/@extractSource], NodeValue('@schema'))"
                 type="expr" xpath="@schema"/>
          <input expr="Iif([/ignored/@splitType]='targetData', '', NodeValue('@recipientLink'))"
                 type="expr" xpath="@recipientLink"/>
          <container applicableIf="HasPackage('nms:federatedDataAccess')" type="visibleGroup"
                     visibleIf="[/ignored/@splitType]='extSharedData' OR [/ignored/@splitType]='externalData'">
            <input label="Targeting dimension" type="targetSchema" xpath="@schema"
                   xpathLink="@recipientLink">
              <form entity-schema="xtk:schema" label="Please select a document" name="entitySchema"
                    namespace="xtk" nothingToSave="true">
                <input monoSelection="true" notifyFolderKeyPath="" schema="xtk:schema"
                       type="linkListChoice" xpath=".">
                  <input alias="@_cs" expr="[.]"/>
                  <input xpath="[.]"/>
                  <input xpath="@namespace"/>
                  <input xpath="@name"/>
                  <orderBy>
                    <node expr="@label"/>
                  </orderBy>
                </input>
              </form>
            </input>
            <input label="Filtering dimension" readOnly="true" type="targetSchemaLink"
                   xpath="@schema" xpathLink="@recipientLink"/>
            <input img="xtk:xtklinkn.png" labelExpr="Iif(NodeCount([extension])==0, [/ignored/@strAddData], [/ignored/@strEditLinkedData])"
                   nolabel="false" prebuildSubForm="false" type="subFormLink" xpath=".">
              <enter name="onClick">
                <set expr="@schema" xpath="/tmp/selectCtrl/in/@schema"/>
                <set value="1" xpath="/tmp/queryAdd/@dataTypeReadOnly"/>
                <set value="1" xpath="/tmp/queryAdd/@reverseLink"/>
                <set expr="[/ignored/@splitType]" xpath="/tmp/queryAdd/@dataType"/>
              </enter>
              <form label="Additional data" ref="xtk:workflow:lib/subforms/queryAdd"
                    type="wizard"/>
            </input>
          </container>
        </container>
        <container colcount="2" colspan="2" xpath="transitions">
          <static colspan="2" label="Results" type="separator"/>
          <input colspan="2" xpath="../@alwaysExtractFromSource"/>
          <input colspan="2" xpath="../@concatenateSegmentCode"/>
          <input colspan="2" xpath="done/@enabled"/>
      <!-- Force rebuild of temp schema and consequent update of activity's XML, for any changes on the 2 previous checkBox-->
          <input expr="wkfTargetSchema(Iif([../@concatenateSegmentCode] and [done/@enabled], NodeValue('../@name'), NodeValue('../@name')), Iif([../@mainSet]='', '', 'src'))"
                 type="expr" xpath="/ignored/@ignoredSchema"/>
          <container colcount="2" colspan="2" type="visibleGroup" visibleIf="[done/@enabled]">
            <input xpath="done/@label"/>
            <input xpath="done/@code"/>
          </container>
          <container colcount="2" colspan="2" type="visibleGroup" visibleIf="![../@alwaysExtractFromSource]">
            <input colspan="2" xpath="remainder/@enabled"/>
            <container colcount="2" colspan="2" type="visibleGroup" visibleIf="[remainder/@enabled]">
              <input xpath="remainder/@label"/>
              <input xpath="remainder/@code"/>
            </container>
            <static colspan="2" type="help">If this option is checked, a complementary subset will contain all remaining records.</static>
          </container>
        </container>
      </container>
  <!--[cf]-->
      <container img="xtk:schema.png" label="Schema" name="schemaTransitionPage">

        <static fontBold="true" label="Data structure generated:"/>
        <container colcount="2">
          <static img="xtk:filter.png" type="image"/>
          <input catchReturnKey="true" label="Find" type="edit" xpath="/ignored/@transitionSearch"/>
        </container>
        <input type="schemaview" xpath="/ignored/@transitionSchema" xpathExpr="/ignored/@transitionExpr"
               xpathHelp="/ignored/selectCtrl/itn/@help" xpathSearchPath="/ignored/@transitionSearch"/>
        <input type="help" xpath="/ignored/selectCtrl/itn/@help"/>

      </container>

  <!--[of]:  timeoutTransitionPage-->
  <!--[c]Container to edit the properties of a timeout.-->
  <!--[c]-->
  <!--[c]This container is used in the detail of a timeout transition and in the form that-->
  <!--[c]is opened on a timeout from an activity-->
  <!--[c]-->
      <container colcount="2" img="nms:delayed.png" name="timeoutTransitionPage">
        <input xpath="@label"/>
        <input xpath="@name"/>
        <input xpath="@keepActive"/>
        <input xpath="@target"/>
        <input colspan="2" xpath="@type"/>
        <container colcount="2" colspan="2" type="visibleGroup" visibleIf="@type=0">
          <input xpath="@delay"/>
          <static/>
        </container>
        <container colcount="2" colspan="2" type="visibleGroup" visibleIf="@type=1 or @type=2">
          <input xpath="@delay"/>
          <input xpath="@date"/>
        </container>
        <container colspan="2" type="visibleGroup" visibleIf="@type=3">
          <input menuId="workflowMenuBuilder" options="notJst" type="scriptEdit"
                 xpath="script"/>
        </container>
        <input colspan="2" xpath="@enabled"/>
        <input colspan="2" xpath="comment"/>
      </container>
  <!--[cf]-->
  <!--[of]:  filterTransitionPage-->
  <!--[c]Container to edit the properties of a segment-->
  <!--[c]-->
      <form name="timeout" ref="xtk:workflow:lib/subforms/timeoutContainer"/>

  <!--[cf]-->
  <!--[of]:  extractOutput-->
      <container colcount="2" img="nms:subset.png" label="Subset" name="filterTransitionPage">

        <input xpath="@label"/>
        <input xpath="@code"/>

        <container colcount="2" colspan="2" label="Select a subset" name="splitSelection"
                   type="frame">
          <static colspan="2" label="Filtering of selected records" type="separator"/>
          <input checkedValue="false" colspan="2" label="Do not filter the inbound population"
                 type="radioButton" xpath="filter/@enabled"/>
          <input checkedValue="true" label="Add a filtering condition on the inbound population"
                 type="radioButton" xpath="filter/@enabled"/>
          <container enabledIf="[filter/@enabled]" type="enabledGroup">
            <input label="Edit..." type="subFormLink" xpath="filter">
              <form label="Query" name="queryWizard" nothingToSave="true" type="wizard">
                <enter>
                  <set value="1" xpath="/ignored/@currentFilterStack"/>
                  <set value="0" xpath="/ignored/@addFilter"/>
                  <set value="" xpath="/ignored/@filterName"/>
                  <set value="1" xpath="/ignored/@havingCond"/>
                  <if expr="[../@schemaOverride]==false">
                    <set expr="[../../../@schema]" xpath="../@schema"/>
                    <set expr="[../../../@recipientLink]" xpath="../@recipientLink"/>
                  </if>
                  <set expr="Iif(Substring([../@schema], 0, 4)=='temp' AND [../@recipientLink]=='', 1, 0)"
                       xpath="/tmp/@useTempSchema"/>
                  <set expr="iif(SubString([../@schema],0,4)!='temp', [../@schema], 'temp:workflow:'+[../../../../../@id]+'_'+[../../../@name]+'_'+[../@name])"
                       xpath="/ignored/@querySchemaExec"/>
                </enter>
                <container desc="Select the schema of the target items to  generate and the associated schema concerned by the filtering."
                           firstActivatedIf="count(where) == 0" img="xtk:filter32.png"
                           name="typePage" title="Targeting and filtering dimension">
                  <input xpath="../@schemaOverride"/>
                  <input expr="iif([../@schemaOverride], NodeValue('../@schema'), [../../../@schema])"
                         type="expr" xpath="../@schema"/>
                  <input expr="iif([../@schemaOverride], NodeValue('../@recipientLink'), [../../../@recipientLink])"
                         type="expr" xpath="../@recipientLink"/>
                  <container type="visibleGroup" visibleIf="![../@schemaOverride]">
                    <input label="Filtering dimension" readOnly="true" type="targetSchemaLink"
                           xpath="../@schema" xpathLink="../@recipientLink"/>
                  </container>
                  <container type="visibleGroup" visibleIf="[../@schemaOverride]">
                    <input checkedValue="0" label="Database schema" type="RadioButton"
                           xpath="/tmp/@useTempSchema"/>
                    <input checkedValue="1" label="Temporary schema" type="RadioButton"
                           xpath="/tmp/@useTempSchema"/>
                    <container type="visibleGroup" visibleIf="[/tmp/@useTempSchema]==0">
                      <input label="Targeting dimension" type="targetSchema" xpath="../@schema"
                             xpathLink="../@recipientLink">
                        <form entity-schema="xtk:schema" label="Please select a document"
                              name="entitySchema" namespace="xtk" nothingToSave="true">
                          <input monoSelection="true" notifyFolderKeyPath="" schema="xtk:schema"
                                 type="linkListChoice" xpath=".">
                            <input alias="@_cs" expr="[.]"/>
                            <input xpath="[.]"/>
                            <input xpath="@namespace"/>
                            <input xpath="@name"/>
                            <orderBy>
                              <node expr="@label"/>
                            </orderBy>
                          </input>
                        </form>
                      </input>
                      <input label="Filtering dimension" type="targetSchemaLink"
                             xpath="../@schema" xpathLink="../@recipientLink"/>
                    </container>
                    <container type="visibleGroup" visibleIf="[/tmp/@useTempSchema]==1">
                      <input label="Schema" recurse="true" type="ExclusionMainSetEdit"
                             xpath="/tmp/@srcDataSet" xpathActivityName="../../../@name"/>
                      <input expr="Iif([/tmp/@useTempSchema]=1 AND [/tmp/@srcDataSet]!='', wkfSchemaName([/tmp/@srcDataSet]), NodeValue('../@schema'))"
                             type="expr" xpath="../@schema"/>
                    </container>
                  </container>
                  <static label="List of restriction filters" type="separator"/>
                  <input dblClickAction="wizNext" img="xtk:filter.png" noEditCollection="true"
                         noToolbar="true" nolabel="true" type="filterList" xpath="/tmp/filterList"
                         xpathFilter="/ignored/@filterName" xpathSchema="../@schema"
                         xpathWhere="where"/>
                </container>
                <container desc="Please enter the definition of the target element"
                           enabledButtonLabelIf="[/ignored/@currentFilterStack] == true"
                           img="xtk:filter32.png" name="targetPage" nextButtonLabel="Refine target &gt;"
                           nextPage="typePage" title="Target element">
                  <container type="visibleGroup" visibleIf="SubString([../@schema],0,5)!='temp:'">
                    <container name="targetPageFocus" style="flat" type="notebook">
                      <container label="Criteria">
                        <static label="Filter settings" type="separator"/>
                        <input propagateXPathToCtx="/ignored/@currentOrderId|/@currentOrderId,/ignored/@querySchemaExec|/@querySchemaExec"
                               type="filterView" valuesContext="true" xpath="." xpathFilter="/ignored/@filterName"
                               xpathQueryLabel="humanCond" xpathSchema="../@schema"
                               xpathsContext="tmp/@segmentation"/>
                      </container>
                      <container label="Preview">
                        <input hideEditButtons="true" name="targetPreviewQuery" noToolbar="true"
                               nolabel="true" propagateXPathToCtx="/ignored/@currentOrderId|/@currentOrderId,/ignored/@querySchemaExec|/@querySchemaExec"
                               type="filterPreviewList" xpath="/ignored/previewList"
                               xpathSchema="../@schema" xpathTargetPart="."/>
                      </container>
                    </container>
                  </container>
                  <container type="visibleGroup" visibleIf="SubString([../@schema],0,5)='temp:'">
                    <static label="Filter settings" type="separator"/>
                    <input propagateXPathToCtx="/ignored/@currentOrderId|/@currentOrderId,/ignored/@querySchemaExec|/@querySchemaExec"
                           type="filterView" valuesContext="true" xpath="." xpathFilter="/ignored/@filterName"
                           xpathQueryLabel="humanCond" xpathSchema="../@schema" xpathsContext="tmp/@segmentation"/>
                  </container>

                  <leave>
                    <set value="1" xpath="/ignored/@addFilter"/>
                    <set value="" xpath="/ignored/@filterName"/>

                    <set translatedExpr="'Query: '+humanCond" xpath="humanCond"/>
                  </leave>
                </container>
              </form>
            </input>
          </container>

          <container colspan="2" type="visibleGroup" visibleIf="[filter/@enabled]"
                     xpath="filter">
            <input fontBold="true" label=" " noBorder="true" readOnly="true" type="memo"
                   xpath="humanCond"/>
          </container>

          <container colcount="2" colspan="2">
            <static colspan="2" label="Record count limitation" type="separator"/>
            <input checkedValue="false" colspan="2" label="Do not limit the number of records"
                   type="radioButton" xpath="limiter/@enabled"/>
            <input checkedValue="true" label="Limit the selected records" type="radioButton"
                   xpath="limiter/@enabled"/>
            <container enabledIf="[limiter/@enabled]" type="enabledGroup">
              <input label="Edit..." type="subFormLink" xpath="limiter">
                <form label="Record count limitation" name="limitWizard" nothingToSave="true"
                      type="wizard">
                  <enter>
                        <!-- set imit in percent by default -->
                    <if expr="@type=''">
                      <set value="percent" xpath="@type"/>
                    </if>
                  </enter>

                  <container desc="Select the required limitation type." img="nms:pictoprofile.png"
                             name="typePage" title="Type of limit">
                    <enter>
                          <!-- set random type by default -->
                      <if expr="!(@order or @random)">
                        <set value="true" xpath="@random"/>
                      </if>
                      <set expr="Iif(@random, Iif(@order, 2, 0), 1)" xpath="/tmp/extract/@subSetSelection"/>
                    </enter>

                    <input checkedValue="0" label="Activate random sampling" type="radioButton"
                           xpath="/tmp/extract/@subSetSelection"/>
                    <input checkedValue="1" label="Keep only the first records after sorting"
                           type="radioButton" xpath="/tmp/extract/@subSetSelection"/>
                    <input checkedValue="2" label="Keep the first ones after sorting (criteria, random)"
                           type="radioButton" xpath="/tmp/extract/@subSetSelection"/>

                    <input expr="Iif([/tmp/extract/@subSetSelection]=0 OR [/tmp/extract/@subSetSelection]=2, true, false)"
                           type="expr" xpath="@random"/>
                    <input expr="Iif([/tmp/extract/@subSetSelection]=1 OR [/tmp/extract/@subSetSelection]=2, true, false)"
                           type="expr" xpath="@order"/>
                  </container>

                  <container desc="Select the sort order for the selected records"
                             img="nms:pictoprofile.png" name="orderPage" title="Sorting"
                             visibleIf="@order">
                    <container ref="xtk:workflow:lib/tabs/schemaSelector" xpath="../../.."/>
                    <input editable="false" name="sortList" nolabel="true" toolbarCaption="Sort columns"
                           type="orderByList" xpath="orderBy/node" xpathChoiceTarget="@expr"
                           xpathCurrentLookupPath="/lookupPath/orderBy" xpathHelp="/@help"
                           xpathSchema="../../../@schema" zoom="false">
                      <input colSize="20" xpath="@label"/>
                      <input choiceType="sortAggregate" colSize="35" editable="true"
                             type="pathedit" xpath="@expr" xpathRecipientLink="../../../../../@recipientLink"
                             xpathSchema="../../../../../@schema"/>
                      <input colSize="15" editable="true" xpath="@sortDesc"/>
                    </input>
                    <input type="help" xpath="/@help"/>
                  </container>

                  <container colcount="2" desc="Select the data limitation values."
                             img="nms:pictoprofile.png" name="limitPage" title="Limits">
                    <input checkedValue="percent" label="Size (in %)" nolabel="true"
                           type="RadioButton" xpath="@type"/>
                    <container type="visibleGroup" visibleIf="@type='percent'">
                      <input nolabel="true" xpath="@percent"/>
                    </container>
                    <container type="visibleGroup" visibleIf="@type!='percent'">
                      <static/>
                    </container>
                    <input checkedValue="segmentPercent" label="Size (as a % of the segment)"
                           nolabel="true" type="RadioButton" xpath="@type"/>
                    <container type="visibleGroup" visibleIf="@type='segmentPercent'">
                      <input nolabel="true" xpath="@percent"/>
                    </container>
                    <container type="visibleGroup" visibleIf="@type!='segmentPercent'">
                      <static/>
                    </container>
                    <input checkedValue="number" label="Maximum size" nolabel="true"
                           type="RadioButton" xpath="@type"/>
                    <container type="visibleGroup" visibleIf="@type='number'">
                      <input nolabel="true" xpath="@number"/>
                    </container>
                    <container type="visibleGroup" visibleIf="@type!='number'">
                      <static/>
                    </container>
                    <input checkedValue="grouped" colspan="2" label="By data grouping"
                           nolabel="true" type="RadioButton" xpath="@type"/>
                    <input checkedValue="groupedPercent" colspan="2" label="By data grouping (as a %)"
                           nolabel="true" type="RadioButton" xpath="@type"/>
                    <container colspan="2" type="visibleGroup" visibleIf="@type='grouped' OR @type='groupedPercent'">
                      <static label="Click 'Next' to enter the additional information."
                              type="help"/>
                    </container>
                    <container colcount="2" colspan="2">
                      <input applicableIf="HasPackage('nms:centralLocal')" checkedValue="distribution"
                             label="By data distribution " nolabel="true" type="RadioButton"
                             xpath="@type"/>
                      <container applicableIf="HasPackage('nms:centralLocal')" type="visibleGroup"
                                 visibleIf="@type='distribution'">
                        <input createMode="none" nolabel="true" notifyPathList="@distributionXPath|../@distributionXPath,@type|../@distributionType,@targetSchema|/ignored/distribution/@targetSchema"
                               xpath="localDistribution" zoom="true">
                          <sysFilter>
                            <condition expr="@targetSchema=$(../../../@schema)"/>
                          </sysFilter>
                        </input>
                      </container>
                      <container applicableIf="HasPackage('nms:centralLocal')" type="visibleGroup"
                                 visibleIf="@type!='distribution'">
                        <static/>
                      </container>
                    </container>
                  </container>
                  <container desc="Select the data to group." img="nms:pictoprofile.png"
                             name="groupPage" title="Data grouping" visibleIf="@type='grouped' OR @type='groupedPercent'">
                    <input editable="false" name="groupList" nolabel="true" toolbarCaption="Group the data"
                           type="groupByList" xpath="groupBy/node" xpathChoiceTarget="@expr"
                           xpathCurrentLookupPath="/lookupPath/groupBy" xpathSchema="../../../@schema"
                           zoom="false">
                      <input colSize="20" xpath="@label"/>
                      <input choiceType="group" colSize="35" editable="true" type="pathedit"
                             xpath="@expr" xpathSchema="../../../../../@schema"/>
                    </input>
                  </container>
                  <container desc="Select the data grouping by limitation values"
                             img="nms:pictoprofile.png" name="groupPageLimit" title="Data grouping"
                             visibleIf="@type='grouped' OR @type='groupedPercent'">
                    <input checkedValue="false" label="All data groupings are the same size"
                           type="RadioButton" xpath="@enableGroupByLimit"/>
                    <input checkedValue="true" label="Limitations by grouping value"
                           type="RadioButton" xpath="@enableGroupByLimit"/>

                    <container type="visibleGroup" visibleIf="@enableGroupByLimit">
                      <input nolabel="true" type="EnumEditList" xpath="groupByLimit"
                             xpathSchema="../../../@schema" xpathType="groupBy/node[1]/@expr">
                        <input xpath="@grpValue"/>
                        <input xpath="@limit"/>
                        <input hidden="true" xpath="@label"/>
                      </input>
                      <container colcount="2">
                        <static label="Otherwise use the following value:"/>
                        <input nolabel="true" xpath="@defaultLimit"/>
                      </container>
                    </container>
                    <container type="visibleGroup" visibleIf="@enableGroupByLimit==false">
                      <container colcount="2">
                        <static/>
                        <input label="Value" xpath="@defaultLimit"/>
                      </container>
                    </container>
                  </container>

                  <leave>
                    <if expr="HasPackage('nms:centralLocal')">
                      <check expr="@type != 'distribution' or (@type == 'distribution' and [@localDistribution-id] != 0)">
                        <error>You must specify a distribution template.</error>
                      </check>
                    </if>

                        <!-- build limiter label -->
                    <if expr="@order and @random">
                      <set translatedExpr="'Order by '+[orderBy/@displayOrder]+' and random sampling,'"
                           xpath="/ignored/@limiterType"/>
                    </if>
                    <if expr="@order and @random==false">
                      <set translatedExpr="'Order by '+[orderBy/@displayOrder]" xpath="/ignored/@limiterType"/>
                    </if>
                    <if expr="@random and @order==false">
                      <set translatedExpr="'Random sampling'" xpath="/ignored/@limiterType"/>
                    </if>

                    <if expr="@type == 'percent'">
                      <set translatedExpr="[/ignored/@limiterType]+' limited to '+@percent+' %'"
                           xpath="humanCond"/>
                    </if>
                    <if expr="@type == 'segmentPercent'">
                      <set translatedExpr="[/ignored/@limiterType]+' limited to '+@percent+' % of the segment'"
                           xpath="humanCond"/>
                    </if>
                    <if expr="@type == 'number'">
                      <set translatedExpr="[/ignored/@limiterType]+' limited to '+@number"
                           xpath="humanCond"/>
                    </if>
                    <if expr="@type == 'grouped' OR @type == 'groupedPercent'">
                      <set translatedExpr="[/ignored/@limiterType]+' with limit by data grouping \''+[groupBy/@displayGroup]+'\''"
                           xpath="humanCond"/>
                    </if>
                    <if expr="@type == 'distribution'">
                      <set translatedExpr="[/ignored/@limiterType]+' with limit by data grouping \''+[@localDistribution-cs]+'\''"
                           xpath="humanCond"/>
                    </if>
                  </leave>
                </form>
              </input>
            </container>
          </container>
          <container colspan="2" type="visibleGroup" visibleIf="[limiter/@enabled]"
                     xpath="limiter">
            <input fontBold="true" label=" " noBorder="true" readOnly="true" type="memo"
                   xpath="humanCond"/>
          </container>
        </container>
      </container>
  <!--[cf]-->

  <!--[of]:  advancedQueryParams-->
  <!--[c]Advanced Query Parameters-->
  <!--[c]-->
      <container name="advancedQueryParams">

        <input hideCalculated="true" hideMappedAsXml="true" label="Link used to identify recipients"
               nolabel="false" type="pathEdit" useLink11Path="true" xpath="@recipientLink"/>

        <static type="help">If the link is specified, generates a population made of documents pointed to by the link (the query fetches foreign keys of the link, not the primary keys of the document type used by the query).</static>

      </container>
  <!--[cf]-->
  <!--[of]:  schemaSelector-->
      <container name="schemaSelector">
        <container type="visibleGroup" visibleIf="[/tmp/@acceptTempSchema]==1">
          <input checkedValue="0" label="Database schema" type="RadioButton" xpath="/tmp/@useTempSchema"/>
          <input checkedValue="1" label="Temporary schema" type="RadioButton" xpath="/tmp/@useTempSchema"/>
        </container>
        <container type="visibleGroup" visibleIf="[/tmp/@useTempSchema]!=1">
          <input label="Targeting dimension" type="targetSchema" xpath="@schema"
                 xpathLink="@recipientLink">
            <form entity-schema="xtk:schema" label="Please select a document" name="entitySchema"
                  namespace="xtk" nothingToSave="true">
              <input monoSelection="true" notifyFolderKeyPath="" schema="xtk:schema"
                     type="linkListChoice" xpath=".">
                <input alias="@_cs" expr="[.]"/>
                <input xpath="[.]"/>
                <input xpath="@namespace"/>
                <input xpath="@name"/>
                <orderBy>
                  <node expr="@label"/>
                </orderBy>
              </input>
            </form>
          </input>
          <input label="Filtering dimension" type="targetSchemaLink" xpath="@schema"
                 xpathLink="@recipientLink"/>
        </container>
        <container type="visibleGroup" visibleIf="[/tmp/@useTempSchema]==1">
          <input label="Schema" recurse="true" type="ExclusionMainSetEdit" xpath="/tmp/@srcDataSet"
                 xpathActivityName="@name"/>
          <input expr="Iif([/tmp/@useTempSchema]=1, wkfSchemaName([/tmp/@srcDataSet]), NodeValue('@schema'))"
                 type="expr" xpath="@schema"/>
        </container>
      </container>
  <!--[cf]-->
  <!--[of]:  queryWizard-->
  <!--[c]Form to edit the query in a query or queryIncremental activity-->
  <!--[c]-->
      <form alwaysActiveFirstPage="true" label="Query" name="queryWizard" nothingToSave="true"
            type="wizard">

        <enter>
          <if expr="@schema==''">
                  <!-- force schema if not defined yet -->
            <set value="nms:recipient" xpath="@schema"/>
          </if>
                <!-- needed to synch schema for other conditionList -->
          <set expr="@schema" xpath="/ignored/@schema"/>
          <set value="" xpath="/ignored/@filterName"/>
          <set value="1" xpath="/ignored/@currentFilterStack"/>
          <set value="0" xpath="/ignored/@addFilter"/>
          <set value="1" xpath="/ignored/@havingCond"/>
          <set expr="Iif(wkfSourceActivity(@name)!='', 1, 0)" xpath="/tmp/@acceptTempSchema"/>
          <set value="0" xpath="/tmp/@useTempSchema"/>
        </enter>

        <container desc="Select the schema of the target items to  generate and the associated schema concerned by the filtering."
                   firstActivatedIf="count(where) == 0" img="xtk:filter32.png" name="typePage"
                   title="Targeting and filtering dimension">

          <container ref="xtk:workflow:lib/tabs/schemaSelector"/>
          <static label="List of restriction filters" type="separator"/>
          <input dblClickAction="wizNext" img="xtk:filter.png" noEditCollection="true"
                 noToolbar="true" nolabel="true" type="filterList" xpath="/tmp/filterList"
                 xpathFilter="/ignored/@filterName" xpathSchema="@schema" xpathWhere="where"/>
        </container>

        <container desc="Specify the filtering conditions used to select the records"
                   enabledButtonLabelIf="[/ignored/@currentFilterStack] == true"
                   img="xtk:filter32.png" name="targetPage" nextButtonLabel="Refine target &gt;"
                   nextPage="typePage" title="Filter">
          <container name="targetPageFocus" style="flat" type="notebook">
            <container label="Criteria">
              <input xpath="@label"/>
              <static label="Filter settings" type="separator"/>
              <input propagateXPathToCtx="/ignored/@currentOrderId|/@currentOrderId,/ignored/@querySchemaExec|/@querySchemaExec"
                     type="filterView" valuesContext="true" xpath="." xpathFilter="/ignored/@filterName"
                     xpathLabel="@label" xpathQueryLabel="humanCond" xpathSchema="@schema"
                     xpathsContext="tmp/@segmentation"/>
            </container>
            <container label="Preview">
              <input hideEditButtons="true" name="targetPreviewQuery" noToolbar="true"
                     nolabel="true" propagateXPathToCtx="/ignored/@currentOrderId|/@currentOrderId,/ignored/@querySchemaExec|/@querySchemaExec"
                     type="filterPreviewList" xpath="/ignored/previewList" xpathTargetPart="."/>
            </container>
          </container>
          <leave>
            <set value="1" xpath="/ignored/@addFilter"/>
            <set value="" xpath="/ignored/@filterName"/>
          </leave>
        </container>
        <leave>
          <set expr="Iif([@recipientLink]='' and SubString(@schema, 0, 5)='temp:', true, false)"
               xpath="@useSource"/>
        </leave>
      </form>
  <!--[cf]-->

<!--[c]Other...-->
  <!--[of]:  fileHistory-->
      <container label="Historization settings" name="fileHistory">
        <container label="Storage directory" type="frame">
          <input xpath="@useDefault"/>
          <container type="visibleGroup" visibleIf="!@useDefault">
            <input xpath="@tmpDirectory"/>
          </container>
        </container>
        <container label="Purge settings" type="frame">
          <input xpath="@maxFiles"/>
          <input xpath="@maxSizeMo"/>
        </container>
      </container>
  <!--[cf]-->

      <container name="colSelector" style="flat" type="notebook">
        <container label="Data" name="data">
          <container hideUnboundPath="false" name="selectCtrl" showCollections="true"
                     type="querySelectContainer" xpath=".">
        <!-- Attention querySelectContainer container enrich this form defintion.
                 Therefore container and hierarchy shouldn't be changes -->
            <container name="vpaned" type="vpaned">
              <container name="schema">
                <static fontBold="true" label="Available fields:"/>
                <container colcount="2">
                  <static img="xtk:filter.png" type="image"/>
                  <input catchReturnKey="true" label="Find" type="edit" xpath="/tmp/selectCtrl/itn/@search"/>
                </container>
                <input checkDuplicates="false" hideMappedAsXml="true" name="schemaView"
                       type="SchemaView" useUnboundPath="true" xpath="/tmp/selectCtrl/in/@schema"
                       xpathHelp="/tmp/selectCtrl/itn/@help" xpathIndex="/tmp/selectCtrl/itn/@current"
                       xpathSearchPath="/tmp/selectCtrl/itn/@search" xpathSelect="select/node/@expr"
                       xpathStartPath="/tmp/selectCtrl/in/@startPath"/>
              </container>
              <container name="output" xpathsToLoad="output*">
                <static fontBold="true" label="Output columns:"/>
                <input alwaysActive="true" expr="Iif([/tmp/outputColumn/itn/@current]=='' OR NodeValue([/tmp/outputColumn/itn/@current] + '/../@expr')=='', '', '/'+ UnExpandXPath(NodeValue([/tmp/outputColumn/itn/@current] + '/../@expr')))"
                       type="expr" xpath="/tmp/outputColumn/in/@startPath"/>
                <input name="columnList" nolabel="true" prebuildSubForm="false" toolbarAlign="vertical"
                       type="columnList" useTreeView="true" xpath="select/node" xpathCurrentLookupPath="/lookupPath/select"
                       xpathGroupBy="groupBy/node" xpathGroupOption="/tmp/selectCtrl/out/@group"
                       xpathHasMemoData="/tmp/selectCtrl/itn/@hasMemoData" xpathHaving="having/condition"
                       xpathHelp="/tmp/selectCtrl/itn/@help" xpathSchema="/tmp/selectCtrl/in/@schema"
                       xpathSelection="/tmp/outputColumn/itn/@current" zoom="false">
                  <input colSize="20" xpath="@label"/>
                  <input colSize="35" type="pathedit" useUnboundPath="true" xpath="@expr"
                         xpathChoiceType="/tmp/selectCtrl/in/@choiceType" xpathSchema="/tmp/selectCtrl/in/@schema"
                         xpathStartPath="/tmp/outputColumn/in/@startPath"/>
                  <input colSize="20" xpath="@alias"/>
                  <input colSize="20" xpath="@groupBy"/>
              <!-- Form description of column -->
                  <form label="Column definition" name="colDetail">
                    <input xpath="@label"/>
                    <container name="extraFields"/>
                <!-- empty container in which edit controls may be
                                                 added by the top level querySelectContainer -->
                    <input noTransaction="true" type="expredit" xpath="@expr" xpathSchema="/tmp/selectCtrl/in/@schema"/>
                <!-- Expression editor description -->
                    <container type="visibleGroup" visibleIf="[/tmp/selectCtrl/itn/@advancedMode]">
                      <container colcount="2" cols-width="100,1">
                        <container>
                          <static fontBold="true" label="Available fields:"/>
                          <container colcount="2">
                            <static img="xtk:filter.png" type="image"/>
                            <input catchReturnKey="true" label="Find" type="edit"
                                   xpath="/tmp/selectCtrl/itn/@search"/>
                          </container>
                          <input type="schemaview" xpath="/tmp/selectCtrl/in/@schema"
                                 xpathExpr="@expr" xpathHelp="/tmp/selectCtrl/itn/@help"
                                 xpathSearchPath="/tmp/selectCtrl/itn/@search" xpathStartPath="/tmp/selectCtrl/in/@startPath"/>
                        </container>
                        <input type="functionview" xpathExpr="@expr" xpathHelp="/tmp/selectCtrl/itn/@help"/>
                      </container>
                      <input type="help" xpath="/tmp/selectCtrl/itn/@help"/>
                    </container>
                    <input label="Advanced mode" nolabel="true" type="checkbox" xpath="/tmp/selectCtrl/itn/@advancedMode"/>
                  </form>
                </input>
                <input img="xtk:properties.png" label="Advanced parameters..." type="subFormLink"
                       xpath=".">
                  <form label="Advanced parameters">
                    <enter>
                      <if expr="NodeName([.])='query' OR NodeName([.])='incremental' OR NodeName([.])='dbImport'">
                        <set expr="@noAutoPk" xpath="/tmp/@noAutoPk"/>
                        <set expr="@noAutoPkFilter" xpath="/tmp/@noAutoPkFilter"/>
                      </if>
                      <if expr="NodeName([.])='query'">
                        <set expr="@useSource" xpath="/tmp/@useSource"/>
                      </if>
                      <if expr="NodeName([.])='enrich' OR NodeName([.])='changeAxis'">
                        <set expr="@noAutoPkFilter" xpath="/tmp/@noAutoPkFilter"/>
                      </if>
                      <if expr="NodeName([.])='enrich'">
                        <set expr="@addAutoPk" xpath="/tmp/@addAutoPk"/>
                      </if>
                    </enter>
                    <container type="visibleGroup" visibleIf="NodeName([.])!='enrich' AND NodeName([.])!='changeAxis' AND NodeName([.])!='dedup'">
                      <input xpath="@keepAllExtraData"/>
                    </container>
                    <input xpath="@groupBy"/>
                    <input xpath="@distinct"/>
                    <container type="visibleGroup" visibleIf="NodeName([.])='query' OR NodeName([.])='incremental' OR NodeName([.])='dbImport'">
                      <input label="Disable automatic adding of the primary keys of the targeting dimension"
                             type="checkbox" xpath="/tmp/@noAutoPk"/>
                      <input label="Disable automatic filtering of 0 ID records"
                             type="checkbox" xpath="/tmp/@noAutoPkFilter"/>
                    </container>
                    <container type="visibleGroup" visibleIf="NodeName([.])='query'">
                      <input label="Use inbound event data" type="checkbox" xpath="/tmp/@useSource"/>
                    </container>
                    <container type="visibleGroup" visibleIf="NodeName([.])='enrich' OR NodeName([.])='changeAxis'">
                      <input label="Disable automatic filtering of 0 ID records"
                             type="checkbox" xpath="/tmp/@noAutoPkFilter"/>
                    </container>
                    <container type="visibleGroup" visibleIf="NodeName([.])='enrich'">
                      <input label="Add an identifier for each line of the result."
                             type="checkbox" xpath="/tmp/@addAutoPk"/>
                    </container>
                    <leave>
                      <if expr="NodeName([.])='query' OR NodeName([.])='incremental' OR NodeName([.])='dbImport'">
                        <set expr="[/tmp/@noAutoPk]" xpath="@noAutoPk"/>
                        <set expr="[/tmp/@noAutoPkFilter]" xpath="@noAutoPkFilter"/>
                      </if>
                      <if expr="NodeName([.])='query'">
                        <set expr="[/tmp/@useSource]" xpath="@useSource"/>
                      </if>
                      <if expr="NodeName([.])='enrich' OR NodeName([.])='changeAxis'">
                        <set expr="[/tmp/@noAutoPkFilter]" xpath="@noAutoPkFilter"/>
                      </if>
                      <if expr="NodeName([.])='enrich'">
                        <set expr="[/tmp/@addAutoPk]" xpath="@addAutoPk"/>
                      </if>
                    </leave>
                  </form>
                </input>
                <input xpath="@keepAllExtraData"/>
              </container>
            </container>
            <input type="help" xpath="/tmp/selectCtrl/itn/@help"/>
          </container>
        </container>
        <container label="Properties" name="collection">
          <container name="contentDesc">
            <input alwaysActive="true" editable="false" img="xtk:xtklinkn.png" noEditCollection="true"
                   nolabel="true" processExprParams="true" type="customizeCondition"
                   xpath="conditionLink" xpathSchema="/tmp/selectCtrl/in/@schema"
                   xpathSelect="select/node" xpathStartPath="/tmp/selectCtrl/in/@startPath"
                   zoom="true">
              <input xpath="@label"/>
              <input label="Columns to create" xpath="@lineCount"/>
              <input xpath="where/@displayFilter"/>
              <input xpath="orderBy/@displayOrder"/>
              <input hidden="true" xpath="@schema"/>

              <form label="Filtering for a collection of personalization information"
                    type="wizard">
                <enter>
                  <set value="0" xpath="/tmp/@useOrderByValuesAsRank"/>
                  <if expr="@lineCount &gt; 1">
                    <if expr="@groupBy==1">
                      <set value="2" xpath="/tmp/@singleRow"/>
                      <set expr="@useOrderByValuesAsRank" xpath="/tmp/@useOrderByValuesAsRank"/>
                    </if>
                    <if expr="@groupBy!=1">
                      <set value="0" xpath="/tmp/@singleRow"/>
                    </if>
                  </if>
                  <if expr="@lineCount==1">
                    <if expr="@groupBy==0">
                      <set value="1" xpath="/tmp/@singleRow"/>
                    </if>
                    <if expr="@singleRow==0 AND @groupBy==0">
                      <set value="0" xpath="/tmp/@singleRow"/>
                    </if>
                    <if expr="@merge==1 AND @groupBy==0">
                      <set value="3" xpath="/tmp/@singleRow"/>
                    </if>
                    <if expr="@groupBy==1">
                      <set value="2" xpath="/tmp/@singleRow"/>
                      <set expr="@useOrderByValuesAsRank" xpath="/tmp/@useOrderByValuesAsRank"/>
                    </if>
                  </if>
                  <if expr="@lineCount==0">
                    <set value="-1" xpath="/tmp/@singleRow"/>
                  </if>
                  <if expr="SubString(@expr, 0, 13)!='Propositions(' AND $(BUILD_NUMBER)&gt;6797">
                    <set expr="wkfBuildTargetDataLink(@schema, [/ignored/@targetExtension])"
                         xpath="@schema"/>
                  </if>
                </enter>
                <container desc="Enter information used to specify which offer will be selected."
                           img="xtk:report/editor/insertColumnRight.png" name="offerParameters"
                           title="Selection parameters" visibleIf="SubString(@expr, 0, 13)='Propositions('">
                  <enter>
                    <set expr="IndexOf(@expr, ',')" xpath="/ignored/queryAdd/@firstComma"/>
                    <set expr="IndexOf(SubString(@expr, [/ignored/queryAdd/@firstComma]+1), ',')"
                         xpath="/ignored/queryAdd/@secondComma"/>
                    <set expr="IndexOf(SubString(@expr, [/ignored/queryAdd/@firstComma]+[/ignored/queryAdd/@secondComma]+2), ',')"
                         xpath="/ignored/queryAdd/@thirdComma"/>
                    <set expr="Iif( [/ignored/queryAdd/@thirdComma]!=-1, 'dynamic', 'forced')"
                         xpath="/tmp/queryAdd/@calcOffer"/>
                    <set expr="IndexOf(@expr, '#')" xpath="/ignored/queryAdd/@firstHash"/>
                    <set expr="IndexOf(SubString(@expr, [/ignored/queryAdd/@firstHash]+1), '#')"
                         xpath="/ignored/queryAdd/@secondHash"/>
                    <if expr="[/tmp/queryAdd/@calcOffer]='dynamic'">
                      <set expr="SubString(@expr, 13, [/ignored/queryAdd/@firstComma]-13)"
                           xpath="/tmp/queryAdd/@offerSpaceIdentifier"/>
                      <set expr="SubString(@expr, [/ignored/queryAdd/@firstComma]+2, [/ignored/queryAdd/@secondComma]-1)"
                           xpath="/tmp/queryAdd/@offerCategoryIdentifier"/>
                      <set expr="SubString(@expr, [/ignored/queryAdd/@firstComma]+[/ignored/queryAdd/@secondComma]+4, [/ignored/queryAdd/@firstHash]-7-[/ignored/queryAdd/@firstComma]-[/ignored/queryAdd/@secondComma])"
                           xpath="/tmp/queryAdd/@offerThemes"/>
                  <!-- query to retrieve the offer category info -->
                      <set value="nms:offerCategory" xpath="/ignored/queryDefCateg/@schema"/>
                      <set value="get" xpath="/ignored/queryDefCateg/@operation"/>
                      <set value="[.]" xpath="/ignored/queryDefCateg/select/node/@expr"/>
                      <set value="@offerCategory-cs" xpath="/ignored/queryDefCateg/select/node/@alias"/>
                      <set value="@id" xpath="/ignored/queryDefCateg/select/node[2]/@expr"/>
                      <set value="@offerCategory-id" xpath="/ignored/queryDefCateg/select/node[2]/@alias"/>
                      <set value="@name" xpath="/ignored/queryDefCateg/select/node[3]/@expr"/>
                      <set value="@offerCategory-name" xpath="/ignored/queryDefCateg/select/node[3]/@alias"/>
                      <set expr="Iif( IndexOf([/tmp/queryAdd/@offerCategoryIdentifier], '\'')==-1, '@id='+[/tmp/queryAdd/@offerCategoryIdentifier], '@name='+[/tmp/queryAdd/@offerCategoryIdentifier])"
                           xpath="/ignored/queryDefCateg/where/condition/@expr"/>
                      <soapCall name="ExecuteQuery" service="xtk:queryDef">
                        <param exprIn="[/ignored/queryDefCateg]" type="DOMDocument"/>
                        <param type="DOMDocument" xpathOut="/ignored/queryAddCateg"/>
                      </soapCall>
                      <set expr="[/ignored/queryAddCateg/@offerCategory-cs]" xpath="/tmp/queryAdd/@offerCategory-cs"/>
                      <set expr="[/ignored/queryAddCateg/@offerCategory-cs]" xpath="/tmp/queryAdd/offerCategory/@offerCategory-cs"/>
                      <set expr="[/ignored/queryAddCateg/@offerCategory-id]" xpath="/tmp/queryAdd/@offerCategory-id"/>
                      <set expr="[/ignored/queryAddCateg/@offerCategory-id]" xpath="/tmp/queryAdd/offerCategory/@id"/>
                      <set expr="[/ignored/queryAddCateg/@offerCategory-name]" xpath="/tmp/queryAdd/@offerCategory-name"/>
                    </if>
                    <if expr="[/tmp/queryAdd/@calcOffer]='forced'">
                      <set expr="SubString(@expr, 13, [/ignored/queryAdd/@firstComma]-13)"
                           xpath="/tmp/queryAdd/@offerIdentifier"/>
                      <set expr="SubString(@expr, [/ignored/queryAdd/@firstComma]+2, [/ignored/queryAdd/@secondComma]-1)"
                           xpath="/tmp/queryAdd/@offerSpaceIdentifier"/>
                  <!-- query to retrieve the offer info -->
                      <set value="nms:offer" xpath="/ignored/queryDefOffer/@schema"/>
                      <set value="get" xpath="/ignored/queryDefOffer/@operation"/>
                      <set value="[.]" xpath="/ignored/queryDefOffer/select/node/@expr"/>
                      <set value="@offer-cs" xpath="/ignored/queryDefOffer/select/node/@alias"/>
                      <set value="@id" xpath="/ignored/queryDefOffer/select/node[2]/@expr"/>
                      <set value="@offer-id" xpath="/ignored/queryDefOffer/select/node[2]/@alias"/>
                      <set value="@name" xpath="/ignored/queryDefOffer/select/node[3]/@expr"/>
                      <set value="@offer-name" xpath="/ignored/queryDefOffer/select/node[3]/@alias"/>
                      <set expr="Iif( IndexOf([/tmp/queryAdd/@offerIdentifier], '\'')==-1, '@id='+[/tmp/queryAdd/@offerIdentifier], '@name='+[/tmp/queryAdd/@offerIdentifier])"
                           xpath="/ignored/queryDefOffer/where/condition/@expr"/>
                      <soapCall name="ExecuteQuery" service="xtk:queryDef">
                        <param exprIn="[/ignored/queryDefOffer]" type="DOMDocument"/>
                        <param type="DOMDocument" xpathOut="/ignored/queryAddOffer"/>
                      </soapCall>
                      <set expr="[/ignored/queryAddOffer/@offer-cs]" xpath="/tmp/queryAdd/@offer-cs"/>
                      <set expr="[/ignored/queryAddOffer/@offer-id]" xpath="/tmp/queryAdd/@offer-id"/>
                      <set expr="[/ignored/queryAddOffer/@offer-id]" xpath="/tmp/queryAdd/offer/@id"/>
                      <set expr="[/ignored/queryAddOffer/@offer-name]" xpath="/tmp/queryAdd/offer/@name"/>
                    </if>
                <!-- query to retrieve the offer space info -->
                    <if expr="IndexOf([/tmp/queryAdd/@offerSpaceIdentifier], '\'')!=-1">
                      <set expr="SubString([/tmp/queryAdd/@offerSpaceIdentifier], 1, IndexOf([/tmp/queryAdd/@offerSpaceIdentifier], ':')-1)"
                           xpath="/tmp/queryAdd/@offerEnv-name"/>
                      <set expr="SubString([/tmp/queryAdd/@offerSpaceIdentifier], IndexOf([/tmp/queryAdd/@offerSpaceIdentifier], ':')+1)"
                           xpath="/tmp/queryAdd/@offerSpace-name"/>
                      <set expr="SubString([/tmp/queryAdd/@offerSpace-name], 0, StrLen([/tmp/queryAdd/@offerSpace-name])-1)"
                           xpath="/tmp/queryAdd/@offerSpace-name"/>
                    </if>
                    <set value="nms:offerSpace" xpath="/ignored/queryDefSpace/@schema"/>
                    <set value="get" xpath="/ignored/queryDefSpace/@operation"/>
                    <set value="[.]" xpath="/ignored/queryDefSpace/select/node/@expr"/>
                    <set value="@offerSpace-cs" xpath="/ignored/queryDefSpace/select/node/@alias"/>
                    <set value="[@env-id]" xpath="/ignored/queryDefSpace/select/node[2]/@expr"/>
                    <set value="[@channel]" xpath="/ignored/queryDefSpace/select/node[3]/@expr"/>
                    <set value="'\'nms:offerView\''" xpath="/ignored/queryDefSpace/select/node[4]/@expr"/>
                    <set value="@id" xpath="/ignored/queryDefSpace/select/node[5]/@expr"/>
                    <set value="@name" xpath="/ignored/queryDefSpace/select/node[6]/@expr"/>
                    <set value="[env/@name]" xpath="/ignored/queryDefSpace/select/node[7]/@expr"/>
                    <set value="@env-name" xpath="/ignored/queryDefSpace/select/node[7]/@alias"/>
                    <set expr="Iif(IndexOf([/tmp/queryAdd/@offerSpaceIdentifier], '\'')==-1 , '@id='+[/tmp/queryAdd/@offerSpaceIdentifier], '@name=\'' + [/tmp/queryAdd/@offerSpace-name] + '\' AND [env/@name]=\'' + [/tmp/queryAdd/@offerEnv-name] + '\'')"
                         xpath="/ignored/queryDefSpace/where/condition/@expr"/>
                    <soapCall name="ExecuteQuery" service="xtk:queryDef">
                      <param exprIn="[/ignored/queryDefSpace]" type="DOMDocument"/>
                      <param type="DOMDocument" xpathOut="/ignored/queryAddSpace"/>
                    </soapCall>
                    <set expr="[/ignored/queryAddSpace/@offerSpace-cs]" xpath="/tmp/queryAdd/@offerSpace-cs"/>
                    <set expr="[/ignored/queryAddSpace/@env-id]" xpath="/tmp/queryAdd/@env-id"/>
                    <set expr="[/ignored/queryAddSpace/@env-id]" xpath="/tmp/queryAdd/env/@id"/>
                    <set expr="[/ignored/queryAddSpace/@env-name]" xpath="/tmp/queryAdd/@offerEnv-name"/>
                    <set expr="[/ignored/queryAddSpace/@id]" xpath="/tmp/queryAdd/@offerSpace-id"/>
                    <set expr="[/ignored/queryAddSpace/@id]" xpath="/tmp/queryAdd/offerSpace/@id"/>
                    <set expr="[/ignored/queryAddSpace/@name]" xpath="/tmp/queryAdd/@offerSpace-name"/>
                    <set expr="[/ignored/queryAddSpace/@channel]" xpath="/tmp/queryAdd/@channel"/>
                    <set value="nms:offerView" xpath="/tmp/queryAdd/@outputSchema"/>
                    <set expr="SubString(@expr, [/ignored/queryAdd/@firstHash]+1, [/ignored/queryAdd/@secondHash])"
                         xpath="/tmp/queryAdd/@contactDate"/>
                    <set expr="@lineCount" xpath="/tmp/queryAdd/@offerCount"/>
                  </enter>
                  <container maxLabelWidth="200" type="visibleGroup" visibleIf="[/tmp/queryAdd/@calcOffer]='dynamic'"
                             xpath="/tmp/queryAdd">
                    <input computeStringAlias="@offerSpace-cs" createMode="none"
                           img="nms:offerSpace.png" label="Space" notifyPathList="@name|@offerSpace-name,@_cs|@offerSpace-cs,env/@propositionSchema|@propositionSchema,@outputSchema|@outputSchema,@channel|@channel,@env-id|@env-id,env/@name|@offerEnv-name,@defaultCategory-id|/tmp/@defaultCategoryId,defaultCategory/@label|/tmp/@defaultCategoryCs,@defaultThemes|/tmp/@defaultThemes"
                           required="true" schema="nms:offerSpace" type="linkEdit"
                           xpath="@offerSpace-id">
                      <enter name="onChange">
                        <set expr="[/tmp/@defaultCategoryId]" xpath="/tmp/defaultCategory/@id"/>
                        <set expr="[/tmp/@defaultCategoryCs]" xpath="/tmp/defaultCategory/@_cs"/>
                        <set expr="[/tmp/@defaultCategoryId]" xpath="/tmp/defaultCategory"/>
                        <set expr="[/tmp/@defaultThemes]" xpath="@offerThemes"/>
                      </enter>
                      <sysFilter>
                        <condition expr="[env/@live]=true"/>
                      </sysFilter>
                    </input>
                    <input computeStringAlias="@offerCategory-cs" img="nms:offerCategory.png"
                           label="Category" notifyPathList="@_cs|@offerCategory-cs"
                           schema="nms:offerCategory" type="linkEdit" xpath="offerCategory"
                           xpathRefresh="/tmp/defaultCategory">
                      <sysFilter>
                        <condition expr="@model = 'nmsOfferCategory' or @model = 'nmsOfferEnv'"/>
                        <condition expr="[@env-id]=$long(/tmp/queryAdd/@env-id)"/>
                      </sysFilter>
                    </input>
                    <input label="Themes" xpath="@offerThemes"/>
                    <input label="Contact date" type="datetime" xpath="@contactDate"/>
                    <input label="Number of offers to keep" type="number" xpath="@offerCount"/>
                  </container>
                  <container type="visibleGroup" visibleIf="[/tmp/queryAdd/@calcOffer]='forced'"
                             xpath="/tmp/queryAdd">
                    <input computeStringAlias="@offerSpace-cs" createMode="none"
                           img="nms:offerSpace.png" label="Space" notifyPathList="@name|@offerSpace-name,@_cs|@offerSpace-cs,env/@propositionSchema|@propositionSchema,@outputSchema|@outputSchema,@channel|@channel,@env-id|@env-id,env/@name|@offerEnv-name"
                           required="true" schema="nms:offerSpace" type="linkEdit"
                           xpath="@offerSpace-id">
                      <sysFilter>
                        <condition expr="[env/@live]=true"/>
                      </sysFilter>
                    </input>
                    <input computeStringAlias="@offer-cs" img="nms:offer.png" label="Offer"
                           notifyPathList="@name|@offer-name,@_cs|@offer-cs" schema="nms:offer"
                           type="linkEdit" xpath="@offer-id">
                      <sysFilter>
                        <condition expr="@status = 6"/>
                        <condition expr="[category/@env-id]=$long(/tmp/queryAdd/@env-id)"/>
                      </sysFilter>
                    </input>
                    <input label="Contact date" type="datetime" xpath="@contactDate"/>
                  </container>
                  <leave>
                <!-- query to retrieve the offer category info -->
                    <if expr="[/tmp/queryAdd/offerCategory]!=[/tmp/queryAdd/offerCategory/@id]">
                      <set value="nms:offerCategory" xpath="/ignored/queryDefCategCheck/@schema"/>
                      <set value="get" xpath="/ignored/queryDefCategCheck/@operation"/>
                      <set value="[.]" xpath="/ignored/queryDefCategCheck/select/node/@expr"/>
                      <set value="@id" xpath="/ignored/queryDefCategCheck/select/node[2]/@expr"/>
                      <set value="@name" xpath="/ignored/queryDefCategCheck/select/node[3]/@expr"/>
                      <set expr="'@id='+[/tmp/queryAdd/offerCategory]" xpath="/ignored/queryDefCategCheck/where/condition/@expr"/>
                      <soapCall name="ExecuteQuery" service="xtk:queryDef">
                        <param exprIn="[/ignored/queryDefCategCheck]" type="DOMDocument"/>
                        <param type="DOMDocument" xpathOut="/ignored/queryAddCateg"/>
                      </soapCall>
                      <set expr="[/ignored/queryAddCateg/@name]" xpath="/tmp/queryAdd/@offerCategory-name"/>
                    </if>
                    <if expr="[/tmp/queryAdd/@calcOffer]='dynamic'">
                      <set expr="'Propositions(\'' + [/tmp/queryAdd/@offerEnv-name] + ':' + [/tmp/queryAdd/@offerSpace-name] + '\', \'' + [/tmp/queryAdd/@offerCategory-name] + '\', \'' + [/tmp/queryAdd/@offerThemes]+ '\', #' + [/tmp/queryAdd/@contactDate] + '#)'"
                           xpath="@expr"/>
                    </if>
                    <if expr="[/tmp/queryAdd/@calcOffer]='forced'">
                      <set expr="'Propositions(\'' + [/tmp/queryAdd/@offer-name] + '\', \'' + [/tmp/queryAdd/@offerEnv-name] + ':' + [/tmp/queryAdd/@offerSpace-name] + '\', #' + [/tmp/queryAdd/@contactDate]+ '#)'"
                           xpath="@expr"/>
                      <set expr="[/tmp/queryAdd/@offer-id]" xpathExpr="'../select/node[@alias=&quot;' + @alias + '&quot;]/node[@alias=&quot;@offer-id&quot;]/@expr'"/>
                    </if>
                    <set expr="[/tmp/queryAdd/@offerSpace-id]" xpathExpr="'../select/node[@alias=&quot;' + @alias + '&quot;]/node[@alias=&quot;@offerSpace-id&quot;]/@expr'"/>
                    <set expr="[/tmp/queryAdd/@channel]" xpathExpr="'../select/node[@alias=&quot;' + @alias + '&quot;]/node[@alias=&quot;@channel&quot;]/@expr'"/>
                    <set expr="'\'nms:offerView\''" xpathExpr="'../select/node[@alias=&quot;' + @alias + '&quot;]/node[@alias=&quot;@offerViewSchema&quot;]/@expr'"/>
                    <set expr="[/tmp/queryAdd/@offerCount]" xpath="@lineCount"/>
                    <set expr="[/tmp/queryAdd/@offerCount]=1" xpath="@singleRow"/>
                    <if expr="[/tmp/queryAdd/@offerCount]&gt;1">
                      <reset xpath="where"/>
                      <set value="@rank" xpath="orderBy/node/@expr"/>
                    </if>
                    <if expr="[/tmp/queryAdd/@offerCount]=1">
                      <reset xpath="orderBy"/>
                      <set value="@rank=1" xpath="where/condition[@internalId='1']/@expr"/>
                    </if>
                  </leave>
                </container>
                <container desc="Enter information for identifying the join between the work table and the external data."
                           name="dataParameters" title="Join parameters" visibleIf="SubString(@expr, 0, 13)!='Propositions(' AND NodeValue('../extension/schema[@extendedSchema=&quot;' + [/tmp/selectCtrl/in/@schema] + '&quot;]/element/element[@name=&quot;' + @xpath + '&quot;]/@target')!=''">
                  <enter>
                    <set expr="NodeValue('../extension/schema[@extendedSchema=&quot;' + [/tmp/selectCtrl/in/@schema] + '&quot;]/element/element[@name=&quot;' + @xpath + '&quot;]/@target')"
                         xpath="/tmp/queryAddData/@linkSchema"/>
                    <set expr="[/tmp/selectCtrl/in/@schema]" xpath="/tmp/queryAddData/@targetSchema"/>
                    <copyElement exprSrc="'../extension/schema[@extendedSchema=&quot;' + [/tmp/selectCtrl/in/@schema] + '&quot;]/element/element[@name=&quot;' + @xpath + '&quot;]'"
                                 xpathDst="/tmp/queryAddData/element"/>
                    <set expr="Iif(NodeCount([/tmp/queryAddData/element/condition])&gt;0, 1, 0)"
                         xpath="/tmp/queryAddData/@advancedJoin"/>
                    <set expr="wkfAddLinkDefToSchema([/tmp/queryAddData/@targetSchema], 'joinTarget', [/ignored/@advancedJoinLinkLabel], Iif( [/tmp/queryAddData/@advancedJoin]==1, [/tmp/queryAddData/@linkSchema], ''))"
                         xpath="/tmp/queryAddData/@targetSchema"/>
                  </enter>
                  <input label="Schema" readOnly="true" type="schemaEdit" xpath="/tmp/queryAddData/@linkSchema"/>
                  <input checkedValue="0" label="Use a simple join" nolabel="false"
                         type="radioButton" xpath="/tmp/queryAddData/@advancedJoin"/>
                  <input checkedValue="1" label="Advanced join conditions" nolabel="false"
                         type="radioButton" xpath="/tmp/queryAddData/@advancedJoin"/>
                  <input expr="wkfAddLinkDefToSchema([/tmp/queryAddData/@targetSchema], 'joinTarget', [/ignored/@advancedJoinLinkLabel], Iif( [/tmp/queryAddData/@advancedJoin]==1, [/tmp/queryAddData/@linkSchema], ''))"
                         type="expr" xpath="/tmp/queryAddData/@targetSchema"/>
                  <container type="visibleGroup" visibleIf="[/tmp/queryAddData/@advancedJoin]!=1">
                    <static label=" " nolabel="false" type="help">Select below the source and target fields that will be matched to build the join condition.</static>
                    <input label=" " toolbarCaption="Join conditions" type="list"
                           xpath="/tmp/queryAddData/element/join">
                      <input label="Remote field" type="pathEdit" xpath="@xpath-dst"
                             xpathSchema="/tmp/queryAddData/@linkSchema"/>
                      <input label="Local field" type="pathEdit" xpath="@xpath-src"
                             xpathSchema="/tmp/queryAddData/@targetSchema"/>
                    </input>
                  </container>
                  <container type="visibleGroup" visibleIf="[/tmp/queryAddData/@advancedJoin]==1">
                    <static label=" " nolabel="false" type="help">Select below the relationship conditions between source and target records. The 'joinTarget (Dynamic link)' link enables you to reference target fields to define joins.</static>
                    <input label=" " name="filterList" noSaveFilter="true" toolbarAlign="horizontal"
                           toolbarCaption="Join conditions" type="conditionList"
                           xpath="/tmp/queryAddData/element" xpathCurrentLookupPath="/lookupPath/where"
                           xpathSchema="/tmp/queryAddData/@targetSchema">
                      <input colSize="15" label=" " xpath="/@bool-operator"/>
                      <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                      <input colSize="15" label="Operator" xpath="/@operator"/>
                      <input colSize="30" label="Value" xpath="/@rightExpr"/>
                    </input>
                  </container>
                  <leave>
                    <copyElement exprDst="'../extension/schema[@extendedSchema=&quot;' + [/tmp/selectCtrl/in/@schema] + '&quot;]/element/element[@name=&quot;' + @xpath + '&quot;]'"
                                 xpathSrc="/tmp/queryAddData/element"/>
                    <setModified/>
                  </leave>
                </container>
                <container desc="Enter information used to specify how many collection elements you want to keep."
                           img="xtk:report/editor/insertColumnRight.png" name="parameters"
                           title="General parameters" visibleIf="SubString(@expr, 0, 13)!='Propositions('">
                  <input enum="xtk:queryDef:rowConditionType" label="Data collected"
                         type="sysEnum" xpath="/tmp/@singleRow"/>

                  <container backcolor="tooltip" type="visibleGroup" visibleIf="[/tmp/@singleRow]==1">
                    <static type="warning">This mode optimizes the generated SQL query thanks to a direct join on the collection elements. \nWarning: if the initial condition isn't complied with, the result may be false (missing lines or duplicates).</static>
                  </container>

                  <container type="visibleGroup" visibleIf="[/tmp/@singleRow]==0 OR [/tmp/@singleRow]==2">
                    <input xpath="@lineCount"/>
                  </container>
                  <container type="visibleGroup" visibleIf="[/tmp/@singleRow]==2 AND @lineCount &gt; 1">
                    <input label="Group aggregates based on the values in the sort columns"
                           type="checkBox" xpath="/tmp/@useOrderByValuesAsRank"/>
                    <static type="help">E.g.: In case of an aggregate calculation with a grouping on the last 5 years: - if the option is checked, aggregates will be calculated for the same 5 years for the entire population - if the option isn't checked, aggregates will be calculated for the last 5 years for each element of the population.</static>
                  </container>
                  <leave>
                    <if expr="[/tmp/@singleRow]==0">
                      <set value="0" xpath="@singleRow"/>
                      <set value="0" xpath="@groupBy"/>
                    </if>
                    <if expr="[/tmp/@singleRow]==1">
                      <set value="1" xpath="@singleRow"/>
                      <set value="0" xpath="@groupBy"/>
                      <set value="1" xpath="@lineCount"/>
                    </if>
                    <if expr="[/tmp/@singleRow]==2">
                      <set value="1" xpath="@singleRow"/>
                      <set value="1" xpath="@groupBy"/>
                      <set expr="[/tmp/@useOrderByValuesAsRank]" xpath="@useOrderByValuesAsRank"/>
                    </if>
                    <if expr="[/tmp/@singleRow]==3">
                      <set value="0" xpath="@singleRow"/>
                      <set value="1" xpath="@merge"/>
                      <set value="1" xpath="@lineCount"/>
                    </if>
                    <if expr="[/tmp/@singleRow]==-1">
                      <set value="0" xpath="@lineCount"/>
                    </if>
                  </leave>
                </container>
                <container desc="Enter the filtering condition used to specify which collection elements you want to keep."
                           img="xtk:filter32.png" name="where" title="Filter" visibleIf="@lineCount&gt;0 AND SubString(@expr, 0, 13)!='Propositions('">
                  <container buildQueryXPath="." ref="xtk:queryDef:where"/>
                </container>
                <container desc="Specify the sort order used to indicates which lines to keep, when there are more lines eligible than specified previously."
                           img="xtk:filter32.png" name="orderBy" title="Sort" visibleIf="(@singleRow==0 OR @singleRow==2) AND @lineCount&gt;0 AND SubString(@expr, 0, 13)!='Propositions('">
                  <container type="visibleGroup" visibleIf="[/tmp/@useOrderByValuesAsRank]">
                    <input editable="false" name="sortList" nolabel="true" toolbarCaption="Sort columns"
                           type="orderByList" xpath="orderBy/node" xpathChoiceTarget="@expr"
                           xpathCurrentLookupPath="/lookupPath/orderBy" xpathHelp="/@help"
                           zoom="false">
                      <input colSize="20" label="Label" xpath="@label"/>
                      <input colSize="35" editable="true" label="Expression" type="pathedit"
                             xpath="@expr" xpathSchema="../../@schema"/>
                      <input colSize="15" editable="true" label="Descending sort"
                             type="checkbox" xpath="@sortDesc"/>
                      <input colSize="15" editable="true" label="Identifier" type="edit"
                             xpath="@alias"/>
                    </input>
                    <input fontBold="true" lineCount="4" noBorder="true" nolabel="true"
                           readOnly="true" type="edit" xpath="/@help"/>
                  </container>
                  <container type="visibleGroup" visibleIf="![/tmp/@useOrderByValuesAsRank]">
                    <input editable="false" name="sortList" nolabel="true" toolbarCaption="Sort columns"
                           type="orderByList" xpath="orderBy/node" xpathChoiceTarget="@expr"
                           xpathCurrentLookupPath="/lookupPath/orderBy" xpathHelp="/@help"
                           zoom="false">
                      <input colSize="20" label="Label" xpath="@label"/>
                      <input colSize="35" editable="true" label="Expression" type="pathedit"
                             xpath="@expr" xpathSchema="../../@schema"/>
                      <input colSize="15" editable="true" label="Descending sort"
                             type="checkbox" xpath="@sortDesc"/>
                    </input>
                    <input fontBold="true" lineCount="4" noBorder="true" nolabel="true"
                           readOnly="true" type="edit" xpath="/@help"/>
                  </container>
                </container>
              </form>
            </input>
          </container>
        </container>
        <container label="Reconciliation &amp;&amp; deduplication" name="reconc">
          <input editable="false" nolabel="true" toolbarCaption="List of references searched for"
                 type="list" xpath="reconc" xpathToIgnore="reconc/condition" zoom="true"
                 zoomOnAdd="true">
            <input editable="true" label="Identifier" xpath="@name"/>
            <input editable="true" label="Description" xpath="@label"/>
            <input label="Destination" xpath="@schema"/>
            <form label="Link definition" name="reconcDetail">
              <enter>
                <set expr="Iif(Substring(@schema, 0, 4)=='temp', 1, 0)" xpath="/tmp/@useTempSchema"/>
                <set expr="Iif(NodeCount([join/condition])==0 AND NodeCount(keys)==0, 0, Iif(NodeCount(keys)==0, 1, 2))"
                     xpath="/tmp/@advancedJoin"/>
              </enter>
              <static label="Description" type="separator"/>
              <input xpath="@name"/>
              <input xpath="@label"/>
              <static label="Definition" type="separator"/>
              <container>
                <input checkedValue="0" label="Database schema" type="RadioButton"
                       xpath="/tmp/@useTempSchema"/>
                <input checkedValue="1" label="Temporary schema" type="RadioButton"
                       xpath="/tmp/@useTempSchema"/>
              </container>
              <container type="visibleGroup" visibleIf="[/tmp/@useTempSchema]==0">
                <input schema="xtk:schema" type="schemaEdit" xpath="@schema"/>
              </container>
              <container type="visibleGroup" visibleIf="[/tmp/@useTempSchema]==1">
                <input label="Schema" type="ExclusionMainSetEdit" xpath="@srcDataSet"
                       xpathActivityName="../@name"/>
                <input expr="wkfSchemaName(@srcDataSet)" type="expr" xpath="@schema"/>
              </container>
              <input expr="wkfAddLinkDefToSchema([/tmp/selectCtrl/in/@schema], 'joinTarget', [/ignored/@advancedJoinLinkLabel], Iif( [/tmp/@advancedJoin]!=0, @schema, ''))"
                     type="expr" xpath="/ignored/@advancedJoinReconcSchema">
                <enter>
                  <if expr="[/tmp/@advancedJoin]!='' AND [/tmp/@advancedJoin]!=1 AND NodeCount([join/condition])&gt;0">
                    <msgBox translatedExpr="'Do you want to delete the advanced join conditions?'"
                            type="yesno" xpathOut="/tmp/@eraseAdvancedJoin"/>
                    <if expr="[/tmp/@eraseAdvancedJoin]='yes'">
                      <reset xpath="join/condition[*]"/>
                      <refresh xpath="join"/>
                    </if>
                    <if expr="[/tmp/@eraseAdvancedJoin]='no'">
                      <set value="1" xpath="/tmp/@advancedJoin"/>
                    </if>
                  </if>
                  <if expr="[/tmp/@advancedJoin]!='' AND [/tmp/@advancedJoin]!=0 AND NodeCount([condition])&gt;0">
                    <msgBox translatedExpr="'Do you want to delete the join conditions?'"
                            type="yesno" xpathOut="/tmp/@eraseAdvancedJoin"/>
                    <if expr="[/tmp/@eraseAdvancedJoin]='yes'">
                      <reset xpath="condition[*]"/>
                    </if>
                    <if expr="[/tmp/@eraseAdvancedJoin]='no'">
                      <set value="0" xpath="/tmp/@advancedJoin"/>
                    </if>
                  </if>
                </enter>
              </input>
              <static label="Join conditions" type="separator"/>
              <input checkedValue="0" label="Use a simple join" nolabel="false" type="radioButton"
                     xpath="/tmp/@advancedJoin"/>
              <input checkedValue="1" label="Advanced join conditions" nolabel="false"
                     type="radioButton" xpath="/tmp/@advancedJoin"/>
              <input checkedValue="2" label="Reconciliation rules" nolabel="false"
                     type="radioButton" xpath="/tmp/@advancedJoin"/>
              <container type="visibleGroup" visibleIf="[/tmp/@advancedJoin]==0">
                <static label=" " nolabel="false" type="help">Select below the source and target fields that will be matched to build the join condition.</static>
                <input label=" " toolbarCaption="Join conditions" type="list" xpath="condition">
                  <input type="pathEdit" xpath="@srcExpr" xpathSchema="/tmp/selectCtrl/in/@schema"/>
                  <input choiceType="export" hideMappedAsXml="true" type="pathEdit"
                         xpath="@dstExpr" xpathSchema="../@schema"/>
                </input>
              </container>
              <container type="visibleGroup" visibleIf="[/tmp/@advancedJoin]==1">
                <static label=" " nolabel="false" type="help">Select below the relationship conditions between source and target records. The 'joinTarget (Dynamic link)' link enables you to reference target fields to define joins.</static>
                <input label=" " name="filterList" noSaveFilter="true" toolbarAlign="horizontal"
                       toolbarCaption="Join conditions" type="conditionList" xpath="join"
                       xpathCurrentLookupPath="/lookupPath/where" xpathSchema="/tmp/selectCtrl/in/@schema">
                  <input colSize="15" label=" " xpath="/@bool-operator"/>
                  <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                  <input colSize="15" label="Operator" xpath="/@operator"/>
                  <input colSize="30" label="Value" xpath="/@rightExpr"/>
                </input>
              </container>
              <container colspan="2" type="visibleGroup" visibleIf="[/tmp/@advancedJoin]=2">
                <static label=" " nolabel="false" type="help">Select the conditions for reconciling source and target records below. When reconciliation criteria aren't reliable enough, you can refine reconciliation using proximity scores. The 'joinTarget (Dynamic link)' link lets you reference the fields of the target to define the join.</static>
                <container label=" " nolabel="false" style="down" type="notebook">
                  <container label="Identification">
                    <input editable="false" nolabel="true" prebuildSubForm="false"
                           toolbarCaption="Reconciliations" type="list" xpath="keys"
                           xpathToIgnore="keys/scoreRule" zoom="true" zoomOnAdd="true">
                      <input editable="true" xpath="@active"/>
                      <input editable="true" expr="Iif(@label!='', @label, [join/@displayFilter])"
                             label="Identification conditions" xpath="@label"/>
                      <input expr="Iif(@scoresApplied!='none', @minScore, '')" label="Required score"/>
                      <input expr="Iif(@scoresApplied=='all', [/ignored/@allLabel], Iif(@scoresApplied=='select', GroupConcat(scoreRule, &quot; '[' + @name + ']' &quot; ), ''))"
                             label="Scores taken into account"/>
                      <form title="Reconciliation rule" type="wizard">
                        <enter>
                          <set expr="Iif(@scoresApplied=='none' OR @scoresApplied=='', 0, 1)"
                               xpath="/tmp/@ruleReconcWithScore"/>
                          <set expr="Iif(@scoresApplied!='select', 0, 1)" xpath="/tmp/@ruleReconcRuleSel"/>
                        </enter>
                        <container desc="Specify below the conditions for identifying the target record"
                                   title="Join conditions">
                          <input label="label" xpath="@label"/>
                          <input label=" " name="filterList" noSaveFilter="true"
                                 nolabel="true" toolbarAlign="horizontal" toolbarCaption="Reconciliation conditions"
                                 type="conditionList" xpath="join" xpathCurrentLookupPath="/lookupPath/where"
                                 xpathHelp="join/@displayFilter" xpathSchema="/tmp/selectCtrl/in/@schema">
                            <input colSize="15" label=" " xpath="/@bool-operator"/>
                            <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                            <input colSize="15" label="Operator" xpath="/@operator"/>
                            <input colSize="30" label="Value" xpath="/@rightExpr"/>
                          </input>
                          <input checkedValue="1" label="Refine reconciliation using proximity scores"
                                 nolabel="true" type="checkBox" unCheckedValue="0"
                                 xpath="/tmp/@ruleReconcWithScore"/>
                        </container>
                        <container desc="Select below the proximity scores to be taken into account to refine reconciliation, then define the reconciliation approval threshold."
                                   title="Proximity scores" visibleIf="[/tmp/@ruleReconcWithScore]=1">
                          <enter>
                            <reset xpath="/tmp/ruleReconcSel"/>
                            <copyElement list="true" xpathDst="/tmp/ruleReconcSel/rules"
                                         xpathSrc="../scoreRule"/>
                            <forEach xpath="scoreRule">
                              <set value="1" xpathExpr="'/tmp/ruleReconcSel/rules/scoreRule[@name=\''+@name+'\']/@sel'"/>
                            </forEach>
                          </enter>
                          <input checkedValue="0" label="All calculation rules" nolabel="true"
                                 type="radioButton" xpath="/tmp/@ruleReconcRuleSel"/>
                          <input checkedValue="1" label="A selection of rules" nolabel="true"
                                 type="radioButton" xpath="/tmp/@ruleReconcRuleSel"/>
                          <container enabledIf="[/tmp/@ruleReconcRuleSel]==1" type="enabledGroup">
                            <input noToolbar="true" nolabel="true" type="list" xpath="/tmp/ruleReconcSel/rules/scoreRule">
                              <input colSize="10" label="Selected" type="checkBox"
                                     xpath="@sel"/>
                              <input label="Proximity score" xpath="@name"/>
                              <input label="Score" xpath="@score"/>
                            </input>
                          </container>
                          <static type="help">Specify below the minimum proximity score required to approve reconciliation.</static>
                          <input label="Minimum score" type="number" xpath="@minScore"/>
                        </container>
                        <leave>
                          <set expr="Iif([/tmp/@ruleReconcWithScore]==0, 'none', IIf([/tmp/@ruleReconcRuleSel]==0, 'all', 'select'))"
                               xpath="@scoresApplied"/>
                          <if expr="[/tmp/@ruleReconcRuleSel]==1 AND [/tmp/@ruleReconcWithScore]==1">
                            <reset xpath="scoreRule[*]"/>
                            <copyElement filter="@sel=1" list="true" xpathDst="."
                                         xpathSrc="/tmp/ruleReconcSel/rules/scoreRule"/>
                          </if>
                        </leave>
                      </form>
                    </input>
                  </container>
                  <container label="Proximity scores">
                    <input editable="false" nolabel="true" prebuildSubForm="false"
                           toolbarCaption="Calculation rules of the proximity score"
                           type="list" xpath="scoreRule" zoom="true" zoomOnAdd="true">
                      <input editable="true" xpath="@active"/>
                      <input label="Name" xpath="@name"/>
                      <input label="Score" xpath="@score"/>
                      <input label="Condition" xpath="join/@displayFilter"/>
                      <form colcount="2" label="Proximity score">
                        <input label="Name" xpath="@name"/>
                        <input label="Score" type="number" xpath="@score"/>
                        <input colspan="2" name="filterList" noSaveFilter="true"
                               nolabel="true" toolbarAlign="horizontal" toolbarCaption="Conditions for triggering score adding"
                               type="conditionList" xpath="join" xpathCurrentLookupPath="/lookupPath/where"
                               xpathHelp="join/@displayFilter" xpathSchema="/tmp/selectCtrl/in/@schema">
                          <input colSize="15" label=" " xpath="/@bool-operator"/>
                          <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                          <input colSize="15" label="Operator" xpath="/@operator"/>
                          <input colSize="30" label="Value" xpath="/@rightExpr"/>
                        </input>
                      </form>
                    </input>
                  </container>
                </container>
              </container>
              <input img="xtk:properties.png" label="Advanced parameters..." nolabel="false"
                     type="subFormLink" xpath=".">
                <form label="Link definition: advanced parameters">
                  <enter>
                    <set expr="Iif(@singleRow==0, Iif(NodeCount([orderBy/node])=0, 1, 2), 0)"
                         xpath="/tmp/@linkDedup"/>
                    <set expr="wkfBuildTargetDataLink(@schema, [/tmp/selectCtrl/in/@schema])"
                         xpath="/tmp/@linkDedupSchema"/>
                  </enter>
                  <static label="Link handling" type="separator"/>
                  <static label="The expression below lets you limit the records for which a link will be calculated"
                          type="help"/>
                  <input type="pathEdit" xpath="@enabledIf" xpathSchema="/tmp/selectCtrl/in/@schema"/>
                  <input xpath="@allowEmptyPart"/>
                  <static label="Deduplication" type="separator"/>
                  <input checkedValue="1" label="Choose for me from those that match a filter"
                         type="radioButton" xpath="/tmp/@linkDedup"/>
                  <container type="visibleGroup" visibleIf="[/tmp/@linkDedup]=1">
                    <container type="visibleGroup" visibleIf="NodeCount([where/condition])=0">
                      <input label="Add a filter for target records..." nolabel="false"
                             type="subformLink" xpath=".">
                        <form label="Link target filter">
                          <input name="filterList" noSaveFilter="true" nolabel="true"
                                 toolbarAlign="horizontal" toolbarCaption="Filter conditions"
                                 type="conditionList" xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                                 xpathHelp="where/@displayFilter" xpathSchema="@schema">
                            <input colSize="15" label=" " xpath="/@bool-operator"/>
                            <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                            <input colSize="15" label="Operator" xpath="/@operator"/>
                            <input colSize="30" label="Value" xpath="/@rightExpr"/>
                          </input>
                        </form>
                      </input>
                    </container>
                    <container type="visibleGroup" visibleIf="NodeCount([where/condition])&gt;0">
                      <input label="Edit the filter..." nolabel="false" type="subformLink"
                             xpath=".">
                        <form label="Link target filter">
                          <input name="filterList" noSaveFilter="true" nolabel="true"
                                 toolbarAlign="horizontal" toolbarCaption="Filter conditions"
                                 type="conditionList" xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                                 xpathHelp="where/@displayFilter" xpathSchema="@schema">
                            <input colSize="15" label=" " xpath="/@bool-operator"/>
                            <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                            <input colSize="15" label="Operator" xpath="/@operator"/>
                            <input colSize="30" label="Value" xpath="/@rightExpr"/>
                          </input>
                        </form>
                      </input>
                      <input label=" " lineCount="4" xpath="where/@displayFilter"/>
                    </container>
                  </container>
                  <input checkedValue="0" label="Do not deduplicate linked records (Expert mode - only one record matches the criteria)"
                         type="radioButton" xpath="/tmp/@linkDedup"/>
                  <container type="visibleGroup" visibleIf="[/tmp/@linkDedup]=0">
                    <container type="visibleGroup" visibleIf="NodeCount([where/condition])=0">
                      <input label="Add a filter for target records..." nolabel="false"
                             type="subformLink" xpath=".">
                        <form label="Link target filter">
                          <input name="filterList" noSaveFilter="true" nolabel="true"
                                 toolbarAlign="horizontal" toolbarCaption="Filter conditions"
                                 type="conditionList" xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                                 xpathHelp="where/@displayFilter" xpathSchema="@schema">
                            <input colSize="15" label=" " xpath="/@bool-operator"/>
                            <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                            <input colSize="15" label="Operator" xpath="/@operator"/>
                            <input colSize="30" label="Value" xpath="/@rightExpr"/>
                          </input>
                        </form>
                      </input>
                    </container>
                    <container type="visibleGroup" visibleIf="NodeCount([where/condition])&gt;0">
                      <input label="Edit the filter..." nolabel="false" type="subformLink"
                             xpath=".">
                        <form label="Link target filter">
                          <input name="filterList" noSaveFilter="true" nolabel="true"
                                 toolbarAlign="horizontal" toolbarCaption="Filter conditions"
                                 type="conditionList" xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                                 xpathHelp="where/@displayFilter" xpathSchema="@schema">
                            <input colSize="15" label=" " xpath="/@bool-operator"/>
                            <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                            <input colSize="15" label="Operator" xpath="/@operator"/>
                            <input colSize="30" label="Value" xpath="/@rightExpr"/>
                          </input>
                        </form>
                      </input>
                      <input label=" " lineCount="4" xpath="where/@displayFilter"/>
                    </container>
                  </container>
                  <input checkedValue="2" label="Specify the selection and deduplication conditions of records"
                         type="radioButton" xpath="/tmp/@linkDedup"/>
                  <container type="visibleGroup" visibleIf="[/tmp/@linkDedup]=2">
                    <container style="flat" type="notebook">
                      <container label="Filter">
                        <input name="filterList" noSaveFilter="true" nolabel="true"
                               toolbarAlign="horizontal" toolbarCaption="Filter conditions"
                               type="conditionList" xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                               xpathSchema="@schema">
                          <input colSize="15" label=" " xpath="/@bool-operator"/>
                          <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                          <input colSize="15" label="Operator" xpath="/@operator"/>
                          <input colSize="30" label="Value" xpath="/@rightExpr"/>
                        </input>
                      </container>
                      <container label="Sort">
                        <input editable="false" name="sortList" nolabel="true" toolbarCaption="Sort columns"
                               type="orderByList" xpath="orderBy/node" xpathChoiceTarget="@expr"
                               xpathCurrentLookupPath="/lookupPath/orderBy" xpathHelp="/@help"
                               xpathSchema="@schema" zoom="false">
                          <input colSize="20" label="Label" xpath="@label"/>
                          <input choiceType="sortAggregate" colSize="35" editable="true"
                                 label="Expression" type="pathedit" xpath="@expr"
                                 xpathSchema="../../@schema"/>
                          <input colSize="15" editable="true" label="Descending sort"
                                 type="checkbox" xpath="@sortDesc"/>
                        </input>
                      </container>
                    </container>
                  </container>
                  <container type="visibleGroup" visibleIf="[/tmp/@advancedJoin]==2">
                    <input nolabel="true" xpath="@flattenTree"/>
                    <static type="help">When using several reconciliation rules, records can be reconciled two by two without a main record being identified. Checking the box above will automatically select a record to be used as a reference for all records reconciled two by two.</static>
                  </container>
                  <leave>
                    <set expr="Iif([/tmp/@linkDedup]&gt;0, 0, 1)" xpath="@singleRow"/>
                  </leave>
                </form>
              </input>
              <leave>
                <set expr="wkfAddLinkDefToSchema([/tmp/selectCtrl/in/@schema], 'joinTarget', [/ignored/@advancedJoinLinkLabel], '')"
                     xpath="/ignored/@advancedJoinReconcSchema"/>
              </leave>
            </form>
          </input>
        </container>
        <container label="Simple join" name="links">
          <input editable="false" nolabel="true" toolbarCaption="List of links" type="list"
                 xpath="links" xpathToIgnore="links/condition" zoom="true" zoomOnAdd="true">
            <input editable="true" label="Identifier" xpath="@name"/>
            <input editable="true" label="Description" xpath="@label"/>
            <input label="Destination" xpath="@schema"/>
            <input editable="true" label="Cardinality" xpath="@cardinality"/>
            <form label="Link definition" name="reconcDetail">
              <enter>
                <set expr="Iif(Substring(@schema, 0, 4)=='temp', Iif(NodeValue('../extension/schema[@name=\''+Substring(@schema, 5)+'\']/element/@sqltable')!='', 2, 1), 0)"
                     xpath="/tmp/@useTempSchema"/>
                <set expr="Iif(NodeCount([join/condition])==0, 0, 1)" xpath="/tmp/@advancedJoin"/>
              </enter>
              <static label="Description" type="separator"/>
              <input xpath="@name"/>
              <input xpath="@label"/>
              <static label="Definition" type="separator"/>
              <container type="visibleGroup" visibleIf="[/tmp/@useTempSchema]!=2">
                <input checkedValue="0" label="Database schema" type="RadioButton"
                       xpath="/tmp/@useTempSchema"/>
                <input checkedValue="1" label="Temporary schema" type="RadioButton"
                       xpath="/tmp/@useTempSchema"/>
              </container>
              <container type="visibleGroup" visibleIf="[/tmp/@useTempSchema]==0">
                <input schema="xtk:schema" type="schemaEdit" xpath="@schema"/>
              </container>
              <container type="visibleGroup" visibleIf="[/tmp/@useTempSchema]==1">
                <input label="Schema" type="ExclusionMainSetEdit" xpath="@srcDataSet"
                       xpathActivityName="../@name"/>
                <input expr="wkfSchemaName(@srcDataSet)" type="expr" xpath="@schema"/>
              </container>
              <container type="visibleGroup" visibleIf="[/tmp/@useTempSchema]==2">
                <input readOnly="true" schema="xtk:schema" type="schemaEdit" xpath="@schema"/>
              </container>
              <static label="Join conditions" type="separator"/>
              <input expr="wkfAddLinkDefToSchema([/tmp/selectCtrl/in/@schema], 'joinTarget', [/ignored/@advancedJoinLinkLabel], Iif( [/tmp/@advancedJoin]==1, @schema, ''))"
                     type="expr" xpath="/ignored/@advancedJoinLinksSchema">
                <enter>
                  <if expr="[/tmp/@advancedJoin]!='' AND [/tmp/@advancedJoin]!=1 AND NodeCount([join/condition])&gt;0">
                    <msgBox translatedExpr="'Do you want to delete the advanced join conditions?'"
                            type="yesno" xpathOut="/tmp/@eraseAdvancedJoin"/>
                    <if expr="[/tmp/@eraseAdvancedJoin]='yes'">
                      <reset xpath="join/condition[*]"/>
                      <refresh xpath="join"/>
                    </if>
                    <if expr="[/tmp/@eraseAdvancedJoin]='no'">
                      <set value="1" xpath="/tmp/@advancedJoin"/>
                    </if>
                  </if>
                  <if expr="[/tmp/@advancedJoin]!='' AND [/tmp/@advancedJoin]!=0 AND NodeCount([condition])&gt;0">
                    <msgBox translatedExpr="'Do you want to delete the join conditions?'"
                            type="yesno" xpathOut="/tmp/@eraseAdvancedJoin"/>
                    <if expr="[/tmp/@eraseAdvancedJoin]='yes'">
                      <reset xpath="condition[*]"/>
                    </if>
                    <if expr="[/tmp/@eraseAdvancedJoin]='no'">
                      <set value="0" xpath="/tmp/@advancedJoin"/>
                    </if>
                  </if>
                </enter>
              </input>
              <input checkedValue="0" label="Use a simple join" nolabel="false" type="radioButton"
                     xpath="/tmp/@advancedJoin"/>
              <input checkedValue="1" label="Advanced join conditions" nolabel="false"
                     type="radioButton" xpath="/tmp/@advancedJoin"/>
              <container type="visibleGroup" visibleIf="[/tmp/@advancedJoin]!=1">
                <static label=" " nolabel="false" type="help">Select below the source and target fields that will be matched to build the join condition.</static>
                <input label=" " toolbarCaption="Join conditions" type="list" xpath="condition">
                  <input type="pathEdit" xpath="@srcExpr" xpathSchema="/tmp/selectCtrl/in/@schema"/>
                  <input type="pathEdit" xpath="@dstExpr" xpathSchema="../@schema"/>
                </input>
              </container>
              <container type="visibleGroup" visibleIf="[/tmp/@advancedJoin]==1">
                <static label=" " nolabel="false" type="help">Select below the relationship conditions between source and target records. The 'joinTarget (Dynamic link)' link enables you to reference target fields to define joins.</static>
                <input label=" " name="filterList" noSaveFilter="true" toolbarAlign="horizontal"
                       toolbarCaption="Join conditions" type="conditionList" xpath="join"
                       xpathCurrentLookupPath="/lookupPath/where" xpathSchema="/tmp/selectCtrl/in/@schema">
                  <input colSize="15" label=" " xpath="/@bool-operator"/>
                  <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                  <input colSize="15" label="Operator" xpath="/@operator"/>
                  <input colSize="30" label="Value" xpath="/@rightExpr"/>
                </input>
              </container>
              <static label="Cardinality" type="separator"/>
              <container>
                <input checkedValue="0" label="Type 1N collection link" type="radioButton"
                       xpath="@cardinality"/>
                <input checkedValue="1" label="Type 11 simple link" type="radioButton"
                       xpath="@cardinality"/>
                <input checkedValue="2" label="Type 11 simple link which may have a non-existent target"
                       type="radioButton" xpath="@cardinality"/>
              </container>
              <container type="visibleGroup" visibleIf="@cardinality=1 OR @cardinality=2">
                <static type="warning">Defining a 1-1 cardinality link can have a negative impact on future joins.</static>
              </container>
              <leave>
                <set expr="0" xpath="/tmp/@useTempSchema"/>
                <set expr="wkfAddLinkDefToSchema([/tmp/selectCtrl/in/@schema], 'joinTarget', [/ignored/@advancedJoinLinkLabel], '')"
                     xpath="/ignored/@advancedJoinLinksSchema"/>
              </leave>
            </form>
          </input>
        </container>
      </container>
    </container>
<!--[cf]-->
<!--[of]:Sub Forms-->
    <container name="subforms" xpath=".">
<!--[of]:zoomTask-->
<!--[c]Form displayed when using the "Display log" command from the contextual menu-->
<!--[c]of an activity.-->
<!--[c]-->
      <form label="Journal" name="zoomTask">

        <input enumImage="@logType" hideEditButtons="true" img="xtk:logs.png" nolabel="true"
               refresh="true" toolbarCaption="Messages in the journal of the selected activity"
               type="linkList" xpath="log" xpathRefresh="/ignored/@selectedActivity">

          <sysFilter>
            <condition enabledIf="$(/ignored/@selectedActivity) !='' " expr="@activity = $(/ignored/@selectedActivity)"/>
          </sysFilter>

          <input xpath="@logDate"/>
          <input xpath="@message"/>
          <orderBy>
            <node expr="@logDate" sortDesc="true"/>
          </orderBy>
        </input>

      </form>
<!--[cf]-->
<!--[of]:Transitions-->
<!--[of]:timeout-->
      <form label="Expiration" name="timeout" type="notebook">

        <container ref="xtk:workflow:lib/tabs/timeoutTransitionPage"/>
        <container ref="xtk:workflow:lib/tabs/schemaTransitionPage"/>
      </form>
<!--[cf]-->
<!--[of]:extractOutput-->
      <form label="Transition" name="extractOutput" type="notebook">
        <enter>
          <set expr="wkfTargetSchema([../../@name], @name, 1)" xpath="/ignored/@transitionSchema"/>
          <set expr="iif(SubString([@schema],0,4)!='temp', @schema, 'temp:workflow:'+[../../../../@id]+'_'+[../../@name]+'_'+[@name])"
               xpath="/ignored/@querySchemaExec"/>
        </enter>
        <container ref="xtk:workflow:lib/tabs/filterTransitionPage"/>
        <container ref="xtk:workflow:lib/tabs/advancedExtractOutputPage"/>
        <container ref="xtk:workflow:lib/tabs/schemaTransitionPage"/>
      </form>
<!--[cf]-->
<!--[of]:result and remainder-->
      <form label="Result" name="resultContainer" type="notebook">
        <container colcount="2" img="xtk:properties.png" label="General" name="tabGeneral">
          <input xpath="@label"/>
          <input xpath="@name"/>
          <input xpath="@code"/>
          <input xpath="@target"/>
          <input colspan="2" xpath="@enabled"/>
          <input colspan="2" xpath="comment"/>
        </container>

        <container ref="xtk:workflow:lib/tabs/schemaTransitionPage"/>
      </form>

      <form label="Result" name="result" type="notebook">
        <enter>
          <set expr="wkfTargetSchema([../../@name], @name, 1)" xpath="/ignored/@transitionSchema"/>
        </enter>
        <container ref="xtk:workflow:lib/subforms/resultContainer/tabGeneral"/>
        <container ref="xtk:workflow:lib/tabs/schemaTransitionPage"/>
      </form>
      <form label="Result" name="remainder" type="notebook">
        <enter>
          <set expr="wkfTargetSchema([../../@name], '', 2)" xpath="/ignored/@transitionSchema"/>
        </enter>
        <container ref="xtk:workflow:lib/subforms/resultContainer/tabGeneral"/>
        <container ref="xtk:workflow:lib/tabs/schemaTransitionPage"/>
      </form>
<!--[cf]-->
<!--[of]:test-->
<!--[c]Conditional transition for jstest activity-->
<!--[c]-->
      <form label="Transition" name="test" type="notebook">

        <enter>
          <set expr="wkfTargetSchema([../../@name],@name,1)" xpath="/ignored/@transitionSchema"/>
        </enter>

        <container img="xtk:properties.png" label="General">

          <input xpath="@label"/>

          <static label="Condition" type="separator"/>
          <input nolabel="true" xpath="condition">
            <container>
              <input menuId="workflowMenuBuilder" options="notJst" type="customizeBtn"
                     xpath="/ignored/customizeBtnOut"/>
            </container>
          </input>

          <static label="Comment" type="separator"/>
          <input nolabel="true" xpath="comment"/>

        </container>

        <container ref="xtk:workflow:lib/tabs/advancedTransitionPage"/>
        <container ref="xtk:workflow:lib/tabs/schemaTransitionPage"/>

      </form>
<!--[cf]-->
<!--[of]:others-->
      <form label="Transition" name="transitionBase" type="notebook">
        <enter>
          <set expr="wkfTargetSchema([../../@name],@name,1)" xpath="/ignored/@transitionSchema"/>
        </enter>
        <container colcount="2" img="xtk:properties.png" label="General">
          <input xpath="@label"/>
          <input xpath="@name"/>
          <input xpath="@enabled"/>
          <input xpath="@target"/>
          <input colspan="2" xpath="comment"/>
        </container>

        <container ref="xtk:workflow:lib/tabs/schemaTransitionPage"/>
      </form>

      <form label="View population" name="transitionExtensions" nothingToEdit="true"
            nothingToSave="true">
        <enter>
          <set expr="wkfTargetSchema([../../@name], @name, 1)" xpath="/ignored/@schema"/>
          <set value="" xpath="/ignored/@tmpDataPreviewError"/>
        </enter>

        <container type="notebook">
          <container img="xtk:sql.png" label="Data">
            <container type="visibleGroup" visibleIf="[/ignored/@tmpDataPreviewError]!=''">
              <static fontBold="true" label=" " nolabel="true">Unable to read data from the base, the table has been purged or the current workflow configuration is no longer compatible with its structure.</static>
              <input img="xtk:logwarn.png" label="Display errors during data loading..."
                     prebuildSubForm="false" type="subFormLink">
                <form label="Detail of errors during data loading" nothingToEdit="true"
                      nothingToSave="true">
                  <input lineCount="7" nolabel="true" readOnly="true" xpath="/ignored/@tmpDataPreviewError"/>
                </form>
              </input>
            </container>
            <input name="resultPreviewQuery" nolabel="true" propagateXPathToCtx="/ignored/@querySchemaExec|/@querySchemaExec"
                   serialize="false" srvTempSchemaExpr="'temp:workflow:'+[../../../../@id]+'_'+[../../@name]+'_'+[@name]"
                   toolbarCaption="Records of the target" type="tmpDataPreviewList"
                   xpath="/ignored/transitionExtensions/@tableName" xpathError="/ignored/@tmpDataPreviewError"
                   xpathHelp="/ignored/selectCtrl/itn/@help1" xpathSchemaName="/ignored/transitionExtensions/@targetSchema"
                   xpathTargetDataSource="/ignored/transitionExtensions/@targetDataSource"/>
             <!--  1st expression expected to be workflow id, and 2nd one activity name.-->

            <input type="help" xpath="/ignored/selectCtrl/itn/@help1"/>
          </container>
          <container img="xtk:schema.png" label="Schema">
            <input type="schemaview" xpath="/ignored/transitionExtensions/@targetSchema"
                   xpathHelp="/ignored/selectCtrl/itn/@help2" xpathTableName="/ignored/transitionExtensions/@tableName"
                   xpathTargetDataSource="/ignored/transitionExtensions/@targetDataSource"/>
            <input type="help" xpath="/ignored/selectCtrl/itn/@help2"/>
          </container>
        </container>


      </form>

      <form name="transition" ref="xtk:workflow:lib/subforms/transitionBase"/>
      <form name="done" ref="xtk:workflow:lib/subforms/transitionBase"/>
      <form name="error" ref="xtk:workflow:lib/subforms/transitionBase"/>
      <form name="initial" ref="xtk:workflow:lib/subforms/transitionBase"/>
      <form name="default" ref="xtk:workflow:lib/subforms/transitionBase"/>
      <form name="refused" ref="xtk:workflow:lib/subforms/transitionBase"/>
      <form name="validated" ref="xtk:workflow:lib/subforms/transitionBase"/>

<!-- File transfer -->
      <form name="fileExists" ref="xtk:workflow:lib/subforms/transitionBase"/>
      <form name="fileDoesNotExist" ref="xtk:workflow:lib/subforms/transitionBase"/>
      <form name="noFile" ref="xtk:workflow:lib/subforms/transitionBase"/>
      <form name="noMail" ref="xtk:workflow:lib/subforms/transitionBase"/>
<!--[cf]-->
<!--[cf]-->
<!--[of]:Activities-->
<!--[of]:Core-->
<!--[of]:start-->
      <form name="start" type="notebook">
        <container img="xtk:miniatures/mini-start.png">
          <input xpath="@label"/>
        </container>
        <container ref="xtk:workflow:lib/tabs/lightActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:end-->
      <form name="end" type="notebook">
        <container img="xtk:miniatures/mini-end.png">
          <input xpath="@label"/>
          <input xpath="@stop"/>
        </container>
        <container ref="xtk:workflow:lib/tabs/lightActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:fork-->
      <form name="fork" type="notebook">
        <container img="xtk:miniatures/mini-fork.png">
          <input xpath="@label"/>
          <input label="Transitions" type="list" xpath="transitions/transition" zoom="true">
            <form name="trans">
              <input xpath="@name"/>
              <input xpath="@label"/>
            </form>
            <input xpath="@name"/>
            <input xpath="@label"/>
          </input>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:andjoin-->
      <form name="andjoin" type="notebook">
        <container img="xtk:miniatures/mini-start.png">
          <input xpath="@label"/>
          <input type="ExclusionMainSetEdit" xpath="@mainSet"/>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:schedule-->
      <form name="schedule" type="notebook">
        <container img="xtk:miniatures/mini-clock.png">
          <input xpath="@label"/>
          <container img="nms:calendar-large.png" label="Execution schedule" type="frame">
            <input type="scheduler" xpath="period"/>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/timeoutsActivityPage"/>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:wait-->
      <form name="wait" type="notebook">
        <container img="xtk:miniatures/mini-hourglass.png">
          <input xpath="@label"/>
          <input xpath="@delay"/>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:timefilter-->
      <form name="timefilter" type="notebook">
        <container img="xtk:miniatures/mini-hourglass.png">
          <input xpath="@label"/>
          <input xpath="@runnableStart"/>
          <input xpath="@runnableEnd"/>
          <input xpath="@retryLater"/>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:subworkflow-->
      <form name="subworkflow" type="notebook">
        <enter>
          <set expr="wkfBuildOutput(@name)" xpath="/ignored/@subWkfStops"/>
        </enter>
        <container img="xtk:miniatures/mini-workflowjob.png">
          <input xpath="@label"/>
          <input createMode="none" img="xtk:miniatures/mini-workflowjob.png" xpath="workflow"/>
          <input expr="wkfBuildOutput(Iif([@workflow-id]=0, @name, @name))" type="expr"
                 xpath="/ignored/@subWkfStops"/>
          <static label="Configuration script" type="separator"/>
          <input nolabel="true" xpath="startScript">
            <container>
              <input menuId="wfSubWorkflowMenuBuilder" options="notJst" type="customizeBtn"
                     xpath="/ignored/customizeBtnOut"/>
            </container>
          </input>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:jumpin-->
      <form name="jumpin" type="notebook">
        <container img="xtk:miniatures/mini-jump-1.png">
          <input xpath="@label"/>
          <input xpath="@number"/>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:jumpout-->
      <form name="jumpout" type="notebook">
        <container img="xtk:miniatures/mini-jump-2.png">
          <input xpath="@label"/>
          <input xpath="@number"/>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:signal-->
      <form name="signal" type="notebook">
        <container img="xtk:miniatures/mini-signal.png">
          <input xpath="@label"/>
        </container>
        <container ref="xtk:workflow:lib/tabs/timeoutsActivityPage"/>
        <container ref="xtk:workflow:lib/tabs/lightActivityPage"/>
      </form>
<!--[cf]-->
<!--[cf]-->
<!--[of]:Xtk-->
<!--[of]:extern-->
      <form name="extern" type="notebook">
        <container img="xtk:miniatures/mini-shell.png">
          <input xpath="@label"/>
          <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@command"/>
          <input type="JstEdit" xpath="additionnalArgs">
            <container>
              <input menuId="workflowMenuBuilder" type="customizeBtn" xpath="/ignored/customizeBtnOut"/>
            </container>
          </input>
          <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@workingDirectory"/>
          <input xpath="@wait"/>
          <input label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:jstest-->
      <form name="jstest" type="notebook">
        <container img="xtk:miniatures/mini-condition.png">
          <input xpath="@label"/>

          <static label="Conditional forks" type="separator"/>
          <input label="Conditions" type="list" xpath="transitions/test">
            <input xpath="@label"/>
            <input menuId="workflowMenuBuilder" noBorder="true" options="notJst"
                   type="scriptEdit" xpath="condition"/>
          </input>

          <static label="Default branching" type="separator"/>
          <input label="Use default connection" xpath="transitions/default/@enabled"/>
          <container type="visibleGroup" visibleIf="[transitions/default/@enabled]">
            <input label="Label" xpath="transitions/default/@label"/>
          </container>
          <static type="help">The default choice creates a transition which is activated if none of the above conditions is satisfied.</static>

        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:js-->
      <form name="js" type="notebook">
        <container img="xtk:miniatures/mini-script.png">
          <input xpath="@label"/>
          <input label="Stop execution after" xpath="maxExecTime"/>
          <input xpath="script">
            <container>
              <input menuId="workflowMenuBuilder" options="notJst" type="customizeBtn"
                     xpath="/ignored/customizeBtnOut"/>
            </container>
          </input>
          <input label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:jsx-->
      <form name="jsx" type="notebook">
        <container img="xtk:miniatures/mini-script.png">
          <input xpath="@label"/>
          <input label="Stop execution after" xpath="maxExecTime"/>
          <container type="hpaned">
            <container>
              <input xpath="call">
                <container>
                  <input menuId="workflowMenuBuilder" options="notJst" type="customizeBtn"
                         xpath="/ignored/customizeBtnOut"/>
                </container>
              </input>
            </container>
            <container>
              <input xpath="recall">
                <container>
                  <input menuId="workflowMenuBuilder" options="notJst" type="customizeBtn"
                         xpath="/ignored/customizeBtnOut"/>
                </container>
              </input>
            </container>
          </container>

          <container colspan="2" toolbarCaption="Transitions" type="notebookList"
                     xpath="transitions/transition" xpath-label="@label">
            <container colcount="2">
              <input xpath="@label"/>
              <input xpath="@name"/>
            </container>
          </container>

        </container>

        <container img="xtk:miniatures/mini-clock.png" label="Schedule">
          <container img="nms:calendar-large.png" label="Execution schedule" type="frame">
            <input type="scheduler" xpath="period"/>
          </container>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:slackAlert-->
      <form label="Template Configuration" name="slackAlert" type="notebook">
        <enter>
          <if expr="![@extAccount-id]">
            <set value="0" xpath="@mode"/>
          </if>
        </enter>
        <container img="nms:miniatures/mini-page.png">
          <input nolabel="true" xpath="@label"/>

          <container label="Slack routing" type="frame">

            <input img="nms:extAccount.png" noAutoComplete="true" xpath="extAccount">
              <sysFilter>
                <condition expr="@messageType = 0 and @type=5"/>
              </sysFilter>
            </input>
          </container>

          <static label="Template mode" type="separator"/>
          <input checkedValue="0" label="Specified explicitly" type="RadioButton"
                 xpath="@mode"/>
          <input checkedValue="1" label="New, created from a template" type="RadioButton"
                 xpath="@mode"/>

          <container type="visibleGroup" visibleIf="@mode==1">
            <input img="xtk:form/script.png" noAutoComplete="true" xpath="slackTemplate">
              <sysFilter>
                <condition expr="@namespace = 'slack'"/>
              </sysFilter>
            </input>
          </container>

          <container type="visibleGroup" visibleIf="@mode==0">
            <input fullToolbar="true" nolabel="true" xpath="script">
              <container>
                <input menuId="workflowMenuBuilder" type="customizeBtn" xpath="/ignored/customizeBtnOut"/>
              </container>
            </input>
          </container>

          <static type="help">Tip: click menu icon to insert enrichment tags &lt;= instance.example &gt;</static>

          <input label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <check expr="[@extAccount-id]!=0">
            <error>You must specify Slack account</error>
          </check>
          <if expr="@mode=1">
            <check expr="[@slackTemplate-name]!=''">
              <error>You must specify JSON template</error>
            </check>
          </if>
          <set expr="'nms:extAccount:'+[extAccount/@name]" xpath="extAccount/@name"/>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:sql-->
      <form name="sql" type="notebook">
        <container img="xtk:miniatures/mini-execsql.png">
          <input xpath="@label"/>
          <input useDesc="true" xpath="@useEntity"/>
          <container applicableIf="HasPackage('xxl:fullfdaCommon')" type="visibleGroup"
                     visibleIf="HasPackage('xxl:fullfdaCommon')">
            <container label="Data source" type="frame">
              <input checkedValue="0" label="Use default data source" type="RadioButton"
                     xpath="@useDataSource"/>
              <input checkedValue="1" label="Use data source extracted from inbound schema."
                     type="RadioButton" xpath="@useDataSource"/>
              <input checkedValue="2" label="V7 compatibility mode." type="RadioButton"
                     xpath="@useDataSource"/>
            </container>
          </container>
          <container type="visibleGroup" visibleIf="@useEntity">
            <input img="xtk:sql.png" noPropagateImg="true" xpath="sql"/>
          </container>
          <container type="visibleGroup" visibleIf="!@useEntity">
            <input contentType="sql" type="JstEdit" xpath="script">
              <container>
                <input menuId="workflowMenuBuilder" type="customizeBtn" xpath="/ignored/customizeBtnOut"/>
              </container>
            </input>
          </container>
          <input label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:sqlDM-->
      <form name="sqlDM" type="notebook">
        <container img="xtk:miniatures/mini-execsql.png">
          <input xpath="@label"/>
          <input img="nms:extAccount.png" label="External account" noAutoComplete="true"
                 xpath="extAccount">
            <sysFilter>
              <condition expr="@type = 7"/>
            </sysFilter>
          </input>
          <input label="Outbound schema" type="targetSchema" xpath="@schema">
            <form entity-schema="xtk:schema" label="Please select an outbound schema"
                  name="entitySchema" namespace="xtk" nothingToSave="true">
              <input monoSelection="true" notifyFolderKeyPath="" schema="xtk:schema"
                     type="linkListChoice" xpath=".">
                <input alias="@_cs" expr="[.]"/>
                <input xpath="[.]"/>
                <input xpath="@namespace"/>
                <input xpath="@name"/>
                <orderBy>
                  <node expr="@label"/>
                </orderBy>
              </input>
            </form>
          </input>
          <input useDesc="true" xpath="@autoCreate"/>
          <input useDesc="true" xpath="@useEntity"/>
          <container type="visibleGroup" visibleIf="@useEntity">
            <input img="xtk:sql.png" noPropagateImg="true" xpath="sql"/>
          </container>
          <container type="visibleGroup" visibleIf="!@useEntity">
            <input contentType="sql" type="JstEdit" xpath="script">
              <container>
                <input menuId="workflowMenuBuilder" type="customizeBtn" xpath="/ignored/customizeBtnOut"/>
              </container>
            </input>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <check expr="[@extAccount-id]!=0">
            <error>You must specify the data source.</error>
          </check>
          <set expr="'nms:extAccount:'+[extAccount/@name]" xpath="extAccount/@name"/>
          <check expr="@schema != ''">
            <error>You must specify the outbound schema.</error>
          </check>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:multiscript-->
      <form name="multiscript" type="notebook">
        <container img="xtk:miniatures/mini-multiscript.png">
          <input xpath="@label"/>
          <input xpath="@language"/>
          <container type="visibleGroup" visibleIf="@language='other'">
            <input xpath="@command"/>
          </container>
          <input contentType="text" xpath="script">
            <container>
              <input menuId="workflowMenuBuilder" type="customizeBtn" xpath="/ignored/customizeBtnOut"/>
            </container>
          </input>
          <input label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:directorywatcher-->
      <form name="directorywatcher" type="notebook">

        <container img="xtk:miniatures/mini-txt.png" label="Directory">
          <input xpath="@label"/>
          <container label="Downloading files" type="frame">
            <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@directory"/>
            <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@pattern"/>
            <input useDesc="true" xpath="@stopAfterFirst"/>
          </container>

          <input img="xtk:import.png" label="File historization settings..." nolabel="false"
                 type="subFormLink" xpath=".">
            <form name="fileHistory" ref="xtk:workflow:lib/tabs/fileHistory"/>
          </input>

          <input label="Process missing file" xpath="transitions/noFile/@enabled"/>
          <input label="Process errors" xpath="transitions/error/@enabled"/>
        </container>

        <container img="xtk:miniatures/mini-clock.png" label="Schedule" name="planningActivityPage">
          <input nolabel="true" xpath="@usePeriod"/>
          <container type="visibleGroup" visibleIf="@usePeriod">
            <container img="nms:calendar-large.png" label="Execution schedule" type="frame">
              <input type="scheduler" xpath="period"/>
            </container>
          </container>
        </container>

        <container ref="xtk:workflow:lib/tabs/timeoutsActivityPage"/>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>

      </form>
<!--[cf]-->
<!--[of]:nlmodule-->
      <form name="nlmodule" type="notebook">
        <container img="xtk:miniatures/mini-exec.png">
          <input xpath="@label"/>
          <input contentType="sql" type="JstEdit" xpath="params">
            <container>
              <input menuId="workflowMenuBuilder" type="customizeBtn" xpath="/ignored/customizeBtnOut"/>
            </container>
          </input>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:import-->
      <form name="import" type="notebook">

        <container img="xtk:miniatures/mini-import.png">
          <input xpath="@label"/>
          <input form="xtk:import" img="xtk:import.png" xpath="model">
            <sysFilter>
              <condition expr="@isModel = 1 and @jobType = 'import'"/>
            </sysFilter>
          </input>
          <container label="File to import" type="frame">
            <input checkedValue="0" label="Specified in the transition" type="RadioButton"
                   xpath="@importType"/>
            <input checkedValue="1" label="Explicit" type="RadioButton" xpath="@importType"/>
            <container type="visibleGroup" visibleIf="@importType=1">
              <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@file"/>
            </container>
          </container>
          <input label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
        </container>

        <container img="xtk:script.png" label="Script">
          <static type="help">Import modification script</static>
          <input nolabel="true" xpath="script">
            <container>
              <input menuId="wfImportMenuBuilder" options="notJst" type="customizeBtn"
                     xpath="/ignored/customizeBtnOut"/>
            </container>
          </input>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>

      </form>
<!--[cf]-->
<!--[of]:export-->
      <form name="export" type="notebook">

        <container img="xtk:miniatures/mini-export.png">
          <input xpath="@label"/>
          <container label="Export" type="frame">
            <input checkedValue="0" label="Specified in the transition" type="RadioButton"
                   xpath="@exportSel"/>
            <input checkedValue="1" label="Explicit" type="RadioButton" xpath="@exportSel"/>
            <input checkedValue="2" label="Calculated by a script" type="RadioButton"
                   xpath="@exportSel"/>
            <input checkedValue="3" label="New, created from a template" type="RadioButton"
                   xpath="@exportSel"/>
            <input checkedValue="4" label="Specified in the activity" type="RadioButton"
                   xpath="@exportSel"/>
            <container type="visibleGroup" visibleIf="@exportSel=1">
              <input createMode="none" enumImage="@status" folderFilterChoice="@model = 'xtkJobInstance'"
                     form="xtk:export" img="xtk:miniatures/mini-export.png" noAutoComplete="true"
                     xpath="export">
                <sysFilter>
                  <condition expr="@isModel = 0"/>
                </sysFilter>
                <orderBy>
                  <node expr="@lastModified" sortDesc="true"/>
                </orderBy>
              </input>
            </container>
            <container type="visibleGroup" visibleIf="@exportSel=2">
              <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="exportIdScript"/>
            </container>
            <container type="visibleGroup" visibleIf="@exportSel=3">
              <input form="xtk:export" img="xtk:export.png" newEntityFormChoice="true"
                     xpath="model">
                <sysFilter>
                  <condition expr="@isModel = 1 and @jobType = 'export'"/>
                </sysFilter>
              </input>

              <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@file"/>
            </container>
            <container type="visibleGroup" visibleIf="@exportSel=4">
              <input img="xtk:miniatures/mini-export.png" label="Edit the file format..."
                     nolabel="false" prebuildSubForm="false" type="subFormLink" xpath=".">
                <form img="xtk:export32.png" label="Extraction file format" type="wizard">
                  <enter>
              <!-- make sure targetData/x and offerView/y can be declared -->
                    <set value="" xpath="/tmp/@schemaChoice"/>
                    <set expr="wkfTargetSchema(@name)" xpath="extraction/source/@schema"/>
              <!-- set input parameters for selectCtrl -->
                    <set expr="[extraction/source/@schema]" xpath="/tmp/selectCtrl/in/@schema"/>
                    <set value="export" xpath="/tmp/selectCtrl/in/@choiceType"/>
                  </enter>

                  <container ref="xtk:exportSource:column" xpath="extraction"/>
                  <container ref="xtk:exportSource:conditionLink" visibleIf="[extraction/source/conditionLink/@xpath]!=''"
                             xpath="extraction"/>
                  <container ref="xtk:exportSource:sort" xpath="extraction"/>
                  <container ref="xtk:exportSource:destInfo" xpath="extraction"/>
                  <container ref="xtk:exportSource:mapping" xpath="extraction"/>
                </form>
              </input>
              <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@file"/>
            </container>
          </container>

          <container type="visibleGroup" visibleIf="@exportSel!=4">
            <container label="Content to export" type="frame">
              <input checkedValue="0" label="Specified in the export wizard" type="RadioButton"
                     xpath="@targetSel"/>
              <input checkedValue="1" label="Specified by the inbound event" type="RadioButton"
                     xpath="@targetSel"/>
            </container>
          </container>

          <input label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
        </container>

        <container img="xtk:script.png" label="Script">
          <static type="help">Export modification script</static>
          <input nolabel="true" xpath="script">
            <container>
              <input menuId="wfExportMenuBuilder" options="notJst" type="customizeBtn"
                     xpath="/ignored/customizeBtnOut"/>
            </container>
          </input>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <set expr="Iif(@exportSel=4, 1, @targetSel)" xpath="@targetSel"/>
        </leave>
      </form>


<!--[cf]-->
<!--[of]:fileTransfer-->
      <form name="fileTransfer" type="notebook">
  <!-- File transfer tab -->
        <enter>
          <if expr="[@extAccount-id]!=0">
            <set value="nms:extAccount" xpath="/ignored/queryDefExtAcc/@schema"/>
            <set value="get" xpath="/ignored/queryDefExtAcc/@operation"/>
            <set value="[.]" xpath="/ignored/queryDefExtAcc/select/node[1]/@expr"/>
            <set value="@id" xpath="/ignored/queryDefExtAcc/select/node[2]/@expr"/>
            <set value="@type" xpath="/ignored/queryDefExtAcc/select/node[3]/@expr"/>
            <set expr="'@id='+[@extAccount-id]" xpath="/ignored/queryDefExtAcc/where/condition/@expr"/>
            <soapCall name="ExecuteQuery" service="xtk:queryDef">
              <param exprIn="[/ignored/queryDefExtAcc]" type="DOMDocument"/>
              <param type="DOMDocument" xpathOut="extAccount"/>
            </soapCall>
          </if>
          <if expr="[@extAccount-id]=0">
            <reset xpath="extAccount"/>
          </if>
        </enter>

        <container img="nms:miniatures/mini-ftp.png">
          <input xpath="@label"/>
          <input xpath="@action"/>

          <container type="visibleGroup" visibleIf="EV([@action], 'upload')">
            <container label="Source" type="frame">
              <input xpath="@useIncomingFile"/>
              <container type="visibleGroup" visibleIf="@useIncomingFile == false">
                <container label="Files" nolabel="false" toolbarAlign="horizontal"
                           type="notebookList" xpath="localFile" zoom="false" zoomOnAdd="false">
                  <container>
                    <input editable="true" label="Source" menuId="workflowMenuBuilder"
                           type="scriptEdit" xpath="@path"/>
                  </container>
                </container>
              </container>
            </container>
          </container>

          <container label="Remote server" type="frame">
            <input xpath="@useExtAccount"/>

            <container type="visibleGroup" visibleIf="[@useExtAccount]">
              <input img="nms:extAccount.png" noAutoComplete="true" notifyPathList="@type"
                     xpath="extAccount">
                <sysFilter>
                  <condition expr="@type IN (4, 14, 15, 16, 17)"/>
                </sysFilter>
              </input>
              <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@filePath"/>
            </container>

            <container type="visibleGroup" visibleIf="[@useExtAccount] == false">
              <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@url"/>
            </container>
          </container>

    <!-- Advanced settings -->
          <container type="visibleGroup" visibleIf="EV([@action], 'upload')">
            <input xpath="@archiveFiles"/>
          </container>
          <input img="xtk:import.png" label="File historization settings..." nolabel="false"
                 type="subFormLink" xpath=".">
            <form name="fileHistory" ref="xtk:workflow:lib/tabs/fileHistory"/>
          </input>
          <input img="xtk:properties.png" label="Advanced parameters..." nolabel="false"
                 prebuildSubForm="false" type="subFormLink" xpath=".">
            <form label="Advanced parameters" maxLabelWidth="60">
              <input nolabel="true" xpath="@deleteFiles"/>
              <input nolabel="true" xpath="@verboseMode"/>
              <container type="visibleGroup" visibleIf="EV([@action], 'fileList')">
                <input nolabel="true" xpath="@listFiles"/>
              </container>
              <container type="visibleGroup" visibleIf="EV([extAccount/@type], 'ftp')">
                <input nolabel="true" xpath="@useSSL"/>
                <input label="Passive mode" type="separator"/>
                <input nolabel="true" xpath="@disablePasv"/>
              </container>
              <container propagateConstraints="false" type="visibleGroup" visibleIf="@disablePasv">
                <input xpath="@portAddress"/>
                <static type="help">Tells the remote server (or the FTP proxy) to which address or network interface to connect when the passive mode is not possible. The value '-' means the default address of the system.</static>
              </container>
            </form>
          </input>

          <input label="Process missing file" xpath="transitions/noFile/@enabled"/>
          <input label="Process errors" xpath="transitions/error/@enabled"/>
          <input expr="EV([@action], 'fileExistence')" type="expr" xpath="transitions/fileExists/@enabled"/>
          <input expr="EV([@action], 'fileExistence')" type="expr" xpath="transitions/fileDoesNotExist/@enabled"/>
          <input expr="EV([@action], 'fileExistence') == false" type="expr" xpath="transitions/done/@enabled"/>
        </container>

  <!-- Scheduling tab -->
        <container ref="xtk:workflow:lib/tabs/planningActivityPage"/>

  <!-- General, pre-script and time-out tabs -->
        <container ref="xtk:workflow:lib/tabs/timeoutsActivityPage"/>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
      <form applicableIf="HasPackage('nms:aamIntegration') and IsIMSLoggedIn()" name="exportToAAM"
            type="notebook">
        <enter>
          <set expr="GetLinkSchema(wkfTargetSchema(@name), 'target')" xpath="/tmp/@schema"/>
          <set expr="Iif([/tmp/@schema]!='',[/tmp/@schema],[../../@schema])" xpath="@schema"/>
        </enter>
        <container img="nms:miniatures/mini-exportToAAM.png">
          <input xpath="@label"/>

          <static label="Adobe Experience Cloud audiences" type="separator"/>

          <input img="nms:miniatures/mini-exportToAAM.png" label="Select a shared audience"
                 nolabel="false" prebuildSubForm="false" type="subFormLink" xpath=".">
            <form label="Select an 'Adobe Experience Cloud' audience" nothingToEdit="true">
              <input sessionToken="true" type="audiencePicker" urlExpr="$(serverUrl)+ '/nms/audienceSelector.jssp?allowCreate=true'"
                     xpath="@traitId"/>
            </form>
          </input>

          <container type="visibleGroup" visibleIf="@segmentId != ''">
            <value fontBold="true" xpath="@segmentId"/>
          </container>
          <container type="visibleGroup" visibleIf="@segmentName != ''">
            <value fontBold="true" xpath="@segmentName"/>
          </container>

          <input createMode="none" img="nms:amcDataSource.png" noAutoComplete="true"
                 xpath="amcDataSource">
            <sysFilter>
              <condition expr="[mapping/@schema] = $(@schema)"/>
            </sysFilter>
          </input>

          <input readOnly="true" schema="xtk:schema" type="schemaEdit" xpath="@schema"/>

          <container name="hidden" type="visibleGroup" visibleIf="false">
            <input readOnly="true" xpath="@traitId"/>
          </container>

          <container xpath="transitions">
            <static colspan="2" label="Results" type="separator"/>
            <input xpath="result/@label"/>
            <static colspan="2" label="Complement" type="separator"/>
            <input colspan="2" xpath="remainder/@enabled"/>
            <container colspan="2" type="visibleGroup" visibleIf="[remainder/@enabled]">
              <input xpath="remainder/@label"/>
            </container>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>


<!--[cf]-->
<!--[of]:httpTransfer-->
      <form name="httpTransfer" type="notebook">

  <!-- Http transfer tab -->
        <container img="nms:miniatures/mini-http.png">
          <input xpath="@label"/>
          <input xpath="@action"/>

          <container label="Web file" type="frame">

            <container>
              <input checkedValue="0" label="Explicit URL" type="radioButton" xpath="@urlSource"/>
              <input checkedValue="1" label="External account" type="radioButton"
                     xpath="@urlSource"/>
              <input checkedValue="2" label="Adobe Campaign instance" type="radioButton"
                     xpath="@urlSource"/>
            </container>

            <container type="visibleGroup" visibleIf="[@urlSource] == 1">
              <input img="nms:extAccount.png" noAutoComplete="true" xpath="extAccount">
                <sysFilter>
                  <condition expr="@type = 5"/>
                </sysFilter>
              </input>
            </container>

            <container type="visibleGroup" visibleIf="[@urlSource] == 0">
              <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@url"/>
            </container>

            <container type="visibleGroup" visibleIf="[@urlSource] == 1 or [@urlSource] == 2">
              <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@filePath"/>
            </container>

          </container>

    <!-- POST parameters -->
          <container type="visibleGroup" visibleIf="EV([@action],'post')">
            <input nolabel="true" toolbarCaption="POST parameters" type="list" xpath="postParameters/postParameter"
                   zoom="true">
              <form>
                <container>
                  <input xpath="@name"/>
                  <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="value"/>
                </container>
              </form>
              <input xpath="@name"/>
              <input xpath="value"/>
            </input>
          </container>

    <!-- Advanced settings -->
          <input img="xtk:import.png" label="File historization settings..." nolabel="false"
                 type="subFormLink" xpath=".">
            <form name="fileHistory" ref="xtk:workflow:lib/tabs/fileHistory"/>
          </input>
          <input img="xtk:properties.png" label="Advanced parameters..." nolabel="false"
                 prebuildSubForm="false" type="subFormLink" xpath=".">
            <form label="Advanced parameters" maxLabelWidth="60">
              <input xpath="@followRedirs"/>
              <input xpath="@addHeaders"/>
              <input xpath="@ignoreRespCode"/>
            </form>
          </input>
          <input label="Process errors" xpath="transitions/error/@enabled"/>
        </container>

  <!-- Scheduling tab -->
        <container ref="xtk:workflow:lib/tabs/planningActivityPage"/>

  <!-- General, pre-script and time-out tabs -->
        <container ref="xtk:workflow:lib/tabs/timeoutsActivityPage"/>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:incoming mail -->
      <form name="inmail" type="notebook">
  <!-- Incoming mail tab -->
        <container colcount="2" img="nms:miniatures/mini-inmail.png">
          <input colspan="2" xpath="@label"/>

          <container colspan="2" label="POP3 server" type="frame">

            <input colspan="2" xpath="@useExtAccount"/>

            <container type="visibleGroup" visibleIf="[@useExtAccount]">
              <input img="nms:extAccount.png" noAutoComplete="true" xpath="extAccount">
                <sysFilter>
                  <condition boolOperator="OR" expr="@type = 6"/> <!-- POP3 -->
                  <condition expr="@type = 99"/> <!-- MAPI -->
                </sysFilter>
              </input>
            </container>
            <container type="visibleGroup" visibleIf="[@useExtAccount] == false">
              <input xpath="@server"/>
              <input xpath="@account"/>
              <input xpath="@password"/>
              <input xpath="@port"/>
              <input xpath="@encryptionType"/>
            </container>
            <input useDesc="true" xpath="@stopAfterFirst"/>
          </container>

          <static colspan="2" label="Script" type="separator"/>
          <input colspan="2" nolabel="true" xpath="script">
            <container>
              <input menuId="workflowMenuBuilder" options="notJst" type="customizeBtn"
                     xpath="/ignored/customizeBtnOut"/>
            </container>
          </input>
          <static colspan="2" type="help">The script must return a value (in the 'nms:workflow:workflow:inmailAction' enumeration) which indicates the action to be carried out each time a message is received.</static>

          <container colcount="2" colspan="2">
            <input nolabel="true" xpath="@bypassCorruptedPart"/>
            <input label="Process email nonexistence" xpath="transitions/noMail/@enabled"/>
            <input label="Process errors" nolabel="true" xpath="transitions/error/@enabled"/>

            <input img="xtk:properties.png" label="Advanced parameters..." type="subFormLink"
                   xpath=".">
              <form label="Advanced parameters">
                <input xpath="@commitAfter"/>
                <static type="help">Messages are deleted after so many messages are processed (0 means process all messages in one single transaction).</static>
                <static type="warning">This property should only be used when messages are systematically deleted from the POP3 mailbox.</static>
              </form>
            </input>
          </container>
        </container>


  <!-- Scheduling tab -->
        <container img="xtk:miniatures/mini-clock.png" label="Schedule" name="planningActivityPage">
          <input nolabel="true" xpath="@usePeriod"/>
          <container type="visibleGroup" visibleIf="@usePeriod">
            <container img="nms:calendar-large.png" label="Execution schedule" type="frame">
              <input type="scheduler" xpath="period"/>
            </container>
          </container>
        </container>

  <!-- General and time-out tabs -->
        <container ref="xtk:workflow:lib/tabs/timeoutsActivityPage"/>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:incoming SMS -->
      <form name="inSms" type="notebook">
  <!-- Incoming SMS tab -->
        <container img="nms:miniatures/mini-sms.png">
          <input xpath="@label"/>

          <container label="SMS routing" type="frame">

            <input img="nms:extAccount.png" noAutoComplete="true" xpath="extAccount">
              <sysFilter>
                <condition expr="@messageType = 1 and @type=3"/>
              </sysFilter>
            </input>
          </container>

          <input img="nms:miniatures/mini-query.png" label="Filters messages to process..."
                 type="subFormLink" xpath="filter">
            <form label="Edit filter">
              <input nolabel="true" schema="nms:inSMS" toolbarAlign="horizontal"
                     toolbarCaption="Filters messages to process" type="conditionlist"
                     xpath="where" xpathCurrentLookupPath="/ignored/where/lookupPath"
                     xpathHelp="helpCond">
                <input colSize="15" label=" " xpath="/ignored/brlog/@bool-operator"/>
                <input colSize="30" label="Expression" xpath="/ignored/brlog/@leftExpr"/>
                <input colSize="15" label="Operator" xpath="/ignored/brlog/@operator"/>
                <input colSize="30" label="Value" xpath="/ignored/brlog/@rightExpr"/>
              </input>
            </form>
          </input>
          <input fontBold="true" lineCount="2" noBorder="true" nolabel="true" readOnly="true"
                 type="edit" xpath="filter/helpCond"/>

          <static label="Script" type="separator"/>
          <input nolabel="true" xpath="script">
            <container>
              <input menuId="wfInSmsMenuBuilder" options="notJst" type="customizeBtn"
                     xpath="/ignored/customizeBtnOut"/>
            </container>
          </input>
          <static type="help">The script must return a value (in the 'nms:workflow:inSmsAction' enumeration) which indicates the action to be carried out each time an SMS is received.</static>

          <input label="Process errors" nolabel="true" xpath="transitions/error/@enabled"/>
          <input type="expr" xpath="transitions/done/@enabled"/>
        </container>

  <!-- Scheduling tab -->
        <container ref="xtk:workflow:lib/tabs/planningActivityPage"/>

  <!-- General and time-out tabs -->
        <container ref="xtk:workflow:lib/tabs/timeoutsActivityPage"/>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[cf]-->
<!--[of]:Nms-->
<!--[of]:validation-->
      <form name="validation" type="notebook">

        <container colcount="2" img="nms:miniatures/mini-validation.png">
          <input colspan="2" xpath="@label"/>
          <input xpath="@assigneeType"/>
          <container type="visibleGroup" visibleIf="[@assigneeType]=0">
            <input createMode="none" img="xtk:group.png" noZoom="true" xpath="assignee">
              <sysFilter>
                <condition expr="@type=1"/>
              </sysFilter>
            </input>
          </container>
          <container type="visibleGroup" visibleIf="[@assigneeType]=1">
            <input createMode="none" img="xtk:operator.png" noZoom="true" xpath="operator">
              <sysFilter>
                <condition expr="@type=0"/>
              </sysFilter>
            </input>
          </container>
          <container type="visibleGroup" visibleIf="[@assigneeType]=2">
            <input label="Assignee" readOnly="true" required="true" xpath="assigneeFilter/@humanCond"/>
          </container>

          <input label="Advanced parameters..." nolabel="true" type="subFormLink"
                 xpath=".">
            <form label="Advanced parameters">
              <enter>
                <set value="xtk:operator" xpath="assigneeFilter/@schema"/>
              </enter>
              <input createMode="none" folderFilterChoice="@model = 'nmsDeliveryModel'"
                     img="nms:email.png" noAutoComplete="true" xpath="scenario">
                <sysFilter>
                  <condition expr="@isModel = 1"/>
                </sysFilter>
                <orderBy>
                  <node expr="@label"/>
                </orderBy>
              </input>
              <container type="visibleGroup" visibleIf="[@assigneeType]=2" xpath="assigneeFilter">
                <static label="Assignee" type="separator"/>
                <container ref="xtk:queryDef:where"/>
                <input expr="[/@helpCond]" type="expr" xpath="@humanCond"/>
              </container>
            </form>
          </input>
          <input xpath="@multiple"/>

          <static colspan="2" label="Message" type="separator"/>
          <input colspan="2" menuId="workflowMenuBuilder" type="scriptEdit" xpath="@title"/>
          <container colspan="2" style="flat" type="contentEditor" xpath="message">
            <container label="HTML" name="tabHtml">
              <input bodyMode="false" fullToolbar="true" name="ctWysiwyg" nolabel="true"
                     type="dhtml" viewSourceBtn="false" xpath="." xpathInsert="/ignored/customizeBtnOut"
                     xpathUrl="/tmp/urlTree/@toSelect">
                <container>
                  <input menuId="workflowMenuBuilder" type="customizeBtn" xpath="/ignored/customizeBtnOut"/>
                </container>
              </input>
            </container>
            <container label="Source" name="tabSource">
              <input fullToolbar="true" name="ctSource" nolabel="true" type="htmlSource"
                     xpath="." xpathInsert="/ignored/customizeBtnOut" xpathSelectCode="/tmp/htmlDiagnostics/@toSelect"
                     xpathTidy="/tmp/tidy/@doTidy" xpathUrl="/tmp/urlTree/@toSelect">
                <container>
                  <input menuId="workflowMenuBuilder" type="customizeBtn" xpath="/ignored/customizeBtnOut"/>
                </container>
              </input>
            </container>
          </container>

          <container colspan="2" toolbarCaption="Possible answers" type="notebookList"
                     xpath="transitions/transition" xpath-label="@label">
            <container colcount="2">
              <input xpath="@label"/>
              <input xpath="@name"/>
            </container>
          </container>

        </container>

        <container ref="xtk:workflow:lib/tabs/timeoutsActivityPage"/>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:alert-->
      <form name="alert" type="notebook">

        <container colcount="2" img="nms:miniatures/mini-alert.png">
          <input colspan="2" xpath="@label"/>
          <input xpath="@assigneeType"/>
          <container type="visibleGroup" visibleIf="[@assigneeType]=0">
            <input createMode="none" img="xtk:group.png" noZoom="true" xpath="assignee">
              <sysFilter>
                <condition expr="@type=1"/>
              </sysFilter>
            </input>
          </container>
          <container type="visibleGroup" visibleIf="[@assigneeType]=1">
            <input createMode="none" img="xtk:operator.png" noZoom="true" xpath="operator">
              <sysFilter>
                <condition expr="@type=0"/>
              </sysFilter>
            </input>
          </container>
          <container type="visibleGroup" visibleIf="[@assigneeType]=2">
            <input label="Assignee" readOnly="true" required="true" xpath="assigneeFilter/@humanCond"/>
          </container>
          <input img="xtk:properties.png" label="Advanced parameters..." nolabel="true"
                 type="subFormLink" xpath=".">
            <form label="Advanced parameters">
              <enter>
                <set value="xtk:operator" xpath="assigneeFilter/@schema"/>
              </enter>
              <input createMode="none" folderFilterChoice="@model = 'nmsDeliveryModel'"
                     img="nms:email.png" noAutoComplete="true" xpath="scenario">
                <sysFilter>
                  <condition expr="@isModel = 1"/>
                </sysFilter>
                <orderBy>
                  <node expr="@label"/>
                </orderBy>
              </input>
              <container type="visibleGroup" visibleIf="[@assigneeType]=2" xpath="assigneeFilter">
                <static label="Assignee" type="separator"/>
                <container ref="xtk:queryDef:where"/>
                <input expr="[/@helpCond]" type="expr" xpath="@humanCond"/>
              </container>
            </form>
          </input>
          <static/>

          <static colspan="2" label="Message" type="separator"/>
          <input colspan="2" menuId="workflowMenuBuilder" type="scriptEdit" xpath="@title"/>
          <container colspan="2" style="flat" type="contentEditor" xpath="message">
            <container label="HTML" name="tabHtml">
              <input bodyMode="false" fullToolbar="true" name="ctWysiwyg" nolabel="true"
                     type="dhtml" viewSourceBtn="false" xpath="." xpathInsert="/ignored/customizeBtnOut"
                     xpathUrl="/tmp/urlTree/@toSelect">
                <container>
                  <input menuId="workflowMenuBuilder" type="customizeBtn" xpath="/ignored/customizeBtnOut"/>
                </container>
              </input>
            </container>
            <container label="Source" name="tabSource">
              <input fullToolbar="true" name="ctSource" nolabel="true" type="htmlSource"
                     xpath="." xpathInsert="/ignored/customizeBtnOut" xpathSelectCode="/tmp/htmlDiagnostics/@toSelect"
                     xpathTidy="/tmp/tidy/@doTidy" xpathUrl="/tmp/urlTree/@toSelect">
                <container>
                  <input menuId="workflowMenuBuilder" type="customizeBtn" xpath="/ignored/customizeBtnOut"/>
                </container>
              </input>
            </container>
          </container>
          <input label="Process errors" nolabel="true" xpath="transitions/error[@name='error']/@enabled"/>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:notification-->
      <form name="notification" type="notebook">
        <enter>
          <set expr="wkfTargetSchema(@name, 'all', 3)" xpath="/ignored/@targetExtension"/>
        </enter>

        <container img="nms:miniatures/mini-notification.png">
          <input xpath="@label"/>

          <input createMode="none" enumImage="@messageType" folderFilterChoice="@model = 'nmsDeliveryModel'"
                 img="nms:deliveryModel.png" noAutoComplete="true" xpath="scenario">
            <sysFilter>
              <condition expr="@isModel = 1"/>
              <condition enabledIf="HasPackage('nms:campaign')" expr="[@operation-id] = 0"/>
            </sysFilter>
            <orderBy>
              <node expr="@label"/>
            </orderBy>
          </input>

          <container label="Recipients" type="frame">
            <input checkedValue="0" label="Specified by the inbound events" type="RadioButton"
                   xpath="@targetType"/>
            <input checkedValue="1" label="Specified in the delivery template" type="RadioButton"
                   xpath="@targetType"/>
            <input checkedValue="2" label="File specified in the input event" type="RadioButton"
                   xpath="@targetType"/>
            <input checkedValue="3" label="Specified by a script" type="RadioButton"
                   xpath="@targetType"/>
            <container type="visibleGroup" visibleIf="@targetType=3">
              <input label=" " xpath="script">
                <container>
                  <input menuId="workflowMenuBuilder" type="customizeBtn" xpath="/ignored/customizeBtnOut"/>
                </container>
              </input>
            </container>
          </container>
          <input label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>

      </form>
<!--[cf]-->
<!--[of]:delivery-->
      <form name="delivery" type="notebook">
        <enter>
          <set expr="wkfTargetSchema(@name, 'all', 3)" xpath="/ignored/@targetExtension"/>
        </enter>
        <container img="nms:miniatures/mini-delivery.png">
          <input xpath="@label"/>

          <container label="Delivery" type="frame">
            <input checkedValue="0" label="Specified in the transition" type="RadioButton"
                   xpath="@deliverySel"/>
            <input checkedValue="1" label="Explicit" type="RadioButton" xpath="@deliverySel"/>
            <input checkedValue="2" label="Computed by a script" type="RadioButton"
                   xpath="@deliverySel"/>
            <input checkedValue="3" label="New, created from a template" type="RadioButton"
                   xpath="@deliverySel"/>
            <container type="visibleGroup" visibleIf="@deliverySel=1">
              <input createMode="none" enumImage="@messageType" folderFilterChoice="@model like 'nmsDelivery%'"
                     img="nms:miniatures/mini-delivery.png" noAutoComplete="true"
                     xpath="delivery">
                <sysFilter>
                  <condition expr="@isModel = 0"/>
                  <condition expr="@state &lt;= 15"/> <!-- the delivery musn't be started -->
                </sysFilter>
                <orderBy>
                  <node expr="@lastModified" sortDesc="true"/>
                </orderBy>
              </input>
            </container>
            <container type="visibleGroup" visibleIf="@deliverySel=2">
              <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="deliveryIdScript"/>
            </container>
            <container type="visibleGroup" visibleIf="@deliverySel=3">
              <input boldLineExpr="@builtIn = 1" createMode="none" enumImage="@messageType"
                     folderFilterChoice="@model = 'nmsDeliveryModel'" img="nms:deliveryModel.png"
                     label="Template" noAutoComplete="true" xpath="scenario">
                <sysFilter>
                  <condition expr="@isModel = 1"/>
                  <condition enabledIf="HasPackage('nms:campaign')" expr="[@operation-id] = 0"/>
                </sysFilter>
              </input>
            </container>
          </container>
          <container label="Recipients" type="frame">
            <input checkedValue="0" label="Specified by the inbound event(s)" type="RadioButton"
                   xpath="@targetSel"/>
            <input checkedValue="1" label="Specified in the delivery" type="RadioButton"
                   xpath="@targetSel"/>
            <input checkedValue="2" label="File(s) specified in the input event(s)"
                   type="RadioButton" xpath="@targetSel"/>
          </container>
          <container label="Content" type="frame">
            <input checkedValue="1" label="Specified by the inbound event" type="RadioButton"
                   xpath="@contentType"/>
            <input checkedValue="0" label="Specified in the delivery" type="RadioButton"
                   xpath="@contentType"/>
            <container applicableIf="HasPackage('nms:interaction')" type="visibleGroup"
                       visibleIf="@targetSel=0">
              <static label="Offers" type="separator"/>
              <input checkedValue="1" label="Specified by the inbound event(s)" type="RadioButton"
                     xpath="@offerSel"/>
              <input checkedValue="0" label="Configured in the delivery" type="RadioButton"
                     xpath="@offerSel"/>
            </container>
          </container>
          <container label="Action to perform" type="frame">
            <input checkedValue="0" label="Save" type="RadioButton" xpath="@actionType"/>
            <input checkedValue="4" label="Estimate the target" type="RadioButton"
                   xpath="@actionType"/>
            <input checkedValue="1" label="Prepare" type="RadioButton" xpath="@actionType"/>
            <input checkedValue="3" label="Send a proof" type="RadioButton" xpath="@actionType"/>
            <input checkedValue="5" label="Send IR (Proof)" type="RadioButton" xpath="@actionType"/>
            <input checkedValue="2" label="Prepare and start" type="RadioButton"
                   xpath="@actionType"/>
          </container>
          <input label="Generate an outbound transition" xpath="transitions/done/@enabled"/>
          <container type="visibleGroup" visibleIf="[transitions/done/@enabled] and @targetSel != 2">
            <input xpath="@ignoreTarget"/>
          </container>
          <input label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
        </container>

        <container img="xtk:script.png" label="Script">
          <static type="help">Delivery object modification script.</static>
          <input nolabel="true" xpath="script">
            <container>
              <input menuId="wfDeliveryMenuBuilder" options="notJst" type="customizeBtn"
                     xpath="/ignored/customizeBtnOut"/>
            </container>
          </input>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:predictiveExtract-->
      <form maxLabelWidth="50" name="predictiveExtract" type="notebook">
        <enter>
          <if expr="@schema==''">
      <!-- force schema if not defined yet -->
            <set value="nms:recipient" xpath="@schema"/>
          </if>

    <!-- No filter -->
          <set value="false" xpath="transitions/extractOutput/filter/@enabled"/>

    <!-- set limit in percent by default -->
          <if expr="[transitions/extractOutput/limiter/@type]=''">
            <set value="percent" xpath="transitions/extractOutput/limiter/@type"/>
          </if>

    <!-- predictive limiter -->
    <!-- set limit in percent by default -->
          <if expr="[transitions/extractOutput/limiter/@limiterPredictiveType]=''">
            <set value="manual" xpath="transitions/extractOutput/limiter/@limiterPredictiveType"/>
          </if>
          <set value="1" xpath="transitions/extractOutput/limiter/@enabled"/>
          <set value="1" xpath="transitions/extractOutput/limiter/@predictive"/>
          <set value="0" xpath="transitions/extractOutput/limiter/@random"/>

        </enter>

        <container colcount="2" img="nms:miniatures/mini-predictive-extract.png"
                   label="Split" xpath="transitions/extractOutput">

          <container colcount="2" colspan="2" label="Predictive selection" type="frame">
            <input colspan="2" xpath="limiter/predictiveModel">
              <sysFilter>
                <condition expr="@isModel = 0"/>
                <condition expr="@state &gt;= 4"/> <!-- the model must be validated -->
              </sysFilter>
              <orderBy>
                <node expr="@lastModified" sortDesc="true"/>
              </orderBy>
            </input>

            <static colspan="2" label="Selection rule" type="separator"/>

            <input checkedValue="manual" colspan="2" label="Limit population size"
                   type="radioButton" xpath="limiter/@limiterPredictiveType"/>
            <container colcount="3" colspan="2" enabledIf="[limiter/@limiterPredictiveType] = 'manual'"
                       type="EnabledGroup">
              <static/>
              <container colcount="2" desc="Select the data limitation values" img="nms:pictoprofile.png"
                         name="limitPage" title="Limits" xpath="limiter">
                <container colcount="2" colspan="2" type="visibleGroup" visibleIf="true">
                  <input checkedValue="percent" label="Size (in %)" type="RadioButton"
                         xpath="@type"/>
                  <container enabledIf="@type=='percent'" type="EnabledGroup">
                    <input nolabel="true" xpath="@percent"/>
                  </container>
                </container>
                <container colcount="2" colspan="2" type="visibleGroup" visibleIf="true">
                  <input checkedValue="number" label="Maximum size" type="RadioButton"
                         xpath="@type"/>
                  <container enabledIf="@type=='number'" type="EnabledGroup">
                    <input nolabel="true" xpath="@number"/>
                  </container>
                </container>
              </container>
            </container>
            <input checkedValue="stickToBudget" colspan="2" label="Respect a budget"
                   type="radioButton" xpath="limiter/@limiterPredictiveType"/>
            <container colcount="3" colspan="2" enabledIf="[limiter/@limiterPredictiveType] = 'stickToBudget'"
                       type="EnabledGroup">
              <static/>
              <input xpath="limiter/@deliveryBudget"/>
              <input xpath="limiter/@unitDeliveryCost"/>
            </container>
            <input checkedValue="maximizeProfit" colspan="2" label="Maximize profit"
                   type="radioButton" xpath="limiter/@limiterPredictiveType"/>
            <container colcount="3" colspan="2" enabledIf="[limiter/@limiterPredictiveType] = 'maximizeProfit'"
                       type="EnabledGroup">
              <static/>
              <input xpath="limiter/@unitTransactionProfit"/>
              <input xpath="limiter/@unitDeliveryCost"/>
            </container>
          </container>

          <container colcount="2" colspan="2" label="Results" type="frame">
            <input xpath="@label"/>
            <input xpath="@code"/>
          </container>

        </container>

        <container label="General">
          <input xpath="@label"/>
          <container ref="xtk:workflow:lib/tabs/schemaSelector"/>
          <container label="Results" type="frame" xpath="transitions">
            <input nolabel="false" xpath="remainder/@enabled"/>
            <static type="help">If this option is checked, a complementary subset will contain all remaining records.</static>
            <container type="visibleGroup" visibleIf="[remainder/@enabled]">
              <input xpath="remainder/@label"/>
            </container>
          </container>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>

        <leave>
          <if expr="[transitions/extractOutput/limiter/@enabled] == false">
            <set value="false" xpath="transitions/extractOutput/limiter/@order"/>
            <set value="false" xpath="transitions/extractOutput/limiter/@random"/>
          </if>
          <if expr="[transitions/extractOutput/limiter/@enabled]=false and ([transitions/extractOutput/limiter/@random] or [transitions/extractOutput/limiter/@order])">
            <set value="true" xpath="transitions/extractOutput/limiter/@enabled"/>
          </if>
        </leave>

      </form>
<!--[cf]-->
<!--[of]:deliveryOperation-->
      <form name="deliveryOperation" type="notebook">
        <enter>
          <set expr="wkfTargetSchema(@name, 'all', 3)" xpath="/ignored/@targetExtension"/>
        </enter>
  <!-- This control editTargetProperties is just used as an indirection to the real form -->
        <container editFormTarget="nms:delivery" name="editTargetProperties" newFormTarget="nms:newDelivery"
                   propagateXPathToCtx="@messageType|/tmp/@messageType, ../../@id|/tmp/@workflowId,/tmp/@parentId,/tmp/@budgetId, /tmp/@budgetLabel, /tmp/@commitmentLevel, /tmp/parameter/*|/tmp/parameter, /tmp/process/*|/tmp/process, /tmp/controlGroup/*|/tmp/controlGroup, /tmp/measure/*|/tmp/measure, /tmp/seedList/*|/tmp/seedList, /tmp/@linkedOperation-id,/ignored/@targetExtension|/tmp/@targetExtension,/ignored/@deliveryRecurring|/tmp/@deliveryRecurring"
                   targetMenuLabel="Edit the delivery..." type="visibleGroup" visibleIf="false">
          <enter>
            <set expr="wkfTargetSchema(@name, 'all', 3)" xpath="/ignored/@targetExtension"/>
            <set expr="iif(NodeName([.]) == 'deliveryRecurring', 1, 0)" xpath="/ignored/@deliveryRecurring"/>
          </enter>
          <leave>
            <if expr="NodeName([.]) == 'deliveryRecurring'">
        <!-- recurring delivery is a template -->
              <set expr="[@delivery-id]" xpath="@scenario-id"/>
            </if>
          </leave>
        </container>

        <container img="nms:miniatures/mini-delivery.png" visibleIf="[@delivery-id]!=0">
          <input xpath="@label"/>
          <static label="Workflow execution settings" type="separator"/>
          <container type="visibleGroup" visibleIf="true">
            <input label="Generate an outbound transition" xpath="transitions/done/@enabled"/>
          </container>
          <container type="visibleGroup" visibleIf="[transitions/done/@enabled]">
            <input xpath="@ignoreTarget"/>
          </container>
          <container type="visibleGroup" visibleIf="true">
            <input label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
          </container>
          <container applicableIf="HasPackage('nms:interaction')" type="visibleGroup"
                     visibleIf="true">
            <input label="Use offers linked to the inbound event" type="checkBox"
                   xpath="@offerSel"/>
          </container>
        </container>
        <container img="nms:miniatures/mini-delivery.png" visibleIf="[@delivery-id]=0">
          <input xpath="@label"/>
          <static label="Workflow execution settings" type="separator"/>
          <container type="visibleGroup" visibleIf="true">
            <input label="Generate an outbound transition" nolabel="false" xpath="transitions/done/@enabled"/>
          </container>
          <container type="visibleGroup" visibleIf="[transitions/done/@enabled]">
            <input nolabel="false" xpath="@ignoreTarget"/>
          </container>
          <container type="visibleGroup" visibleIf="true">
            <input label="Process errors" nolabel="false" xpath="transitions/error[@name='error']/@enabled"/>
          </container>
          <container applicableIf="HasPackage('nms:interaction')" type="visibleGroup"
                     visibleIf="true">
            <input label="Use offers linked to the inbound event" nolabel="false"
                   type="checkBox" xpath="@offerSel"/>
          </container>
        </container>
        <container img="xtk:script.png" label="Script">
          <static type="help">Delivery object modification script.</static>
          <input nolabel="true" xpath="script">
            <container>
              <input menuId="wfDeliveryMenuBuilder" options="notJst" type="customizeBtn"
                     xpath="/ignored/customizeBtnOut"/>
            </container>
          </input>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:deliveryOutline-->
      <form name="deliveryOutline" type="notebook" xpathsToLoad="@messageType">
        <enter>
          <set value="0" xpath="/ignored/@addFilterRule"/>
          <if expr="HasPackage('nms:interaction')">
            <if expr="@maxPropositionCount&gt;0">
              <set value="1" xpath="/tmp/@callOfferEngine"/>
            </if>
          </if>
        </enter>

        <container img="nms:miniatures/mini-deliveryOutline.png">
          <input xpath="@label"/>
          <input label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
          <input createMode="none" fullLoad="true" img="nms:deliveryOutline.png"
                 notifyPathList="@messageType|../@messageType" xpath="deliveryOutline">
            <sysFilter>
              <condition expr="[@operation-id]=$(../../@operation-id)"/>
            </sysFilter>
          </input>
          <input xpath="@contactDate"/>
          <static applicableIf="HasPackage('nms:interaction')" label="Offer selection"
                  type="separator"/>
          <input applicableIf="HasPackage('nms:interaction')" checkedValue="1" label="Restrict the number of propositions selected"
                 type="checkBox" unCheckedValue="0" xpath="/tmp/@callOfferEngine"/>
          <container applicableIf="HasPackage('nms:interaction')" type="visibleGroup"
                     visibleIf="[/tmp/@callOfferEngine]">
            <input label="Number of propositions" xpath="@maxPropositionCount"/>
            <input createMode="none" img="nms:offerSpace.png" xpath="offerSpace">
              <sysFilter>
                <condition expr="[env/@live]=true"/>
              </sysFilter>
            </input>
            <static type="help">Indicate the number of propositions to be kept among those referenced in the composition and the foreseen space.</static>
          </container>
          <container ref="nms:delivery:lib/typology"/>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <if expr="[/tmp/@callOfferEngine]=0 AND HasPackage('nms:interaction')">
            <set value="0" xpath="@maxPropositionCount"/>
          </if>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:controlDelivery-->
      <form name="controlDelivery" type="notebook">

        <container img="nms:miniatures/mini-control-delivery.png">
          <input xpath="@label"/>

          <container label="Delivery" type="frame">
            <input checkedValue="0" label="Specified in the transition" type="RadioButton"
                   xpath="@deliverySel"/>
            <input checkedValue="1" label="Explicit" type="RadioButton" xpath="@deliverySel"/>
            <input checkedValue="2" label="Computed by a script" type="RadioButton"
                   xpath="@deliverySel"/>
            <container type="visibleGroup" visibleIf="@deliverySel=1">
              <input createMode="none" folderFilterChoice="@model like 'nmsDelivery%'"
                     img="nms:email.png" noAutoComplete="true" xpath="delivery">
                <sysFilter>
                  <condition expr="@isModel = 0"/>
                </sysFilter>
                <orderBy>
                  <node expr="@lastModified" sortDesc="true"/>
                </orderBy>
              </input>
            </container>
            <container type="visibleGroup" visibleIf="@deliverySel=2">
              <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="deliveryIdScript"/>
            </container>
          </container>
          <container label="Action to perform" type="frame">
            <input checkedValue="1" label="Start" type="RadioButton" xpath="@actionType"/>
            <input checkedValue="2" label="Pause" type="RadioButton" xpath="@actionType"/>
            <input checkedValue="3" label="Stop" type="RadioButton" xpath="@actionType"/>
          </container>
          <input label="Generate an outbound transition" xpath="transitions/done/@enabled"/>
          <input label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>

      </form>
<!--[cf]-->
<!--[of]:incremental query-->
      <form name="incremental" type="notebook">
        <enter>
          <set expr="wkfTargetSchema(@name)" xpath="/ignored/@targetExtension"/>
        </enter>

        <container colcount="2" img="nms:miniatures/mini-incremental.png">
          <input colspan="2" xpath="@label"/>
          <input alwaysActive="true" expr="@schema" type="expr" xpath="/tmp/selectCtrl/in/@schema"/>
          <static colspan="2" label="Target selection" type="separator"/>
          <input colspan="2" img="nms:miniatures/mini-query.png" label="Edit query..."
                 nolabel="false" prebuildSubForm="false" type="subFormLink" xpath=".">
            <form ref="xtk:workflow:lib/tabs/queryWizard"/>
          </input>
          <input colspan="2" fontBold="true" label=" " lineCount="5" noBorder="true"
                 readOnly="true" type="edit" xpath="humanCond"/>

          <static colspan="2" label="Complementary information" type="separator"/>
          <input img="xtk:xtklinkn.png" label="Add data..." nolabel="false" prebuildSubForm="false"
                 type="subFormLink" xpath=".">
            <enter name="onClick">
              <set value="0" xpath="/tmp/queryAdd/@dataTypeReadOnly"/>
            </enter>
            <form label="Additional data" ref="xtk:workflow:lib/subforms/queryAdd"
                  type="wizard"/>
          </input>
          <container type="visibleGroup" visibleIf="NodeCount([select/node])==0"/>
          <container type="visibleGroup" visibleIf="NodeCount([select/node])&gt;=1">
            <input align="right" img="nms:list.png" label="Edit additional data..."
                   prebuildSubForm="false" type="subFormLink" xpath=".">
              <form label="Additional columns">
                <enter>
                  <set expr="wkfTargetSchema(@name, '', 1)" xpath="/ignored/@targetExtension"/>
                  <set value="aggregate" xpath="/tmp/selectCtrl/in/@choiceType"/>
                </enter>
                <container style="flat" type="notebook">
                  <container ref="xtk:workflow:lib/tabs/colSelector/data"/>
                  <container ref="xtk:workflow:lib/tabs/colSelector/collection"/>
                </container>
              </form>
            </input>
          </container>
          <input alwaysActive="true" expr="GroupConcat([select/descendant::node], &quot; ' [' + [@label] + '] ' &quot; )"
                 type="expr" xpath="/tmp/selectCtrl/out/@humanSelect"/>
          <input colspan="2" fontBold="true" label=" " lineCount="5" noBorder="true"
                 readOnly="true" type="edit" xpath="/tmp/selectCtrl/out/@humanSelect"/>

          <container colcount="2" colspan="2" xpath="transitions">
            <static colspan="2" label="Results" type="separator"/>
            <input xpath="result/@label"/>
            <input xpath="result/@code"/>
          </container>
        </container>

        <container img="nl:smallcalendar.png" label="Scheduling &amp;&amp; History">
          <container label="Scheduling" type="frame">
            <input nolabel="true" xpath="@usePeriod"/>
            <container type="visibleGroup" visibleIf="@usePeriod">
              <input type="scheduler" xpath="period"/>
            </container>
          </container>
          <container label="History" type="frame">
            <input xpath="@history"/>
            <input xpath="@keepHistory"/>
            <input xpath="@sqlTableHisto"/>
            <static label="Overloads the name of the SQL table used to keep history."
                    type="help"/>
          </container>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>

      </form>
<!--[cf]-->
<!--[of]:queryAdd-->
      <form label="Additional data" name="queryAdd" type="wizard">
        <enter>
          <set expr="[/tmp/queryAdd/@dataTypeReadOnly]" xpath="/ignored/queryAdd/@dataTypeReadOnly"/>
          <set expr="[/tmp/queryAdd/@reverseLink]" xpath="/ignored/queryAdd/@reverseLink"/>
          <set expr="Iif([/tmp/queryAdd/@dataType]='', 'linkedData', [/tmp/queryAdd/@dataType])"
               xpath="/ignored/queryAdd/@dataType"/>
          <reset xpath="/tmp/queryAdd"/>
          <set expr="[/ignored/queryAdd/@dataTypeReadOnly]" xpath="/tmp/queryAdd/@dataTypeReadOnly"/>
          <set expr="[/ignored/queryAdd/@reverseLink]" xpath="/tmp/queryAdd/@reverseLink"/>
          <set expr="[/ignored/queryAdd/@dataType]" xpath="/tmp/queryAdd/@dataType"/>

          <set expr="NodeName([.])" xpath="/tmp/queryAdd/@entityName"/>
          <set expr="@name" xpath="/tmp/queryAdd/@activityName"/>
          <set value="" xpath="/tmp/queryAdd/@collName"/>
          <set expr="GroupConcat(conditionLink, &quot; '|' + @alias + '|' &quot;)"
               xpath="/tmp/queryAdd/@collNameList"/>
          <if expr="FieldExists('xtk:workflow', 'activities/'+[/tmp/queryAdd/@entityName]+'/links')">
            <set expr="[/tmp/queryAdd/@collNameList] + GroupConcat(links, &quot; '|' + @name + '|' &quot;)"
                 xpath="/tmp/queryAdd/@collNameList"/>
          </if>
          <if expr="FieldExists('xtk:workflow', 'activities/'+[/tmp/queryAdd/@entityName]+'/reconc')">
            <set expr="[/tmp/queryAdd/@collNameList] + GroupConcat(reconc, &quot; '|' + @name + '|' &quot;)"
                 xpath="/tmp/queryAdd/@collNameList"/>
          </if>
          <set value="" xpath="/tmp/queryAdd/@label"/>
          <set expr="[/tmp/selectCtrl/in/@schema]" xpath="/tmp/queryAdd/@schema"/>
          <set value="[.]" xpath="/tmp/queryAdd/@schemaRoot"/>
          <set expr="[/tmp/selectCtrl/in/@schema]" xpath="/tmp/queryAdd/@filterSchema"/>
          <if expr="[/tmp/queryAdd/@dataTypeReadOnly]!=1">
            <set value="linkedData" xpath="/tmp/queryAdd/@dataType"/>
          </if>
          <set value="0" xpath="/tmp/queryAdd/@lineCount"/>
          <set value="0" xpath="/tmp/queryAdd/@useOrderByValuesAsRank"/>
          <set expr="Iif([/tmp/queryAdd/@reverseLink]=1, -1,1)" xpath="/tmp/queryAdd/@rowCount"/>
        </enter>
        <container desc="You can select data linked to the filtering dimension, external data, an offer proposition, a predictive scoring, depending on the applications installed on your instance."
                   img="xtk:filter32.png" title="Select the type of data to add"
                   visibleIf="[/tmp/queryAdd/@dataTypeReadOnly]!=1 AND (HasPackage('nms:federatedDataAccess') OR HasPackage('nms:coreInteraction') OR HasPackage('nms:predictive') OR FieldExists('xtk:workflow', 'activities/'+NodeName([.])+'/reconc'))"
                   xpath="/tmp/queryAdd">
          <container colcount="2" enabledIf="[/tmp/queryAdd/@dataTypeReadOnly]!=1"
                     type="enabledGroup">
            <input img="nms:activities/query.png" rowspan="2" type="image"/>
            <input checkedValue="linkedData" label="Data linked to the filtering dimension"
                   nolabel="true" type="radioButton" xpath="@dataType"/>
            <static>Lets you select data from the Adobe Campaign database.</static>
            <input applicableIf="HasPackage('nms:federatedDataAccess')" img="nms:activities/dbImport.png"
                   rowspan="2" type="image"/>
            <input applicableIf="HasPackage('nms:federatedDataAccess')" checkedValue="extSharedData"
                   label="External data" nolabel="true" type="radioButton" xpath="@dataType"/>
            <static applicableIf="HasPackage('nms:federatedDataAccess')">Lets you select data from an external database.</static>
            <input applicableIf="HasPackage('nms:coreInteraction')" img="nms:activities/offerSelection.png"
                   rowspan="2" type="image"/>
            <input applicableIf="HasPackage('nms:coreInteraction')" checkedValue="offer"
                   label="An offer proposition" nolabel="true" type="radioButton"
                   xpath="@dataType"/>
            <static applicableIf="HasPackage('nms:coreInteraction')">Adds a set of columns to store the best proposition generated by the offer engine.</static>
            <input applicableIf="HasPackage('nms:predictive')" img="nms:activities/predictive.png"
                   rowspan="2" type="image"/>
            <input applicableIf="HasPackage('nms:predictive')" checkedValue="score"
                   label="A predictive score" nolabel="true" type="radioButton" xpath="@dataType"/>
            <static applicableIf="HasPackage('nms:predictive')">Adds a column to store the score computed by the selected predictive model.</static>
            <container colcount="2" colspan="2" type="visibleGroup" visibleIf="FieldExists('xtk:workflow', 'activities/'+@entityName+'/reconc')">
              <input img="nms:activities/links.png" rowspan="2" type="image"/>
              <input checkedValue="linkDefColl" label="A link" nolabel="true" type="radioButton"
                     xpath="@dataType"/>
              <static>Adds the required column(s) for storing a reference to data in the Adobe Campaign database.</static>
            </container>
          </container>
        </container>
        <container desc="Select the link for accessing additional data." img="xtk:filter32.png"
                   title="Select fields to add" visibleIf="[/tmp/queryAdd/@dataType]='linkedData' OR [/tmp/queryAdd/@dataType]='distantData' OR [/tmp/queryAdd/@dataType]=''"
                   xpath="/tmp/queryAdd">
          <input checkedValue="linkedData" label="Data of the filtering dimension"
                 nolabel="true" type="radioButton" xpath="@dataType"/>
          <input checkedValue="distantData" label="Data linked to the filtering dimension"
                 nolabel="true" type="radioButton" xpath="@dataType"/>
          <input expr="Iif(@dataType='linkedData', 0, NodeValue('@lineCount'))" type="expr"
                 xpath="@lineCount"/>
          <container type="visibleGroup" visibleIf="@dataType='distantData'">
            <container colcount="2">
              <static img="xtk:filter.png" type="image"/>
              <input catchReturnKey="true" label="Find" type="edit" xpath="/tmp/@search"/>
            </container>
            <input dblClickAction="wizNext" expandXPath="true" type="schemaView"
                   useUnboundPath="true" xpath="/tmp/queryAdd/@schema" xpathExpr="/tmp/queryAdd/@filterLink"
                   xpathFilter="462" xpathHelp="/tmp/@help" xpathSearchPath="/tmp/@search"
                   xpathStartPath="/tmp/@startPath"/>
            <input type="help" xpath="/tmp/@help"/>
          </container>
          <leave>
            <if expr="[/tmp/queryAdd/@dataType]='linkedData' AND [/tmp/queryAdd/@recipientLink]=''">
              <set expr="@schema" xpath="collection/@schema"/>
            </if>
            <if expr="[/tmp/queryAdd/@reverseLink]!=1 AND (([/tmp/queryAdd/@dataType]='linkedData' AND [/tmp/queryAdd/@recipientLink]!='') OR [/tmp/queryAdd/@dataType]='distantData')">
              <set value="0" xpath="@rowCount"/>
              <set value="3" xpath="@lineCount"/>
            </if>
            <if expr="[/tmp/queryAdd/@dataType]='linkedData'">
              <set expr="ExtractRight(@schema, ':')" xpath="@collName"/>
              <set expr="LabelOf('/tmp/queryAdd/@schemaRoot', '/tmp/queryAdd/@schema')"
                   xpath="@label"/>
            </if>
            <if expr="[/tmp/queryAdd/@dataType]='distantData'">
              <set expr="ExtractRight(GetLinkSchema(@schema, @filterLink), ':')"
                   xpath="@collName"/>
              <set expr="LabelOf('/tmp/queryAdd/@filterLink', '/tmp/queryAdd/@schema')"
                   xpath="@label"/>
            </if>
          </leave>
        </container>
        <container desc="Select external data source." img="nms:activities/dbImport.png"
                   title="Select fields to add" visibleIf="[/tmp/queryAdd/@dataType]='extSharedData' OR [/tmp/queryAdd/@dataType]='externalData'"
                   xpath="/tmp/queryAdd">
          <input checkedValue="extSharedData" label="Using an external account" type="radioButton"
                 xpath="@dataType"/>
          <input checkedValue="externalData" label="Locally defining the data source"
                 type="radioButton" xpath="@dataType"/>
          <container type="visibleGroup" visibleIf="@dataType='extSharedData'">
            <input createMode="none" img="nms:miniatures/mini-dbImport.png" label="External account"
                   notifyPathList="@name|dataSourceDesc/@name,@NChar|dataSourceDesc/@NChar,@unicodeData|dataSourceDesc/@unicodeData"
                   schema="nms:extAccount" type="linkEdit" xpath="@dataSource-id">
              <sysFilter>
                <condition expr="@type = 7"/>
              </sysFilter>
            </input>
            <static type="help">Select the external account for accessing additional data, then click next to select the table.</static>
          </container>
          <container type="visibleGroup" visibleIf="@dataType='externalData'" xpath="dataSourceDesc">
            <input enum="xtk:workflow:provider" label="Engine" type="sysenum" xpath="@provider"/>

            <static label="Database server" type="separator"/>
            <input label="Server" xpath="@server"/>
            <container type="visibleGroup" visibleIf="[@provider]=='Oracle'">
              <static type="help">TNS name (defined on the application server) used to access the database server.</static>
            </container>
            <container type="visibleGroup" visibleIf="[@provider]=='PostgreSQL'">
              <static type="help">DNS name (or IP address) valid on the application server to access the database server.</static>
            </container>
            <container type="visibleGroup" visibleIf="[@provider]=='MSSQL'">
              <static type="help">DNS name (or IP address) valid on the application server to access the database server.</static>
              <static label="Authentication mode used to access SQL Server" type="separator"/>
              <input checkedValue="false" label="SQL Server authentication" type="RadioButton"
                     xpath="/tmp/@integratedSecurity"/>
              <input checkedValue="true" label="Windows NT authentication (integrated security)"
                     type="RadioButton" xpath="/tmp/@integratedSecurity"/>
            </container>
            <container type="visibleGroup" visibleIf="[@provider]=='DB2'">
              <static type="help">Host name or 'host:port' combination used to access the database server.</static>
            </container>
            <container type="visibleGroup" visibleIf="[@provider]=='MySQL'">
              <static type="help">DNS name (or IP address) valid on the application server to access the database server.</static>
            </container>

            <static label="Authentication settings" type="separator"/>
            <input label="User" xpath="@login"/>
            <input crypt="true" instancePassword="true" label="Password" type="passwordedit"
                   xpath="@password"/>
            <container type="visibleGroup" visibleIf="[@provider]!='Oracle' AND [@provider]!='Teradata'">
              <static label="Database" type="separator"/>
              <input label="Database" xpath="@dbName"/>
            </container>
            <input label="Unicode database" type="checkbox" xpath="@unicodeData"/>
            <container type="visibleGroup" visibleIf="[@provider]='Oracle' OR [@provider]='MSSQL'">
              <input xpath="@NChar"/>
            </container>
            <input enum="xtk:common:timezone" label="Time zone" type="sysenum" xpath="@timezone"/>
          </container>
          <leave>
            <if expr="[/tmp/queryAdd/@reverseLink]!=1 ">
              <set value="0" xpath="@rowCount"/>
              <set value="3" xpath="@lineCount"/>
            </if>
          </leave>
        </container>
        <container desc="Select the space and the offer category you want to use to generate propositions."
                   img="nms:activities/offerSelection.png" title="Offer proposition"
                   visibleIf="[/tmp/queryAdd/@dataType]='offer'" xpath="/tmp/queryAdd">
          <enter>
            <if expr="@collName==''">
              <set value="proposition" xpath="@collName"/>
              <set value="proposition" xpath="@label"/>
              <set expr="Iif(HasPackage('nms:interaction'), 'dynamic', 'forced')"
                   xpath="@calcOffer"/>
              <set value="1" xpath="@offerCount"/>
            </if>
          </enter>
          <static type="help">Select an identifier and a label, to easily find propositions during the rest of the segmentation.</static>
          <input label="Identifier" required="true" size="24" xpath="@collName"/>
          <container type="visibleGroup" visibleIf="IndexOf(@collNameList, '|' + @collName + '|')&gt;=0">
            <static type="warning">The identifier above is already used. If you keep it, the configuration of the search engine below will replace the existing one.</static>
          </container>
          <input label="Label" xpath="@label"/>
          <input applicableIf="HasPackage('nms:interaction')" checkedValue="dynamic"
                 label="Search for the best offer in a category" type="radioButton"
                 xpath="@calcOffer"/>
          <input applicableIf="HasPackage('nms:interaction')" checkedValue="forced"
                 label="A predefined offer" type="radioButton" xpath="@calcOffer"/>
          <container applicableIf="HasPackage('nms:interaction')" type="visibleGroup"
                     visibleIf="@calcOffer='dynamic'">
            <static type="help">Call to the engine to calculate the best available offer for the incoming population. Adds columns to the incoming population to store the best proposition. Proposition historization will take place later when the proposition is used in a delivery.</static>
            <input computeStringAlias="@offerSpace-cs" createMode="none" img="nms:offerSpace.png"
                   label="Space" notifyPathList="@name|@offerSpace-name,@_cs|@offerSpace-cs,env/@propositionSchema|@propositionSchema,@outputSchema|@outputSchema,@channel|@channel,@env-id|@env-id,env/@name|@offerEnv-name,@defaultCategory-id|/tmp/@defaultCategoryId,defaultCategory/@label|/tmp/@defaultCategoryCs,@defaultThemes|/tmp/@defaultThemes"
                   required="true" schema="nms:offerSpace" type="linkEdit" xpath="@offerSpace-id">
              <enter name="onChange">
                <set expr="[/tmp/@defaultCategoryId]" xpath="/tmp/defaultCategory/@id"/>
                <set expr="[/tmp/@defaultCategoryCs]" xpath="/tmp/defaultCategory/@_cs"/>
                <set expr="[/tmp/@defaultCategoryId]" xpath="/tmp/defaultCategory"/>
                <set expr="[/tmp/@defaultThemes]" xpath="@offerThemes"/>
              </enter>
              <sysFilter>
                <condition expr="[env/@live]=true"/>
              </sysFilter>
            </input>
            <container maxLabelWidth="200" type="visibleGroup" visibleIf="[@offerSpace-id]!='' AND [@offerSpace-id]!=0">
              <input computeStringAlias="@offerCategory-cs" img="nms:offerCategory.png"
                     label="Category" notifyPathList="@_cs|@offerCategory-cs" schema="nms:offerCategory"
                     type="linkEdit" xpath="offerCategory" xpathRefresh="/tmp/defaultCategory">
                <sysFilter>
                  <condition expr="@model IN ('nmsOfferCategory', 'nmsOfferEnv')"/>
                  <condition expr="[@env-id]=$long(/tmp/queryAdd/@env-id)"/>
                </sysFilter>
              </input>
              <input label="Themes" xpath="@offerThemes"/>
              <input label="Contact date" type="datetime" xpath="@contactDate"/>
              <input label="Number of offers to keep" type="number" xpath="@offerCount"/>
            </container>
          </container>
          <container type="visibleGroup" visibleIf="@calcOffer='forced'">
            <static type="help">Adds columns to the incoming population to store a proposition for the chosen offer. Proposition historization will take place later when the proposition is used in a delivery.</static>
            <input computeStringAlias="@offerSpace-cs" createMode="none" img="nms:offerSpace.png"
                   label="Space" notifyPathList="@name|@offerSpace-name,@_cs|@offerSpace-cs,env/@propositionSchema|@propositionSchema,@outputSchema|@outputSchema,@channel|@channel,@env-id|@env-id,env/@name|@offerEnv-name"
                   required="true" schema="nms:offerSpace" type="linkEdit" xpath="@offerSpace-id">
              <sysFilter>
                <condition expr="[env/@live]=true"/>
              </sysFilter>
            </input>
            <input computeStringAlias="@offer-cs" createMode="none" img="nms:offer.png"
                   label="Offer" notifyPathList="@_cs|@offer-cs,@name|@offer-name"
                   schema="nms:offer" type="linkEdit" xpath="@offer-id">
              <sysFilter>
                <condition expr="@status = 6"/>
                <condition expr="[category/@env-id]=$long(/tmp/queryAdd/@env-id)"/>
              </sysFilter>
            </input>
            <input label="Contact date" type="datetime" xpath="@contactDate"/>
          </container>
        </container>
        <container desc="Select the predictive model to apply for score computing"
                   img="nms:packages/predictive.png" title="Configuring score computing"
                   visibleIf="[/tmp/queryAdd/@dataType]='score'" xpath="/tmp/queryAdd">
          <enter>
            <if expr="@collName==''">
              <set value="score" xpath="@collName"/>
              <set value="score" xpath="@label"/>
            </if>
          </enter>
          <static type="help">Select an identifier and a label, to easily find the stored values during the rest of segmentation.</static>
          <input label="Identifier" required="true" size="24" xpath="@collName"/>
          <container type="visibleGroup" visibleIf="IndexOf(@collNameList, '|' + @collName + '|')&gt;=0">
            <static type="warning">The identifier above is already used. If you keep it, the score computed by the predictive model below will replace the existing one.</static>
          </container>
          <input label="Label" xpath="@label"/>
          <static type="help">Select the predictive model for computing a score for each individual of the inbound population.</static>
          <input createMode="none" label="Predictive model" notifyPathList="@internalName|@predictiveModel-name,@_cs|predictiveModel/@_cs,@id|predictiveModel/@id"
                 schema="nms:predictiveModel" type="linkEdit" xpath="@predictiveModel-id">
            <sysFilter>
              <condition expr="@isModel = 0"/>
              <condition expr="@state &gt;= 4"/>
        <!-- the model must be validated -->
            </sysFilter>
            <orderBy>
              <node expr="@lastModified" sortDesc="true"/>
            </orderBy>
          </input>
        </container>
        <container desc="Select the table, then associate the data with the filtering dimension"
                   img="nms:activities/dbImport.png" title="Select fields to add"
                   visibleIf="[/tmp/queryAdd/@dataType]='extSharedData' OR [/tmp/queryAdd/@dataType]='externalData'"
                   xpath="/tmp/queryAdd">
          <enter>
            <if expr="[/tmp/queryAdd/@dataType]='extSharedData'">
              <set expr="'nms:extAccount:' + [dataSourceDesc/@name]" xpath="@dataSource"/>
            </if>
            <if expr="[/tmp/queryAdd/@dataType]='externalData'">
              <set expr="'{' + [dataSourceDesc/@provider] + ':' + [dataSourceDesc/@login] + ':' + [dataSourceDesc/@dbName] + '/' + Iif(SubString([dataSourceDesc/@password], 0, 13)=='__PLAINTEXT__', SubString([dataSourceDesc/@password], 13), [dataSourceDesc/@password] ) + '@' + [dataSourceDesc/@server] + Iif([dataSourceDesc/@unicodeData], ';unicodeData=1', ';unicodeData=0') + Iif([dataSourceDesc/@NChar], ';NChar=1', ';NChar=0') + ';timezone=' + [dataSourceDesc/@timezone] + '}'"
                   xpath="@dataSource"/>
            </if>
            <set expr="Iif(@advancedJoin=='', 0, @advancedJoin)" xpath="@advancedJoin"/>
          </enter>
          <input label="Table name" xpath="@tableName">
            <input img="xtk:choiceField.png" modeless="false" name="btnChoiceTable"
                   prebuildSubForm="false" xpath=".">
              <enter name="onClick">
                <soapCall name="BuildTableList" service="xtk:sqlSchema">
                  <param exprIn="@dataSource" type="string"/>
                  <param exprIn="'%' + [/ignored/dbImport/@tableFilter] + '%'" type="string"/>
                  <param type="DOMDocument" xpathOut="/ignored/dbImport/tableList"/>
                </soapCall>
              </enter>
              <form colcount="2" label="Select the table">
                <input catchReturnKey="true" label="Filter" xpath="/ignored/dbImport/@tableFilter"/>
                <input label="Filter" type="button">
                  <enter>
                    <soapCall name="BuildTableList" service="xtk:sqlSchema">
                      <param exprIn="@dataSource" type="string"/>
                      <param exprIn="'%' + [/ignored/dbImport/@tableFilter] + '%'"
                             type="string"/>
                      <param type="DOMDocument" xpathOut="/ignored/dbImport/tableList"/>
                    </soapCall>
                  </enter>
                </input>
                <input colspan="2" dblClickAction="btnOk" editable="false" entitySchema="xtk:sqlSchema"
                       noToolbar="true" nolabel="true" readOnly="true" type="list"
                       xpath="/ignored/dbImport/tableList/table" xpathSelection="/tmp/dbImport/@tableName">
                  <input editable="false" label="Table name" xpath="@name"/>
                </input>
                <leave>
                  <set expr="NodeValue([/tmp/dbImport/@tableName]+'/@name')" xpath="@tableName"/>
                </leave>
              </form>
            </input>
          </input>
          <input expr="wkfExternalSchema(@tableName, @dataSource, @tableName)" type="expr"
                 xpath="@targetSchema"/>
          <input expr="@tableName" type="expr" xpath="@collName"/>
          <container type="visibleGroup" visibleIf="IndexOf(@collNameList, '|' + @collName + '|')&gt;=0">
            <static type="warning">The identifier above is already used, the new configuration will replace the existing one.</static>
          </container>
          <input expr="@tableName" type="expr" xpath="@label"/>
          <container type="visibleGroup" visibleIf="[/tmp/queryAdd/@reverseLink]=1">
            <input label="Identifier" required="true" size="24" xpath="@collName"/>
            <input label="Label" xpath="@label"/>
          </container>
          <container type="visibleGroup" visibleIf="@targetSchema!=''">
            <static label="Join conditions" type="separator"/>
            <input checkedValue="0" label="Use a simple join" nolabel="false" type="radioButton"
                   xpath="@advancedJoin"/>
            <input checkedValue="1" label="Advanced join conditions" nolabel="false"
                   type="radioButton" xpath="@advancedJoin"/>
            <input applicableIf="$(BUILD_NUMBER)&gt;6819" expr="wkfAddLinkDefToSchema(@filterSchema, 'joinTarget', [/ignored/@advancedJoinLinkLabel], Iif( [@advancedJoin]==1, @targetSchema, ''))"
                   type="expr" xpath="/ignored/@advancedJoinQueryAddSchema">
              <enter>
                <if expr="@advancedJoin!='' AND @advancedJoin!=1 AND NodeCount([element/condition])&gt;0">
                  <msgBox translatedExpr="'Do you want to delete the advanced join conditions?'"
                          type="yesno" xpathOut="/tmp/@eraseAdvancedJoin"/>
                  <if expr="[/tmp/@eraseAdvancedJoin]='yes'">
                    <reset xpath="element/condition[*]"/>
                    <refresh xpath="element"/>
                  </if>
                  <if expr="[/tmp/@eraseAdvancedJoin]='no'">
                    <set value="1" xpath="@advancedJoin"/>
                  </if>
                </if>
                <if expr="@advancedJoin!='' AND @advancedJoin!=0 AND NodeCount([element/join])&gt;0">
                  <msgBox translatedExpr="'Do you want to delete the join conditions?'"
                          type="yesno" xpathOut="/tmp/@eraseAdvancedJoin"/>
                  <if expr="[/tmp/@eraseAdvancedJoin]='yes'">
                    <reset xpath="element/join[*]"/>
                  </if>
                  <if expr="[/tmp/@eraseAdvancedJoin]='no'">
                    <set value="0" xpath="@advancedJoin"/>
                  </if>
                </if>
              </enter>
            </input>
            <container type="visibleGroup" visibleIf="@advancedJoin!=1" xpath="element">
              <static label=" " nolabel="false" type="help">Select below the source and target fields that will be matched to build the join condition.</static>
              <input label=" " toolbarCaption="Join conditions" type="list" xpath="join">
                <input label="Remote field" schemaExpr="[../../@targetSchema]" type="pathEdit"
                       xpath="@xpath-dst"/>
                <input label="Local field" schemaExpr="[../../@filterSchema]" type="pathEdit"
                       xpath="@xpath-src"/>
              </input>
            </container>
            <container type="visibleGroup" visibleIf="@advancedJoin==1" xpath="element">
              <static label=" " nolabel="false" type="help">Select below the relationship conditions between source and target records. The 'joinTarget (Dynamic link)' link enables you to reference target fields to define joins.</static>
              <input label=" " name="filterList" noSaveFilter="true" toolbarAlign="horizontal"
                     toolbarCaption="Join conditions" type="conditionList" xpath="."
                     xpathCurrentLookupPath="/lookupPath/where" xpathSchema="../@filterSchema">
                <input colSize="15" label=" " xpath="/@bool-operator"/>
                <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                <input colSize="15" label="Operator" xpath="/@operator"/>
                <input colSize="30" label="Value" xpath="/@rightExpr"/>
              </input>
            </container>
          </container>
          <leave>
            <if expr="@tableName=='' OR ([@dataSource-id]==0 AND [dataSourceDesc/@server]='')">
              <reset xpath="extension"/>
            </if>
            <if expr="@tableName!='' AND ([@dataSource-id]!=0 OR [dataSourceDesc/@server]!='')">
              <set expr="wkfExternalSchema(@tableName, @dataSource, @tableName, 'extension')"
                   xpath="/ignored/dbImport/@schema"/>
            </if>
          </leave>
        </container>
        <container desc="Enter information used to specify how many collection elements you want to keep."
                   img="xtk:report/editor/insertColumnRight.png" name="parameters"
                   title="General parameters" visibleIf="[/tmp/queryAdd/@reverseLink]!=1 AND (([/tmp/queryAdd/@dataType]='linkedData' AND [/tmp/queryAdd/@recipientLink]!='') OR [/tmp/queryAdd/@dataType]='distantData' OR [/tmp/queryAdd/@dataType]='extSharedData' OR [/tmp/queryAdd/@dataType]='externalData')"
                   xpath="/tmp/queryAdd">
          <static type="help">Select an identifier and a label to easily find the stored values during the rest of segmentation.</static>
          <input label="Identifier" required="true" size="24" xpath="@collName"/>
          <container type="visibleGroup" visibleIf="IndexOf(@collNameList, '|' + @collName + '|')&gt;=0">
            <static type="warning">The identifier above is already used, the new configuration will replace the existing one.</static>
          </container>
          <input label="Label" xpath="@label"/>
          <input enum="xtk:queryDef:rowConditionType" label="Data collected" type="sysEnum"
                 xpath="@rowCount"/>
          <input expr="Iif(@rowCount&gt;1, 1, Iif(@rowCount=-1, 0, NodeValue('/tmp/queryAdd/@lineCount')))"
                 type="expr" xpath="@lineCount"/>
          <container type="visibleGroup" visibleIf="@rowCount==0 OR @rowCount==2">
            <input label="Lines to retrieve" type="number" xpath="@lineCount"/>
          </container>
          <container backcolor="tooltip" type="visibleGroup" visibleIf="@rowCount==1">
            <static type="warning">This mode optimizes the generated SQL query thanks to a direct join on the collection elements. \nWarning: if the initial condition isn't complied with, the result may be false (missing lines or duplicates).</static>
          </container>
          <container type="visibleGroup" visibleIf="@rowCount==2 AND @lineCount &gt; 1">
            <input label="Group aggregates based on the values in the sort columns"
                   type="checkBox" xpath="@useOrderByValuesAsRank"/>
            <static type="help">E.g.: In case of an aggregate calculation with a grouping on the last 5 years: - if the option is checked, aggregates will be calculated for the same 5 years for the entire population - if the option isn't checked, aggregates will be calculated for the last 5 years for each element of the population.</static>
          </container>
          <leave>
            <check expr="@collName!=''">
              <error>Please specify an identifier for the storage of additional data.</error>
            </check>
            <set translatedExpr="Iif(@rowCount=0, 'Several rows'+' - ' + @lineCount, Iif(@rowCount=1, 'Aggregates', 'Single row'))"
                 xpath="@collectDesc"/>
          </leave>
        </container>
        <container descExpr="'Enter the filtering condition for determining which collection elements to keep.\nAs a reminder, you have chosen to recover ' + Iif([/tmp/queryAdd/@rowCount]=0, [/tmp/queryAdd/@lineCount] + ' line(s)', Iif([/tmp/queryAdd/@rowCount]=1, 'a single row', 'aggregates'))"
                   img="xtk:filter32.png" title="Filter" visibleIf="[/tmp/queryAdd/@lineCount]&gt;0"
                   xpath="/tmp/queryAdd/collection">
          <enter>
            <if expr="[../@dataType]='extSharedData' or [../@dataType]='externalData'">
              <set expr="[../@targetSchema]" xpath="@schema"/>
            </if>
            <if expr="[../@dataType]='distantData'">
              <set expr="GetLinkSchema([../@filterSchema], [../@filterLink])" xpath="@schema"/>
            </if>
            <if expr="[../@dataType]='distantData' AND $(BUILD_NUMBER)&gt;6797">
              <set expr="wkfBuildTargetDataLink(GetLinkSchema([../@filterSchema], [../@filterLink]), [../@filterSchema])"
                   xpath="@schema"/>
            </if>
            <if expr="[../@dataType]='linkedData'">
              <set expr="[../@schema]" xpath="@schema"/>
            </if>
          </enter>
          <container buildQueryXPath="." ref="xtk:queryDef:where"/>
        </container>
        <container descExpr="'Indicate the sorting order which defines the lines to be kept in case the number of eligible lines exceeds the number of lines to recover following filtering.\nAs a reminder, you have chosen to recover ' + [/tmp/queryAdd/@lineCount] + ' line(s)'"
                   img="xtk:filter32.png" title="Sort" visibleIf="[/tmp/queryAdd/@rowCount]==3 OR [/tmp/queryAdd/@rowCount]==0 OR ([/tmp/queryAdd/@rowCount]==2 AND [/tmp/queryAdd/@lineCount]&gt;1)"
                   xpath="/tmp/queryAdd/collection">
          <container type="visibleGroup" visibleIf="[/tmp/queryAdd/@useOrderByValuesAsRank]">
            <input editable="false" name="sortList" nolabel="true" toolbarCaption="Sort columns"
                   type="orderByList" xpath="orderBy/node" xpathChoiceTarget="@expr"
                   xpathCurrentLookupPath="/lookupPath/orderBy" xpathHelp="/@help"
                   zoom="false">
              <input colSize="20" label="Label" xpath="@label"/>
              <input colSize="35" editable="true" label="Expression" type="pathedit"
                     xpath="@expr" xpathSchema="../../@schema"/>
              <input colSize="15" editable="true" label="Descending" type="checkbox"
                     xpath="@sortDesc"/>
              <input colSize="20" editable="true" label="Identifier" type="edit"
                     xpath="@alias"/>
            </input>
            <input fontBold="true" lineCount="4" noBorder="true" nolabel="true" readOnly="true"
                   type="edit" xpath="/@help"/>
          </container>
          <container type="visibleGroup" visibleIf="![/tmp/queryAdd/@useOrderByValuesAsRank]">
            <input editable="false" name="sortList" nolabel="true" toolbarCaption="Sort columns"
                   type="orderByList" xpath="orderBy/node" xpathChoiceTarget="@expr"
                   xpathCurrentLookupPath="/lookupPath/orderBy" xpathHelp="/@help"
                   zoom="false">
              <input colSize="20" label="Label" xpath="@label"/>
              <input colSize="35" editable="true" label="Expression" type="pathedit"
                     xpath="@expr" xpathSchema="../../@schema"/>
              <input colSize="15" editable="true" label="Descending" type="checkbox"
                     xpath="@sortDesc"/>
            </input>
            <input fontBold="true" lineCount="4" noBorder="true" nolabel="true" readOnly="true"
                   type="edit" xpath="/@help"/>
          </container>
        </container>
        <container desc="Select the data to keep." img="xtk:filter32.png" title="Data to add"
                   visibleIf="[/tmp/queryAdd/@rowCount]!=-1 AND ([/tmp/queryAdd/@dataType]='linkedData' OR [/tmp/queryAdd/@dataType]='distantData' OR [/tmp/queryAdd/@dataType]='extSharedData' OR [/tmp/queryAdd/@dataType]='externalData')"
                   xpath="/tmp/queryAdd/collection">
          <enter>
            <set expr="Iif([/tmp/queryAdd/@rowCount]=2 OR ([/tmp/selectCtrl/in/@recipientLink]!='' AND @recipientLink=''), 'aggregate', '')"
                 xpath="/tmp/selectCtrl/in/@choiceType"/>
          </enter>

          <container hideUnboundPath="false" name="selectCtrl" type="querySelectContainer"
                     xpath=".">
      <!-- Attention querySelectContainer container enrich this form defintion.
               Therefore container and hierarchy shouldn't be changes -->
            <container name="vpaned" type="vpaned">
              <container name="schema">
                <static fontBold="true" label="Available fields:"/>
                <container colcount="2">
                  <static img="xtk:filter.png" type="image"/>
                  <input catchReturnKey="true" label="Find" type="edit" xpath="/tmp/selectCtrl/itn/@search"/>
                </container>
                <input checkDuplicates="false" hideMappedAsXml="true" name="schemaView"
                       showLinks1="true" type="SchemaView" xpath="/tmp/queryAdd/collection/@schema"
                       xpathFilter="85" xpathHelp="/tmp/selectCtrl/itn/@help" xpathIndex="/tmp/selectCtrl/itn/@current"
                       xpathSearchPath="/tmp/selectCtrl/itn/@search" xpathSelect="select/node/@expr"/>
              </container>
              <container name="output" xpathsToLoad="output*">
                <static fontBold="true" label="Output columns:"/>
                <input name="columnList" nolabel="true" prebuildSubForm="false" toolbarAlign="vertical"
                       type="columnList" xpath="select/node" xpathCurrentLookupPath="/lookupPath/select"
                       xpathGroupBy="groupBy/node" xpathGroupOption="/tmp/selectCtrl/out/@group"
                       xpathHasMemoData="/tmp/selectCtrl/itn/@hasMemoData" xpathHaving="having/condition"
                       xpathHelp="/tmp/selectCtrl/itn/@help" xpathSchema="/tmp/queryAdd/collection/@schema"
                       xpathSelection="/tmp/outputColumn/itn/@current" zoom="false">
                  <input colSize="20" label="Label" xpath="@label"/>
                  <input colSize="35" label="Expression" type="pathedit" useUnboundPath="true"
                         xpath="@expr" xpathChoiceType="/tmp/selectCtrl/in/@choiceType"
                         xpathSchema="/tmp/queryAdd/collection/@schema"/>
                  <input colSize="20" label="Alias" xpath="@alias"/>
                  <input colSize="20" label="Group" type="checkbox" xpath="@groupBy"/>

            <!-- Form description of column -->
                  <form label="Column definition" name="colDetail">
                    <input xpath="@label"/>
                    <container name="extraFields"/>
              <!-- empty container in which edit controls may be
                                               added by the top level querySelectContainer -->
                    <input noTransaction="true" type="expredit" xpath="@expr" xpathSchema="/tmp/queryAdd/collection/@schema"/>
              <!-- Expression editor description -->
                    <container type="visibleGroup" visibleIf="[/tmp/selectCtrl/itn/@advancedMode]">
                      <container colcount="2" cols-width="100,1">
                        <container>
                          <static fontBold="true" label="Available fields:"/>
                          <container colcount="2">
                            <static img="xtk:filter.png" type="image"/>
                            <input catchReturnKey="true" label="Find" type="edit"
                                   xpath="/tmp/selectCtrl/itn/@search"/>
                          </container>
                          <input type="schemaview" xpath="/tmp/queryAdd/collection/@schema"
                                 xpathExpr="@expr" xpathHelp="/tmp/selectCtrl/itn/@help"
                                 xpathSearchPath="/tmp/selectCtrl/itn/@search" xpathStartPath="/tmp/selectCtrl/in/@startPath"/>
                        </container>
                        <input type="functionview" xpathExpr="@expr" xpathHelp="/tmp/selectCtrl/itn/@help"/>
                      </container>
                      <input type="help" xpath="/tmp/selectCtrl/itn/@help"/>
                    </container>
                    <input label="Advanced mode" nolabel="true" type="checkbox" xpath="/tmp/selectCtrl/itn/@advancedMode"/>
                  </form>
                </input>
              </container>
            </container>
            <input type="help" xpath="/tmp/selectCtrl/itn/@help"/>
          </container>
        </container>
        <container desc="Select the type of link and the target of your link." img="nms:activities/links.png"
                   title="Link definition" visibleIf="SubString([/tmp/queryAdd/@dataType],0,7)='linkDef'"
                   xpath="/tmp/queryAdd">
          <enter>
            <if expr="[linkedDef/@useTempSchema]==''">
              <set value="0" xpath="linkedDef/@useTempSchema"/>
            </if>
          </enter>
          <static label="Link type" type="separator"/>
          <container colcount="2">
            <input img="xtk:xtklinkn.png" type="image"/>
            <input checkedValue="linkDefColl" label="Define a collection" type="radioButton"
                   xpath="@dataType"/>
            <input img="xtk:xtklink1.png" type="image"/>
            <input checkedValue="linkDef" label="Define a link whose target is always available"
                   type="radioButton" xpath="@dataType"/>
            <input img="xtk:xtklink0.png" type="image"/>
            <input checkedValue="linkDefExt" label="Define a link whose target may not exist in the database"
                   type="radioButton" xpath="@dataType"/>
            <container colcount="2" colspan="2" type="visibleGroup" visibleIf="[/tmp/queryAdd/@entityName]='enrich'">
              <input img="xtk:xtklinkr.png" type="image"/>
              <input checkedValue="linkDefRef" label="Define a link by searching for a reference among several options"
                     type="radioButton" xpath="@dataType"/>
              <static colspan="2" type="help">This last option lets you define possible deduplication conditions in case of insufficient join conditions.</static>
            </container>
          </container>
          <static label="Link target" type="separator"/>
          <container>
            <input checkedValue="0" label="Database schema" type="RadioButton" xpath="linkedDef/@useTempSchema"/>
            <input checkedValue="1" label="Temporary schema" type="RadioButton" xpath="linkedDef/@useTempSchema"/>
            <container type="visibleGroup" visibleIf="[linkedDef/@useTempSchema]==0">
              <input label="Target schema" schema="xtk:schema" type="schemaEdit"
                     xpath="linkedDef/@schema"/>
            </container>
            <container type="visibleGroup" visibleIf="[linkedDef/@useTempSchema]==1">
              <input label="Target schema" type="ExclusionMainSetEdit" xpath="linkedDef/@srcDataSet"
                     xpathActivityName="@activityName"/>
              <input expr="wkfSchemaName([linkedDef/@srcDataSet])" type="expr" xpath="linkedDef/@schema"/>
            </container>
          </container>
          <leave>
            <check expr="[linkedDef/@schema]!=''">
              <error>Please define the link target.</error>
            </check>
          </leave>
        </container>
        <container desc="Enter the keys for linking the document to the target of your link"
                   img="nms:activities/links.png" title="Link definition" visibleIf="SubString([/tmp/queryAdd/@dataType], 0, 7)='linkDef'"
                   xpath="/tmp/queryAdd/linkedDef">
          <enter>
            <set expr="Iif(@advancedJoin=='', 0, @advancedJoin)" xpath="@advancedJoin"/>
            <if expr="[../@collName]=''">
              <set expr="ExtractRight(@schema, ':')" xpath="../@collName"/>
              <set value="[.]" xpath="../@rootXPath"/>
              <set expr="LabelOf('/tmp/queryAdd/@rootXPath', '/tmp/queryAdd/linkedDef/@schema')"
                   xpath="../@label"/>
            </if>
            <set value="-2" xpath="/tmp/queryAdd/@rowCount"/>
          </enter>
          <input label="Identifier" required="true" xpath="../@collName"/>
          <container type="visibleGroup" visibleIf="IndexOf([../@collNameList], '|' + [../@collName] + '|')&gt;=0">
            <static type="warning">The identifier above is already used, the new configuration will replace the existing one</static>
          </container>
          <input label="Label" xpath="../@label"/>
          <static label="Join conditions" type="separator"/>
          <input checkedValue="0" label="Use a simple join" nolabel="false" type="radioButton"
                 xpath="@advancedJoin"/>
          <input checkedValue="1" label="Advanced join conditions" nolabel="false"
                 type="radioButton" xpath="@advancedJoin"/>
          <container type="visibleGroup" visibleIf="[/tmp/queryAdd/@dataType] = 'linkDefRef'">
            <input checkedValue="2" label="Reconciliation rules" nolabel="false"
                   type="radioButton" xpath="@advancedJoin"/>
          </container>
          <input expr="wkfAddLinkDefToSchema([/tmp/queryAdd/@schema], 'joinTarget', [/ignored/@advancedJoinLinkLabel], Iif( [@advancedJoin]!=0, @schema, ''))"
                 type="expr" xpath="/ignored/@advancedJoinQueryAddSchema">
            <enter>
              <if expr="@advancedJoin!='' AND @advancedJoin!=1 AND NodeCount([join/condition])&gt;0">
                <msgBox translatedExpr="'Do you want to delete the advanced join conditions?'"
                        type="yesno" xpathOut="/tmp/@eraseAdvancedJoin"/>
                <if expr="[/tmp/@eraseAdvancedJoin]='yes'">
                  <reset xpath="join/condition[*]"/>
                  <refresh xpath="join"/>
                </if>
                <if expr="[/tmp/@eraseAdvancedJoin]='no'">
                  <set value="1" xpath="@advancedJoin"/>
                </if>
              </if>
              <if expr="@advancedJoin!='' AND @advancedJoin!=0 AND NodeCount([condition])&gt;0">
                <msgBox translatedExpr="'Do you want to delete the join conditions?'"
                        type="yesno" xpathOut="/tmp/@eraseAdvancedJoin"/>
                <if expr="[/tmp/@eraseAdvancedJoin]='yes'">
                  <reset xpath="condition[*]"/>
                </if>
                <if expr="[/tmp/@eraseAdvancedJoin]='no'">
                  <set value="0" xpath="@advancedJoin"/>
                </if>
              </if>
            </enter>
          </input>
          <container type="visibleGroup" visibleIf="@advancedJoin==0">
            <static label=" " nolabel="false" type="help">Select below the source and target fields that will be matched to build the join condition.</static>
            <input label=" " toolbarCaption="Join conditions" type="list" xpath="condition">
              <input label="Source" type="pathEdit" xpath="@srcExpr" xpathSchema="/tmp/queryAdd/@schema"/>
              <input label="Target" type="pathEdit" xpath="@dstExpr" xpathSchema="../@schema"/>
            </input>
          </container>
          <container type="visibleGroup" visibleIf="@advancedJoin==1">
            <static label=" " nolabel="false" type="help">Select below the relationship conditions between source and target records. The 'joinTarget (Dynamic link)' link enables you to reference target fields to define joins.</static>
            <input label=" " name="filterList" noSaveFilter="true" toolbarAlign="horizontal"
                   toolbarCaption="Join conditions" type="conditionList" xpath="join"
                   xpathCurrentLookupPath="/lookupPath/where" xpathSchema="/tmp/queryAdd/@schema">
              <input colSize="15" label=" " xpath="/@bool-operator"/>
              <input colSize="30" label="Expression" xpath="/@leftExpr"/>
              <input colSize="15" label="Operator" xpath="/@operator"/>
              <input colSize="30" label="Value" xpath="/@rightExpr"/>
            </input>
          </container>
          <container colspan="2" type="visibleGroup" visibleIf="@advancedJoin=2">
            <static label=" " nolabel="false" type="help">Select the conditions for reconciling source and target records below. When reconciliation criteria aren't reliable enough, you can refine reconciliation using proximity scores. The 'joinTarget (Dynamic link)' link lets you reference the fields of the target to define the join.</static>
            <container label=" " nolabel="false" style="down" type="notebook">
              <container label="Identification">
                <input editable="false" nolabel="true" prebuildSubForm="false" toolbarCaption="Reconciliations"
                       type="list" xpath="keys" xpathToIgnore="keys/scoreRule" zoom="true"
                       zoomOnAdd="true">
                  <input editable="true" expr="Iif(@label!='', @label, [join/@displayFilter])"
                         label="Identification conditions" xpath="@label"/>
                  <input expr="Iif(@scoresApplied!='none', @minScore, '')" label="Required score"/>
                  <input expr="Iif(@scoresApplied=='all', [/ignored/@allLabel], Iif(@scoresApplied=='select', GroupConcat(scoreRule, &quot; '[' + @name + ']' &quot; ), ''))"
                         label="Scores taken into account"/>
                  <form title="Reconciliation rule" type="wizard">
                    <enter>
                      <set value="true" xpath="@active"/>
                      <set expr="Iif(@id!='', @id, Gid())" xpath="@id"/>
                      <set expr="Iif(@scoresApplied=='none' OR @scoresApplied=='', 0, 1)"
                           xpath="/tmp/@ruleReconcWithScore"/>
                      <set expr="Iif(@scoresApplied!='select', 0, 1)" xpath="/tmp/@ruleReconcRuleSel"/>
                    </enter>
                    <container desc="Specify below the conditions for identifying the target record"
                               title="Join conditions">
                      <input label="label" xpath="@label"/>
                      <input label=" " name="filterList" noSaveFilter="true" nolabel="true"
                             toolbarAlign="horizontal" toolbarCaption="Reconciliation conditions"
                             type="conditionList" xpath="join" xpathCurrentLookupPath="/lookupPath/where"
                             xpathHelp="join/@displayFilter" xpathSchema="/tmp/selectCtrl/in/@schema">
                        <input colSize="15" label=" " xpath="/@bool-operator"/>
                        <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                        <input colSize="15" label="Operator" xpath="/@operator"/>
                        <input colSize="30" label="Value" xpath="/@rightExpr"/>
                      </input>
                      <input checkedValue="1" label="Refine reconciliation using proximity scores"
                             nolabel="true" type="checkBox" unCheckedValue="0" xpath="/tmp/@ruleReconcWithScore"/>
                    </container>
                    <container desc="Select below the proximity scores to be taken into account to refine reconciliation, then define the reconciliation approval threshold."
                               title="Proximity scores" visibleIf="[/tmp/@ruleReconcWithScore]=1">
                      <enter>
                        <reset xpath="/tmp/ruleReconcSel"/>
                        <copyElement list="true" xpathDst="/tmp/ruleReconcSel/rules"
                                     xpathSrc="../scoreRule"/>
                        <forEach xpath="scoreRule">
                          <set value="1" xpathExpr="'/tmp/ruleReconcSel/rules/scoreRule[@name=\''+@name+'\']/@sel'"/>
                        </forEach>
                      </enter>
                      <input checkedValue="0" label="All calculation rules" nolabel="true"
                             type="radioButton" xpath="/tmp/@ruleReconcRuleSel"/>
                      <input checkedValue="1" label="A selection of rules" nolabel="true"
                             type="radioButton" xpath="/tmp/@ruleReconcRuleSel"/>
                      <container enabledIf="[/tmp/@ruleReconcRuleSel]==1" type="enabledGroup">
                        <input noToolbar="true" nolabel="true" type="list" xpath="/tmp/ruleReconcSel/rules/scoreRule">
                          <input colSize="10" label="Selected" type="checkBox" xpath="@sel"/>
                          <input label="Proximity score" xpath="@name"/>
                          <input label="Score" xpath="@score"/>
                        </input>
                      </container>
                      <static type="help">Specify below the minimum proximity score required to approve reconciliation.</static>
                      <input label="Minimum score" type="number" xpath="@minScore"/>
                    </container>
                    <leave>
                      <set expr="Iif([/tmp/@ruleReconcWithScore]==0, 'none', IIf([/tmp/@ruleReconcRuleSel]==0, 'all', 'select'))"
                           xpath="@scoresApplied"/>
                      <if expr="[/tmp/@ruleReconcRuleSel]==1 AND [/tmp/@ruleReconcWithScore]==1">
                        <reset xpath="scoreRule[*]"/>
                        <copyElement filter="@sel=1" list="true" xpathDst="." xpathSrc="/tmp/ruleReconcSel/rules/scoreRule"/>
                      </if>
                    </leave>
                  </form>
                </input>
              </container>
              <container label="Proximity scores">
                <input editable="false" nolabel="true" prebuildSubForm="false" toolbarCaption="Calculation rules of the proximity score"
                       type="list" xpath="scoreRule" zoom="true" zoomOnAdd="true">
                  <input label="Name" xpath="@name"/>
                  <input label="Score" xpath="@score"/>
                  <input label="Condition" xpath="join/@displayFilter"/>
                  <form colcount="2" label="Proximity score">
                    <enter>
                      <set value="true" xpath="@active"/>
                      <set expr="Iif(@id!='', @id, Gid())" xpath="@id"/>
                    </enter>
                    <input label="Name" xpath="@name"/>
                    <input label="Score" type="number" xpath="@score"/>
                    <input colspan="2" name="filterList" noSaveFilter="true" nolabel="true"
                           toolbarAlign="horizontal" toolbarCaption="Conditions for triggering score adding"
                           type="conditionList" xpath="join" xpathCurrentLookupPath="/lookupPath/where"
                           xpathHelp="join/@displayFilter" xpathSchema="/tmp/selectCtrl/in/@schema">
                      <input colSize="15" label=" " xpath="/@bool-operator"/>
                      <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                      <input colSize="15" label="Operator" xpath="/@operator"/>
                      <input colSize="30" label="Value" xpath="/@rightExpr"/>
                    </input>
                  </form>
                </input>
              </container>
            </container>
          </container>
          <container type="visibleGroup" visibleIf="[../@dataType]=='linkDefRef'">
            <input img="xtk:properties.png" label="Advanced parameters..." nolabel="false"
                   type="subFormLink" xpath=".">
              <form label="Link definition: advanced parameters">
                <enter>
                  <set expr="Iif(@singleRow!=1, Iif(NodeCount([where/condition])=0 AND NodeCount([orderBy/node])=0, 1, 2), 0)"
                       xpath="/tmp/@linkDedup"/>
                  <set expr="wkfBuildTargetDataLink(@schema, [/tmp/selectCtrl/in/@schema])"
                       xpath="/tmp/@linkDedupSchema"/>
                </enter>
                <static label="Link handling" type="separator"/>
                <input type="pathEdit" xpath="@enabledIf" xpathSchema="/tmp/selectCtrl/in/@schema"/>
                <input label="Authorize empty values during reconciliation" type="checkBox"
                       xpath="@allowEmptyPart"/>
                <static label="Deduplication" type="separator"/>
                <input checkedValue="1" label="Choose for me from those that match a filter"
                       type="radioButton" xpath="/tmp/@linkDedup"/>
                <container type="visibleGroup" visibleIf="[/tmp/@linkDedup]=1">
                  <container type="visibleGroup" visibleIf="NodeCount([where/condition])=0">
                    <input label="Add a filter for target records..." nolabel="false"
                           type="subformLink" xpath=".">
                      <form label="Link target filter">
                        <input name="filterList" noSaveFilter="true" nolabel="true"
                               toolbarAlign="horizontal" toolbarCaption="Filter conditions"
                               type="conditionList" xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                               xpathHelp="where/@displayFilter" xpathSchema="@schema">
                          <input colSize="15" label=" " xpath="/@bool-operator"/>
                          <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                          <input colSize="15" label="Operator" xpath="/@operator"/>
                          <input colSize="30" label="Value" xpath="/@rightExpr"/>
                        </input>
                      </form>
                    </input>
                  </container>
                  <container type="visibleGroup" visibleIf="NodeCount([where/condition])&gt;0">
                    <input label="Edit the filter..." nolabel="false" type="subformLink"
                           xpath=".">
                      <form label="Link target filter">
                        <input name="filterList" noSaveFilter="true" nolabel="true"
                               toolbarAlign="horizontal" toolbarCaption="Filter conditions"
                               type="conditionList" xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                               xpathHelp="where/@displayFilter" xpathSchema="@schema">
                          <input colSize="15" label=" " xpath="/@bool-operator"/>
                          <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                          <input colSize="15" label="Operator" xpath="/@operator"/>
                          <input colSize="30" label="Value" xpath="/@rightExpr"/>
                        </input>
                      </form>
                    </input>
                    <input label=" " lineCount="4" xpath="where/@displayFilter"/>
                  </container>
                </container>
                <input checkedValue="0" label="Do not deduplicate linked records (Expert mode - only one record matches the criteria)"
                       type="radioButton" xpath="/tmp/@linkDedup"/>
                <container type="visibleGroup" visibleIf="[/tmp/@linkDedup]=2">
                  <container type="visibleGroup" visibleIf="NodeCount([where/condition])=0">
                    <input label="Add a filter for target records..." nolabel="false"
                           type="subformLink" xpath=".">
                      <form label="Link target filter">
                        <input name="filterList" noSaveFilter="true" nolabel="true"
                               toolbarAlign="horizontal" toolbarCaption="Filter conditions"
                               type="conditionList" xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                               xpathHelp="where/@displayFilter" xpathSchema="@schema">
                          <input colSize="15" label=" " xpath="/@bool-operator"/>
                          <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                          <input colSize="15" label="Operator" xpath="/@operator"/>
                          <input colSize="30" label="Value" xpath="/@rightExpr"/>
                        </input>
                      </form>
                    </input>
                  </container>
                  <container type="visibleGroup" visibleIf="NodeCount([where/condition])&gt;0">
                    <input label="Edit the filter..." nolabel="false" type="subformLink"
                           xpath=".">
                      <form label="Link target filter">
                        <input name="filterList" noSaveFilter="true" nolabel="true"
                               toolbarAlign="horizontal" toolbarCaption="Filter conditions"
                               type="conditionList" xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                               xpathHelp="where/@displayFilter" xpathSchema="@schema">
                          <input colSize="15" label=" " xpath="/@bool-operator"/>
                          <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                          <input colSize="15" label="Operator" xpath="/@operator"/>
                          <input colSize="30" label="Value" xpath="/@rightExpr"/>
                        </input>
                      </form>
                    </input>
                    <input label=" " lineCount="4" xpath="where/@displayFilter"/>
                  </container>
                </container>
                <input checkedValue="2" label="Specify the selection and deduplication conditions of records"
                       type="radioButton" xpath="/tmp/@linkDedup"/>
                <container type="visibleGroup" visibleIf="[/tmp/@linkDedup]=2">
                  <container style="flat" type="notebook">
                    <container label="Filter">
                      <input name="filterList" noSaveFilter="true" nolabel="true"
                             toolbarAlign="horizontal" toolbarCaption="Filter conditions"
                             type="conditionList" xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                             xpathSchema="@schema">

                        <input colSize="15" label=" " xpath="/@bool-operator"/>
                        <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                        <input colSize="15" label="Operator" xpath="/@operator"/>
                        <input colSize="30" label="Value" xpath="/@rightExpr"/>
                      </input>
                    </container>
                    <container label="Sort">
                      <input editable="false" name="sortList" nolabel="true" toolbarCaption="Sort columns"
                             type="orderByList" xpath="orderBy/node" xpathChoiceTarget="@expr"
                             xpathCurrentLookupPath="/lookupPath/orderBy" xpathHelp="/@help"
                             xpathSchema="@schema" zoom="false">
                        <input colSize="20" label="Label" xpath="@label"/>
                        <input choiceType="sortAggregate" colSize="35" editable="true"
                               label="Expression" type="pathedit" xpath="@expr" xpathSchema="../../@schema"/>
                        <input colSize="15" editable="true" label="Descending sort"
                               type="checkbox" xpath="@sortDesc"/>
                      </input>
                    </container>
                  </container>
                </container>
                <leave>
                  <set expr="Iif([/tmp/@linkDedup]&gt;0, 0, 1)" xpath="@singleRow"/>
                  <if expr="[/tmp/@linkDedup]=1">
                    <reset xpath="orderBy"/>
                  </if>
                </leave>
              </form>
            </input>
          </container>
        </container>
        <leave>
          <set expr="wkfAddLinkDefToSchema([/tmp/queryAdd/@schema], 'joinTarget', [/ignored/@advancedJoinLinkLabel], '')"
               xpath="/ignored/@advancedJoinQueryAddSchema"/>
          <set expr="ToIdentifier([/tmp/queryAdd/@collName])" xpath="/tmp/queryAdd/@collName"/>
          <check expr="[/tmp/queryAdd/@collName]!=''">
            <error>Please specify an identifier for the storage of additional data.</error>
          </check>
          <if expr="[/tmp/queryAdd/@dataType]='extSharedData' OR [/tmp/queryAdd/@dataType]='externalData'">
            <set expr="Iif([/tmp/queryAdd/@dataType]='extSharedData', 'nms:extAccount:'+[/tmp/queryAdd/dataSourceDesc/@name], 'crypted:'+AESEncrypt([/tmp/queryAdd/@dataSource]))"
                 xpath="/tmp/queryAdd/extension/element/@dataSource"/>
            <set expr="[/tmp/queryAdd/@label]" xpath="/tmp/queryAdd/extension/@label"/>
            <set expr="[/tmp/queryAdd/@label]" xpath="/tmp/queryAdd/extension/element/@label"/>
            <copyElement exprDst="'extension/schema[@name=\''+[/tmp/queryAdd/@tableName]+'\']'"
                         xpathSrc="/tmp/queryAdd/extension"/>
            <set expr="[/tmp/queryAdd/@targetSchema]" xpath="/tmp/queryAdd/element/@target"/>
            <set expr="@name + '_' + ToIdentifier([/tmp/queryAdd/@tableName])" xpath="/tmp/queryAdd/element/@name"/>
            <set expr="[/tmp/queryAdd/@label]" xpath="/tmp/queryAdd/element/@label"/>
            <set value="1" xpath="/tmp/queryAdd/element/@unbound"/>
            <set value="link" xpath="/tmp/queryAdd/element/@type"/>
            <if expr="[/tmp/queryAdd/@reverseLink]=1">
              <set expr="@name + '_' + ExtractRight([/tmp/selectCtrl/in/@schema], ':')"
                   xpath="/tmp/queryAdd/element/@revLink"/>
            </if>
            <copyElement exprDst="'extension/schema[@name=\''+ ExtractRight([/tmp/selectCtrl/in/@schema], ':')+'\']/element[@name=\''+ ExtractRight([/tmp/selectCtrl/in/@schema], ':')+'\']/element[@name=\'' + @name + '_' + ToIdentifier([/tmp/queryAdd/@tableName]) + '\']'"
                         xpathSrc="/tmp/queryAdd/element"/>
            <set expr="Extract([/tmp/selectCtrl/in/@schema], ':')" xpathExpr="'extension/schema[@name=\''+ ExtractRight([/tmp/selectCtrl/in/@schema], ':')+'\']/@namespace'"/>
            <set expr="[/tmp/selectCtrl/in/@schema]" xpathExpr="'extension/schema[@name=\''+ ExtractRight([/tmp/selectCtrl/in/@schema], ':')+'\']/@extendedSchema'"/>
          </if>
          <if expr="[/tmp/queryAdd/@reverseLink]!=1 AND SubString([/tmp/queryAdd/@dataType],0,7)!='linkDef'">
            <set expr="[/tmp/queryAdd/@collName]" xpath="/tmp/queryAdd/collection/@alias"/>
            <if expr="[/tmp/queryAdd/@dataType]='linkedData' AND [/tmp/queryAdd/@recipientLink]!=''">
              <set expr="GetRevXPath([/tmp/queryAdd/@schema], [/tmp/queryAdd/@recipientLink])"
                   xpath="/tmp/queryAdd/collection/select/@expr"/>
            </if>
            <if expr="[/tmp/queryAdd/@dataType]='distantData'">
              <set expr="[/tmp/queryAdd/@filterLink]" xpath="/tmp/queryAdd/collection/select/@expr"/>
            </if>
            <if expr="[/tmp/queryAdd/@dataType]='extSharedData' OR [/tmp/queryAdd/@dataType]='externalData'">
              <set expr="@name + '_' + ToIdentifier([/tmp/queryAdd/@tableName])"
                   xpath="/tmp/queryAdd/collection/select/@expr"/>
            </if>
            <set expr="[/tmp/queryAdd/@label]" xpath="/tmp/queryAdd/collection/select/@label"/>
            <set expr="ExpandXPath([/tmp/queryAdd/collection/select/@expr])" xpath="/tmp/queryAdd/collection/select/@expr"/>
            <set expr="[/tmp/queryAdd/@collName]" xpath="/tmp/queryAdd/collection/select/@alias"/>
            <set value="1" xpath="/tmp/queryAdd/collection/select/@noComputeString"/>
            <set expr="[/tmp/queryAdd/@label]" xpath="/tmp/queryAdd/collection/@label"/>
            <if expr="[/tmp/queryAdd/@dataType]='linkedData' OR [/tmp/queryAdd/@dataType]='distantData' OR [/tmp/queryAdd/@dataType]='extSharedData' OR [/tmp/queryAdd/@dataType]='externalData'">
              <set expr="Iif(StartWith([/tmp/queryAdd/collection/select/@expr], '['), SubString([/tmp/queryAdd/collection/select/@expr], 1, StrLen([/tmp/queryAdd/collection/select/@expr])-2),[/tmp/queryAdd/collection/select/@expr])"
                   xpath="/tmp/queryAdd/collection/@xpath"/>
            </if>
            <if expr="[/tmp/queryAdd/@dataType]='score'">
              <set expr="'ToDouble(PredictiveScore(\''+[/tmp/queryAdd/@predictiveModel-name]+'\'))'"
                   xpath="/tmp/queryAdd/collection/select/@expr"/>
            </if>
            <if expr="[/tmp/queryAdd/@dataType]='offer'">
              <set expr="NodeValue('/tmp/queryAdd/offerCategory')" xpath="/tmp/queryAdd/@offerCategory-id"/>
              <set expr="[/tmp/queryAdd/@label]" xpath="/tmp/queryAdd/collection/@label"/>
              <set expr="@name + '_prop_' + [/tmp/queryAdd/@collName]" xpath="/tmp/queryAdd/collection/@xpath"/>
              <set value="nms:offerView" xpath="/tmp/queryAdd/@outputSchema"/>
              <if expr="[/tmp/queryAdd/@calcOffer]='forced'">
                <set expr="'Propositions(\'' + [/tmp/queryAdd/@offer-name] + '\', \'' + [/tmp/queryAdd/@offerEnv-name] + ':' + [/tmp/queryAdd/@offerSpace-name]+'\', #'+[/tmp/queryAdd/@contactDate]+'#)'"
                     xpath="/tmp/queryAdd/collection/@expr"/>
                <set expr="[/tmp/queryAdd/@offer-id]" xpath="/tmp/queryAdd/collection/select/node/@expr"/>
                <set value="@offer-id" xpath="/tmp/queryAdd/collection/select/node/@alias"/>
                <set value="[@offer-id]" xpath="/tmp/queryAdd/@channelXPath"/>
                <set expr="LabelOf('/tmp/queryAdd/@channelXPath', '/tmp/queryAdd/@outputSchema')"
                     xpath="/tmp/queryAdd/collection/select/node/@label"/>
              </if>
              <if expr="[/tmp/queryAdd/@calcOffer]!='forced'">
                <if expr="[/tmp/queryAdd/@offerCategory-id]!='' AND [/tmp/queryAdd/@offerCategory-id]!=0">
                  <set value="nms:offerCategory" xpath="/ignored/queryDefCategCheck/@schema"/>
                  <set value="get" xpath="/ignored/queryDefCategCheck/@operation"/>
                  <set value="[.]" xpath="/ignored/queryDefCategCheck/select/node/@expr"/>
                  <set value="@id" xpath="/ignored/queryDefCategCheck/select/node[2]/@expr"/>
                  <set value="@name" xpath="/ignored/queryDefCategCheck/select/node[3]/@expr"/>
                  <set expr="'@id='+[/tmp/queryAdd/@offerCategory-id]" xpath="/ignored/queryDefCategCheck/where/condition/@expr"/>
                  <soapCall name="ExecuteQuery" service="xtk:queryDef">
                    <param exprIn="[/ignored/queryDefCategCheck]" type="DOMDocument"/>
                    <param type="DOMDocument" xpathOut="/ignored/queryAddCateg"/>
                  </soapCall>
                  <set expr="[/ignored/queryAddCateg/@name]" xpath="/tmp/queryAdd/@offerCategory-name"/>
                </if>
                <set expr="'Propositions('+[/tmp/queryAdd/@offerSpace-id]+', '+Iif([/tmp/queryAdd/@offerCategory-id]='', 0, [/tmp/queryAdd/@offerCategory-id])+', \''+[/tmp/queryAdd/@offerThemes]+'\', #'+[/tmp/queryAdd/@contactDate]+'#)'"
                     xpath="/tmp/queryAdd/collection/@expr"/>
              </if>
              <set expr="[/tmp/queryAdd/@propositionSchema]" xpath="/tmp/queryAdd/collection/@schema"/>
              <set expr="@name + '_prop_' + [/tmp/queryAdd/@collName]" xpath="/tmp/queryAdd/collection/select/@expr"/>
              <set expr="[/tmp/queryAdd/@channel]" xpath="/tmp/queryAdd/collection/select/node[-1]/@expr"/>
              <set expr="NodeCount([/tmp/queryAdd/collection/select/node])" xpath="/tmp/queryAdd/@nodeCount"/>
              <set value="@channel" xpathExpr="'/tmp/queryAdd/collection/select/node[' + [/tmp/queryAdd/@nodeCount] + ']/@alias'"/>
              <set value="nms:delivery:@messageType" xpathExpr="'/tmp/queryAdd/collection/select/node[' + [/tmp/queryAdd/@nodeCount] + ']/@ref'"/>
              <set value="[offerSpace/@channel]" xpath="/tmp/queryAdd/@channelXPath"/>
              <set expr="LabelOf('/tmp/queryAdd/@channelXPath', '/tmp/queryAdd/collection/@schema')"
                   xpathExpr="'/tmp/queryAdd/collection/select/node[' + [/tmp/queryAdd/@nodeCount] + ']/@label'"/>
              <set expr="[/tmp/queryAdd/@offerSpace-id]" xpath="/tmp/queryAdd/collection/select/node[-1]/@expr"/>
              <set expr="NodeCount([/tmp/queryAdd/collection/select/node])" xpath="/tmp/queryAdd/@nodeCount"/>
              <set value="@offerSpace-id" xpathExpr="'/tmp/queryAdd/collection/select/node[' + [/tmp/queryAdd/@nodeCount] + ']/@alias'"/>
              <set value="[@offerSpace-id]" xpath="/tmp/queryAdd/@channelXPath"/>
              <set expr="LabelOf('/tmp/queryAdd/@channelXPath', '/tmp/queryAdd/collection/@schema')"
                   xpathExpr="'/tmp/queryAdd/collection/select/node[' + [/tmp/queryAdd/@nodeCount] + ']/@label'"/>
              <set expr="'\'nms:offerView\''" xpath="/tmp/queryAdd/collection/select/node[-1]/@expr"/>
              <set expr="NodeCount([/tmp/queryAdd/collection/select/node])" xpath="/tmp/queryAdd/@nodeCount"/>
              <set value="@offerViewSchema" xpathExpr="'/tmp/queryAdd/collection/select/node[' + [/tmp/queryAdd/@nodeCount] + ']/@alias'"/>
              <set value="nms:offerView" xpath="/tmp/queryAdd/@channelXPath"/>
              <set expr="SchemaLabel('/tmp/queryAdd/@channelXPath')" xpathExpr="'/tmp/queryAdd/collection/select/node[' + [/tmp/queryAdd/@nodeCount] + ']/@label'"/>
              <set value="offer" xpath="/tmp/queryAdd/collection/select/node[-1]/@expr"/>
              <set expr="NodeCount([/tmp/queryAdd/collection/select/node])" xpath="/tmp/queryAdd/@nodeCount"/>
              <set value="offer" xpath="/tmp/queryAdd/@channelXPath"/>
              <set expr="LabelOf('/tmp/queryAdd/@channelXPath', '/tmp/queryAdd/@outputSchema')"
                   xpathExpr="'/tmp/queryAdd/collection/select/node[' + [/tmp/queryAdd/@nodeCount] + ']/@label'"/>
              <set value="offerSpace" xpath="/tmp/queryAdd/collection/select/node[-1]/@expr"/>
              <set expr="NodeCount([/tmp/queryAdd/collection/select/node])" xpath="/tmp/queryAdd/@nodeCount"/>
              <set value="offerSpace" xpath="/tmp/queryAdd/@channelXPath"/>
              <set translatedExpr="'Location'" xpathExpr="'/tmp/queryAdd/collection/select/node[' + [/tmp/queryAdd/@nodeCount] + ']/@label'"/>
              <set expr="@name + '_prop_' + [/tmp/queryAdd/@collName]" xpath="/tmp/queryAdd/collection/select/node[-1]/@expr"/>
              <set expr="NodeCount([/tmp/queryAdd/collection/select/node])" xpath="/tmp/queryAdd/@nodeCount"/>
              <set translatedExpr="'Representation'" xpathExpr="'/tmp/queryAdd/collection/select/node[' + [/tmp/queryAdd/@nodeCount] + ']/@label'"/>
              <set value="offerView" xpathExpr="'/tmp/queryAdd/collection/select/node[' + [/tmp/queryAdd/@nodeCount] + ']/@alias'"/>

              <set expr="ExtractRight([/tmp/selectCtrl/in/@schema], ':')" xpath="/tmp/queryAdd/@targetSchemaName"/>
              <set expr="'extension/schema[@name=\''+ ExtractRight([/tmp/selectCtrl/in/@schema], ':')+'\']'"
                   xpath="/tmp/queryAdd/@schemaExpr"/>

              <set expr="Extract([/tmp/selectCtrl/in/@schema], ':')" xpathExpr="[/tmp/queryAdd/@schemaExpr] + '/@namespace'"/>
              <set expr="[/tmp/selectCtrl/in/@schema]" xpathExpr="[/tmp/queryAdd/@schemaExpr] + '/@extendedSchema'"/>
              <set expr="[/tmp/queryAdd/@schemaExpr] + '/element[@name=\''+ [/tmp/queryAdd/@targetSchemaName] +'\']/element[@name=\''+ @name + '_prop_' + [/tmp/queryAdd/@collName]+'\']'"
                   xpath="/tmp/queryAdd/@linkToPropXPath"/>
              <set value="link" xpathExpr="[/tmp/queryAdd/@linkToPropXPath] + '/@type'"/>
              <set expr="[/tmp/queryAdd/@label]" xpathExpr="[/tmp/queryAdd/@linkToPropXPath] + '/@label'"/>
              <set expr="[/tmp/queryAdd/@propositionSchema]" xpathExpr="[/tmp/queryAdd/@linkToPropXPath] + '/@target'"/>
              <set value="1" xpathExpr="[/tmp/queryAdd/@linkToPropXPath] + '/@unbound'"/>

              <set expr="ExtractRight([/tmp/queryAdd/@propositionSchema], ':')" xpath="/tmp/queryAdd/@targetPropSchemaName"/>
              <set expr="'extension/schema[@name=\''+ ExtractRight([/tmp/queryAdd/@propositionSchema], ':')+'\']'"
                   xpath="/tmp/queryAdd/@schemaExpr"/>

              <set expr="Extract([/tmp/queryAdd/@propositionSchema], ':')" xpathExpr="[/tmp/queryAdd/@schemaExpr] + '/@namespace'"/>
              <set expr="[/tmp/queryAdd/@propositionSchema]" xpathExpr="[/tmp/queryAdd/@schemaExpr] + '/@extendedSchema'"/>
              <set expr="[/tmp/queryAdd/@schemaExpr] + '/element[@name=\''+ [/tmp/queryAdd/@targetPropSchemaName] +'\']/element[@name=\''+ @name + '_prop_' + [/tmp/queryAdd/@collName]+'\']'"
                   xpath="/tmp/queryAdd/@linkToPropXPath"/>
              <set value="link" xpathExpr="[/tmp/queryAdd/@linkToPropXPath] + '/@type'"/>
              <set translatedExpr="'Representation'" xpathExpr="[/tmp/queryAdd/@linkToPropXPath] + '/@label'"/>
              <set expr="[/tmp/queryAdd/@outputSchema]" xpathExpr="[/tmp/queryAdd/@linkToPropXPath] + '/@target'"/>
              <set value="0" xpathExpr="[/tmp/queryAdd/@linkToPropXPath] + '/@unbound'"/>

            </if>
            <if expr="([/tmp/queryAdd/@dataType]='linkedData' AND [/tmp/queryAdd/@recipientLink]='')">
              <copyElement list="true" xpathDst="select" xpathSrc="/tmp/queryAdd/collection/select/node"/>
            </if>
            <if expr="([/tmp/queryAdd/@dataType]!='linkedData' OR [/tmp/queryAdd/@recipientLink]!='')">
              <copyElement exprDst="'select/node['+Iif([/tmp/queryAdd/@collName]=='', '@expr=\'' + [/tmp/queryAdd/collection/select/@expr] + '\'', '@alias=\'' + [/tmp/queryAdd/@collName] + '\'')+']'"
                           xpathSrc="/tmp/queryAdd/collection/select"/>
            </if>
          </if>
          <reset xpath="/tmp/queryAdd/collection/select"/>
          <if expr="[/tmp/queryAdd/@rowCount]=0">
            <set value="0" xpath="/tmp/queryAdd/collection/@singleRow"/>
            <set value="0" xpath="/tmp/queryAdd/collection/@groupBy"/>
            <set expr="[/tmp/queryAdd/@lineCount]" xpath="/tmp/queryAdd/collection/@lineCount"/>
          </if>
          <if expr="[/tmp/queryAdd/@rowCount]=1 OR [/tmp/queryAdd/@dataType]='offer'">
            <set expr="Iif([/tmp/queryAdd/@calcOffer]='dynamic' AND [/tmp/queryAdd/@dataType]='offer', [/tmp/queryAdd/@offerCount]=1, 1)"
                 xpath="/tmp/queryAdd/collection/@singleRow"/>
            <set expr="Iif([/tmp/queryAdd/@calcOffer]='dynamic' AND [/tmp/queryAdd/@dataType]='offer', [/tmp/queryAdd/@offerCount], 1)"
                 xpath="/tmp/queryAdd/collection/@lineCount"/>
            <set value="0" xpath="/tmp/queryAdd/collection/@groupBy"/>
            <if expr="[/tmp/queryAdd/@dataType]='offer'">
              <if expr="[/tmp/queryAdd/@offerCount]&gt;1">
                <set value="@rank" xpath="/tmp/queryAdd/collection/orderBy/node/@expr"/>
              </if>
              <if expr="[/tmp/queryAdd/@offerCount]=1">
                <set value="@rank=1" xpath="/tmp/queryAdd/collection/where/condition[@internalId='1']/@expr"/>
              </if>
            </if>
          </if>
          <if expr="[/tmp/queryAdd/@rowCount]=2">
            <set value="1" xpath="/tmp/queryAdd/collection/@singleRow"/>
            <set value="1" xpath="/tmp/queryAdd/collection/@groupBy"/>
            <set expr="[/tmp/queryAdd/@lineCount]" xpath="/tmp/queryAdd/collection/@lineCount"/>
            <set expr="[/tmp/queryAdd/@useOrderByValuesAsRank]" xpath="/tmp/queryAdd/collection/@useOrderByValuesAsRank"/>
          </if>
          <if expr="[/tmp/queryAdd/@rowCount]=3">
            <set value="0" xpath="/tmp/queryAdd/collection/@singleRow"/>
            <set value="0" xpath="/tmp/queryAdd/collection/@groupBy"/>
            <set value="1" xpath="/tmp/queryAdd/collection/@merge"/>
            <set expr="1" xpath="/tmp/queryAdd/collection/@lineCount"/>
          </if>
          <if expr="[/tmp/queryAdd/@rowCount]=-1 OR [/tmp/queryAdd/@reverseLink]=1">
            <set value="0" xpath="/tmp/queryAdd/collection/@lineCount"/>
          </if>
          <if expr="[/tmp/queryAdd/@dataType]='linkDef' OR [/tmp/queryAdd/@dataType]='linkDefColl' OR [/tmp/queryAdd/@dataType]='linkDefExt'">
            <set expr="Iif([/tmp/queryAdd/@dataType]='linkDefColl', 0, Iif([/tmp/queryAdd/@dataType]='linkDef', 1, 2))"
                 xpath="/tmp/queryAdd/linkedDef/@cardinality"/>
            <set expr="[/tmp/queryAdd/@collName]" xpath="/tmp/queryAdd/linkedDef/@name"/>
            <set expr="[/tmp/queryAdd/@label]" xpath="/tmp/queryAdd/linkedDef/@label"/>
            <set expr="Gid()" xpath="/tmp/queryAdd/linkedDef/@id"/>
            <copyElement exprDst="'links[@name=\''+ [/tmp/queryAdd/@collName] + '\']'"
                         xpathSrc="/tmp/queryAdd/linkedDef"/>
          </if>
          <if expr="[/tmp/queryAdd/@dataType]='linkDefRef'">
            <set expr="[/tmp/queryAdd/@collName]" xpath="/tmp/queryAdd/linkedDef/@name"/>
            <set expr="[/tmp/queryAdd/@label]" xpath="/tmp/queryAdd/linkedDef/@label"/>
            <set expr="Gid()" xpath="/tmp/queryAdd/linkedDef/@id"/>
            <copyElement exprDst="'reconc[@name=\''+ [/tmp/queryAdd/@collName] + '\']'"
                         xpathSrc="/tmp/queryAdd/linkedDef"/>
          </if>
          <if expr="[/tmp/queryAdd/@dataTypeReadOnly]!=1 AND [/tmp/queryAdd/@dataType]!='score' AND SubString([/tmp/queryAdd/@dataType],0,7)!='linkDef'">
            <if expr="([/tmp/queryAdd/@dataType]!='linkedData' OR [/tmp/queryAdd/@recipientLink]!='')">
              <set expr="Gid()" xpath="/tmp/queryAdd/collection/@id"/>
              <copyElement exprDst="'conditionLink['+Iif([/tmp/queryAdd/@collName]=='', '@expr=\'' + [/tmp/queryAdd/collection/@expr] + '\'', '@alias=\'' + [/tmp/queryAdd/@collName] + '\'')+']'"
                           xpathSrc="/tmp/queryAdd/collection"/>
            </if>
          </if>
          <if expr="[/tmp/queryAdd/@reverseLink]=1">
            <set expr="[/tmp/queryAdd/@targetSchema]" xpath="@schema"/>
            <set expr="[/tmp/queryAdd/element/@revLink]" xpath="@recipientLink"/>
          </if>
          <refresh xpath="."/>
        </leave>
      </form>
<!--[cf]-->
<!--[cf]-->
<!--[of]:query-->
      <form label="Query" name="query" type="notebook">
        <enter>
          <set expr="wkfTargetSchema(@name)" xpath="/ignored/@targetExtension"/>
          <if expr="@useSource">
            <set expr="'temp:workflow:'+[../../@id]+'_'+wkfSourceActivity(@name)"
                 xpath="/ignored/@querySchemaExec"/>
          </if>
        </enter>

        <container colcount="2" img="nms:miniatures/mini-query.png">
          <input colspan="2" xpath="@label"/>
          <input alwaysActive="true" expr="@schema" type="expr" xpath="/tmp/selectCtrl/in/@schema"/>
          <input alwaysActive="true" expr="@recipientLink" type="expr" xpath="/tmp/selectCtrl/in/@recipientLink"/>
          <static colspan="2" label="Target selection" type="separator"/>
          <input img="nms:miniatures/mini-query.png" label="Edit query..." nolabel="false"
                 prebuildSubForm="false" type="subFormLink" xpath=".">
            <form ref="xtk:workflow:lib/tabs/queryWizard"/>
          </input>
          <container type="visibleGroup" visibleIf="NodeCount([select/node])==0"/>
          <container type="visibleGroup" visibleIf="NodeCount([select/node])&gt;=1">
            <input align="right" img="nms:miniatures/mini-piechart.png" label="Refine the target using additional data..."
                   margin-right="5" prebuildSubForm="false" type="subFormLink" xpath=".">
              <form label="Refine the target using additional data...">
                <enter>
                  <set expr="wkfTargetSchema(@name)" xpath="/tmp/addFilter/@schema"/>
                </enter>
                <input name="havingList" nolabel="true" toolbarAlign="horizontal"
                       toolbarCaption="Filter conditions" type="conditionlist" xpath="outputFilter"
                       xpathCurrentLookupPath="/lookupPath/having" xpathHelp="/@helpHaving"
                       xpathSchema="/tmp/addFilter/@schema">

                  <input colSize="15" label=" " xpath="/having/@bool-operator"/>
                  <input colSize="30" label="Expression" xpath="/having/@leftExpr"/>
                  <input colSize="15" label="Operator" xpath="/having/@operator"/>
                  <input colSize="30" label="Value" xpath="/having/@rightExpr"/>
                </input>
              </form>
            </input>
          </container>
          <input alwaysActive="true" translatedExpr="iif([outputFilter/@displayFilter]=='undefined', humanCond, humanCond + '\n' + [outputFilter/@displayFilter])"
                 type="expr" xpath="/tmp/selectCtrl/out/humanCond"/>
          <input colspan="2" fontBold="true" label=" " lineCount="5" noBorder="true"
                 readOnly="true" type="edit" xpath="/tmp/selectCtrl/out/humanCond"/>
          <static colspan="2" label="Complementary information" type="separator"/>
          <input img="xtk:xtklinkn.png" label="Add data..." nolabel="false" prebuildSubForm="false"
                 type="subFormLink" xpath=".">
            <enter name="onClick">
              <set value="0" xpath="/tmp/queryAdd/@dataTypeReadOnly"/>
            </enter>
            <form label="Additional data" ref="xtk:workflow:lib/subforms/queryAdd"
                  type="wizard"/>
          </input>
          <container type="visibleGroup" visibleIf="NodeCount([select/node])==0"/>
          <container type="visibleGroup" visibleIf="NodeCount([select/node])&gt;=1">
            <input align="right" img="nms:list.png" label="Edit additional data..."
                   margin-right="5" prebuildSubForm="false" type="subFormLink" xpath=".">
              <form label="Additional columns">
                <enter>
                  <set expr="wkfTargetSchema(@name, '', 1)" xpath="/ignored/@targetExtension"/>
                  <set value="aggregate" xpath="/tmp/selectCtrl/in/@choiceType"/>
                </enter>
                <container style="flat" type="notebook">
                  <container ref="xtk:workflow:lib/tabs/colSelector/data"/>
                  <container ref="xtk:workflow:lib/tabs/colSelector/collection"/>
                </container>
              </form>
            </input>
          </container>
          <input alwaysActive="true" expr="GroupConcat([select/descendant::node], &quot; ' [' + [@label] + '] ' &quot; )"
                 type="expr" xpath="/tmp/selectCtrl/out/@humanSelect"/>
          <input colspan="2" fontBold="true" label=" " lineCount="3" noBorder="true"
                 readOnly="true" type="edit" xpath="/tmp/selectCtrl/out/@humanSelect"/>
          <container colspan="2" xpath="transitions">
            <static label="Results" type="separator"/>
            <container colcount="2">
              <input xpath="result/@label"/>
              <input xpath="result/@code"/>
            </container>
          </container>

        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>

      </form>
<!--[cf]-->
<!--[of]:schemaEdit-->
      <form label="Edit schema" name="schemaEdit" type="notebook">
        <enter>
          <set expr="wkfTargetSchema(@mainSet)" xpath="/tmp/selectCtrl/in/@schema"/>
        </enter>
        <container colcount="2" img="nms:miniatures/mini-schemaEdit.png">
          <input colspan="2" xpath="@label"/>
          <input colspan="2" type="ExclusionMainSetEdit" xpath="@mainSet"/>
          <static colspan="2" label=" " type="help">Select above the population for which the schema will be modified.</static>
          <input colspan="2" expr="wkfTargetSchema(@mainSet)" type="expr" xpath="/tmp/selectCtrl/in/@schema"/>
          <input colspan="2" xpath="@hideSourceColumn"/>
          <container colspan="2" type="visibleGroup" visibleIf="[/tmp/selectCtrl/in/@schema]!='' OR NodeCount([select/node])&gt;0">
            <static label="Modifications and expressions" type="separator"/>
            <container allowDistinct="false" extraColumns="@alias" hideUnboundPath="true"
                       name="selectCtrl" type="querySelectContainer" xpath=".">
          <!-- Attention querySelectContainer container enrich this form defintion.
       Therefore container and hierarchy shouldn't be changes -->
              <container name="vpaned" type="vpaned">
                <container name="schema">
                  <static fontBold="true" label="Available fields:"/>
                  <container colcount="2">
                    <static img="xtk:filter.png" type="image"/>
                    <input catchReturnKey="true" label="Find" type="edit" xpath="/tmp/selectCtrl/itn/@search"/>
                  </container>
                  <input name="schemaView" type="SchemaView" useUnboundPath="true"
                         xpath="/tmp/selectCtrl/in/@schema" xpathHelp="/tmp/selectCtrl/itn/@help"
                         xpathIndex="/tmp/selectCtrl/itn/@current" xpathSearchPath="/tmp/selectCtrl/itn/@search"
                         xpathSelect="select/node/@expr" xpathStartPath="/tmp/selectCtrl/in/@startPath"/>
                </container>
                <container name="output" xpathsToLoad="output*">
                  <static fontBold="true" label="Output columns:"/>
                  <input name="columnList" nolabel="true" prebuildSubForm="false"
                         toolbarAlign="vertical" type="columnList" xpath="select/node"
                         xpathCurrentLookupPath="/lookupPath/select" xpathGroupBy="groupBy/node"
                         xpathGroupOption="/tmp/selectCtrl/out/@group" xpathHasMemoData="/tmp/selectCtrl/itn/@hasMemoData"
                         xpathHaving="having/condition" xpathHelp="/tmp/selectCtrl/itn/@help"
                         xpathSchema="/tmp/selectCtrl/in/@schema" xpathStartPath="/tmp/selectCtrl/in/@startPath"
                         zoom="false">

                    <input colSize="20" xpath="@label"/>
                    <input colSize="35" type="pathedit" xpath="@expr" xpathChoiceType="/tmp/selectCtrl/in/@choiceType"
                           xpathSchema="/tmp/selectCtrl/in/@schema" xpathStartPath="/tmp/selectCtrl/in/@startPath"/>

                <!-- Form description of column -->
                    <form label="Column definition" name="colDetail">
                      <input xpath="@label"/>
                      <container name="extraFields"/>
                  <!-- empty container in which edit controls may be
                                               added by the top level querySelectContainer -->
                      <input noTransaction="true" type="expredit" xpath="@expr" xpathSchema="/tmp/selectCtrl/in/@schema"/>

                  <!-- Expression editor description -->
                      <container type="visibleGroup" visibleIf="[/tmp/selectCtrl/itn/@advancedMode]">
                        <container colcount="2" cols-width="100,1">
                          <container>
                            <static fontBold="true" label="Available fields:"/>
                            <container colcount="2">
                              <static img="xtk:filter.png" type="image"/>
                              <input catchReturnKey="true" label="Find" type="edit"
                                     xpath="/tmp/selectCtrl/itn/@search"/>
                            </container>
                            <input type="schemaview" xpath="/tmp/selectCtrl/in/@schema"
                                   xpathExpr="@expr" xpathHelp="/tmp/selectCtrl/itn/@help"
                                   xpathSearchPath="/tmp/selectCtrl/itn/@search"
                                   xpathStartPath="/tmp/selectCtrl/in/@startPath"/>
                          </container>
                          <input type="functionview" xpathExpr="@expr" xpathHelp="/tmp/selectCtrl/itn/@help"/>
                        </container>
                        <input type="help" xpath="/tmp/selectCtrl/itn/@help"/>
                      </container>
                      <input label="Advanced mode" nolabel="true" type="checkbox"
                             xpath="/tmp/selectCtrl/itn/@advancedMode"/>
                    </form>
                  </input>
                </container>
              </container>
              <input type="help" xpath="/tmp/selectCtrl/itn/@help"/>
            </container>
          </container>
          <container colcount="2" colspan="2" xpath="transitions">
            <static colspan="2" label="Results" type="separator"/>
            <input xpath="result/@label"/>
            <input xpath="result/@code"/>
          </container>

        </container>

        <container img="xtk:xtklink1.png" label="Links">
          <static type="help">Create the links between your working data and database data here. For each link, you can use one or more reconciliation conditions.</static>
          <input editable="false" nolabel="true" toolbarCaption="List of links" type="list"
                 xpath="links" xpathToIgnore="links/condition" zoom="true" zoomOnAdd="true">
            <input editable="true" label="Identifier" xpath="@name"/>
            <input editable="true" label="Description" xpath="@label"/>
            <input label="Destination" xpath="@schema"/>
            <input editable="true" label="Cardinality" xpath="@cardinality"/>
            <form label="Link definition" name="reconcDetail">
              <enter>
                <set expr="Iif(Substring(@schema, 0, 4)=='temp', 1, 0)" xpath="/tmp/@useTempSchema"/>
                <set expr="Iif(NodeCount([join/condition])==0, 0, 1)" xpath="/tmp/@advancedJoin"/>
              </enter>
              <static label="Description" type="separator"/>
              <input xpath="@name"/>
              <input xpath="@label"/>
              <static label="Definition" type="separator"/>
              <container>
                <input checkedValue="0" label="Database schema" type="RadioButton"
                       xpath="/tmp/@useTempSchema"/>
                <input checkedValue="1" label="Temporary schema" type="RadioButton"
                       xpath="/tmp/@useTempSchema"/>
              </container>
              <container type="visibleGroup" visibleIf="[/tmp/@useTempSchema]==0">
                <input schema="xtk:schema" type="schemaEdit" xpath="@schema"/>
              </container>
              <container type="visibleGroup" visibleIf="[/tmp/@useTempSchema]==1">
                <input label="Schema" type="ExclusionMainSetEdit" xpath="@srcDataSet"
                       xpathActivityName="../@name"/>
                <input expr="wkfSchemaName(@srcDataSet)" type="expr" xpath="@schema"/>
              </container>
              <static label="Join conditions" type="separator"/>
              <input expr="wkfAddLinkDefToSchema([/tmp/selectCtrl/in/@schema], 'joinTarget', [/ignored/@advancedJoinLinkLabel], Iif( [/tmp/@advancedJoin]==1, @schema, ''))"
                     type="expr" xpath="/ignored/@advancedJoinLinksSchema">
                <enter>
                  <if expr="[/tmp/@advancedJoin]!='' AND [/tmp/@advancedJoin]!=1 AND NodeCount([join/condition])&gt;0">
                    <msgBox translatedExpr="'Do you want to delete the advanced join conditions?'"
                            type="yesno" xpathOut="/tmp/@eraseAdvancedJoin"/>
                    <if expr="[/tmp/@eraseAdvancedJoin]='yes'">
                      <reset xpath="join/condition[*]"/>
                      <refresh xpath="element"/>
                    </if>
                    <if expr="[/tmp/@eraseAdvancedJoin]='no'">
                      <set value="1" xpath="/tmp/@advancedJoin"/>
                    </if>
                  </if>
                  <if expr="[/tmp/@advancedJoin]!='' AND [/tmp/@advancedJoin]!=0 AND NodeCount([condition])&gt;0">
                    <msgBox translatedExpr="'Do you want to delete the join conditions?'"
                            type="yesno" xpathOut="/tmp/@eraseAdvancedJoin"/>
                    <if expr="[/tmp/@eraseAdvancedJoin]='yes'">
                      <reset xpath="condition[*]"/>
                    </if>
                    <if expr="[/tmp/@eraseAdvancedJoin]='no'">
                      <set value="0" xpath="/tmp/@advancedJoin"/>
                    </if>
                  </if>
                </enter>
              </input>
              <input checkedValue="0" label="Use a simple join" nolabel="false" type="radioButton"
                     xpath="/tmp/@advancedJoin"/>
              <input checkedValue="1" label="Advanced join conditions" nolabel="false"
                     type="radioButton" xpath="/tmp/@advancedJoin"/>
              <container type="visibleGroup" visibleIf="[/tmp/@advancedJoin]!=1">
                <static label=" " nolabel="false" type="help">Select below the source and target fields that will be matched to build the join condition.</static>
                <input label=" " toolbarCaption="Join conditions" type="list" xpath="condition">
                  <input type="pathEdit" xpath="@srcExpr" xpathSchema="/tmp/selectCtrl/in/@schema"/>
                  <input type="pathEdit" xpath="@dstExpr" xpathSchema="../@schema"/>
                </input>
              </container>
              <container type="visibleGroup" visibleIf="[/tmp/@advancedJoin]==1">
                <static label=" " nolabel="false" type="help">Select below the relationship conditions between source and target records. The 'joinTarget (Dynamic link)' link enables you to reference target fields to define joins.</static>
                <input label=" " name="filterList" noSaveFilter="true" toolbarAlign="horizontal"
                       toolbarCaption="Join conditions" type="conditionList" xpath="join"
                       xpathCurrentLookupPath="/lookupPath/where" xpathSchema="/tmp/selectCtrl/in/@schema">
                  <input colSize="15" label=" " xpath="/@bool-operator"/>
                  <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                  <input colSize="15" label="Operator" xpath="/@operator"/>
                  <input colSize="30" label="Value" xpath="/@rightExpr"/>
                </input>
              </container>
              <container>
                <input checkedValue="0" label="Type 1N collection link" type="radioButton"
                       xpath="@cardinality"/>
                <input checkedValue="1" label="Type 11 simple link" type="radioButton"
                       xpath="@cardinality"/>
                <input checkedValue="2" label="Type 11 simple link which may have a non-existent target"
                       type="radioButton" xpath="@cardinality"/>
              </container>
              <container type="visibleGroup" visibleIf="@cardinality=1 OR @cardinality=2">
                <static type="warning">Defining a 1-1 cardinality link can have a negative impact on future joins.</static>
              </container>
              <leave>
                <set expr="0" xpath="/tmp/@useTempSchema"/>
                <set expr="wkfAddLinkDefToSchema([/tmp/selectCtrl/in/@schema], 'joinTarget', [/ignored/@advancedJoinLinkLabel], '')"
                     xpath="/ignored/@advancedJoinLinksSchema"/>
              </leave>
            </form>
          </input>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>

      </form>
<!--[cf]-->
<!--[of]:enrich-->
      <form label="Add additional data" name="enrich" type="notebook">
        <enter>
          <set expr="wkfTargetSchema(@name, 'src')" xpath="/ignored/@targetExtension"/>
          <set expr="[/ignored/@targetExtension]" xpath="/tmp/selectCtrl/in/@schema"/>
          <set expr="Iif(NodeCount([mainReconc/join/condition])==0, Iif(NodeCount([mainReconc/keys])==0, 0, 2), 1)"
               xpath="/tmp/@advancedReconc"/>
        </enter>
        <container colcount="2" img="nms:miniatures/mini-enrich.png">
          <input colspan="2" xpath="@label"/>
          <input colspan="2" type="ExclusionMainSetEdit" xpath="@mainSet"/>
          <static colspan="2" label=" " nolabel="false" type="help">Select the population which to which the additional data will be added.</static>
          <input expr="wkfTargetSchema(@name, Iif(@mainSet!='', 'src', ''))" type="expr"
                 xpath="/tmp/selectCtrl/in/@schema"/>
          <container colcount="2" colspan="2" type="visibleGroup" visibleIf="@mainSet != ''">
            <static colspan="2" label="Complementary information" type="separator"/>
            <input colspan="2" xpath="@keepAllExtraData"/>
            <input img="xtk:xtklinkn.png" label="Add data..." nolabel="false" prebuildSubForm="false"
                   type="subFormLink" xpath=".">
              <enter name="onClick">
                <set value="0" xpath="/tmp/queryAdd/@dataTypeReadOnly"/>
              </enter>
              <form label="Additional data" ref="xtk:workflow:lib/subforms/queryAdd"
                    type="wizard"/>
            </input>
            <container type="visibleGroup" visibleIf="NodeCount([select/node])==0 AND NodeCount([links])==0 AND NodeCount([reconc])==0"/>
            <container type="visibleGroup" visibleIf="NodeCount([select/node])&gt;=1 OR NodeCount([links])&gt;=1 OR NodeCount([reconc])&gt;=1">
              <input align="right" img="nms:list.png" label="Edit additional data..."
                     margin-right="5" prebuildSubForm="false" type="subFormLink"
                     xpath=".">
                <form label="Select additional columns">
                  <enter>
                    <set value="aggregate" xpath="/tmp/selectCtrl/in/@choiceType"/>
                  </enter>
                  <container style="flat" type="notebook">
                    <container ref="xtk:workflow:lib/tabs/colSelector/data"/>
                    <container ref="xtk:workflow:lib/tabs/colSelector/collection"/>
                    <container ref="xtk:workflow:lib/tabs/colSelector/reconc"/>
                    <container ref="xtk:workflow:lib/tabs/colSelector/links"/>
                  </container>
                </form>
              </input>
            </container>
            <input alwaysActive="true" translatedExpr="Iif(NodeCount([select/node])&gt;0, Iif(NodeCount(links)&gt;0 OR NodeCount(reconc)&gt;0, 'Data:\n', '') + GroupConcat([select/descendant::node], &quot; ' [' + [@label] + '] ' &quot; ), '') + Iif(NodeCount(links)&gt;0, '\nLinks:\n' + GroupConcat([links], &quot; ' [' + [@label] + '] ' &quot;), '') + Iif(NodeCount(reconc)&gt;0, '\nReconciliations :\n' + GroupConcat([reconc], &quot; ' [' + [@label] + '] ' &quot;), '')"
                   type="expr" xpath="/tmp/selectCtrl/out/@humanSelect"/>
            <input colspan="2" fontBold="true" label=" " lineCount="5" margin-right="5"
                   noBorder="true" readOnly="true" type="edit" xpath="/tmp/selectCtrl/out/@humanSelect"/>
            <input colspan="2" img="nms:miniatures/mini-piechart.png" label="Refine the target using additional data..."
                   nolabel="false" prebuildSubForm="false" type="subFormLink" xpath=".">
              <form label="Refine the target using additional data...">
                <enter>
                  <set expr="wkfTargetSchema(@name)" xpath="/tmp/addFilter/@schema"/>
                </enter>
                <input name="havingList" nolabel="true" toolbarAlign="horizontal"
                       toolbarCaption="Filter conditions" type="conditionlist" xpath="outputFilter"
                       xpathCurrentLookupPath="/lookupPath/having" xpathHelp="/@helpHaving"
                       xpathSchema="/tmp/addFilter/@schema">

                  <input colSize="15" label=" " xpath="/having/@bool-operator"/>
                  <input colSize="30" label="Expression" xpath="/having/@leftExpr"/>
                  <input colSize="15" label="Operator" xpath="/having/@operator"/>
                  <input colSize="30" label="Value" xpath="/having/@rightExpr"/>
                </input>
              </form>
            </input>
            <container colspan="2" type="visibleGroup" visibleIf="NodeCount(outputFilter)&gt;0">
              <input fontBold="true" label=" " lineCount="4" margin-right="5" noBorder="true"
                     readOnly="true" type="edit" xpath="outputFilter/@displayFilter"/>
            </container>
          </container>
          <container colcount="2" colspan="2" xpath="transitions">
            <static colspan="2" label="Results" type="separator"/>
            <input xpath="result/@label"/>
            <input xpath="result/@code"/>
          </container>

        </container>

        <container img="xtk:xtklink1.png" label="Reconciliation">
          <input nolabel="true" xpath="mainReconc/@enabled"/>
          <container colcount="2" type="visibleGroup" visibleIf="[mainReconc/@enabled]"
                     xpath="mainReconc">
            <static colspan="2" label="Targeting dimension" type="separator"/>
            <static colspan="2" type="help">Create here the identification conditions for your targeting dimension.</static>
            <input colspan="2" required="true" schema="xtk:schema" type="schemaEdit"
                   xpath="@schema"/>
            <input colspan="2" expr="wkfAddLinkDefToSchema([/tmp/selectCtrl/in/@schema], 'joinTarget', [/ignored/@advancedJoinLinkLabel], Iif( [/tmp/@advancedReconc]!=0, @schema, ''))"
                   type="expr" xpath="/ignored/@advancedReconcSchema"/>
            <static colspan="2" label="Reconciliation conditions" type="separator"/>
            <input checkedValue="0" colspan="2" label="Use simple reconciliation keys"
                   nolabel="true" type="radioButton" xpath="/tmp/@advancedReconc"/>
            <input checkedValue="1" colspan="2" label="Advanced reconciliation conditions"
                   nolabel="true" type="radioButton" xpath="/tmp/@advancedReconc"/>
            <input checkedValue="2" colspan="2" label="Reconciliation rules" nolabel="true"
                   type="radioButton" xpath="/tmp/@advancedReconc"/>
            <container colspan="2" type="visibleGroup" visibleIf="[/tmp/@advancedReconc]=0">
              <static type="help">Select below the source and target fields that will be matched to build the reconciliation condition.</static>
              <input nolabel="true" toolbarAlign="vertical" type="list" xpath="condition">
                <input type="pathEdit" xpath="@srcExpr" xpathSchema="/tmp/selectCtrl/in/@schema"/>
                <input type="pathEdit" xpath="@dstExpr" xpathSchema="../@schema"/>
              </input>
            </container>
            <container colspan="2" type="visibleGroup" visibleIf="[/tmp/@advancedReconc]=1">
              <static type="help">Select below the conditions which allow reconciliation between source and target records. The 'joinTarget (Dynamic link)' link enables you to reference target fields to define joins.</static>
              <input name="filterList" noSaveFilter="true" nolabel="true" toolbarAlign="horizontal"
                     toolbarCaption="Reconciliation conditions" type="conditionList"
                     xpath="join" xpathCurrentLookupPath="/lookupPath/where" xpathSchema="/tmp/selectCtrl/in/@schema">
                <input colSize="15" label=" " xpath="/@bool-operator"/>
                <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                <input colSize="15" label="Operator" xpath="/@operator"/>
                <input colSize="30" label="Value" xpath="/@rightExpr"/>
              </input>
            </container>
            <container colspan="2" type="visibleGroup" visibleIf="[/tmp/@advancedReconc]=2">
              <static type="help">Select the conditions for reconciling source and target records below. When reconciliation criteria aren't reliable enough, you can refine reconciliation using proximity scores. The 'joinTarget (Dynamic link)' link lets you reference the fields of the target to define the join.</static>
              <container style="down" type="notebook">
                <container label="Identification">
                  <input editable="false" nolabel="true" prebuildSubForm="false"
                         toolbarCaption="Reconciliations" type="list" xpath="keys"
                         xpathToIgnore="keys/scoreRule" zoom="true" zoomOnAdd="true">
                    <input editable="true" xpath="@active"/>
                    <input editable="true" expr="Iif(@label!='', @label, [join/@displayFilter])"
                           label="Identification conditions" xpath="@label"/>
                    <input expr="Iif(@scoresApplied!='none', @minScore, '')" label="Required score"/>
                    <input expr="Iif(@scoresApplied=='all', [/ignored/@allLabel], Iif(@scoresApplied=='select', GroupConcat(scoreRule, &quot; '[' + @name + ']' &quot; ), ''))"
                           label="Scores taken into account"/>
                    <form title="Reconciliation rule" type="wizard">
                      <enter>
                        <set expr="Iif(@scoresApplied=='none' OR @scoresApplied=='', 0, 1)"
                             xpath="/tmp/@ruleReconcWithScore"/>
                        <set expr="Iif(@scoresApplied!='select', 1, 0)" xpath="/tmp/@ruleReconcRuleSel"/>
                      </enter>
                      <container desc="Specify below the conditions for identifying the target record"
                                 title="Join conditions">
                        <input xpath="@label"/>
                        <input label=" " name="filterList" noSaveFilter="true" nolabel="true"
                               toolbarAlign="horizontal" toolbarCaption="Reconciliation conditions"
                               type="conditionList" xpath="join" xpathCurrentLookupPath="/lookupPath/where"
                               xpathHelp="join/@displayFilter" xpathSchema="/tmp/selectCtrl/in/@schema">
                          <input colSize="15" label=" " xpath="/@bool-operator"/>
                          <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                          <input colSize="15" label="Operator" xpath="/@operator"/>
                          <input colSize="30" label="Value" xpath="/@rightExpr"/>
                        </input>
                        <input checkedValue="1" label="Refine reconciliation using proximity scores"
                               nolabel="true" type="checkBox" unCheckedValue="0"
                               xpath="/tmp/@ruleReconcWithScore"/>
                      </container>
                      <container desc="Select below the proximity scores to be taken into account to refine reconciliation, then define the reconciliation approval threshold."
                                 title="Proximity scores" visibleIf="[/tmp/@ruleReconcWithScore]=1">
                        <enter>
                          <reset xpath="/tmp/ruleReconcSel"/>
                          <copyElement list="true" xpathDst="/tmp/ruleReconcSel/rules"
                                       xpathSrc="../scoreRule"/>
                          <forEach xpath="scoreRule">
                            <set value="1" xpathExpr="'/tmp/ruleReconcSel/rules/scoreRule[@name=\''+@name+'\']/@sel'"/>
                          </forEach>
                        </enter>
                        <input checkedValue="0" label="All calculation rules" nolabel="true"
                               type="radioButton" xpath="/tmp/@ruleReconcRuleSel"/>
                        <input checkedValue="1" label="A selection of rules" nolabel="true"
                               type="radioButton" xpath="/tmp/@ruleReconcRuleSel"/>
                        <container enabledIf="[/tmp/@ruleReconcRuleSel]==1" type="enabledGroup">
                          <input noToolbar="true" nolabel="true" type="list" xpath="/tmp/ruleReconcSel/rules/scoreRule">
                            <input colSize="10" label="Selected" type="checkBox"
                                   xpath="@sel"/>
                            <input label="Proximity score" xpath="@name"/>
                            <input label="Score" xpath="@score"/>
                          </input>
                        </container>
                        <static type="help">Specify below the minimum proximity score required to approve reconciliation.</static>
                        <input label="Minimum score" xpath="@minScore"/>
                      </container>
                      <leave>
                        <set expr="Iif([/tmp/@ruleReconcWithScore]==0, 'none', IIf([/tmp/@ruleReconcRuleSel]==0, 'all', 'select'))"
                             xpath="@scoresApplied"/>
                        <if expr="[/tmp/@ruleReconcRuleSel]==1 AND [/tmp/@ruleReconcWithScore]==1">
                          <reset xpath="scoreRule[*]"/>
                          <copyElement filter="@sel=1" list="true" xpathDst="." xpathSrc="/tmp/ruleReconcSel/rules/scoreRule"/>
                        </if>
                      </leave>
                    </form>
                  </input>
                </container>
                <container label="Proximity scores">
                  <input editable="false" nolabel="true" prebuildSubForm="false"
                         toolbarCaption="Calculation rules of the proximity score"
                         type="list" xpath="scoreRule" zoom="true" zoomOnAdd="true">
                    <input editable="true" xpath="@active"/>
                    <input xpath="@name"/>
                    <input xpath="@score"/>
                    <input label="condition" xpath="join/@displayFilter"/>
                    <form colcount="2" label="Proximity score">
                      <input xpath="@name"/>
                      <input label="Score" xpath="@score"/>
                      <input colspan="2" name="filterList" noSaveFilter="true" nolabel="true"
                             toolbarAlign="horizontal" toolbarCaption="Conditions for triggering score adding"
                             type="conditionList" xpath="join" xpathCurrentLookupPath="/lookupPath/where"
                             xpathHelp="join/@displayFilter" xpathSchema="/tmp/selectCtrl/in/@schema">
                        <input colSize="15" label=" " xpath="/@bool-operator"/>
                        <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                        <input colSize="15" label="Operator" xpath="/@operator"/>
                        <input colSize="30" label="Value" xpath="/@rightExpr"/>
                      </input>
                    </form>
                  </input>
                </container>
              </container>
            </container>
            <input nolabel="true" xpath="@outerJoin"/>
            <input align="right" label="Advanced parameters..." type="subFormLink"
                   xpath=".">
              <form label="Filter and deduplication" type="wizard">
                <container desc="Specify below the filtering conditions to be taken into account during reconciliation"
                           title="Refine reconciliation">
                  <input label=" " name="filterList" noSaveFilter="true" toolbarAlign="horizontal"
                         toolbarCaption="Restriction" type="conditionList" xpath="where"
                         xpathCurrentLookupPath="/lookupPath/where" xpathHelp="where/@displayFilter"
                         xpathSchema="@schema">
                    <input colSize="15" label=" " xpath="/@bool-operator"/>
                    <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                    <input colSize="15" label="Operator" xpath="/@operator"/>
                    <input colSize="30" label="Value" xpath="/@rightExpr"/>
                  </input>
                  <static label="Reconciliation parameters" type="separator"/>
                  <container type="visibleGroup" visibleIf="[/tmp/@advancedReconc]==2">
                    <input nolabel="true" xpath="@flattenTree"/>
                    <static type="help">When using several reconciliation rules, records can be reconciled two by two without a main record being identified. Checking the box above will automatically select a record to be used as a reference for all records reconciled two by two.</static>
                  </container>
                  <input nolabel="true" xpath="@dedup"/>
                  <static type="help">Click next to define the selection sequence of the main record among duplicates. If no selection is made, a record will be chosen at random.</static>
                </container>
                <container desc="Select the deduplication criteria" title="Deduplication"
                           visibleIf="@dedup">
                  <container style="down" toolbarAlign="horizontal" toolbarCaption="Selection sequence"
                             type="notebookList" xpath="orderedValue" xpath-label="@label">
                    <container>
                      <input enum="xtk:workflow:dedupReconcType" xpath="@dedupType"/>
                      <container type="visibleGroup" visibleIf="@dedupType='order'">
                        <static type="help">Records for which the expression below is entered will be kept as a priority</static>
                      </container>
                      <input hideCalculated="true" hideMappedAsXml="false" label="Expression"
                             nolabel="false" type="pathedit" xpath="@expr" xpathLabel="@label"
                             xpathSchema="../@schema"/>
                      <container type="visibleGroup" visibleIf="@dedupType='order'">
                        <input label=" " nolabel="false" type="EnumEditList" xpath="value"
                               xpathSchema="@schema" xpathType="@expr">
                          <input xpath="@value"/>
                        </input>
                        <static label="Other values" type="separator"/>
                        <input checkedValue="0" label="Indifferent" type="radioButton"
                               xpath="@orderType"/>
                      </container>
                      <container type="visibleGroup" visibleIf="@dedupType='order' OR @dedupType='expr'">
                        <input checkedValue="1" label="Keep the smallest value" type="radioButton"
                               xpath="@orderType"/>
                        <input checkedValue="2" label="Keep the largest value" type="radioButton"
                               xpath="@orderType"/>
                      </container>
                    </container>
                  </container>
                </container>
              </form>
            </input>
          </container>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>

      </form>
<!--[cf]-->
<!--[of]:changeAxis-->
      <form label="Changing the targeting dimension" maxLabelWidth="50" name="changeAxis"
            type="notebook">
        <enter>
          <set expr="wkfTargetSchema(wkfSourceActivity(@name), wkfTransitionName(wkfSourceActivity(@name), @name), 1)"
               xpath="/ignored/@orgSchema"/>
          <set expr="Iif(@schema!='' and @recipientLink!='', wkfTargetSchema([@name], 'src'), '')"
               xpath="/ignored/@srcSchema"/>
          <set expr="Iif([configuration/@number]&gt;1, 2, [configuration/@number])"
               xpath="/tmp/@useLimit"/>
        </enter>
        <container colcount="2" img="nms:miniatures/mini-changeAxis.png">
          <input colspan="2" xpath="@label"/>
          <container colspan="2" type="visibleGroup" visibleIf="[/ignored/@orgSchema]==''">
            <static type="warning">This activity requires an inbound population.</static>
          </container>
          <container colspan="2" type="visibleGroup" visibleIf="[/ignored/@orgSchema]!=''">
            <input choiceType="xpath" label="Change dimension" nolabel="false" type="pathEdit"
                   useTablePath="true" useUnboundPath="true" xpath="@recipientLink"
                   xpathSchema="/ignored/@orgSchema"/>
            <input expr="GetLinkSchema([/ignored/@orgSchema], [@recipientLink])"
                   type="expr" xpath="@schema"/>
            <container type="visibleGroup" visibleIf="[@schema]==''">
              <static label=" " nolabel="false" type="warning">You must select the link which enables you to change the targeting dimension.</static>
            </container>
            <container type="visibleGroup" visibleIf="[@schema]!=''">
              <input label="Targeting document" readOnly="true" schema="xtk:schema"
                     type="schemaEdit" xpath="@schema"/>
            </container>
          </container>
          <input checkedValue="1" colspan="2" label="Keep a single item in the new targeting document"
                 nolabel="false" type="radioButton" xpath="/tmp/@useLimit"/>
          <input checkedValue="0" colspan="2" label="Keep all records" nolabel="false"
                 type="radioButton" xpath="/tmp/@useLimit"/>
          <input checkedValue="2" colspan="2" label="Limit the number of items in the new targeting document"
                 nolabel="false" type="radioButton" xpath="/tmp/@useLimit"/>
          <container colspan="2" type="visibleGroup" visibleIf="[/tmp/@useLimit]==2">
      <!--static/-->
            <input label="Limit" xpath="configuration/@number"/>
          </container>
          <container colspan="2" type="visibleGroup" visibleIf="@schema!='' and @recipientLink!=''">
            <container xpath="configuration">
              <static label="Deduplication parameters" type="separator"/>
              <input img="nms:miniatures/mini-dedup.png" label="Edit configuration..."
                     nolabel="false" prebuildSubForm="false" type="DedupFormLink"
                     xpath=".">
                <form img="nms:activities/dedup.png" label="Deduplication" name="queryWizard"
                      nothingToSave="true" type="wizard">
                  <enter>
                    <set expr="Iif([/tmp/@useLimit]==2, @number, [/tmp/@useLimit])"
                         xpath="@number"/>
                    <set expr="wkfTargetSchema([../@name], 'src')" xpath="/ignored/@srcSchema"/>
                  </enter>
                  <container desc="Please specify the list of fields or expressions which are used to find duplicates in case of identical values."
                             name="groupDedup" title="Identification of duplicates">
                    <input nolabel="true" toolbarCaption="List of fields" type="list"
                           xpath="groupExpr" xpathChoiceTarget="@expr">
                      <input hideCalculated="false" hideMappedAsXml="true" label="Expression"
                             type="pathedit" xpath="@expr" xpathLabel="@label" xpathSchema="/ignored/@srcSchema"/>
                      <input xpath="@label"/>
                    </input>
                  </container>
                  <container desc="If necessary, enter filtering conditions to restrict the eligible elements of the new dimension."
                             name="groupFlt" title="Filtering of the new targeting dimension">
                    <input name="filterList" noSaveFilter="true" nolabel="true" toolbarAlign="horizontal"
                           toolbarCaption="Filter conditions" type="conditionList"
                           xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                           xpathSchema="../@schema">
                      <input colSize="15" label=" " xpath="/@bool-operator"/>
                      <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                      <input colSize="15" label="Operator" xpath="/@operator"/>
                      <input colSize="30" label="Value" xpath="/@rightExpr"/>
                    </input>
                  </container>
                  <container desc="Please select the method used to identify the records to keep."
                             name="group" title="Deduplication method" visibleIf="([/tmp/@useLimit]!=0 OR [../@keepRank])">
                    <input xpath="@type"/>
                    <container type="visibleGroup" visibleIf="@type='choice'">
                      <static label="Randomly select which duplicates to keep." type="help"/>
                    </container>
                    <container type="visibleGroup" visibleIf="@type='order'">
                      <static label="The record priority order is based on the following, for one or more fields (or expressions)."
                              type="help"/>
                    </container>
                    <container type="visibleGroup" visibleIf="@type='noEmpty'">
                      <static label="Records for which the expression is not empty have priority."
                              type="help"/>
                    </container>
                    <container type="visibleGroup" visibleIf="@type='expr'">
                      <static label="Keep records for which the specified expression has the smallest or largest value."
                              type="help"/>
                    </container>
                    <container type="visibleGroup" visibleIf="@type='order'">
                      <container style="down" toolbarAlign="horizontal" toolbarCaption="List of values"
                                 type="notebookList" xpath="orderedValue" xpath-label="@label">
                        <container>
                          <input hideCalculated="true" hideMappedAsXml="false" label="Expression"
                                 nolabel="false" type="pathedit" xpath="@expr" xpathLabel="@label"
                                 xpathSchema="/ignored/@srcSchema"/>
                          <input label=" " nolabel="false" type="EnumEditList" xpath="value"
                                 xpathSchema="/ignored/@srcSchema" xpathType="@expr">
                            <input xpath="@value"/>
                          </input>
                          <static label="Other values" type="separator"/>
                          <input checkedValue="0" label="Indifferent" type="radioButton"
                                 xpath="@orderType"/>
                          <input checkedValue="1" label="Keep the smallest value"
                                 type="radioButton" xpath="@orderType"/>
                          <input checkedValue="2" label="Keep the largest value"
                                 type="radioButton" xpath="@orderType"/>
                        </container>
                      </container>
                    </container>
                    <container type="visibleGroup" visibleIf="@type='expr'">
                      <input nolabel="true" style="down" toolbarAlign="horizontal"
                             toolbarCaption="List of expressions" type="list" xpath="orderedExpr"
                             xpath-label="@label">
                        <input hideMappedAsXml="true" label="Expression" type="pathedit"
                               xpath="@expr" xpathSchema="/ignored/@srcSchema"/>
                        <input label="Keep" xpath="@compType"/>
                      </input>
                    </container>
                    <container type="visibleGroup" visibleIf="@type='noEmpty'">
                      <input hideMappedAsXml="true" label="Expression" nolabel="false"
                             type="pathedit" xpath="orderedExpr/@expr" xpathSchema="/ignored/@srcSchema"/>
                    </container>
                  </container>

                  <leave>
              <!-- to build display -->
                    <set value="1" xpath="/ignored/@display"/>
                  </leave>

                </form>
              </input>
              <input fontBold="true" label=" " lineCount="5" noBorder="true" readOnly="true"
                     type="edit" xpath="display"/>
            </container>
          </container>
        </container>
        <container colcount="2" img="nms:miniatures/mini-enrich.png" label="Result">
          <static colspan="2" label="Complementary information" type="separator"/>
          <input xpath="@keepAllExtraData"/>
          <container type="visibleGroup" visibleIf="[/tmp/@useLimit]!=1">
            <input xpath="@keepRank"/>
          </container>
          <container type="visibleGroup" visibleIf="[/tmp/@useLimit]==1">
            <input xpath="configuration/@includeMainInDuplicates"/>
          </container>
          <input img="xtk:xtklinkn.png" label="Add data..." nolabel="false" prebuildSubForm="false"
                 type="subFormLink" xpath=".">
            <enter name="onClick">
              <set expr="wkfTargetSchema(@name, 'src')" xpath="/tmp/selectCtrl/in/@schema"/>
              <set value="aggregate" xpath="/tmp/selectCtrl/in/@choiceType"/>
              <set value="0" xpath="/tmp/queryAdd/@dataTypeReadOnly"/>
            </enter>
            <form label="Additional data" ref="xtk:workflow:lib/subforms/queryAdd"
                  type="wizard"/>
          </input>
          <input align="right" img="nms:list.png" label="Edit additional data..."
                 nolabel="false" prebuildSubForm="false" type="subFormLink" xpath=".">
            <form label="Select additional columns">
              <enter>
                <set expr="Iif([/tmp/@useLimit]==2, [configuration/@number], [/tmp/@useLimit])"
                     xpath="configuration/@number"/>
                <set expr="wkfTargetSchema(@name, 'src')" xpath="/tmp/selectCtrl/in/@schema"/>
                <set value="aggregate" xpath="/tmp/selectCtrl/in/@choiceType"/>
              </enter>
              <container style="flat" type="notebook">
                <container ref="xtk:workflow:lib/tabs/colSelector/data"/>
                <container ref="xtk:workflow:lib/tabs/colSelector/collection"/>
              </container>
            </form>
          </input>
          <input alwaysActive="true" expr="GroupConcat([select/descendant::node], &quot; ' [' + [@label] + '] ' &quot; )"
                 type="expr" xpath="/tmp/selectCtrl/out/@humanSelect"/>
          <input colspan="2" fontBold="true" label=" " lineCount="5" noBorder="true"
                 readOnly="true" type="edit" xpath="/tmp/selectCtrl/out/@humanSelect"/>

          <container colcount="2" colspan="2" xpath="transitions">
            <static colspan="2" label="Results" type="separator"/>
            <input xpath="result/@label"/>
            <input xpath="result/@code"/>
            <static colspan="2" label="Complement" type="separator"/>
            <input colspan="2" xpath="remainder/@enabled"/>
            <container colspan="2" type="visibleGroup" visibleIf="[remainder/@enabled]">
              <input xpath="remainder/@label"/>
            </container>
            <static colspan="2" type="help">If this option is checked, all duplicates are saved in a second set.</static>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <set expr="Iif([/tmp/@useLimit]==2, [configuration/@number], [/tmp/@useLimit])"
               xpath="configuration/@number"/>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:dbImport-->
      <form name="dbImport" type="notebook">
        <enter>
          <if expr="@tableName!='' AND ([@dataSource-id]!=0 OR [dataSourceDesc/@server]!='')">
            <set expr="Iif(EV(@inline, 'extAccount')=false, Iif(EV(@inline,'server'), [dataSourceDesc/@name], '{' + [dataSourceDesc/@provider] + ':' + [dataSourceDesc/@login] + ':' + [dataSourceDesc/@dbName] + '/' + [dataSourceDesc/@password] + '@' + [dataSourceDesc/@server] + Iif([dataSourceDesc/@unicodeData], ';unicodeData=1', ';unicodeData=0') + Iif([dataSourceDesc/@NChar], ';NChar=1', ';NChar=0') + ';timezone=' + [dataSourceDesc/@timezone] + '}'), 'nms:extAccount:'+[@dataSource-id])"
                 xpath="/tmp/extDataSource/@desc"/>
            <set expr="wkfTargetSchema(@name, 'src')" xpath="/tmp/selectCtrl/in/@schema"/>
            <set value="select" xpath="/tmp/selectCtrl/in/@choiceType"/>
          </if>
        </enter>
        <container img="nms:miniatures/mini-dbImport.png">
          <input xpath="@label"/>
          <static label="Connection settings" type="separator"/>
          <static type="help">To access external data, you can either use an external account (shared connection) already defined or add a new connection, usable only in this workflow.</static>
          <input checkedValue="0" label="Shared external data source" type="radioButton"
                 xpath="@inline"/>
          <input checkedValue="1" label="Local external data source" type="radioButton"
                 xpath="@inline"/>
          <input checkedValue="2" label="Server-defined external data source" type="radioButton"
                 xpath="@inline"/>
          <container type="visibleGroup" visibleIf="EV(@inline,'inline')">
            <input img="xtk:dbcnx.png" label="Define the data source..." nolabel="false"
                   type="subFormLink" xpath="dataSourceDesc">
              <form label="Connection setting">
                <static>Select the database engine to use from the list of supported ones.</static>
                <input enum="xtk:workflow:provider" label="Engine" xpath="@provider"/>

                <static label="Database server" type="separator"/>
                <input xpath="@server"/>
                <container type="visibleGroup" visibleIf="[@provider]=='Oracle'">
                  <static type="help">TNS name (defined on the application server) used to access the database server.</static>
                </container>
                <container type="visibleGroup" visibleIf="[@provider]=='PostgreSQL'">
                  <static type="help">DNS name (or IP address) valid on the application server to access the database server.</static>
                </container>
                <container type="visibleGroup" visibleIf="[@provider]=='MSSQL'">
                  <static type="help">DNS name (or IP address) valid on the application server to access the database server.</static>
                  <static label="Authentication mode used to access SQL Server" type="separator"/>
                  <input checkedValue="false" label="SQL Server authentication" type="RadioButton"
                         xpath="/tmp/@integratedSecurity"/>
                  <input checkedValue="true" label="Windows NT authentication (integrated security)"
                         type="RadioButton" xpath="/tmp/@integratedSecurity"/>
                </container>
                <container type="visibleGroup" visibleIf="[@provider]=='DB2'">
                  <static type="help">Host name or host:port name used to access the database server.</static>
                </container>
                <container type="visibleGroup" visibleIf="[@provider]=='MySQL'">
                  <static type="help">DNS name (or IP address) valid on the application server to access the database server.</static>
                </container>

                <static label="Authentication settings" type="separator"/>
                <input xpath="@login"/>
                <input crypt="true" instancePassword="true" type="passwordedit" xpath="@password"/>
                <container type="visibleGroup" visibleIf="[@provider]!='Oracle' AND [@provider]!='Teradata'">
                  <static label="Database to use" type="separator"/>
                  <input xpath="@dbName"/>
                </container>
                <input xpath="@unicodeData"/>
                <container type="visibleGroup" visibleIf="[@provider]='Oracle' OR [@provider]='MSSQL'">
                  <input xpath="@NChar"/>
                </container>
                <input enum="xtk:common:timezone" type="sysenum" xpath="@timezone"/>
              </form>
            </input>
          </container>
          <container type="visibleGroup" visibleIf="EV(@inline, 'extAccount')">
            <input img="nms:miniatures/mini-dbImport.png" notifyPathList="@name|../dataSourceDesc/@name,@NChar|../dataSourceDesc/@NChar,@unicodeData|../dataSourceDesc/@unicodeData"
                   xpath="dataSource">
              <sysFilter>
                <condition expr="@type = 7"/>
              </sysFilter>
            </input>
          </container>
          <container type="visibleGroup" visibleIf="EV(@inline, 'server')">
            <input xpath="dataSourceDesc/@name"/>
          </container>
          <input alwaysActive="true" expr="Iif(EV(@inline, 'extAccount')=false, Iif(EV(@inline,'server'), [dataSourceDesc/@name], '{' + [dataSourceDesc/@provider] + ':' + [dataSourceDesc/@login] + ':' + [dataSourceDesc/@dbName] + '/' + [dataSourceDesc/@password] + '@' + [dataSourceDesc/@server] + Iif([dataSourceDesc/@unicodeData], ';unicodeData=1', ';unicodeData=0') + Iif([dataSourceDesc/@NChar], ';NChar=1', ';NChar=0') + ';timezone=' + [dataSourceDesc/@timezone] + '}'), 'nms:extAccount:'+[dataSourceDesc/@name])"
                 type="expr" xpath="/tmp/extDataSource/@desc"/>
          <input label="Table name" xpath="@tableName">
            <input img="xtk:choiceField.png" modeless="false" name="btnChoiceTable"
                   prebuildSubForm="false" xpath=".">
              <enter name="onClick">
                <soapCall name="BuildTableList" service="xtk:sqlSchema">
                  <param exprIn="[/tmp/extDataSource/@desc]" type="string"/>
                  <param exprIn="'%' + [/ignored/dbImport/@tableFilter] + '%'" type="string"/>
                  <param type="DOMDocument" xpathOut="/ignored/dbImport/tableList"/>
                </soapCall>
                <setModified/>
              </enter>
              <form colcount="2" label="Select the table">
                <input catchReturnKey="true" label="Filter" xpath="/ignored/dbImport/@tableFilter"/>
                <input label="Filter" type="button">
                  <enter>
                    <soapCall name="BuildTableList" service="xtk:sqlSchema">
                      <param exprIn="[/tmp/extDataSource/@desc]" type="string"/>
                      <param exprIn="'%' + [/ignored/dbImport/@tableFilter] + '%'"
                             type="string"/>
                      <param type="DOMDocument" xpathOut="/ignored/dbImport/tableList"/>
                    </soapCall>
                  </enter>
                </input>
                <input colspan="2" dblClickAction="btnOk" editable="false" entitySchema="xtk:sqlSchema"
                       noToolbar="true" nolabel="true" readOnly="true" type="list"
                       xpath="/ignored/dbImport/tableList/table" xpathSelection="/tmp/dbImport/@tableName">
                  <input editable="false" label="Table name" xpath="@name"/>
                </input>
                <leave>
                  <set expr="NodeValue([/tmp/dbImport/@tableName]+'/@name')" xpath="@tableName"/>
                </leave>
              </form>
            </input>
          </input>
          <input img="xtk:properties.png" label="Advanced..." nolabel="false" prebuildSubForm="false"
                 type="subFormLink" xpath=".">
            <form label="Advanced parameters">
              <container>
                <static label="Table name selection" type="separator"/>
                <input checkedValue="2" label="Identical to the template" type="RadioButton"
                       xpath="@importType"/>
                <input checkedValue="0" label="Specified in the transition" type="RadioButton"
                       xpath="@importType"/>
                <input checkedValue="1" label="Explicit" type="RadioButton" xpath="@importType"/>
                <container type="visibleGroup" visibleIf="@importType=1">
                  <input label="Computed name" menuId="workflowMenuBuilder" type="scriptEdit"
                         xpath="@script"/>
                  <static type="help">This script allows the use of a table whose name is computed at any execution time.</static>
                </container>
                <static label="" type="separator"/>
                <input img="nms:list.png" label="Update schema structure" prebuildSubForm="false"
                       type="urlButton">
                  <enter>
                    <soapCall name="UpdateTempSchemasFromDatabase" service="xtk:builder">
                      <param exprIn="[extension]" type="DOMElement"/>
                      <param type="DOMElement" xpathOut="extension"/>
                      <param type="string" xpathOut="/ignored/@warning"/>
                    </soapCall>
                    <setModified/>
                    <if expr="[/ignored/@warning] == ''">
                      <msgBox translatedExpr="'Updated schemas'"/>
                    </if>
                  </enter>
                </input>
                <container type="visibleGroup" visibleIf="[/ignored/@warning] != ''">
                  <input type="warning" xpath="/ignored/@warning"/>
                </container>
              </container>
            </form>
          </input>
          <container type="visibleGroup" visibleIf="@tableName != ''">
            <container colcount="2" label="Information collected" type="frame">
              <input colspan="2" xpath="@keepAllExtraData"/>
              <input img="nms:list.png" label="Select the columns to extract..."
                     prebuildSubForm="false" type="subFormLink" xpath=".">
                <form label="Select extra columns">
                  <enter>
                    <set expr="wkfTargetSchema(@name, 'src')" xpath="/tmp/selectCtrl/in/@schema"/>
                  </enter>
                  <container style="flat" type="notebook">
                    <container ref="xtk:workflow:lib/tabs/colSelector/data"/>
                    <container ref="xtk:workflow:lib/tabs/colSelector/collection"/>
                    <container ref="xtk:workflow:lib/tabs/colSelector/links"/>
                  </container>
                </form>
              </input>
              <input align="right" img="nms:miniatures/mini-dbImport.png" label="Add a linked table..."
                     prebuildSubForm="false" type="subFormLink" xpath=".">
                <form label="Link configuration" type="wizard">
                  <enter>
                    <reset xpath="/tmp/dbImportAdd"/>
                    <set expr="wkfTargetSchema(@name, 'src')" xpath="/tmp/dbImportAdd/@targetSchema"/>
                    <set value="linkDefColl" xpath="/tmp/dbImportAdd/@dataType"/>
                  </enter>
                  <container desc="Select the type of link you want to create, then choose the target table where data is stored."
                             title="Definition of the link target">
                    <static label="Link type" type="separator"/>
                    <container colcount="2">
                      <input img="xtk:xtklinkn.png" type="image"/>
                      <input checkedValue="linkDefColl" label="Define a collection"
                             type="radioButton" xpath="/tmp/dbImportAdd/@dataType"/>
                      <input img="xtk:xtklink1.png" type="image"/>
                      <input checkedValue="linkDef" label="Define a link whose target is always available"
                             type="radioButton" xpath="/tmp/dbImportAdd/@dataType"/>
                      <input img="xtk:xtklink0.png" type="image"/>
                      <input checkedValue="linkDefExt" label="Define a link whose target may not exist in the database"
                             type="radioButton" xpath="/tmp/dbImportAdd/@dataType"/>
                    </container>
                    <static label="Link target" type="separator"/>
                    <input label="Table name" xpath="/tmp/dbImportAdd/@tableName">
                      <input img="xtk:choiceField.png" modeless="false" name="btnChoiceTable"
                             prebuildSubForm="false" xpath=".">
                        <enter name="onClick">
                          <soapCall name="BuildTableList" service="xtk:sqlSchema">
                            <param exprIn="[/tmp/extDataSource/@desc]" type="string"/>
                            <param exprIn="'%' + [/ignored/dbImport/@tableFilter] + '%'"
                                   type="string"/>
                            <param type="DOMDocument" xpathOut="/ignored/dbImport/tableList"/>
                          </soapCall>
                          <setModified/>
                        </enter>
                        <form colcount="2" label="Select the table">
                          <input catchReturnKey="true" label="Filter" xpath="/ignored/dbImport/@tableFilter"/>
                          <input label="Filter" type="button">
                            <enter>
                              <soapCall name="BuildTableList" service="xtk:sqlSchema">
                                <param exprIn="[/tmp/extDataSource/@desc]" type="string"/>
                                <param exprIn="'%' + [/ignored/dbImport/@tableFilter] + '%'"
                                       type="string"/>
                                <param type="DOMDocument" xpathOut="/ignored/dbImport/tableList"/>
                              </soapCall>
                            </enter>
                          </input>
                          <input colspan="2" dblClickAction="btnOk" editable="false"
                                 entitySchema="xtk:sqlSchema" noToolbar="true" nolabel="true"
                                 readOnly="true" type="list" xpath="/ignored/dbImport/tableList/table"
                                 xpathSelection="/tmp/dbImport/@tableName">
                            <input editable="false" label="Table name" xpath="@name"/>
                          </input>
                          <leave>
                            <set expr="NodeValue([/tmp/dbImport/@tableName]+'/@name')"
                                 xpath="/tmp/dbImportAdd/@tableName"/>
                            <set expr="[/tmp/dbImportAdd/@tableName]" xpath="/tmp/dbImportAdd/@tableLabel"/>
                          </leave>
                        </form>
                      </input>
                    </input>
                    <input label="Label" xpath="/tmp/dbImportAdd/@tableLabel"/>
                    <leave>
                      <check expr="[/tmp/dbImportAdd/@tableName] != ''">
                        <error>You must specify the table name.</error>
                      </check>
                      <check expr="[/tmp/dbImportAdd/@tableLabel] != ''">
                        <error>You must specify the table label.</error>
                      </check>
                    </leave>
                  </container>
                  <container descExpr="'In the list below, add join conditions between \'' + @tableName + '\' and \'' + [/tmp/dbImportAdd/@tableName] + '\''"
                             title="Join definition">
                    <enter>
                      <set expr="wkfExternalSchema([/tmp/dbImportAdd/@tableName], [/tmp/extDataSource/@desc], [/tmp/dbImportAdd/@tableName], 'extension/schema[@name=\''+[/tmp/dbImportAdd/@tableName]+'\']')"
                           xpath="/tmp/dbImportAdd/@linkSchema"/>
                      <set expr="[/tmp/dbImportAdd/@tableLabel]" xpathExpr="'extension/schema[@name=\''+[/tmp/dbImportAdd/@tableName]+'\']/@label'"/>
                      <set expr="[/tmp/dbImportAdd/@tableLabel]" xpathExpr="'extension/schema[@name=\''+[/tmp/dbImportAdd/@tableName]+'\']/element/@label'"/>
                    </enter>
                    <input nolabel="true" toolbarCaption="Join conditions" type="list"
                           xpath="/tmp/dbImportAdd/element/condition">
                      <input label="Remote field" type="pathEdit" xpath="@dstExpr"
                             xpathSchema="/tmp/dbImportAdd/@linkSchema"/>
                      <input label="Local field" type="pathEdit" xpath="@srcExpr"
                             xpathSchema="/tmp/dbImportAdd/@targetSchema"/>
                    </input>
                  </container>
                  <leave>
              <!-- create the link structure to hold selected link definition -->
                    <set expr="[/tmp/dbImportAdd/@tableName]" xpath="/tmp/dbImportAdd/element/@name"/>
                    <set expr="[/tmp/dbImportAdd/@tableLabel]" xpath="/tmp/dbImportAdd/element/@label"/>
                    <set expr="[/tmp/dbImportAdd/@linkSchema]" xpath="/tmp/dbImportAdd/element/@schema"/>
                    <set expr="Iif([/tmp/dbImportAdd/@dataType]='linkDefColl', 0, Iif([/tmp/dbImportAdd/@dataType]='linkDef', 1, 2))"
                         xpath="/tmp/dbImportAdd/element/@cardinality"/>
                    <copyElement exprDst="'links[@name=\'' + [/tmp/dbImportAdd/@tableName] + '\']'"
                                 xpathSrc="/tmp/dbImportAdd/element"/>
                  </leave>
                </form>
              </input>
              <input alwaysActive="true" translatedExpr="Iif(NodeCount([select/node])&gt;0, Iif(NodeCount(links)&gt;0, 'Data:\n', '') + GroupConcat([select/descendant::node], &quot; ' [' + [@label] + '] ' &quot; ), '') + Iif(NodeCount(links)&gt;0, '\nLinks:\n' + GroupConcat([links], &quot; ' [' + [@label] + '] ' &quot;), '')"
                     type="expr" xpath="/tmp/selectCtrl/out/@humanSelect"/>
              <input colspan="2" fontBold="true" lineCount="4" noBorder="true" nolabel="true"
                     readOnly="true" type="edit" xpath="/tmp/selectCtrl/out/@humanSelect"/>
            </container>
            <container label="Source filtering" type="frame">
              <input img="nms:miniatures/mini-query.png" label="Edit query..." prebuildSubForm="false"
                     type="subFormLink" xpath=".">
                <form label="Query">
                  <input name="filterList" noSaveFilter="true" nolabel="true" toolbarAlign="horizontal"
                         toolbarCaption="Filter conditions" type="conditionList"
                         xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                         xpathHelp="humanCond" xpathSchema="/tmp/selectCtrl/in/@schema">

                    <input colSize="15" label=" " xpath="/@bool-operator"/>
                    <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                    <input colSize="15" label="Operator" xpath="/@operator"/>
                    <input colSize="30" label="Value" xpath="/@rightExpr"/>
                  </input>
                  <leave>
                    <set expr="SubString(humanCond, IndexOf(humanCond, ':')+2)" xpath="@label"/>
                  </leave>
                </form>
              </input>
              <input fontBold="true" lineCount="4" noBorder="true" nolabel="true"
                     readOnly="true" type="edit" xpath="humanCond"/>
            </container>
          </container>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <if expr="@tableName=='' OR ([@dataSource-id]==0 AND [dataSourceDesc/@server]='')">
            <reset xpath="extension"/>
          </if>
          <if expr="@tableName!='' AND ([@dataSource-id]!=0 OR [dataSourceDesc/@server]!='')">
            <set expr="wkfExternalSchema(@tableName, [/tmp/extDataSource/@desc], @tableName, 'extension/schema[@name=\'' + @tableName + '\']')"
                 xpath="/ignored/dbImport/@schema"/>
          </if>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:fileImport-->
      <form maxLabelWidth="50" name="fileImport" type="notebook">
        <enter>
          <set value="1" xpath="/ignored/@hideSQLName"/>
          <set expr="Iif([@fileConnection-id]!=0, 4, iif(@preproc!='', 2, Iif(@md5!='', 3, @importType)))"
               xpath="/tmp/@fileHandling"/>
          <set expr="Iif([@dataSource-id]!=0, 1, 0)" xpath="/tmp/@dataSourceTarget"/>
        </enter>
        <container colcount="2" img="nms:miniatures/mini-fileImport.png" label="Data">
          <input colspan="2" xpath="@label"/>
          <container colcount="2" colspan="2" xpath="source">
            <static colspan="2" label="File format" type="separator"/>
            <container colcount="2" colspan="2" importList="true" name="autoDetect"
                       type="importAutoDetectContainer" xpath="dataSourceConfig"
                       xpathAutoDetect="../name" xpathLastParsed="../@lastParsedDataSource"
                       xpathUploadFile="../@upload">
              <container colspan="2" type="visibleGroup" visibleIf="[../@upload]">
                <input filters="Text, CSV or XML files (*.txt;*.csv;*.tab;*.xml)|*.txt;*.csv;*.tab;*.xml|All (*.*)|*.*|"
                       label="Sample file" type="fileEdit" xpath="../name" xpathType="../@format"/>
              </container>
              <container colspan="2" type="visibleGroup" visibleIf="[../@upload]==false">
                <input label="Sample file" xpath="../name"/>
              </container>
              <input label="Use a sample file on the local computer" xpath="../@upload"/>
              <input xpath="../../@collectLineNumber"/>
              <input img="xtk:refresh.png" label="Auto-Detect format" name="autoDetectBtn1"
                     nolabel="false" type="urlButton"/>
              <input img="xtk:fileEdit.png" label="Click here to change the file format..."
                     nolabel="false" prebuildSubForm="false" type="subFormLink" xpath=".">
                <form ref="nms:importList:lib/fileFormat"/>
              </input>
            </container>
            <static colspan="2" label="Preview" type="separator"/>
            <input colspan="2" name="PreviewList" type="fileParsingPreviewList" xpath="dataSourceConfig"
                   xpathIndex="/tmp/columns/@current"/>
          </container>
          <container colcount="2" colspan="2">
            <static colspan="2" label="Name of the file to load" type="separator"/>
            <container colcount="2" colspan="2">
              <input checkedValue="0" colspan="1" label="Specified in the transition"
                     type="RadioButton" xpath="/tmp/@fileHandling"/>
              <input checkedValue="1" colspan="1" label="Calculated" type="RadioButton"
                     xpath="/tmp/@fileHandling"/>
              <input checkedValue="2" colspan="1" label="Pre-process the file" type="RadioButton"
                     xpath="/tmp/@fileHandling"/>
              <input checkedValue="3" colspan="1" label="Upload a file from the local machine"
                     type="RadioButton" xpath="/tmp/@fileHandling"/>
              <input checkedValue="4" colspan="1" label="Create a view for file"
                     type="RadioButton" xpath="/tmp/@fileHandling"/>
            </container>
            <container colspan="2" type="visibleGroup" visibleIf="[/tmp/@fileHandling]==0">
              <static/>
            </container>
            <container colspan="2" type="visibleGroup" visibleIf="[/tmp/@fileHandling]=1">
              <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@file"/>
            </container>
            <container colspan="2" type="visibleGroup" visibleIf="[/tmp/@fileHandling]=2">
              <container type="visibleGroup" visibleIf="GetOption('XtkSecurity_Disable_Preproc')!=1">
                <input label="Command" menuId="workflowMenuBuilder" xpath="@preprocessCommand"/>
              </container>
              <container type="visibleGroup" visibleIf="GetOption('XtkSecurity_Disable_Preproc')==1">
                <input label="Command" menuId="workflowMenuBuilder" type="scriptEdit"
                       xpath="@preproc"/>
                <static label="Allowing arbitrary command for pre-processing is a security concern, disable security option XtkSecurity_Disable_Preproc to force the use of a predefined list of commands"
                        type="warning"/>
              </container>
            </container>
            <container colcount="2" colspan="2" type="visibleGroup" visibleIf="[/tmp/@fileHandling]=3">
              <container colspan="2">
                <input filters="Text, CSV or XML files (*.txt;*.csv;*.tab;*.xml)|*.txt;*.csv;*.tab;*.xml|All (*.*)|*.*|"
                       label="File name" type="fileEdit" xpath="@file"/>
                <input alwaysActive="true" expr="FileUploaded([@file], [@md5])" type="expr"
                       xpath="/ignored/file/@uploadStatus"/>
              </container>
              <container colcount="2" colspan="2">
                <container type="visibleGroup" visibleIf="[/ignored/file/@uploadStatus] == -1">
                  <static img="xtk:logwarn.png" label=" " nolabel="false">The file no longer exists on the local disk and has not been uploaded.</static>
                </container>
                <container type="visibleGroup" visibleIf="[/ignored/file/@uploadStatus] == 0">
                  <static img="xtk:loginfo.png" label=" " nolabel="false">The local file has not been uploaded onto the server.</static>
                </container>
                <container type="visibleGroup" visibleIf="[/ignored/file/@uploadStatus] == 1">
                  <static img="xtk:logwarn.png" label=" " nolabel="false">The local file is different from the one on the server.</static>
                </container>
                <container type="visibleGroup" visibleIf="[/ignored/file/@uploadStatus] == 2">
                  <static img="xtk:xtkcheck.png" label=" " nolabel="false">File exists on server, but not on the local disk.</static>
                </container>
                <container type="visibleGroup" visibleIf="[/ignored/file/@uploadStatus] == 3">
                  <static img="xtk:xtkcheck.png" label=" " nolabel="false">File already exists on server.</static>
                </container>
                <input img="xtk:upload.png" label="Upload on server..." nolabel="false"
                       prebuildSubForm="false" type="subFormLink" xpath=".">
                  <form label="Updating file on server">
                    <enter>
                      <set value="" xpath="/ignored/@performedUpload"/>
                      <set expr="@file" xpath="/ignored/resource/@fileName"/>
                      <set expr="@md5==''" xpath="/ignored/resource/@md5Empty"/>
                    </enter>

                    <input label="File" required="true" type="fileEdit" xpath="/ignored/resource/@fileName"/>

                    <static type="help">Click on 'Upload' to start the file transfer to the server.</static>
                    <container exprTransferType="true" keyIsMd5="true" methodName="NONE"
                               notResTable="true" type="resourceTransferContainer"
                               xpathFile="/ignored/resource/@fileName" xpathOutList="@md5,/ignored/@performedUpload">
                      <input name="JobLogsList" type="JobLogList"/>
                      <container colcount="2">
                        <value dataType="timespan" label="Elapsed" xpath="/tmp/execution/@elapsed"/>
                        <value dataType="timespan" label="Estimated left" xpath="/tmp/execution/@remaining"/>
                      </container>
                      <container colcount="2" enabledIf="[/ignored/@performedUpload] == ''"
                                 type="enabledGroup">
                        <value name="JobProgressBar" type="ProgressBar" valign="center"
                               xpathElapsed="/tmp/timing/@elapsed" xpathRemaining="/tmp/timing/@remaining"/>
                        <input enabledIf="[/ignored/resource/@fileName]!= '' " img="xtk:upload.png"
                               label="&amp;Upload" name="JobSubmitButton" type="flatbutton"/>
                      </container>
                    </container>
                  </form>
                </input>
              </container>
            </container>
            <container colspan="2" type="visibleGroup" visibleIf="[/tmp/@fileHandling]=4">
              <input img="nms:miniatures/mini-fileImport.png" xpath="fileConnection">
          <!-- only cloud storage -->
                <sysFilter>
                  <condition expr="@type IN ( 15, 16, 17 )"/>
                </sysFilter>
              </input>
              <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@file"/>
            </container>
          </container>

    <!-- extAccount for data source target-->
          <container colcount="2" colspan="2" rowspan="2">
            <static colspan="2" label="Target database" type="separator"/>
            <input checkedValue="0" colspan="1" label="Default" type="RadioButton"
                   xpath="/tmp/@dataSourceTarget"/>
            <input checkedValue="1" colspan="1" label="External database" type="RadioButton"
                   xpath="/tmp/@dataSourceTarget"/>
            <container colspan="2" type="visibleGroup" visibleIf="[/tmp/@dataSourceTarget]==1">
              <input colspan="1" img="nms:miniatures/mini-dbImport.png" xpath="dataSource">
          <!-- only external base -->
                <sysFilter>
                  <condition expr="@type = 7"/>
                </sysFilter>
              </input>
            </container>
          </container>

          <container colcount="2" colspan="2">
            <static colspan="2" label="Reject management" type="separator"/>
            <input colspan="1" xpath="@maxErrorCount"/>
            <input colspan="1" label="Keep the rejects in a file" xpath="transitions/remainder/@enabled"/>
            <container type="visibleGroup" visibleIf="[transitions/remainder/@enabled]">
              <input colspan="2" label="Rejection file" menuId="workflowMenuBuilder"
                     type="scriptEdit" xpath="transitions/remainder/@file"/>
            </container>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <set expr="Iif([/tmp/@dataSourceTarget]=1, [@dataSource-id], 0)" xpath="@dataSource-id"/>
          <set expr="Iif([/tmp/@fileHandling]&lt;2, [/tmp/@fileHandling], Iif([/tmp/@fileHandling]=2, iif(GetOption('XtkSecurity_Disable_Preproc')!=1, 0, 1), 1 ))"
               xpath="@importType"/>
          <set expr="Iif([/tmp/@fileHandling]=2, '', @file)" xpath="@file"/>
          <set expr="Iif([/tmp/@fileHandling]=2, iif(GetOption('XtkSecurity_Disable_Preproc')!=1, @preprocessCommand, @preproc), '')"
               xpath="@preproc"/>
          <set expr="Iif([/tmp/@fileHandling]=3, @md5, '')" xpath="@md5"/>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:soapImport-->
      <form maxLabelWidth="50" name="soapImport" type="notebook">
        <enter>
          <set expr="Iif(@URL!='', 1, 0)" xpath="/tmp/@useWSDL"/>
        </enter>
        <container img="nms:miniatures/mini-soapImport.png" label="SOAP call">
          <input xpath="@label"/>
          <container type="hpaned">
            <container>
              <container label="Result format" type="frame">
                <input checkedValue="0" label="Use an example XML" type="radioButton"
                       xpath="/tmp/@useWSDL"/>
                <input checkedValue="1" label="Use a WSDL" type="radioButton" xpath="/tmp/@useWSDL"/>
                <container colcount="2" type="visibleGroup" visibleIf="[/tmp/@useWSDL]=1">
                  <input label="Access URL" xpath="@URL"/>
                  <input label="Generate the skeletal code..." type="subFormLink"
                         xpath=".">
                    <form label="Web service description" type="wizard">
                      <enter>
                        <soapCall name="describeWSDL" service="xtk:workflow">
                          <param exprIn="@URL" type="string"/>
                          <param type="DOMElement" xpathOut="/tmp/wsdlDescription"/>
                        </soapCall>
                        <set expr="sample" xpath="/tmp/wsdlDescription/sampleResult"/>
                        <setModified/>
                      </enter>
                      <container desc="In the list below, select the service from which to choose an endpoint."
                                 img="nms:activities/soapImport.png" title="Select service">
                        <input columnIndex="true" editable="false" noToolbar="true"
                               nolabel="true" type="list" xpath="/tmp/wsdlDescription/service"
                               xpathValue="/tmp/wsdlSelectedService">
                          <input label="Service" xpath="@name"/>
                        </input>
                        <input expr="Iif([/tmp/wsdlSelectedService]!='', NodeValue('/tmp/wsdlSelectedService/@name'), '')"
                               type="expr" xpath="@serviceName"/>
                      </container>
                      <container desc="In the list below, select the endpoint from which to choose a function."
                                 img="nms:activities/soapImport.png" title="Select endpoint"
                                 visibleIf="[/tmp/wsdlSelectedService]!=''">
                        <input columnIndex="true" editable="false" noToolbar="true"
                               nolabel="true" type="list" xpath="/tmp/wsdlSelectedService/port"
                               xpathValue="/tmp/wsdlSelectedPort">
                          <input label="Endpoint" xpath="@name"/>
                          <input label="Address" xpath="@url"/>
                        </input>
                        <input expr="Iif([/tmp/wsdlSelectedPort]!='', NodeValue('/tmp/wsdlSelectedPort/@name'), '')"
                               type="expr" xpath="@portName"/>
                      </container>
                      <container desc="In the list below, select the function for recovering the data to insert into the database."
                                 img="nms:activities/soapImport.png" title="Select function"
                                 visibleIf="[/tmp/wsdlSelectedPort]!=''">
                        <input columnIndex="true" editable="false" noToolbar="true"
                               nolabel="true" type="list" xpath="/tmp/wsdlSelectedPort/operation"
                               xpathValue="/tmp/wsdlSelectedCall">
                          <input label="Function" xpath="@name"/>
                          <input label="Prototype" xpath="@label"/>
                        </input>
                        <input expr="Iif([/tmp/wsdlSelectedCall]!='', NodeValue('/tmp/wsdlSelectedCall/@name'), '')"
                               type="expr" xpath="@callName"/>
                        <input expr="Iif([/tmp/wsdlSelectedCall]!='', NodeValue('/tmp/wsdlSelectedCall/sample'), sample)"
                               type="expr" xpath="/tmp/wsdlDescription/sampleResult"/>
                      </container>
                      <container desc="Here is an example of a call of the selected function. You can change it to specify the expected result."
                                 img="nms:activities/soapImport.png" title="Example of a result"
                                 visibleIf="[/tmp/wsdlDescription/sampleResult]!=''">
                        <input label="Example of a result" lineCount="7" xpath="/tmp/wsdlDescription/sampleResult"/>
                        <input xpath="@collectionResult"/>
                      </container>
                      <leave>
                        <if expr="[/tmp/wsdlSelectedCall]!=''">
                          <soapCall name="generateSOAPCode" service="xtk:workflow">
                            <param exprIn="[/tmp/wsdlSelectedCall]" type="DOMElement"/>
                            <param type="DOMElement" xpathOut="/tmp/wsdlCalls"/>
                          </soapCall>
                          <set value="yes" xpath="/tmp/wsdlCalls/@validate"/>
                          <if expr="soapInit!='' OR soapCall!=''">
                            <msgBox translatedExpr="'Replace the existing code with the new skeletal code?'"
                                    type="yesno" xpathOut="/tmp/wsdlCalls/@validate"/>
                          </if>
                          <if expr="[/tmp/wsdlCalls/@validate]=='yes'">
                            <set expr="[/tmp/wsdlCalls/init]" xpath="soapInit"/>
                            <set expr="[/tmp/wsdlCalls/call]" xpath="soapCall"/>
                            <set expr="[/tmp/wsdlDescription/sampleResult]" xpath="sample"/>
                          </if>
                        </if>
                      </leave>
                    </form>
                  </input>
                  <value colspan="2" fontBold="true" xpath="@serviceName"/>
                  <value colspan="2" fontBold="true" xpath="@portName"/>
                  <value colspan="2" fontBold="true" xpath="@callName"/>
                </container>
                <container type="visibleGroup" visibleIf="[/tmp/@useWSDL]=0">
                  <input filters="XML files (*.xml)|*.xml|All (*.*)|*.*|" label="Sample file"
                         type="fileEdit" useInlineXML="false" xpath="/tmp/@sampleFile"
                         xpathLoadContent="sample"/>
                </container>
                <container colcount="2" importList="true" modeSource="xml" name="autoDetect"
                           type="importAutoDetectContainer" xpath="dataSourceConfig"
                           xpathAutoDetect="../sample" xpathLastParsed="../@lastParsedDataSource"
                           xpathUploadFile="/tmp/@upload">
                  <input colspan="2" xpath="../sample"/>
                  <input img="xtk:fileEdit.png" label="Click here to view and edit analysis results..."
                         nolabel="false" prebuildSubForm="false" type="subFormLink"
                         xpath=".">
                    <form colcount="2" label="File format">
                      <input columnIndex="true" editable="false" img="xtk:xml.png"
                             noToolbar="true" nolabel="true" notitle="true" type="list"
                             xpath="dataSourceColumn" xpathIndex="/tmp/columns/@current"
                             xpathToIgnore="dataSourceColumn/valueMapping">
                        <input xpath="@label"/>
                      </input>
                      <container type="collectionItemGroup" xpath="dataSourceColumn"
                                 xpathIndex="/tmp/columns/@current">
                        <input xpath="@label"/>
                        <container type="visibleGroup" visibleIf="@typeXform!=''">
                          <input label="Data type" type="sysEnum" xpath="@typeXform"/>
                        </container>
                        <container type="visibleGroup" visibleIf="@typeXform=''">
                          <input xpath="@type"/>
                        </container>
                        <container type="visibleGroup" visibleIf="@type=='date' OR @typeXform=='date'">
                          <input xpath="@dateFormat"/>
                        </container>
                        <container type="visibleGroup" visibleIf="@type=='time' OR @typeXform=='time'">
                          <input xpath="@timeFormat"/>
                        </container>
                        <container type="visibleGroup" visibleIf="@type=='datetime' OR @typeXform=='datetime'">
                          <input xpath="@dateFormat"/>
                        </container>
                        <container type="visibleGroup" visibleIf="@type=='double' OR @typeXform=='double'">
                          <input xpath="@numFormat"/>
                        </container>
                        <input xpath="@ignore"/>

                        <container type="visibleGroup" visibleIf="!@ignore">
                          <input xpath="@allowNullValues"/>
                          <input xpath="@name"/>
                          <container type="visibleGroup" visibleIf="[/ignored/@hideSQLName]!=1">
                            <input xpath="@sqlname"/>
                            <static type="help">If the SQL name is not specified a default name will be used instead.</static>
                          </container>
                          <input align="right" label="Advanced parameters..." type="subFormLink"
                                 xpath=".">
                            <form label="Configure column data" maxLabelWidth="50">
                              <enter>
                                <if expr="@stringXform=''">
                                  <set expr="'none'" xpath="@stringXform"/>
                                </if>
                                <if expr="@spaceXform=''">
                                  <set expr="'none'" xpath="@spaceXform"/>
                                </if>
                                <if expr="@typeXform=''">
                                  <set expr="@type" xpath="@typeXform"/>
                                  <if expr="EV(@typeXform, 'date', 'time', 'datetime')">
                                    <set value="/" xpath="@dateSep"/>
                                    <set value=" " xpath="@dateTimeSep"/>
                                    <set value=":" xpath="@timeSep"/>
                                  </if>
                                </if>
                                <if expr="@typeXform=@type">
                                  <set expr="'string'" xpath="@type"/>
                                </if>
                              </enter>

                              <input expr="Iif(EV(@typeXform, 'date','time', 'datetime')=false, '', '/')"
                                     type="expr" xpath="@dateSep"/>
                              <input expr="Iif(EV(@typeXform, 'date','time', 'datetime')=false, '', ' ')"
                                     type="expr" xpath="@dateTimeSep"/>
                              <input expr="Iif(EV(@typeXform, 'date','time', 'datetime')=false, '', ':')"
                                     type="expr" xpath="@timeSep"/>
                              <input label="Data type" xpath="@typeXform"/>
                              <input xpath="@allowNullValues"/>
                              <container type="visibleGroup" visibleIf="@typeXform='string'">
                                <input xpath="@width"/>
                                <input label="Data transformation" xpath="@stringXform"/>
                                <input label="White space management" xpath="@spaceXform"/>
                              </container>
                              <container type="visibleGroup" visibleIf="@typeXform=='date'">
                                <container label="Format and separator" maxLabelWidth="300"
                                           type="frame">
                                  <input xpath="@dateFormat"/>
                                  <container colcount="2" type="visibleGroup" visibleIf="EV(@dateFormat, 'ymdnosep')=false">
                                    <input label="Year, month, day" width="5" xpath="@dateSep"/>
                                  </container>
                                </container>
                              </container>
                              <container type="visibleGroup" visibleIf="@typeXform=='time'">
                                <container label="Format and separator" maxLabelWidth="300"
                                           type="frame">
                                  <input xpath="@timeFormat"/>
                                  <container colcount="2" type="visibleGroup" visibleIf="EV(@dateFormat, 'ymdnosep')=false">
                                    <input label="Hour, minute, second" width="5"
                                           xpath="@timeSep"/>
                                  </container>
                                </container>
                              </container>
                              <container type="visibleGroup" visibleIf="@typeXform=='datetime'">
                                <container label="Format and separators" maxLabelWidth="300"
                                           type="frame">
                                  <input xpath="@dateFormat"/>
                                  <container colcount="2" type="visibleGroup" visibleIf="EV(@dateFormat, 'ymdnosep')=false">
                                    <input label="Year, month, day" width="5" xpath="@dateSep"/>
                                    <input label="Hour, minute, second" width="5"
                                           xpath="@timeSep"/>
                                    <input label="Date, hour" width="5" xpath="@dateTimeSep"/>
                                  </container>
                                </container>
                              </container>
                              <container type="visibleGroup" visibleIf="@typeXform=='double'">
                                <input xpath="@numFormat"/>
                              </container>

                              <container colcount="2" label="Mapping" maxLabelWidth="300"
                                         type="frame">
                                <input nolabel="true" type="list" xpath="valueMapping">
                                  <input label="Value" xpath="@src"/>
                                  <input label="Result" xpath="@dst"/>
                                </input>
                              </container>
                              <input xpath="@colProcessing"/>
                              <container type="visibleGroup" visibleIf="EV(@colProcessing, 'defaultOnErr', 'defaultOnMissing')">
                                <input xpath="@default"/>
                              </container>
                              <leave>
                                <if expr="@typeXform!=@type">
                                  <set expr="'string'" xpath="@type"/>
                                </if>
                              </leave>
                            </form>
                          </input>
                        </container>

                      </container>
                    </form>
                  </input>
                  <input align="right" img="xtk:refresh.png" label="Re-analyze the example"
                         name="autoDetectBtn1" nolabel="false" type="urlButton"/>
                </container>
                <input xpath="@collectLineNumber"/>
                <input xpath="@collectionResult"/>
              </container>
            </container>
            <container>
              <static label="Code" type="separator"/>
              <container type="notebook">
                <container label="Initialization">
                  <static label="This script lets you initialize communication with the server."
                          type="help"/>
                  <input nolabel="true" type="jsedit" xpath="soapInit">
                    <container>
                      <input menuId="workflowMenuBuilder" options="notJst" type="customizeBtn"
                             xpath="/ignored/customizeBtnOut"/>
                    </container>
                  </input>
                </container>
                <container label="Iteration">
                  <static label="Each result of the script call above will be stored in the work table. \nTo end this SOAP session, please return 'null'"
                          type="help"/>
                  <input nolabel="true" type="jsedit" xpath="soapCall">
                    <container>
                      <input menuId="workflowMenuBuilder" options="notJst" type="customizeBtn"
                             xpath="/ignored/customizeBtnOut"/>
                    </container>
                  </input>
                </container>
                <container label="Finalization">
                  <static label="This script lets you free all possible resources used during previous calls."
                          type="help"/>
                  <input nolabel="true" type="jsedit" xpath="soapEnd">
                    <container>
                      <input menuId="workflowMenuBuilder" options="notJst" type="customizeBtn"
                             xpath="/ignored/customizeBtnOut"/>
                    </container>
                  </input>
                </container>
              </container>
            </container>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <if expr="[/tmp/@useWSDL]='0'">
            <set value="" xpath="@URL"/>
          </if>
        </leave>
      </form>
<!--[cf]-->
  <!--[of]:  export-->
      <form name="fileExport" type="notebook">
        <enter>
          <set expr="wkfTargetSchema(@name)" xpath="/ignored/@orgSchema"/>
        </enter>
        <container img="xtk:miniatures/mini-fileExport.png">
          <input xpath="@label"/>
          <container label="File to extract" type="frame">
            <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@file"/>
            <input img="xtk:export.png" label="Edit the file format..." nolabel="false"
                   prebuildSubForm="false" type="subFormLink" xpath=".">
              <form img="xtk:export32.png" label="Extraction file format" type="wizard">
                <enter>
            <!-- make sure targetData/x and offerView/y can be declared -->
                  <set value="" xpath="/tmp/@schemaChoice"/>
                  <set expr="wkfTargetSchema(@name, '', 1)" xpath="extraction/source/@schema"/>
            <!-- set input parameters for selectCtrl -->
                  <set expr="[extraction/source/@schema]" xpath="/tmp/selectCtrl/in/@schema"/>
                  <set value="export" xpath="/tmp/selectCtrl/in/@choiceType"/>
                </enter>

                <container ref="xtk:exportSource:column" xpath="extraction"/>
                <container ref="xtk:exportSource:conditionLink" visibleIf="[extraction/source/conditionLink/@xpath]!=''"
                           xpath="extraction"/>
                <container ref="xtk:exportSource:sort" xpath="extraction"/>
                <container ref="xtk:exportSource:destInfo" xpath="extraction"/>
                <container ref="xtk:exportSource:mapping" xpath="extraction"/>
              </form>
            </input>
            <container type="visibleGroup" visibleIf="[/ignored/@orgSchema]==''">
              <static type="warning">This activity requires an inbound population.</static>
            </container>
          </container>

          <input label="Generate an outbound transition" xpath="transitions/done/@enabled"/>
          <input label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
        </container>

        <container img="xtk:script.png" label="Script">
          <static type="help">Export modification script</static>
          <input nolabel="true" xpath="script">
            <container>
              <input menuId="wfExportMenuBuilder" options="notJst" type="customizeBtn"
                     xpath="/ignored/customizeBtnOut"/>
            </container>
          </input>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <check expr="@file!=''">
            <error>You must specify the output file name.</error>
          </check>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:union-->
      <form name="union" type="notebook">
        <enter>
          <set expr="Iif(@useKeyForReconciliation, 0, Iif(nodeCount(joinKeys)==0, 1, 2))"
               xpath="/tmp/@joinType"/>
          <set expr="wkfTargetSchema(@name)" xpath="/tmp/@joinSchema"/>
        </enter>
        <container colcount="2" img="nms:miniatures/mini-union.png">
          <input colspan="2" xpath="@label"/>
          <container colspan="2" label="Reconciliation" type="frame">
            <input checkedValue="0" label="Keys only" type="RadioButton" xpath="/tmp/@joinType"/>
            <input checkedValue="1" label="All shared columns" type="RadioButton"
                   xpath="/tmp/@joinType"/>
            <input checkedValue="2" label="A selection of columns" type="RadioButton"
                   xpath="/tmp/@joinType"/>
            <container type="visibleGroup" visibleIf="[/tmp/@joinType]==1">
              <input type="ExclusionMainSetEdit" xpath="@mainSet"/>
              <static type="help">Select the population above for which the characteristics will be kept for the rest of the workflow</static>
            </container>
            <container type="visibleGroup" visibleIf="[/tmp/@joinType]==2">
              <input type="ExclusionMainSetEdit" xpath="@mainSet"/>
              <static type="help">Select the population above for which the characteristics will be kept for the rest of the workflow</static>
              <static label="Columns used for the join" type="separator"/>
              <input label=" " toolbarAlign="vertical" type="list" xpath="joinKeys">
                <input choiceType="xpath" hideCalculated="true" hideLinks="true"
                       hideMappedAsXml="true" type="pathEdit" xpath="@xpath" xpathSchema="/tmp/@joinSchema"/>
              </input>
            </container>
          </container>
          <input colspan="2" xpath="@useOnlyCommonColumns"/>
          <input colspan="2" xpath="@enableLimit"/>
          <container colcount="2" colspan="2" type="visibleGroup" visibleIf="@enableLimit">
            <input label="Number" xpath="@limit"/>
            <static label="This field specifies the maximum number of records in the inbound populations."
                    type="help"/>
          </container>
          <container colspan="2" type="visibleGroup" visibleIf="@enableLimit">
            <static label="Priorities of inbound populations" type="separator"/>
            <input editable="false" hideEditButtons="true" label=" " toolbarAlign="vertical"
                   type="UnionLimitList" xpath="eventLimit">
              <input xpath="@label"/>
              <input xpath="@name"/>
            </input>
            <static label="Inbound populations are used up in priority order until the maximum number of records is reached."
                    type="help"/>
          </container>
          <container colcount="2" colspan="2" xpath="transitions">
            <static colspan="2" label="Results" type="separator"/>
            <input xpath="result/@label"/>
            <input xpath="result/@code"/>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <set expr="Iif([/tmp/@joinType]==0, 1, 0)" xpath="@useKeyForReconciliation"/>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:intersection-->
      <form name="intersection" type="notebook">
        <enter>
          <set expr="Iif(@useKeyForReconciliation, 0, Iif(nodeCount(joinKeys)==0, 1, 2))"
               xpath="/tmp/@joinType"/>
          <set expr="wkfTargetSchema(@name)" xpath="/tmp/@joinSchema"/>
        </enter>
        <container colcount="2" img="nms:miniatures/mini-intersection.png">
          <input colspan="2" xpath="@label"/>
          <container colspan="2" label="Reconciliation" type="frame">
            <input checkedValue="0" label="Keys only" type="RadioButton" xpath="/tmp/@joinType"/>
            <input checkedValue="1" label="All shared columns" type="RadioButton"
                   xpath="/tmp/@joinType"/>
            <input checkedValue="2" label="A selection of columns" type="RadioButton"
                   xpath="/tmp/@joinType"/>
            <container type="visibleGroup" visibleIf="[/tmp/@joinType]==1">
              <input type="ExclusionMainSetEdit" xpath="@mainSet"/>
              <static type="help">Select the population above for which the characteristics will be kept for the rest of the workflow</static>
            </container>
            <container type="visibleGroup" visibleIf="[/tmp/@joinType]==2">
              <input type="ExclusionMainSetEdit" xpath="@mainSet"/>
              <static type="help">Select the population above for which the characteristics will be kept for the rest of the workflow</static>
              <static label="Columns used for the join" type="separator"/>
              <input label=" " toolbarAlign="vertical" type="list" xpath="joinKeys">
                <input type="pathEdit" xpath="@xpath" xpathSchema="/tmp/@joinSchema"/>
              </input>
            </container>
          </container>
          <input colspan="2" xpath="@useOnlyCommonColumns"/>

          <container colcount="2" colspan="2" xpath="transitions">
            <static colspan="2" label="Results" type="separator"/>
            <input xpath="result/@label"/>
            <input xpath="result/@code"/>
            <static colspan="2" label="Complement" type="separator"/>
            <input colspan="2" xpath="remainder/@enabled"/>
            <container colcount="2" colspan="2" type="visibleGroup" visibleIf="[remainder/@enabled]">
              <input xpath="remainder/@label"/>
              <input xpath="remainder/@code"/>
            </container>
            <static colspan="2" type="help">The complement set is the union of the inputs minus the intersection.</static>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <set expr="Iif([/tmp/@joinType]==0, 1, 0)" xpath="@useKeyForReconciliation"/>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:exclusion-->
      <form name="exclusion" type="notebook">
        <enter>
          <set expr="wkfTargetSchema(@name)" xpath="/tmp/@exclusionSetSchema"/>
        </enter>
        <container colcount="2" img="nms:miniatures/mini-exclusion.png">
          <input colspan="2" xpath="@label"/>
          <input colspan="2" type="ExclusionMainSetEdit" xpath="@mainSet"/>
          <static colspan="2" type="help">Select the population above from which records included in the other populations will be excluded.</static>
          <input colspan="2" expr="wkfSchemaName(@mainSet)" type="expr" xpath="/tmp/@exclusionSetSchema"/>
          <static colspan="2" label="Exclusion rules for incompatible targeting dimensions"
                  type="separator"/>
          <input colspan="2" editable="false" label=" " type="list" xpath="exclusionSet"
                 zoom="true" zoomOnAdd="true">
            <input type="ExclusionMainSetEdit" xpath="@name" xpathActivityName="../@name"/>
            <input xpath="@excludeType"/>
            <input xpath="@excludeAxis"/>
            <input xpath="@excludePath"/>
            <form label="Exception definition" maxLabelWidth="60">
              <enter>
                <set expr="wkfSchemaName(@name)" xpath="/tmp/@exclusionExceptionSchema"/>
              </enter>
              <input type="ExclusionMainSetEdit" xpath="@name" xpathActivityName="../@name"/>
              <input expr="wkfSchemaName(@name)" type="expr" xpath="/tmp/@exclusionExceptionSchema"/>
              <input label="Change dimension" xpath="@excludeType"/>
              <container type="visibleGroup" visibleIf="EV(@excludeType, 'axis')">
                <input label="Link" nolabel="false" type="pathEdit" useTablePath="true"
                       xpath="@excludeAxis" xpathSchema="/tmp/@exclusionExceptionSchema"/>
              </container>
              <container type="visibleGroup" visibleIf="EV(@excludeType, 'id')">
                <input label="Field" nolabel="false" type="pathEdit" xpath="@excludePath"
                       xpathSchema="/tmp/@exclusionExceptionSchema"/>
              </container>
              <container type="visibleGroup" visibleIf="EV(@excludeType, 'join')">
                <input nolabel="true" toolbarCaption="Columns used for the join"
                       type="List" xpath="joinKeys">
                  <input type="pathEdit" xpath="@xpathSrc" xpathSchema="/tmp/@exclusionExceptionSchema"/>
                  <input type="pathEdit" xpath="@xpathDst" xpathSchema="/tmp/@exclusionSetSchema"/>
                </input>
              </container>
            </form>
          </input>
          <container colcount="2" colspan="2" xpath="transitions">
            <static colspan="2" label="Results" type="separator"/>
            <input xpath="result/@label"/>
            <input xpath="result/@code"/>
            <static colspan="2" label="Complement" type="separator"/>
            <input colspan="2" xpath="remainder/@enabled"/>
            <container colcount="2" colspan="2" type="visibleGroup" visibleIf="[remainder/@enabled]">
              <input xpath="remainder/@label"/>
              <input xpath="remainder/@code"/>
            </container>
            <static colspan="2" type="help">The complement set is the intersection between the union of the inputs and the primary set.</static>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:extract-->
      <form name="extract" type="notebook">
        <enter>
          <set expr="wkfSourceActivity(@name, 1)!=''" xpath="/ignored/@hasMultipleSource"/>
          <if expr="![/ignored/@hasMultipleSource]">
            <set value="" xpath="@mainSet"/>
          </if>
          <if expr="[/ignored/@hasMultipleSource] AND @mainSet=''">
            <set expr="wkfSourceActivity(@name)" xpath="@mainSet"/>
          </if>
          <set expr="wkfTargetSchema(@name, Iif(@mainSet='', '', 'src'))" xpath="/ignored/@targetExtension"/>
          <set expr="wkfSchemaName(wkfSourceActivity(@name), wkfTransitionName(wkfSourceActivity(@name), @name))"
               xpath="/ignored/@extractSource"/>
          <refresh xpath="/workflow"/>
          <set value="0" xpath="/tmp/@acceptTempSchema"/>
          <set value="0" xpath="/tmp/@useTempSchema"/>

          <set value="" xpath="/ignored/@splitType"/>
          <if expr="SubString(@schema, 0, 5)!='temp:' or [@recipientLink]!=''">
            <set value="linkedData" xpath="/ignored/@splitType"/>
          </if>
          <if expr="NodeValue('extension/schema[@name=\''+ExtractRight(@schema,':')+'\']/element/@dataSource')!=''">
            <set value="extSharedData" xpath="/ignored/@splitType"/>
          </if>
          <if expr="[/ignored/@splitType]='' and [@recipientLink]=''">
            <set value="targetData" xpath="/ignored/@splitType"/>
            <if expr="SubString(@schema, 0, 5)='temp:'">
              <set expr="[/ignored/@extractSource]" xpath="@schema"/>
            </if>
          </if>
          <forEach xpath="transitions/extractOutput">
            <if expr="!@schemaOverride">
              <set expr="[../../@schema]" xpath="@schema"/>
              <set expr="[../../@recipientLink]" xpath="@recipientLink"/>
            </if>
            <if expr="@schemaOverride and SubString(@schema, 0, 5)='temp:' and [/ignored/@hasMultipleSource]==false">
              <set expr="[/ignored/@extractSource]" xpath="@schema"/>
            </if>
          </forEach>
          <if expr="@schema==''">
      <!-- force schema if not defined yet -->
            <set value="nms:recipient" xpath="@schema"/>
          </if>

          <set translatedExpr="'Add data...'" xpath="/ignored/@strAddData"/>
          <set translatedExpr="'Edit linked data...'" xpath="/ignored/@strEditLinkedData"/>

        </enter>

        <container img="nms:miniatures/mini-piechart.png" label="Subsets" xpath="transitions/extractOutput">

          <container style="down" toolbarAlign="horizontal" toolbarCaption="Subset computation parameters"
                     type="notebookList" xpath="." xpath-label="@label">
            <container img="nms:subset.png" ref="xtk:workflow:lib/tabs/filterTransitionPage"/>
          </container>

        </container>

        <container colcount="2" label="General" ref="xtk:workflow:lib/tabs/extractGene"/>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>

        <leave>
          <set expr="[transitions/remainder/@enabled]==1 AND [@alwaysExtractFromSource]==0"
               xpath="transitions/remainder/@enabled"/>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:offerCells-->
<!--
  Specific implementation for a offer propositions based on cells selection
  Uncomment code below to use it in your instance
-->
      <form name="offerCells" type="notebook">
        <enter>
          <set expr="wkfTargetSchema(@name)" xpath="/ignored/@targetExtension"/>
          <set expr="wkfSchemaName(wkfSourceActivity(@name), wkfTransitionName(wkfSourceActivity(@name), @name))"
               xpath="/ignored/@extractSource"/>
          <refresh xpath="/workflow"/>
          <set value="0" xpath="/tmp/@acceptTempSchema"/>
          <set value="0" xpath="/tmp/@useTempSchema"/>
          <set value="" xpath="/ignored/@splitType"/>
          <if expr="SubString(@schema, 0, 5)!='temp:' or [@recipientLink]!=''">
            <set value="linkedData" xpath="/ignored/@splitType"/>
          </if>
          <if expr="NodeValue('extension/schema[@name=\''+ExtractRight(@schema,':')+'\']/element/@dataSource')!=''">
            <set value="extSharedData" xpath="/ignored/@splitType"/>
          </if>
          <if expr="[/ignored/@splitType]='' and [@recipientLink]=''">
            <set value="targetData" xpath="/ignored/@splitType"/>
            <if expr="SubString(@schema, 0, 5)='temp:'">
              <set expr="[/ignored/@extractSource]" xpath="@schema"/>
            </if>
          </if>
          <forEach xpath="transitions/extractOutput">
            <if expr="!@schemaOverride">
              <set expr="[../../@schema]" xpath="@schema"/>
              <set expr="[../../@recipientLink]" xpath="@recipientLink"/>
            </if>
          </forEach>
          <if expr="@schema==''">
            <set value="nms:recipient" xpath="@schema"/>
          </if>
          <set value="proposition/offerSpace" xpath="select/node[1]/@alias"/>
          <set value="link" xpath="select/node[1]/@type"/>
          <set value="nms:offerSpace" xpath="select/node[1]/@dataType"/>
          <set value="nms:proposition" xpath="/ignored/offerCells/@schema"/>
          <set value="offerSpace" xpath="/ignored/offerCells/@xpath"/>
          <set expr="LabelOf('/ignored/offerCells/@xpath', '/ignored/offerCells/@schema')"
               xpath="select/node[1]/@label"/>
          <set value="proposition/@channel" xpath="select/node[2]/@alias"/>
          <set value="nms:offerSpace" xpath="/ignored/offerCells/@schema"/>
          <set value="@channel" xpath="/ignored/offerCells/@xpath"/>
          <set expr="LabelOf('/ignored/offerCells/@xpath', '/ignored/offerCells/@schema')"
               xpath="select/node[2]/@label"/>
          <set value="byte" xpath="select/node[2]/@type"/>
          <set value="nms:offerSpace:@channel" xpath="select/node[2]/@ref"/>
          <set value="proposition/@offerViewSchema" xpath="select/node[3]/@alias"/>
          <set value="nms:offerView" xpath="/ignored/offerCells/@schema"/>
          <set expr="SchemaLabel('/ignored/offerCells/@schema')" xpath="select/node[3]/@label"/>
          <set value="string" xpath="select/node[3]/@type"/>
          <set value="nms:offerView" xpath="select/node[3]/@value"/>
          <if expr="NodeValue('select/node[1]/@value')!=''">
            <set value="nms:offerSpace" xpath="/ignored/queryDef/@schema"/>
            <set value="get" xpath="/ignored/queryDef/@operation"/>
            <set value="[@env-id]" xpath="/ignored/queryDef/select/node[1]/@expr"/>
            <set expr="'@id='+NodeValue('select/node[1]/@value')" xpath="/ignored/queryDef/where/condition/@expr"/>
            <soapCall name="ExecuteQuery" service="xtk:queryDef">
              <param exprIn="[/ignored/queryDef]" type="DOMDocument"/>
              <param type="DOMDocument" xpathOut="/ignored/offerSpace"/>
            </soapCall>
          </if>
        </enter>

        <container img="nms:miniatures/mini-offerCells.png" label="Cells" xpath="transitions/extractOutput">
          <input editable="false" nolabel="true" ordered="true" prebuildSubForm="false"
                 toolbarAlign="horizontal" toolbarCaption="Subset computation parameters"
                 type="list" xpath="." xpathRefresh="../*" xpathToIgnore="filter/where,limiter/orderBy,limiter/groupBy"
                 zoom="true">
            <form name="cellDetail" type="notebook">
              <enter>
                <if expr="@schema=''">
                  <set expr="[../../@schema]" xpath="@schema"/>
                  <set expr="[../../@recipientLink]" xpath="@recipientLink"/>
                  <set value="false" xpath="@schemaOverride"/>
                </if>
                <copyElement xpathDst="select/node[1]" xpathSrc="../../select/node[1]"/>
                <copyElement xpathDst="select/node[2]" xpathSrc="../../select/node[2]"/>
                <copyElement xpathDst="select/node[3]" xpathSrc="../../select/node[3]"/>
                <set value="proposition/offer" xpath="select/node[4]/@alias"/>
                <set value="link" xpath="select/node[4]/@type"/>
                <set value="nms:offer" xpath="select/node[4]/@dataType"/>
                <set value="nms:proposition" xpath="/ignored/offerCells/@schema"/>
                <set value="offer" xpath="/ignored/offerCells/@xpath"/>
                <set expr="LabelOf('/ignored/offerCells/@xpath', '/ignored/offerCells/@schema')"
                     xpath="select/node[4]/@label"/>
              </enter>
              <container colcount="2" img="nms:subset.png" label="Selection">
                <input xpath="@label"/>
                <input xpath="@code"/>
                <container ref="xtk:workflow:lib/tabs/filterTransitionPage/splitSelection"/>
                <container colspan="2" type="visibleGroup" visibleIf="[/ignored/offerSpace/@env-id]!=''">
                  <container xpath="select/node[1]">
                    <input computeStringAlias="@valueLabel" label="Space" readOnly="true"
                           schema="nms:offerSpace" type="linkEdit" xpath="@value"/>
                  </container>
                  <container xpath="select/node[4]">
                    <input computeStringAlias="@valueLabel" label="Offer" notifyPathList="@_cs|@valueLabel"
                           schema="nms:offer" type="linkEdit" xpath="@value">
                      <sysFilter>
                        <condition expr="@status = 6"/>
                        <condition expr="[category/@env-id]=$long(/ignored/offerSpace/@env-id)"/>
                      </sysFilter>
                    </input>
                  </container>
                </container>
                <container colspan="2" type="visibleGroup" visibleIf="[/ignored/offerSpace/@env-id]=''">
                  <static label="Please enter a space in the activity's 'Main' tab."
                          type="warning"/>
                </container>
              </container>
              <container ref="xtk:workflow:lib/tabs/advancedExtractOutputPage"/>
            </form>
            <input editable="true" xpath="@label"/>
            <input editable="true" xpath="filter/@enabled"/>
            <input editable="false" expr="Iif([filter/@enabled], [filter/humanCond], '')"
                   label="Filter"/>
            <input editable="true" xpath="limiter/@enabled"/>
            <input editable="false" expr="Iif([limiter/@enabled], [limiter/humanCond], '')"
                   label="Limit"/>
            <input editable="true" xpath="@forExclusion"/>
            <input editable="false" xpath="@code"/>
          </input>
        </container>
        <container colcount="2" label="General">
          <input colspan="2" xpath="@label"/>
          <container colspan="2" type="visibleGroup" visibleIf="@mainSet!=''">
            <input type="ExclusionMainSetEdit" xpath="@mainSet"/>
          </container>
          <container colspan="2">
            <static label="Filtering settings" type="separator"/>
            <input checkedValue="linkedData" label="Use data from the target and additional data"
                   nolabel="false" type="radioButton" xpath="/ignored/@splitType"/>
            <input checkedValue="targetData" label="Use the additional data only"
                   nolabel="false" type="radioButton" xpath="/ignored/@splitType"/>
            <input applicableIf="HasPackage('nms:federatedDataAccess')" checkedValue="extSharedData"
                   label="Use external data" nolabel="false" type="radioButton" xpath="/ignored/@splitType"/>
            <container type="visibleGroup" visibleIf="[/ignored/@splitType]='linkedData'">
              <container ref="xtk:workflow:lib/tabs/schemaSelector"/>
            </container>
            <container type="visibleGroup" visibleIf="[/ignored/@splitType]='targetData'">
              <input label="Targeting dimension" readOnly="true" type="schemaEdit"
                     xpath="@schema"/>
            </container>
            <input expr="Iif([/ignored/@splitType]='targetData', [/ignored/@extractSource], NodeValue('@schema'))"
                   type="expr" xpath="@schema"/>
            <input expr="Iif([/ignored/@splitType]='targetData', '', NodeValue('@recipientLink'))"
                   type="expr" xpath="@recipientLink"/>
            <container applicableIf="HasPackage('nms:federatedDataAccess')" type="visibleGroup"
                       visibleIf="[/ignored/@splitType]='extSharedData' OR [/ignored/@splitType]='externalData'">
              <input label="Targeting dimension" type="targetSchema" xpath="@schema"
                     xpathLink="@recipientLink">
                <form entity-schema="xtk:schema" label="Please select a document"
                      name="entitySchema" namespace="xtk" nothingToSave="true">
                  <input monoSelection="true" notifyFolderKeyPath="" schema="xtk:schema"
                         type="linkListChoice" xpath=".">
                    <input alias="@_cs" expr="[.]"/>
                    <input xpath="[.]"/>
                    <input xpath="@namespace"/>
                    <input xpath="@name"/>
                    <orderBy>
                      <node expr="@label"/>
                    </orderBy>
                  </input>
                </form>
              </input>
              <input label="Filtering dimension" readOnly="true" type="targetSchemaLink"
                     xpath="@schema" xpathLink="@recipientLink"/>
              <input img="xtk:xtklinkn.png" labelExpr="Iif(NodeCount([extension])==0, [/ignored/@strAddData], [/ignored/@strEditLinkedData])"
                     nolabel="false" prebuildSubForm="false" type="subFormLink" xpath=".">
                <enter name="onClick">
                  <set expr="@schema" xpath="/tmp/selectCtrl/in/@schema"/>
                  <set value="1" xpath="/tmp/queryAdd/@dataTypeReadOnly"/>
                  <set value="1" xpath="/tmp/queryAdd/@reverseLink"/>
                  <set expr="[/ignored/@splitType]" xpath="/tmp/queryAdd/@dataType"/>
                </enter>
                <form label="Additional data" ref="xtk:workflow:lib/subforms/queryAdd"
                      type="wizard"/>
              </input>
            </container>
          </container>
          <container colcount="2" colspan="2" xpath="transitions">
            <static colspan="2" label="Results" type="separator"/>
            <input colspan="2" xpath="../@alwaysExtractFromSource"/>
            <input colspan="2" xpath="../@concatenateSegmentCode"/>
            <input colspan="2" xpath="done/@enabled"/>
      <!-- Force rebuild of temp schema and consequent update of activity's XML, for any changes on the 2 previous checkBox-->
            <input expr="wkfTargetSchema(Iif([../@concatenateSegmentCode] and [done/@enabled], NodeValue('../@name'), NodeValue('../@name')), Iif([../@mainSet]='', '', 'src'))"
                   type="expr" xpath="/ignored/@ignoredSchema"/>
            <container colcount="2" colspan="2" type="visibleGroup" visibleIf="[done/@enabled]">
              <input xpath="done/@label"/>
              <input xpath="done/@code"/>
            </container>
            <container colcount="2" colspan="2" type="visibleGroup" visibleIf="![../@alwaysExtractFromSource]">
              <input colspan="2" xpath="remainder/@enabled"/>
              <container colcount="2" colspan="2" type="visibleGroup" visibleIf="[remainder/@enabled]">
                <input xpath="remainder/@label"/>
                <input xpath="remainder/@code"/>
              </container>
              <static colspan="2" type="help">If this option is checked, a complementary subset will contain all remaining records.</static>
            </container>
            <static colspan="2">Select the space whose offers you want to use:</static>
            <container colspan="2" xpath="../select/node[1]">
              <input computeStringAlias="@valueLabel" label="Space" notifyPathList="@_cs|@valueLabel,@channel|../../select/node[2]/@value,@env-id|/ignored/offerSpace/@env-id"
                     schema="nms:offerSpace" type="linkEdit" xpath="@value">
                <sysFilter>
                  <condition expr="[env/@live]=true"/>
                </sysFilter>
              </input>
            </container>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <set expr="[transitions/remainder/@enabled]==1 AND [@alwaysExtractFromSource]==0"
               xpath="transitions/remainder/@enabled"/>
          <forEach xpath="transitions/extractOutput">
            <copyElement xpathDst="select/node[1]" xpathSrc="../../select/node[1]"/>
            <copyElement xpathDst="select/node[2]" xpathSrc="../../select/node[2]"/>
            <copyElement xpathDst="select/node[3]" xpathSrc="../../select/node[3]"/>
          </forEach>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:extractCells-->
      <form name="extractCells" type="notebook">
        <enter>
          <set expr="wkfTargetSchema(@name)" xpath="/ignored/@targetExtension"/>
          <set expr="wkfSchemaName(wkfSourceActivity(@name), wkfTransitionName(wkfSourceActivity(@name), @name))"
               xpath="/ignored/@extractSource"/>
          <refresh xpath="/workflow"/>
          <set value="0" xpath="/tmp/@acceptTempSchema"/>
          <set value="0" xpath="/tmp/@useTempSchema"/>
          <set value="" xpath="/ignored/@splitType"/>
          <if expr="SubString(@schema, 0, 5)!='temp:' or [@recipientLink]!=''">
            <set value="linkedData" xpath="/ignored/@splitType"/>
          </if>
          <if expr="NodeValue('extension/schema[@name=\''+ExtractRight(@schema,':')+'\']/element/@dataSource')!=''">
            <set value="extSharedData" xpath="/ignored/@splitType"/>
          </if>
          <if expr="[/ignored/@splitType]='' and [@recipientLink]=''">
            <set value="targetData" xpath="/ignored/@splitType"/>
            <if expr="SubString(@schema, 0, 5)='temp:'">
              <set expr="[/ignored/@extractSource]" xpath="@schema"/>
            </if>
          </if>
          <forEach xpath="transitions/extractOutput">
            <if expr="!@schemaOverride">
              <set expr="[../../@schema]" xpath="@schema"/>
              <set expr="[../../@recipientLink]" xpath="@recipientLink"/>
            </if>
          </forEach>
          <if expr="@schema==''">
    <!-- force schema if not defined yet -->
            <set value="nms:recipient" xpath="@schema"/>
          </if>
        </enter>

        <container img="nms:miniatures/mini-cells.png" label="Cells" xpath="transitions/extractOutput">
          <input editable="false" nolabel="true" ordered="true" prebuildSubForm="false"
                 toolbarAlign="horizontal" toolbarCaption="Subset computation parameters"
                 type="list" xpath="." xpathRefresh="../*" xpathToIgnore="filter/where,limiter/orderBy,limiter/groupBy"
                 zoom="true">
            <form name="cellDetail" type="notebook">
              <enter>
                <if expr="@schema=''">
                  <set expr="[../../@schema]" xpath="@schema"/>
                  <set expr="[../../@recipientLink]" xpath="@recipientLink"/>
                  <set value="false" xpath="@schemaOverride"/>
                </if>
              </enter>
      <!-- Sample for personnalization of the cells detail -->
      <!--
      <container img="nms:subset.png" label="Sélection">
        <input xpath="@label"/>
        <container ref="xtk:workflow:lib/tabs/filterTransitionPage/splitSelection"/>
      </container>
      <container img="nms:miniatures/mini-enrich.png" label="Données">
        <input xpath="@code"/>
        <container xpath="select/node[@alias='@numTest']">
          <input type="expr" xpath="@type" expr="'long'" alwaysActive="true"/>
          <input type="expr" xpath="@label" expr="'Priorité'" alwaysActive="true"/>
          <input label="Priorité" type="number" xpath="@value" xpathEditFromType="@type" minValue="0" maxValue="12"/>
        </container>
        <container xpath="select/node[@alias='@test']">
          <input type="expr" xpath="@type" expr="'string'"  alwaysActive="true"/>
          <input type="expr" xpath="@label" expr="'Identifiant'"  alwaysActive="true"/>
          <input label="Identifiant de la cellule" xpath="@value"/>
        </container>
        <container xpath="select/node[@alias='linkTest']">
          <input type="expr" xpath="@type" expr="'link'" alwaysActive="true"/>
          <input type="expr" xpath="@dataType" expr="'nms:offer'" alwaysActive="true"/>
          <input type="expr" xpath="@label" expr="'Offre'" alwaysActive="true"/>
          <input label="Offres" type="linkEdit" xpath="@value" schema="nms:offer"
                 computeStringAlias="@valueLabel" notifyPathList="@_cs|@valueLabel"/>
        </container>
      </container>
      <container ref="xtk:workflow:lib/tabs/advancedExtractOutputPage"/>
      -->
              <container ref="xtk:workflow:lib/tabs/filterTransitionPage"/>
              <container ref="xtk:workflow:lib/tabs/advancedExtractOutputPage"/>
            </form>
            <input editable="true" xpath="@label"/>
            <input editable="true" xpath="filter/@enabled"/>
            <input editable="false" expr="Iif([filter/@enabled], [filter/humanCond], '')"
                   label="Filter"/>
            <input editable="true" xpath="limiter/@enabled"/>
            <input editable="false" expr="Iif([limiter/@enabled], [limiter/humanCond], '')"
                   label="Limit"/>
            <input editable="true" xpath="@forExclusion"/>
            <input editable="false" xpath="@code"/>
          </input>
        </container>

        <container colcount="2" label="General" ref="xtk:workflow:lib/tabs/extractGene"/>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>

        <leave>
          <set expr="[transitions/remainder/@enabled]==1 AND [@alwaysExtractFromSource]==0"
               xpath="transitions/remainder/@enabled"/>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:dedup-->
      <form name="dedup" type="notebook">
        <enter>
          <set expr="Iif(@merge, wkfTargetSchema(@name), wkfTargetSchema(wkfSourceActivity(@name), wkfTransitionName(wkfSourceActivity(@name), @name), 1))"
               xpath="/tmp/selectCtrl/in/@schema"/>
          <set expr="@schema" xpath="/tmp/mergeCollection/@schema"/>
        </enter>
        <container colcount="2" img="nms:miniatures/mini-dedup.png">
          <input colspan="2" xpath="@label"/>
          <static colspan="2" label="Deduplication parameters" type="separator"/>
          <input colspan="2" img="nms:miniatures/mini-dedup.png" label="Edit configuration..."
                 nolabel="false" prebuildSubForm="false" type="DedupFormLink" xpath=".">
            <form label="Deduplication" name="queryWizard" nothingToSave="true" type="wizard">
              <enter>
                <if expr="@schema==''">
               <!-- force schema if not defined yet -->
                  <set value="nms:recipient" xpath="@schema"/>
                </if>
                <set expr="" xpath="/ignored/@display"/>
                <set value="-1" xpath="/ignored/dedup/@type"/>

                <if expr="count(groupExpr)==1 and [groupExpr[1]/@expr]=='@email'">
                  <set value="0" xpath="/ignored/dedup/@type"/>
                </if>
                <if expr="count(groupExpr)==1 and [groupExpr[1]/@expr]=='@mobilePhone'">
                  <set value="1" xpath="/ignored/dedup/@type"/>
                </if>
                <if expr="count(groupExpr)==1 and [groupExpr[1]/@expr]=='@phone'">
                  <set value="2" xpath="/ignored/dedup/@type"/>
                </if>
                <if expr="count(groupExpr)==1 and [groupExpr[1]/@expr]=='@fax'">
                  <set value="3" xpath="/ignored/dedup/@type"/>
                </if>
                <if expr="count(groupExpr)==6 and [groupExpr[1]/@expr]=='[postalAddress/@line1]' AND [groupExpr[2]/@expr]=='[postalAddress/@line6]' AND [groupExpr[3]/@expr]=='[postalAddress/@line2]' AND [groupExpr[4]/@expr]=='[postalAddress/@line3]' AND [groupExpr[5]/@expr]=='[postalAddress/@line4]' AND [groupExpr[6]/@expr]=='[postalAddress/@line5]'">
                  <set value="4" xpath="/ignored/dedup/@type"/>
                </if>
                <if expr="[/ignored/dedup/@type]==-1">
                  <set value="5" xpath="/ignored/dedup/@type"/>
                </if>
                <set value="1" xpath="/tmp/@acceptTempSchema"/>
                <set expr="Iif(Substring(@schema, 0, 4)=='temp', 1, 0) AND @recipientLink=''"
                     xpath="/tmp/@useTempSchema"/>
                <set expr="Substring(@schema, 5)" xpath="/tmp/@srcDataSet"/>
              </enter>

              <container desc="Please select the targeting type for the target element."
                         name="typePage" title="Targeting dimension">
                <container ref="xtk:workflow:lib/tabs/schemaSelector"/>
                <container type="visibleGroup" visibleIf="@schema=='nms:recipient'">
                  <input checkedValue="0" label="Email" type="RadioButton" xpath="/ignored/dedup/@type"/>
                  <input checkedValue="1" label="SMS" type="RadioButton" xpath="/ignored/dedup/@type"/>
                  <input checkedValue="2" label="Phone" type="RadioButton" xpath="/ignored/dedup/@type"/>
                  <input checkedValue="3" label="Fax" type="RadioButton" xpath="/ignored/dedup/@type"/>
                  <input checkedValue="4" label="Postal address" type="RadioButton"
                         xpath="/ignored/dedup/@type"/>
                  <input checkedValue="5" label="Other" type="RadioButton" xpath="/ignored/dedup/@type"/>
                </container>

                <leave>
                  <if expr="@schema='nms:recipient'">
                    <if expr="[/ignored/dedup/@type]!=5">
                      <reset xpath="groupExpr[*]"/>
                      <if expr="[/ignored/dedup/@type]==0">
                        <set value="@email" xpath="groupExpr[1]/@expr"/>
                        <set translatedExpr="'Email'" xpath="groupExpr[1]/@label"/>
                      </if>
                      <if expr="[/ignored/dedup/@type]==1">
                        <set value="@mobilePhone" xpath="groupExpr[1]/@expr"/>
                        <set translatedExpr="'Mobile'" xpath="groupExpr[1]/@label"/>
                      </if>
                      <if expr="[/ignored/dedup/@type]==2">
                        <set value="@phone" xpath="groupExpr[1]/@expr"/>
                        <set translatedExpr="'Telephone'" xpath="groupExpr[1]/@label"/>
                      </if>
                      <if expr="[/ignored/dedup/@type]==3">
                        <set value="@fax" xpath="groupExpr[1]/@expr"/>
                        <set translatedExpr="'Fax'" xpath="groupExpr[1]/@label"/>
                      </if>
                      <if expr="[/ignored/dedup/@type]==4">
                        <set value="[postalAddress/@line1]" xpath="groupExpr[1]/@expr"/>
                        <set translatedExpr="'Postal address (Last name, first name)'"
                             xpath="groupExpr[1]/@label"/>
                        <set value="[postalAddress/@line6]" xpath="groupExpr[2]/@expr"/>
                        <set translatedExpr="'Postal address (Zip code/Postcode, city)'"
                             xpath="groupExpr[2]/@label"/>
                        <set value="[postalAddress/@line2]" xpath="groupExpr[3]/@expr"/>
                        <set translatedExpr="'Postal address (line 2)'" xpath="groupExpr[3]/@label"/>
                        <set value="[postalAddress/@line3]" xpath="groupExpr[4]/@expr"/>
                        <set translatedExpr="'Postal address (line 3)'" xpath="groupExpr[4]/@label"/>
                        <set value="[postalAddress/@line4]" xpath="groupExpr[5]/@expr"/>
                        <set translatedExpr="'Postal address (Street)'" xpath="groupExpr[5]/@label"/>
                        <set value="[postalAddress/@line5]" xpath="groupExpr[6]/@expr"/>
                        <set translatedExpr="'Postal address (line 5)'" xpath="groupExpr[6]/@label"/>
                      </if>
                    </if>
                  </if>

                </leave>
              </container>

              <container desc="Please specify the list of fields or expressions which are used to find duplicates in case of identical values."
                         name="group" title="Identification of duplicates" visibleIf="[/ignored/dedup/@type]=5 or @schema!='nms:recipient'">
                <input nolabel="true" toolbarCaption="List of fields" type="list"
                       xpath="groupExpr" xpathChoiceTarget="@expr">
                  <input hideCalculated="false" hideMappedAsXml="true" label="Expression"
                         type="pathedit" xpath="@expr" xpathLabel="@label" xpathSchema="../@schema"/>
                  <input xpath="@label"/>
                </input>
              </container>
              <container desc="Please select the method used to identify the records to keep."
                         name="group" title="Deduplication method">
                <input label="Doubles to keep" minValue="1" xpath="@number"/>
                <input xpath="@type"/>
                <container type="visibleGroup" visibleIf="@type='choice'">
                  <static label="Randomly select which duplicates to keep." type="help"/>
                </container>
                <container type="visibleGroup" visibleIf="@type='order'">
                  <static label="The record priority order is based on the following, for one or more fields (or expressions)."
                          type="help"/>
                </container>
                <container type="visibleGroup" visibleIf="@type='noEmpty'">
                  <static label="Records for which the expression is not empty have priority."
                          type="help"/>
                </container>
                <container type="visibleGroup" visibleIf="@type='expr'">
                  <static label="Keep records for which the specified expression has the smallest or largest value."
                          type="help"/>
                </container>
                <container type="visibleGroup" visibleIf="@type='order'">
                  <container style="down" toolbarAlign="horizontal" toolbarCaption="List of values"
                             type="notebookList" xpath="orderedValue" xpath-label="@label">
                    <container>
                      <input hideCalculated="true" hideMappedAsXml="false" label="Expression"
                             nolabel="false" type="pathedit" xpath="@expr" xpathLabel="@label"
                             xpathSchema="../@schema"/>
                      <input label=" " nolabel="false" type="EnumEditList" xpath="value"
                             xpathSchema="../@schema" xpathType="@expr">
                        <input xpath="@value"/>
                      </input>
                      <static label="Other values" type="separator"/>
                      <input checkedValue="0" label="Indifferent" type="radioButton"
                             xpath="@orderType"/>
                      <input checkedValue="1" label="Keep the smallest value" type="radioButton"
                             xpath="@orderType"/>
                      <input checkedValue="2" label="Keep the largest value" type="radioButton"
                             xpath="@orderType"/>
                    </container>
                  </container>
                </container>
                <container type="visibleGroup" visibleIf="@type='expr' or @type='noEmpty'">
                  <input hideMappedAsXml="true" label="Expression" nolabel="false"
                         type="pathedit" xpath="@expr" xpathSchema="@schema"/>
                </container>

                <container type="visibleGroup" visibleIf="@type='expr'">
                  <input checkedValue="0" label="Keep the records with the smallest value"
                         type="radioButton" xpath="@compType"/>
                  <input checkedValue="1" label="Keep the records with the largest value"
                         type="radioButton" xpath="@compType"/>
                </container>
                <input align="right" label="Advanced parameters..." nolabel="true"
                       prebuildSubForm="false" type="subFormLink" xpath=".">
                  <form label="Deduplication parameter">
                    <input xpath="@noAutoPkFilter"/>
                    <container enabledIf="[@number]==1" type="enabledGroup">
                      <static label="When keeping a single record, you can create a record merging data from the selected duplicates."
                              type="help"/>
                      <input xpath="@merge"/>
                      <input xpath="@multipleMergeCriteria"/>
                    </container>
                    <container enabledIf="[@number]!=1" type="enabledGroup">
                      <static label="If necessary, you can keep the sequence of records selected by the deduplication process."
                              type="help"/>
                      <input xpath="@keepRank"/>
                    </container>
                  </form>
                </input>
              </container>
              <leave>
            <!-- to build display -->
                <set value="1" xpath="/ignored/@display"/>
                <set expr="Iif(@merge, wkfTargetSchema(@name), wkfTargetSchema(wkfSourceActivity(@name), wkfTransitionName(wkfSourceActivity(@name), @name), 1))"
                     xpath="/tmp/selectCtrl/in/@schema"/>
                <set expr="@schema" xpath="/tmp/mergeCollection/@schema"/>
              </leave>
            </form>
          </input>
          <input colspan="2" fontBold="true" label=" " lineCount="5" noBorder="true"
                 readOnly="true" type="edit" xpath="display"/>
          <container colcount="2" colspan="2" xpath="transitions">
            <static colspan="2" label="Results" type="separator"/>
            <input xpath="result/@label"/>
            <input xpath="result/@code"/>
            <static colspan="2" label="Complement" type="separator"/>
            <input colspan="2" xpath="remainder/@enabled"/>
            <container colcount="2" colspan="2" type="visibleGroup" visibleIf="[remainder/@enabled]">
              <input xpath="remainder/@label"/>
              <input xpath="remainder/@code"/>
            </container>
            <static colspan="2" type="help">If this option is checked, all duplicates are saved in a second set.</static>
          </container>
        </container>
        <container colcount="2" img="nms:miniatures/mini-enrich.png" label="Merge"
                   visibleIf="@number=1 AND @merge=1 AND @multipleMergeCriteria=0">
          <static colspan="2" label="Select merged data" type="separator"/>
          <static colspan="2" type="Help">Select the data you wish to keep during the merge process below. The 'Taken into account' expression linked to each column allows you to keep the record value only if the expression is true.</static>
          <container colspan="2" label="Data" name="data">
            <container hideUnboundPath="false" name="selectCtrl" showCollections="true"
                       type="querySelectContainer" xpath=".">
        <!-- Attention querySelectContainer container enrich this form defintion.
                 Therefore container and hierarchy shouldn't be changes -->
              <container name="vpaned" type="vpaned">
                <container name="schema">
                  <static fontBold="true" label="Available fields:"/>
                  <container colcount="2">
                    <static img="xtk:filter.png" type="image"/>
                    <input catchReturnKey="true" label="Find" type="edit" xpath="/tmp/selectCtrl/itn/@search"/>
                  </container>
                  <input checkDuplicates="false" hideMappedAsXml="true" name="schemaView"
                         type="SchemaView" useUnboundPath="true" xpath="@schema"
                         xpathHelp="/tmp/selectCtrl/itn/@help" xpathIndex="/tmp/selectCtrl/itn/@current"
                         xpathSearchPath="/tmp/selectCtrl/itn/@search" xpathSelect="select/node/@expr"
                         xpathStartPath="/tmp/selectCtrl/in/@startPath"/>
                </container>
                <container name="output" xpathsToLoad="output*">
                  <static fontBold="true" label="Output columns:"/>
                  <input alwaysActive="true" expr="Iif([/tmp/outputColumn/itn/@current]=='' OR NodeValue([/tmp/outputColumn/itn/@current] + '/../@expr')=='', '', '/'+ UnExpandXPath(NodeValue([/tmp/outputColumn/itn/@current] + '/../@expr')))"
                         type="expr" xpath="/tmp/outputColumn/in/@startPath"/>
                  <input name="columnList" nolabel="true" prebuildSubForm="false"
                         toolbarAlign="vertical" type="columnList" xpath="select/node"
                         xpathCurrentLookupPath="/lookupPath/select" xpathGroupBy="groupBy/node"
                         xpathGroupOption="/tmp/selectCtrl/out/@group" xpathHasMemoData="/tmp/selectCtrl/itn/@hasMemoData"
                         xpathHaving="having/condition" xpathHelp="/tmp/selectCtrl/itn/@help"
                         xpathSchema="@schema" xpathSelection="/tmp/outputColumn/itn/@current"
                         zoom="false">
                    <input colSize="20" xpath="@label"/>
                    <input colSize="35" type="pathedit" useUnboundPath="true" xpath="@expr"
                           xpathChoiceType="/tmp/selectCtrl/in/@choiceType" xpathSchema="../../@schema"
                           xpathStartPath="/tmp/outputColumn/in/@startPath"/>
                    <input colSize="30" xpath="@alias"/>
                    <input colSize="45" label="Enabled if" type="pathedit" useUnboundPath="true"
                           xpath="@enabledIf" xpathChoiceType="/tmp/selectCtrl/in/@choiceType"
                           xpathSchema="../../@schema" xpathStartPath="/tmp/outputColumn/in/@startPath"/>

              <!-- Form description of column -->
                    <form label="Column definition" name="colDetail">
                      <input xpath="@label"/>
                      <container name="extraFields"/>
                <!-- empty container in which edit controls may be
                                                 added by the top level querySelectContainer -->
                      <input noTransaction="true" type="expredit" xpath="@expr" xpathSchema="../../@schema"/>
                <!-- Expression editor description -->
                      <container type="visibleGroup" visibleIf="[/tmp/selectCtrl/itn/@advancedMode]">
                        <container colcount="2" cols-width="100,1">
                          <container>
                            <static fontBold="true" label="Available fields:"/>
                            <container colcount="2">
                              <static img="xtk:filter.png" type="image"/>
                              <input catchReturnKey="true" label="Find" type="edit"
                                     xpath="/tmp/selectCtrl/itn/@search"/>
                            </container>
                            <input type="schemaview" xpath="@schema" xpathExpr="@expr"
                                   xpathHelp="/tmp/selectCtrl/itn/@help" xpathSearchPath="/tmp/selectCtrl/itn/@search"
                                   xpathStartPath="/tmp/selectCtrl/in/@startPath"/>
                          </container>
                          <input type="functionview" xpathExpr="@expr" xpathHelp="/tmp/selectCtrl/itn/@help"/>
                        </container>
                        <input type="help" xpath="/tmp/selectCtrl/itn/@help"/>
                      </container>
                      <input label="Advanced mode" nolabel="true" type="checkbox"
                             xpath="/tmp/selectCtrl/itn/@advancedMode"/>
                    </form>
                  </input>
                  <input xpath="@distinct"/>
                  <input xpath="@keepAllExtraData"/>
                </container>
              </container>
              <input type="help" xpath="/tmp/selectCtrl/itn/@help"/>
            </container>
          </container>
        </container>
        <container img="nms:miniatures/mini-enrich.png" label="Merge" visibleIf="@number=1 AND @merge=1 AND @multipleMergeCriteria=1">
          <static type="Help">Select the data you wish to keep during the merge process below. The 'Taken into account' expression linked to each column allows you to keep the record value only if the expression is true.</static>
          <input addChildButton="false" editable="false" name="columnList" nolabel="true"
                 ordered="false" prebuildSubForm="false" toolbarAlign="horizontal"
                 toolbarCaption="Select merged data" type="columnList" useTreeView="true"
                 xpath="select/node" xpathSchema="@schema" zoom="true" zoomOnAdd="true">
            <input colSize="20" editable="true" xpath="@label"/>
            <input colSize="35" type="pathedit" useUnboundPath="true" xpath="@expr"
                   xpathChoiceType="/tmp/selectCtrl/in/@choiceType" xpathSchema="/tmp/mergeCollection/@schema"
                   xpathStartPath="/tmp/outputColumn/in/@startPath"/>
            <input colSize="30" xpath="@alias"/>
            <input colSize="45" expr="Iif(NodeName([..])=='node', @enabledIf, NodeValue('../../conditionLink[@alias=\'' + @alias + '\']/where/@displayFilter'))"
                   label="Enabled if" type="pathedit" useUnboundPath="true" xpathChoiceType="/tmp/selectCtrl/in/@choiceType"
                   xpathSchema="/tmp/mergeCollection/@schema" xpathStartPath="/tmp/outputColumn/in/@startPath"/>
            <form label="Select data to be merged" type="wizard">
              <enter>
                <reset xpath="/tmp/mergeCollection"/>
                <set expr="Iif(NodeName([..])='node', 1, 0)" xpath="/tmp/mergeCollection/@onlyLast"/>
                <set expr="Iif(NodeName([..])='node', '../', '')" xpath="/tmp/mergeCollection/@startNodePath"/>
                <set expr="NodeValue([/tmp/mergeCollection/@startNodePath]+'../../@schema')"
                     xpath="/tmp/mergeCollection/@schema"/>
                <if expr="@expr=='' and [/tmp/mergeCollection/@onlyLast]=0">
                  <set value="duplicates" xpath="@expr"/>
                </if>
                <set expr="NodeValue([/tmp/mergeCollection/@startNodePath]+'@expr')"
                     xpath="/tmp/mergeCollection/node/@expr"/>
                <if expr="NodeValue([/tmp/mergeCollection/@startNodePath]+'@alias')!=''">
                  <set expr="NodeValue([/tmp/mergeCollection/@startNodePath]+'@alias')"
                       xpath="/tmp/mergeCollection/@oldAlias"/>
                  <set expr="NodeValue([/tmp/mergeCollection/@startNodePath]+'@label')"
                       xpath="/tmp/mergeCollection/node/@label"/>
                  <set expr="NodeValue([/tmp/mergeCollection/@startNodePath]+'@alias')"
                       xpath="/tmp/mergeCollection/node/@alias"/>
                  <set expr="NodeValue([/tmp/mergeCollection/@startNodePath]+'@expr')"
                       xpath="/tmp/mergeCollection/node/@expr"/>
                  <set expr="GetLinkSchema([/tmp/mergeCollection/@schema], [/tmp/mergeCollection/node/@expr])"
                       xpath="/tmp/mergeCollection/@collectionSchema"/>
                  <copyElement exprSrc="[/tmp/mergeCollection/@startNodePath]+'node'"
                               list="true" xpathDst="/tmp/mergeCollection/node"/>
                  <copyElement exprSrc="[/tmp/mergeCollection/@startNodePath]+'../../conditionLink[@alias=\'' + [/tmp/mergeCollection/@oldAlias] + '\']'"
                               xpathDst="/tmp/mergeCollection/conditionLink"/>
                </if>
                <set expr="Iif([/tmp/mergeCollection/node/@expr]='duplicates', false, true)"
                     xpath="/tmp/mergeCollection/@useOtherCollection"/>
              </enter>
              <container desc="Indicate the identifier of the group of fields to be merged"
                         title="Identifier and label" xpath="/tmp/mergeCollection/node">
                <input label="Identifier" required="true" type="computeNameEdit"
                       xpath="@alias"/>
                <input label="Label" xpath="@label"/>
                <input label="Specify a collection (expert mode)" type="checkBox"
                       xpath="/tmp/mergeCollection/@useOtherCollection"/>
                <container type="visibleGroup" visibleIf="[/tmp/mergeCollection/@useOtherCollection]">
                  <input dblClickAction="wizNext" expandXPath="true" type="schemaView"
                         useUnboundPath="true" xpath="/tmp/mergeCollection/@schema"
                         xpathExpr="@expr" xpathFilter="462" xpathHelp="/tmp/@help"
                         xpathSearchPath="/tmp/@search"/>
                  <input type="help" xpath="/tmp/@help"/>
                </container>
                <leave>
                  <check expr="@alias!=''">
                    <error>Please specify an identifier for the storage of additional data.</error>
                  </check>
                  <if expr="[/tmp/mergeCollection/@useOtherCollection]=false">
                    <set value="duplicates" xpath="/tmp/mergeCollection/node/@expr"/>
                  </if>
                  <set expr="GetLinkSchema([/tmp/mergeCollection/@schema], [/tmp/mergeCollection/node/@expr])"
                       xpath="/tmp/mergeCollection/@collectionSchema"/>
                </leave>
              </container>
              <container desc="Indicate the conditions that enable you to select the records to be taken into account"
                         title="Filter" xpath="/tmp/mergeCollection">
                <input noSaveFilter="true" nolabel="true" toolbarAlign="horizontal"
                       toolbarCaption="Enabling conditions" type="conditionList"
                       xpath="conditionLink/where" xpathCurrentLookupPath="/lookupPath/where"
                       xpathHelp="conditionLink/@humanCond" xpathSchema="@collectionSchema">
                  <input colSize="15" label=" " xpath="/@bool-operator"/>
                  <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                  <input colSize="15" label="Operator" xpath="/@operator"/>
                  <input colSize="30" label="Value" xpath="/@rightExpr"/>
                </input>
              </container>
              <container desc="Indicate the sequence to be applied to records taken into account"
                         title="Sort" xpath="/tmp/mergeCollection">
                <input editable="false" noZoomOnAdd="true" nolabel="true" ordered="true"
                       type="columnList" xpath="conditionLink/orderBy/node" xpathSchema="/tmp/mergeCollection/@collectionSchema"
                       zoom="false">
                  <input colSize="20" label="Label" xpath="@label"/>
                  <input choiceType="sortAggregate" colSize="35" editable="true"
                         label="Expression" type="pathedit" xpath="@expr" xpathLabel="@label"
                         xpathSchema="/tmp/mergeCollection/@collectionSchema"/>
                  <input colSize="15" editable="true" label="Descending" type="checkbox"
                         xpath="@sortDesc"/>
                </input>
              </container>
              <container desc="Select the fields you want to keep" title="Fields to be kept"
                         xpath="/tmp/mergeCollection/node">
                <container hideUnboundPath="false" name="selectCtrl" showCollections="true"
                           type="querySelectContainer" xpath=".">
            <!-- Attention querySelectContainer container enrich this form defintion.
                 Therefore container and hierarchy shouldn't be changes -->
                  <container name="vpaned" type="vpaned">
                    <container name="schema">
                      <static fontBold="true" label="Available fields:"/>
                      <container colcount="2">
                        <static img="xtk:filter.png" type="image"/>
                        <input catchReturnKey="true" label="Find" type="edit" xpath="/tmp/selectCtrl/itn/@search"/>
                      </container>
                      <input checkDuplicates="false" hideMappedAsXml="true" name="schemaView"
                             type="SchemaView" useUnboundPath="true" xpath="/tmp/mergeCollection/@collectionSchema"
                             xpathHelp="/tmp/selectCtrl/itn/@help" xpathIndex="/tmp/selectCtrl/itn/@current"
                             xpathSearchPath="/tmp/selectCtrl/itn/@search" xpathSelect="node/@expr"
                             xpathStartPath="/tmp/selectCtrl/in/@startPath"/>
                    </container>
                    <container name="output" xpathsToLoad="output*">
                      <static fontBold="true" label="Output columns:"/>
                      <input alwaysActive="true" expr="Iif([/tmp/outputColumn/itn/@current]=='' OR NodeValue([/tmp/outputColumn/itn/@current] + '/../@expr')=='', '', '/'+ UnExpandXPath(NodeValue([/tmp/outputColumn/itn/@current] + '/../@expr')))"
                             type="expr" xpath="/tmp/outputColumn/in/@startPath"/>
                      <input name="columnList" nolabel="true" prebuildSubForm="false"
                             toolbarAlign="vertical" type="columnList" xpath="node"
                             xpathCurrentLookupPath="/lookupPath/select" xpathGroupBy="groupBy/node"
                             xpathGroupOption="/tmp/selectCtrl/out/@group" xpathHasMemoData="/tmp/selectCtrl/itn/@hasMemoData"
                             xpathHaving="having/condition" xpathHelp="/tmp/selectCtrl/itn/@help"
                             xpathSchema="/tmp/mergeCollection/@collectionSchema"
                             xpathSelection="/tmp/outputColumn/itn/@current" zoom="false">
                        <input colSize="20" label="Label" xpath="@label"/>
                        <input colSize="35" label="Expression" type="pathedit" useUnboundPath="true"
                               xpath="@expr" xpathChoiceType="/tmp/selectCtrl/in/@choiceType"
                               xpathLabel="@label" xpathSchema="/tmp/mergeCollection/@collectionSchema"/>
                        <input colSize="30" label="Alias" xpath="@alias"/>
                        <input colSize="45" label="Enabled if" type="pathedit" useUnboundPath="true"
                               xpath="@enabledIf" xpathChoiceType="/tmp/selectCtrl/in/@choiceType"
                               xpathSchema="/tmp/mergeCollection/@collectionSchema"/>

                  <!-- Form description of column -->
                        <form label="Column definition" name="colDetail">
                          <input xpath="@label"/>
                          <container name="extraFields"/>
                    <!-- empty container in which edit controls may be
                                                 added by the top level querySelectContainer -->
                          <input noTransaction="true" type="expredit" xpath="@expr"
                                 xpathSchema="/tmp/mergeCollection/@collectionSchema"/>
                    <!-- Expression editor description -->
                          <container type="visibleGroup" visibleIf="[/tmp/selectCtrl/itn/@advancedMode]">
                            <container colcount="2" cols-width="100,1">
                              <container>
                                <static fontBold="true" label="Available fields:"/>
                                <container colcount="2">
                                  <static img="xtk:filter.png" type="image"/>
                                  <input catchReturnKey="true" label="Find" type="edit"
                                         xpath="/tmp/selectCtrl/itn/@search"/>
                                </container>
                                <input type="schemaview" xpath="/tmp/mergeCollection/@collectionSchema"
                                       xpathExpr="@expr" xpathHelp="/tmp/selectCtrl/itn/@help"
                                       xpathSearchPath="/tmp/selectCtrl/itn/@search"
                                       xpathStartPath="/tmp/selectCtrl/in/@startPath"/>
                              </container>
                              <input type="functionview" xpathExpr="@expr" xpathHelp="/tmp/selectCtrl/itn/@help"/>
                            </container>
                            <input type="help" xpath="/tmp/selectCtrl/itn/@help"/>
                          </container>
                          <input label="Advanced mode" nolabel="true" type="checkbox"
                                 xpath="/tmp/selectCtrl/itn/@advancedMode"/>
                        </form>
                      </input>
                    </container>
                  </container>
                  <input type="help" xpath="/tmp/selectCtrl/itn/@help"/>
                </container>
              </container>
              <leave>
                <if expr="[/tmp/mergeCollection/@oldAlias]!=''">
                  <reset expr="[/tmp/mergeCollection/@startNodePath]+'../../conditionLink[@alias=\'' + [/tmp/mergeCollection/@oldAlias] + '\']'"/>
                  <reset expr="[/tmp/mergeCollection/@startNodePath]+'node[@alias=\'' + [/tmp/mergeCollection/@oldAlias] + '\']'"/>
                </if>
                <set expr="[/tmp/mergeCollection/node/@alias]" xpath="/tmp/mergeCollection/conditionLink/@alias"/>
                <set expr="[/tmp/mergeCollection/node/@expr]" xpath="/tmp/mergeCollection/conditionLink/@xpath"/>
                <set value="1" xpath="/tmp/mergeCollection/conditionLink/@lineCount"/>
                <set value="1" xpath="/tmp/mergeCollection/conditionLink/@merge"/>
                <set value="0" xpath="/tmp/mergeCollection/conditionLink/@singleRow"/>
                <set value="0" xpath="/tmp/mergeCollection/conditionLink/@groupBy"/>
                <copyElement exprDst="[/tmp/mergeCollection/@startNodePath]+'../../conditionLink[@alias=\'' + [/tmp/mergeCollection/node/@alias] + '\']'"
                             xpathSrc="/tmp/mergeCollection/conditionLink"/>
                <copyElement exprDst="[/tmp/mergeCollection/@startNodePath]+'.'"
                             xpathSrc="/tmp/mergeCollection/node"/>
              </leave>
            </form>
          </input>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <if expr="@number&gt;1">
            <set value="false" xpath="@merge"/>
          </if>
          <if expr="@number&lt;=1">
            <set value="false" xpath="@keepRank"/>
          </if>
          <if expr="!@merge">
            <reset xpath="select"/>
          </if>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:saveGroup-->
      <form name="saveGroup" type="notebook">
        <enter>
          <set expr="Iif([savedGroup/@computeName]==false, 0, Iif([savedGroup/@computeFolder]==false, 1, 2))"
               xpath="/tmp/@computeMode"/>
          <if expr="HasPackage('nms:federatedDataAccess')">
            <set expr="Iif([savedGroup/@dataSourceTarget] == 4, 0, [savedGroup/@dataSourceTarget])"
                 xpath="/tmp/@dataSourceTarget"/>
            <set expr="[savedGroup/@dataSourceTarget] == 4" xpath="/tmp/@shareList"/>
          </if>
        </enter>
        <container img="nms:miniatures/mini-group.png">
          <input xpath="@label"/>
          <static label="Select list" type="separator"/>
          <input checkedValue="0" label="Specified explicitly" type="RadioButton"
                 xpath="/tmp/@computeMode"/>
          <input checkedValue="1" label="Create the list if necessary (Computed name)"
                 type="RadioButton" xpath="/tmp/@computeMode"/>
          <input checkedValue="2" label="Create the list if necessary (Computed Folder and Name)"
                 type="RadioButton" xpath="/tmp/@computeMode"/>
          <input expr="[/tmp/@computeMode]&gt;0" type="expr" xpath="savedGroup/@computeName"/>
          <input expr="[/tmp/@computeMode]=2" type="expr" xpath="savedGroup/@computeFolder"/>
          <container type="visibleGroup" visibleIf="[savedGroup/@computeName]">
            <container type="visibleGroup" visibleIf="![savedGroup/@computeFolder]">
              <input img="nms:fldrcpgrp.png" label="In the folder" xpath="savedGroup/folder">
                <sysFilter>
                  <condition boolOperator="OR" expr="@model = 'nmsGroup'"/>
                  <condition enabledIf="HasPackage('crm:lead')" expr="@model = 'crmListImport'"/>
                </sysFilter>
              </input>
            </container>
            <container type="visibleGroup" visibleIf="[savedGroup/@computeFolder]">
              <input label="Folder (computed)" menuId="workflowMenuBuilder" type="scriptEdit"
                     xpath="savedGroup/folderScript"/>
            </container>
            <input label="Label (computed)" menuId="workflowMenuBuilder" type="scriptEdit"
                   xpath="savedGroup/script"/>
          </container>
          <container type="visibleGroup" visibleIf="![savedGroup/@computeName]">
            <container type="visibleGroup" visibleIf="[savedGroup/@dedicatedTable]">
              <input createMode="none" notifyPathList="@label|../../transitions/result/@label"
                     xpath="savedGroup/group">
                <sysFilter>
                  <condition expr="@type &gt; 0"/>
                </sysFilter>
              </input>
            </container>
            <container type="visibleGroup" visibleIf="![savedGroup/@dedicatedTable]">
              <input notifyPathList="@label|../../transitions/result/@label" xpath="savedGroup/group">
                <sysFilter>
                  <condition expr="@type = 0"/>
                </sysFilter>
              </input>
            </container>
          </container>
    <!-- extAccount for data source target-->
          <container applicableIf="HasPackage('nms:federatedDataAccess')" type="visibleGroup"
                     visibleIf="[savedGroup/@dedicatedTable]" xpath="savedGroup">
            <static label="Database used for storing the list table" type="separator"/>
            <input applicableIf="HasPackage('xxl:fullfdaCommon')==false" checkedValue="0"
                   label="Adobe Campaign database" type="RadioButton" xpath="/tmp/@dataSourceTarget"/>
            <input checkedValue="1" label="Database of the targeting dimension (recommended)"
                   type="RadioButton" xpath="/tmp/@dataSourceTarget"/>
            <input checkedValue="2" label="External database" type="RadioButton"
                   xpath="/tmp/@dataSourceTarget"/>
            <container type="visibleGroup" visibleIf="[/tmp/@dataSourceTarget] == 0">
              <input applicableIf="HasPackage('nms:acsProvisioning')" label="Share with ACS"
                     type="checkBox" xpath="/tmp/@shareList"/>
            </container>

            <container type="visibleGroup" visibleIf="[/tmp/@dataSourceTarget]==2">
              <input img="nms:miniatures/mini-dbImport.png" xpath="dataSource">
          <!-- only external base -->
                <sysFilter>
                  <condition expr="@type = 7"/>
                </sysFilter>
              </input>
            </container>
          </container>

          <static label="Save type" type="separator"/>
          <container type="visibleGroup" visibleIf="[/tmp/@dataSourceTarget] != 0 or [/tmp/@shareList] == false">
            <input xpath="savedGroup/@dedicatedTable"/>
          </container>
          <input xpath="savedGroup/@recycle"/>
          <container xpath="transitions/result">
            <static label="Transition" type="separator"/>
            <input label="Generate an outbound transition" xpath="@enabled"/>
            <container type="visibleGroup" visibleIf="@enabled">
              <input xpath="@label"/>
            </container>
          </container>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <if expr="HasPackage('nms:federatedDataAccess')">
            <set expr="Iif([/tmp/@dataSourceTarget] == 0 and [/tmp/@shareList], 4, [/tmp/@dataSourceTarget])"
                 xpath="savedGroup/@dataSourceTarget"/>
          </if>
    <!-- must be done AFTER dataSourceTarget is updated -->
          <if expr="[/tmp/@dataSourceTarget] == 0 and [/tmp/@shareList]">
            <set expr="1" xpath="savedGroup/@dedicatedTable"/>
          </if>
          <if expr="HasPackage('nms:federatedDataAccess')">
            <set expr="Iif([savedGroup/@dataSourceTarget]==2, [savedGroup/@dataSource-id], 0)"
                 xpath="savedGroup/@dataSource-id"/>
          </if>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:readGroup-->
      <form name="readGroup" type="notebook">
        <enter>
          <set expr="Iif([readGroup/@computeName]==false, 0, Iif([readGroup/@computeFolder]==false, 1, 2))"
               xpath="/tmp/@computeMode"/>
          <set expr="'temp:group:'+[readGroup/@group-id]" xpath="/ignored/@querySchemaExec"/>
        </enter>
        <container img="nms:miniatures/mini-prefill.png">
          <input xpath="@label"/>
          <input expr="'temp:group:'+[readGroup/@group-id]" type="expr" xpath="/ignored/@querySchemaExec"/>
          <static label="Select list to use" type="separator"/>
          <input checkedValue="0" label="Specified explicitly" type="RadioButton"
                 xpath="/tmp/@computeMode"/>
          <input checkedValue="1" label="Name computed by a script" type="RadioButton"
                 xpath="/tmp/@computeMode"/>
          <input checkedValue="2" label="Folder and name computed by a script" type="RadioButton"
                 xpath="/tmp/@computeMode"/>
          <input expr="[/tmp/@computeMode]&gt;0" type="expr" xpath="readGroup/@computeName"/>
          <input expr="[/tmp/@computeMode]=2" type="expr" xpath="readGroup/@computeFolder"/>
          <container type="visibleGroup" visibleIf="![readGroup/@computeName]">
            <input createMode="none" xpath="readGroup/group">
              <enter name="onChange">
                <if expr="[readGroup/@group-id]!=0 AND [readGroup/@group-id]!=''">
                  <set value="nms:group" xpath="/ignored/queryDefGroup/@schema"/>
                  <set value="get" xpath="/ignored/queryDefGroup/@operation"/>
                  <set value="@type" xpath="/ignored/queryDefGroup/select/node[1]/@expr"/>
                  <set value="@schema" xpath="/ignored/queryDefGroup/select/node[2]/@expr"/>
                  <set value="extension" xpath="/ignored/queryDefGroup/select/node[3]/@expr"/>
                  <set value="true" xpath="/ignored/queryDefGroup/select/node[3]/@anyType"/>
                  <set expr="iif(HasPackage('xxl:fullfdaCommon'),'@id='+'\''+[readGroup/@group-id]+'\'','@id='+[readGroup/@group-id])"
                       xpath="/ignored/queryDefGroup/where/condition/@expr"/>
                  <soapCall name="ExecuteQuery" service="xtk:queryDef">
                    <param exprIn="[/ignored/queryDefGroup]" type="DOMDocument"/>
                    <param type="DOMDocument" xpathOut="/ignored/group"/>
                  </soapCall>
                  <copyElement xpathDst="extension" xpathSrc="/ignored/group/extension"/>
                  <set expr="iif([/ignored/group/@type]=2, '', [/ignored/group/@schema])"
                       xpath="@schema"/>

                <!-- Apply activity with name of list -->
                  <set expr="[readGroup/@group-cs]" xpath="@label"/>
                </if>
              </enter>
            </input>
          </container>
          <container type="visibleGroup" visibleIf="[readGroup/@computeName]">
            <container type="visibleGroup" visibleIf="![readGroup/@computeFolder]">
              <input img="nms:fldrcpgrp.png" label="In the folder" xpath="readGroup/folder">
                <sysFilter>
                  <condition boolOperator="OR" expr="@model = 'nmsGroup'"/>
                  <condition enabledIf="HasPackage('crm:lead')" expr="@model = 'crmListImport'"/>
                </sysFilter>
              </input>
            </container>
            <container type="visibleGroup" visibleIf="[readGroup/@computeFolder]">
              <input label="Folder (computed)" menuId="workflowMenuBuilder" type="scriptEdit"
                     xpath="readGroup/folderScript"/>
            </container>
            <input label="Label (computed)" menuId="workflowMenuBuilder" type="scriptEdit"
                   xpath="readGroup/script"/>
            <static label="List template (used to define the structure)" type="separator"/>
            <input createMode="none" xpath="readGroup/group">
              <enter name="onChange">
                <if expr="[readGroup/@group-id]!=0 AND [readGroup/@group-id]!=''">
                  <set value="nms:group" xpath="/ignored/queryDefGroup/@schema"/>
                  <set value="get" xpath="/ignored/queryDefGroup/@operation"/>
                  <set value="@type" xpath="/ignored/queryDefGroup/select/node[1]/@expr"/>
                  <set value="@schema" xpath="/ignored/queryDefGroup/select/node[2]/@expr"/>
                  <set value="extension" xpath="/ignored/queryDefGroup/select/node[3]/@expr"/>
                  <set value="true" xpath="/ignored/queryDefGroup/select/node[3]/@anyType"/>
                  <set expr="'@id='+[readGroup/@group-id]" xpath="/ignored/queryDefGroup/where/condition/@expr"/>
                  <soapCall name="ExecuteQuery" service="xtk:queryDef">
                    <param exprIn="[/ignored/queryDefGroup]" type="DOMDocument"/>
                    <param type="DOMDocument" xpathOut="/ignored/group"/>
                  </soapCall>
                  <copyElement xpathDst="extension" xpathSrc="/ignored/group/extension"/>
                  <set expr="iif([/ignored/group/@type]=2, '', [/ignored/group/@schema])"
                       xpath="@schema"/>
                </if>
              </enter>
              <sysFilter>
                <condition expr="[folder/@model]!='crmListImport'"/> <!-- To hide imports with Leads -->
              </sysFilter>
            </input>
          </container>

          <container visibleIf="Iif([readGroup/@group-id]!=0 AND [readGroup/@group-id]!='', NodeValue('extension/element/@name'), '')!=''">
            <static label="Source filtering" type="separator"/>
            <input img="nms:miniatures/mini-query.png" label="Edit query..." nolabel="true"
                   prebuildSubForm="false" type="subFormLink" xpath=".">
              <form label="Query">
                <enter>
                  <set expr="LoadSchema('extension')" xpath="/tmp/selectCtrl/in/@schema"/>
                </enter>
                <input name="filterList" noSaveFilter="true" nolabel="true" propagateXPathToCtx="/ignored/@currentOrderId|/@currentOrderId,/ignored/@querySchemaExec|/@querySchemaExec"
                       toolbarAlign="horizontal" toolbarCaption="Filter conditions"
                       type="conditionList" xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                       xpathHelp="humanCond" xpathSchema="/tmp/selectCtrl/in/@schema"
                       xpathSchemaExec="/ignored/@querySchemaExec">

                  <input colSize="15" label=" " xpath="/@bool-operator"/>
                  <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                  <input colSize="15" label="Operator" xpath="/@operator"/>
                  <input colSize="30" label="Value" xpath="/@rightExpr"/>
                </input>
                <input fontBold="true" lineCount="4" noBorder="true" nolabel="true"
                       readOnly="true" type="edit" xpath="humanCond"/>
                <leave>
                  <set expr="SubString(humanCond, 10)" xpath="@label"/>
                </leave>
              </form>
            </input>
            <input fontBold="true" label=" " lineCount="15" noBorder="true" readOnly="true"
                   type="edit" xpath="humanCond"/>
          </container>
          <static label="Transition" type="separator"/>
          <input xpath="transitions/result/@label"/>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>

      </form>
<!--[cf]-->
<!--[of]:readGroup-->
      <form name="readSurvey" type="notebook">
        <enter>
          <set expr="'temp:webApp:'+[@survey-id]" xpath="/ignored/@querySchemaExec"/>
        </enter>
        <container label="General">
          <input xpath="@label"/>
          <input expr="'temp:webApp:'+[@survey-id]" type="expr" xpath="/ignored/@querySchemaExec"/>
          <input createMode="none" img="nms:webForm.png" xpath="survey">
            <sysFilter>
              <condition expr="[facet/@survey] = true"/>
            </sysFilter>
            <enter name="onChange">
        <!-- Copy selected survey schema definition part -->
              <set value="nms:webApp" xpath="/ignored/queryDef/@schema"/>
              <set value="get" xpath="/ignored/queryDef/@operation"/>
              <set value="@schema" xpath="/ignored/queryDef/select/node[1]/@expr"/>
              <set value="archivedFieldsSchema" xpath="/ignored/queryDef/select/node[2]/@expr"/>
              <set expr="'@id='+[@survey-id]" xpath="/ignored/queryDef/where/condition/@expr"/>

              <soapCall name="ExecuteQuery" service="xtk:queryDef">
                <param exprIn="[/ignored/queryDef]" type="DOMDocument"/>
                <param type="DOMDocument" xpathOut="/tmp/queryDef"/>
              </soapCall>

              <copyElement xpathDst="extension/schema" xpathSrc="/tmp/queryDef/archivedFieldsSchema"/>
              <set expr="[/tmp/queryDef/@schema]" xpath="@targetSchema"/>
            </enter>
          </input>
          <container type="visibleGroup" visibleIf="[@survey-id]!=0">
            <container label="Information collected" type="frame">
              <input nolabel="false" xpath="@keepAllExtraData"/>
              <input img="nms:list.png" label="Select the columns to extract..."
                     prebuildSubForm="false" type="subFormLink" xpath=".">
                <form label="Select extra columns">
                  <enter>
                    <set expr="wkfTargetSchema(@name)" xpath="/tmp/@ignoredSchema"/>
                    <set expr="loadSchema('extension/schema')" xpath="/tmp/@ignoredWebAppSchema"/>
                    <set expr="'temp:'+NodeValue('extension/schema/element/@name')"
                         xpath="/tmp/selectCtrl/in/@schema"/>
                  </enter>
                  <container style="flat" type="notebook">
                    <container ref="xtk:workflow:lib/tabs/colSelector/data"/>
                    <container ref="xtk:workflow:lib/tabs/colSelector/collection"/>
                  </container>
                </form>
              </input>
              <input alwaysActive="true" expr="GroupConcat([select/descendant::node], &quot; ' [' + [@label] + '] ' &quot; )"
                     type="expr" xpath="/tmp/selectCtrl/out/@humanSelect"/>
              <input fontBold="true" lineCount="4" noBorder="true" nolabel="true"
                     readOnly="true" type="edit" xpath="/tmp/selectCtrl/out/@humanSelect"/>
            </container>
            <container label="Source filtering" type="frame">
              <input img="nms:miniatures/mini-query.png" label="Edit query..." prebuildSubForm="false"
                     type="subFormLink" xpath=".">
                <form label="Query">
                  <enter>
                    <set expr="wkfTargetSchema(@name)" xpath="/tmp/@ignoredSchema"/>
                    <set expr="'temp:'+NodeValue('extension/schema/element/@name')"
                         xpath="/tmp/selectCtrl/in/@schema"/>
                  </enter>
                  <input name="filterList" noSaveFilter="true" nolabel="true" propagateXPathToCtx="/ignored/@currentOrderId|/@currentOrderId,/ignored/@querySchemaExec|/@querySchemaExec"
                         toolbarAlign="horizontal" toolbarCaption="Filter conditions"
                         type="conditionList" xpath="where" xpathCurrentLookupPath="/lookupPath/where"
                         xpathHelp="humanCond" xpathSchema="/tmp/selectCtrl/in/@schema"
                         xpathSchemaExec="/ignored/@querySchemaExec">

                    <input colSize="15" label=" " xpath="/@bool-operator"/>
                    <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                    <input colSize="15" label="Operator" xpath="/@operator"/>
                    <input colSize="30" label="Value" xpath="/@rightExpr"/>
                  </input>
                  <leave>
                    <set expr="SubString(humanCond, IndexOf(humanCond, ':')+2)" xpath="@label"/>
                  </leave>
                </form>
              </input>
              <input fontBold="true" lineCount="4" noBorder="true" nolabel="true"
                     readOnly="true" type="edit" xpath="humanCond"/>
            </container>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <soapCall name="readSurveySchema" service="xtk:workflow">
            <param exprIn="[.]" type="DOMElement"/>
            <param type="DOMElement" xpathOut="."/>
          </soapCall>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:setOfService-->
      <form name="setOfService" type="notebook">
        <container img="nms:miniatures/mini-setService.png">
          <input xpath="@label"/>
          <input checkedValue="1" label="Registration" type="RadioButton" xpath="@subscribeType"/>
          <input checkedValue="0" label="Unsubscription" type="RadioButton" xpath="@subscribeType"/>
          <input xpath="@sendConfirmation"/>

          <container label="Select the service" type="frame">
            <container defaultColumns="@label" exprOut1="@label" filterEditField="@label"
                       newEntityFormChoice="true" nodeModel="nmsSetOfServices" schema="nms:service"
                       setOnClick="true" type="navTreeEntityList" xpath="@service-id"
                       xpathOut1="transitions/result/@label"/>
          </container>
          <container xpath="transitions/result">
            <static label="Transition" type="separator"/>
            <input label="Generate an outbound transition" xpath="@enabled"/>
            <container type="visibleGroup" visibleIf="@enabled">
              <input xpath="@label"/>
            </container>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:writer-->
      <form name="writer" type="notebook">
        <enter>
          <if expr="@schema==''">
      <!-- force schema if not defined yet -->
            <set value="nms:recipient" xpath="@schema"/>
          </if>
          <set expr="wkfTargetSchema(wkfSourceActivity(@name), wkfTransitionName(wkfSourceActivity(@name), @name), 1)"
               xpath="/ignored/@writerSchema"/>
          <set expr="Iif([/ignored/@writerSchema]!='' AND [primaryKeyNode/@calcExpr]!='' AND @schema==GetLinkSchema([/ignored/@writerSchema], UnExpandXPath([primaryKeyNode/@calcExpr])), wkfAlterWriterSchema(@name), '')"
               xpath="/ignored/@writerTarget"/>
          <set expr="Iif(NodeCount(primaryKeyNode)&gt;0, Iif([primaryKeyNode/@dstExpr]!='', 2, 1), Iif(EV(@operationType, 'merge'), 1, 0))"
               xpath="/tmp/@targetDimension"/>
        </enter>
        <container colcount="2" img="nms:miniatures/mini-writer.png">
          <input colspan="2" xpath="@label"/>
          <input xpath="@operationType"/>
          <input xpath="@transactionSize"/>
          <input expr="Iif(EV(@operationType, 'merge'), 1, NodeValue('/tmp/@targetDimension'))"
                 type="expr" xpath="/tmp/@targetDimension"/>
          <static colspan="2" label="Record identification" type="separator"/>
          <container colspan="2" type="visibleGroup" visibleIf="EV(@operationType, 'merge')=false">
            <input checkedValue="0" label="Directly using the targeting dimension"
                   type="radioButton" xpath="/tmp/@targetDimension"/>
            <input checkedValue="1" label="Using one or more links" type="radioButton"
                   xpath="/tmp/@targetDimension"/>
            <input checkedValue="2" label="Using reconciliation keys" type="radioButton"
                   xpath="/tmp/@targetDimension"/>
          </container>
          <container colspan="2" type="visibleGroup" visibleIf="EV(@operationType, 'merge')">
            <static label=" " nolabel="false">Select the links for identifying the primary record</static>
            <input expr="Iif([/ignored/@writerSchema]!='' AND [primaryKeyNode/@calcExpr]!='' AND @schema==GetLinkSchema([/ignored/@writerSchema], UnExpandXPath([primaryKeyNode/@calcExpr])), wkfAlterWriterSchema(@name), '')"
                   type="expr" xpath="/ignored/@writerTarget"/>
          </container>
          <container colspan="2" type="visibleGroup" visibleIf="[/tmp/@targetDimension]=0">
            <input type="schemaEdit" xpath="@schema"/>
          </container>
          <container colspan="2" type="visibleGroup" visibleIf="[/tmp/@targetDimension]=1">
            <input editable="true" label=" " lineCount="6" ordered="true" toolbarCaption="List of links that can be used to find the records (by order of priority)"
                   type="list" xpath="primaryKeyNode">
              <input choiceType="xpath" label="Identifier" nolabel="false" type="pathEdit"
                     useTablePath="true" xpath="@calcExpr" xpathSchema="/ignored/@writerSchema"/>
              <input type="pathedit" xpath="@enabledIf" xpathSchema="/ignored/@writerSchema"/>
            </input>
            <input expr="Iif(NodeCount(primaryKeyNode)==0, '', GetLinkSchema([/ignored/@writerSchema], [primaryKeyNode/@calcExpr]))"
                   type="expr" xpath="@schema"/>
            <input readOnly="true" type="schemaEdit" xpath="@schema"/>
          </container>
          <container colspan="2" type="visibleGroup" visibleIf="[/tmp/@targetDimension]=2">
            <input type="schemaEdit" xpath="@schema"/>
            <input editable="true" label=" " lineCount="6" ordered="true" toolbarCaption="Keys for finding records"
                   type="list" xpath="primaryKeyNode">
              <input choiceType="xpath" colSize="35" hideCalculated="true" hideMappedAsXml="true"
                     type="pathedit" xpath="@dstExpr" xpathSchema="../@schema"/>
              <input label="Identifier" type="pathEdit" xpath="@calcExpr" xpathSchema="/ignored/@writerSchema"/>
            </input>
          </container>
          <container colspan="2" type="visibleGroup" visibleIf="EV(@operationType, 'insertOrUpdate')">
            <static label="Fields to update" type="separator"/>
            <input editable="true" label=" " ordered="true" toolbarAlign="vertical"
                   type="list" xpath="node" xpathHelp="/ignored/@help" xpathSchema="@schema">
              <container>
                <input img="xtk:wand.png" label="Automatically associate fields with the same name"
                       textAlign="toolTip" type="flatButton" xpath="/ignored/@dummyBoolean">
                  <enter>
                    <set expr="wkfBuildAutomatedWriter([../@name])" xpath="/ignored/@magicAssociation"/>
                  </enter>
                </input>
              </container>
              <input choiceType="xpath" colSize="35" hideMappedAsXml="true" type="pathedit"
                     xpath="@dstExpr" xpathSchema="../@schema"/>
              <input type="dynedit" xpath="@calcExpr" xpathDynamicSchema="../@schema"
                     xpathDynamicType="@dstExpr" xpathLabel="@valueLabel" xpathSchema="/ignored/@writerSchema"/>
              <input type="pathedit" xpath="@enabledIf" xpathSchema="/ignored/@writerSchema"/>
              <input xpath="@enabledOperation"/>
            </input>
          </container>
          <container colspan="2" type="visibleGroup" visibleIf="EV(@operationType, 'insert', 'update')">
            <static label="Fields to update" type="separator"/>
            <input editable="true" label=" " ordered="true" toolbarAlign="vertical"
                   type="list" xpath="node" xpathHelp="/ignored/@help" xpathSchema="@schema">
              <container>
                <input img="xtk:wand.png" label="Automatically associate fields with the same name"
                       textAlign="toolTip" type="flatButton">
                  <enter>
                    <set expr="wkfBuildAutomatedWriter([../@name])" xpath="/ignored/@magicAssociation"/>
                  </enter>
                </input>
              </container>
              <input choiceType="xpath" colSize="35" hideMappedAsXml="true" type="pathedit"
                     xpath="@dstExpr" xpathSchema="../@schema"/>
              <input type="dynedit" xpath="@calcExpr" xpathDynamicSchema="../@schema"
                     xpathDynamicType="@dstExpr" xpathLabel="@valueLabel" xpathSchema="/ignored/@writerSchema"/>
              <input type="pathedit" xpath="@enabledIf" xpathSchema="/ignored/@writerSchema"/>
            </input>
          </container>
          <container colspan="2" type="visibleGroup" visibleIf="EV(@operationType, 'merge')">
            <static label="Fields and collections of the target record to be updated"
                    type="separator"/>
            <static type="help">the "Targeting dimension (target)" link represents the secondary record</static>
            <input editable="false" label=" " noZoomOnAdd="true" ordered="true" prebuildSubForm="false"
                   toolbarAlign="vertical" type="list" xpath="node" xpathHelp="/ignored/@help"
                   xpathSchema="@schema" zoom="true" zoomOnAdd="false">
              <form label="Updating collection elements" type="wizard">
                <enter>
                  <set expr="GetLinkSchema([/ignored/@writerSchema], UnExpandXPath(@calcExpr))"
                       xpath="/ignored/@outputSchemaCollection"/>
                  <set expr="GetLinkSchema([../@schema], UnExpandXPath(@dstExpr))"
                       xpath="/ignored/@inputSchemaCollection"/>
                </enter>
                <container label="Select the destination field or collection, then the expression used to calculate its value in the source data"
                           title="Update">
                  <container type="visibleGroup" visibleIf="GetLinkCardinality([../@schema], @dstExpr)==0 OR @dstExpr=''">
                    <input enum="xtk:workflow:mergeType" label="Merge type" type="sysenum"
                           xpath="@operationType"/>
                  </container>
                  <input choiceType="xpath" hideMappedAsXml="true" nolabel="false"
                         type="pathedit" useUnboundPath="true" xpath="@dstExpr" xpathSchema="../@schema"/>
                  <input choiceType="condition" hideCalculated="true" hideMappedAsXml="true"
                         nolabel="false" type="pathedit" useUnboundPath="true" xpath="@calcExpr"
                         xpathLabel="@valueLabel" xpathSchema="/ignored/@writerSchema"/>
                  <static label="Calculation parameters" type="separator"/>
                  <input xpath="@onlyIfNotExists"/>
                  <input label="Condition" nolabel="false" schemaExpr="Iif(GetLinkCardinality([../@schema], @dstExpr)==0, GetLinkSchema([/ignored/@writerSchema], UnExpandXPath(@calcExpr)),[/ignored/@writerSchema])"
                         type="pathedit" xpath="@enabledIf"/>
                  <container type="visibleGroup" visibleIf="@operationType='replace'">
                    <static type="help">Select the condition used to identify the records to be deleted from the target</static>
                    <input label=" " nolabel="false" schemaExpr="Iif(GetLinkCardinality([../@schema], @dstExpr)==0, GetLinkSchema([/ignored/@writerSchema], UnExpandXPath(@calcExpr)),[/ignored/@writerSchema])"
                           type="pathedit" xpath="@replacedIf"/>
                  </container>
                </container>
                <container title="Identification settings of updated collection elements"
                           visibleIf="[/ignored/@inputSchemaCollection]!=[/ignored/@outputSchemaCollection] AND @dstExpr!=''">
                  <static type="help">Select the join conditions for reconciling the records in the destination collection based on those in the source</static>
                  <input editable="true" label=" " ordered="true" toolbarCaption="Identification keys"
                         type="list" xpath="primaryKeyNode">
                    <input choiceType="xpath" colSize="35" hideMappedAsXml="true"
                           type="pathedit" xpath="@dstExpr" xpathSchema="/ignored/@inputSchemaCollection"/>
                    <input label="Identifier" type="pathEdit" xpath="@calcExpr" xpathSchema="/ignored/@outputSchemaCollection"/>
                  </input>
                </container>
                <container title="Updated fields in the target collection" visibleIf="[/ignored/@inputSchemaCollection]!=[/ignored/@outputSchemaCollection] AND @dstExpr!=''">
                  <static type="help">Select the fields to be updated in the target collection.</static>
                  <input editable="true" nolabel="true" ordered="true" toolbarAlign="vertical"
                         type="list" xpath="node" xpathHelp="/ignored/@help" xpathSchema="@schema">
                    <input choiceType="xpath" colSize="35" hideMappedAsXml="true"
                           type="pathedit" xpath="@dstExpr" xpathSchema="/ignored/@inputSchemaCollection"/>
                    <input choiceType="condition" hideCalculated="true" hideMappedAsXml="true"
                           type="dynedit" xpath="@calcExpr" xpathDynamicSchema="/ignored/@inputSchemaCollection"
                           xpathDynamicType="@dstExpr" xpathLabel="@valueLabel" xpathSchema="/ignored/@outputSchemaCollection"/>
                    <input schemaExpr="Iif(GetLinkCardinality([/ignored/@inputSchemaCollection], @dstExpr)==0, GetLinkSchema([/ignored/@inputSchemaCollection], @dstExpr),[/ignored/@outputSchemaCollection])"
                           type="pathedit" xpath="@enabledIf"/>
                  </input>
                </container>
              </form>
              <container>
                <input img="xtk:wand.png" label="Automatically associate fields with the same name"
                       textAlign="toolTip" type="flatButton">
                  <enter>
                    <set expr="wkfBuildAutomatedWriter([../@name])" xpath="/ignored/@magicAssociation"/>
                  </enter>
                </input>
              </container>
              <input choiceType="xpath" colSize="35" editable="true" hideMappedAsXml="true"
                     label="Destination (main)" type="pathedit" useUnboundPath="true"
                     xpath="@dstExpr" xpathSchema="../@schema"/>
              <input choiceType="condition" editable="true" hideCalculated="true"
                     hideMappedAsXml="true" label="Source expression (secondary)"
                     type="dynedit" useUnboundPath="true" xpath="@calcExpr" xpathDynamicSchema="../@schema"
                     xpathDynamicType="@dstExpr" xpathLabel="@valueLabel" xpathSchema="/ignored/@writerSchema"/>
              <input editable="true" schemaExpr="Iif(GetLinkCardinality([../@schema], @dstExpr)==0, GetLinkSchema([/ignored/@writerSchema], UnExpandXPath(@calcExpr)),[/ignored/@writerSchema])"
                     type="pathedit" xpath="@enabledIf"/>
              <input editable="false" xpath="@operationType"/>
            </input>
          </container>
          <container colspan="2">
            <input img="xtk:properties.png" label="Advanced parameters..." nolabel="false"
                   type="subFormLink" xpath=".">
              <form label="Advanced parameters" name="advancedWriter" xpathsToLoadOpt="@operationType">
          <!-- The following options are irrelevant in case of a deletion -->
                <container type="visibleGroup" visibleIf="EV(@operationType, 'delete')=false">
                  <container type="notebook">
                    <container label="General">
                      <container>
                        <input xpath="@noAutoPK"/>
                        <input xpath="@noAudit"/>
                        <input xpath="@noPreservation"/>
                        <input xpath="@noMinimalUpdate"/>
                        <input xpath="@updateAllColumns"/>
                      </container>
                      <container type="visibleGroup" visibleIf="@updateAllColumns">
                        <input xpath="@noUpdateLinks"/>
                      </container>
                      <static label="Enabled if" type="separator"/>
                      <input type="pathedit" xpath="@enabledIf" xpathSchema="/ignored/@writerSchema"/>
                      <static label="You can specify handling conditions for elements of the source. \nAn empty handling condition will not filter the source."
                              type="help"/>
                    </container>
                    <container label="Doubles">
                      <static label="You can specify the conditions based on which duplicates will be taken into account. \nIf you ignore records which concern the same target, only the first one in the order specified below will be taken into account."
                              type="help"/>
                      <input xpath="@ignoreDuplicates"/>
                      <input nolabel="true" toolbarCaption="Order in which duplicates are taken into account"
                             type="list" xpath="orderedExpr">
                        <input type="pathEdit" xpath="@expr" xpathSchema="/ignored/@writerSchema"/>
                        <input type="checkBox" xpath="@desc"/>
                      </input>
                    </container>
                  </container>
                </container>
                <container type="visibleGroup" visibleIf="EV(@operationType, 'delete')=true">
                  <static label="Enabled if" type="separator"/>
                  <input type="pathedit" xpath="@enabledIf" xpathSchema="/ignored/@writerSchema"/>
                  <static label="You can specify handling conditions for elements of the source. \nAn empty handling condition will not filter the source."
                          type="help"/>
                </container>
              </form>
            </input>
          </container>
          <static colspan="2" label="Transitions" type="separator"/>
          <container colspan="2" xpath="transitions">
            <input label="Generate an outbound transition" xpath="done/@enabled"/>
            <container type="visibleGroup" visibleIf="[done/@enabled]">
              <input xpath="done/@label"/>
            </container>
            <input label="Generate an outbound transition for the rejects" xpath="remainder/@enabled"/>
            <container type="visibleGroup" visibleIf="[remainder/@enabled]">
              <input xpath="remainder/@label"/>
            </container>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <if expr="[/tmp/@targetDimension]==0">
            <reset xpath="primaryKeyNode[*]"/>
          </if>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:content-->
      <form maxLabelWidth="60" name="content" type="notebook">
        <container addSchemaMenu="nms:recipient" menuId="targetIdForProperties" type="customMenuBuilder"/>
        <container img="nms:miniatures/mini-content.png">
          <input xpath="@label"/>
          <static label="Content" type="separator"/>
          <input checkedValue="0" label="Specified in the transition" type="RadioButton"
                 xpath="@contentSel"/>
          <input checkedValue="1" label="Explicit" type="RadioButton" xpath="@contentSel"/>
          <input checkedValue="2" label="Calculated by a script" type="RadioButton"
                 xpath="@contentSel"/>
          <input checkedValue="3" label="New, created from a publication template"
                 type="RadioButton" xpath="@contentSel"/>
          <container type="visibleGroup" visibleIf="@contentSel=1">
            <input img="ncm:content.png" xpath="content"/>
          </container>
          <container type="visibleGroup" visibleIf="@contentSel=2">
            <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="contentIdScript"/>
          </container>
          <container type="visibleGroup" visibleIf="@contentSel=3">
            <input img="ncm:publishing.png" xpath="publishing"/>
            <input img="ncm:channel.png" xpath="channel">
              <sysFilter>
                <condition expr="@entity = 'ncm:channel'"/>
              </sysFilter>
            </input>
          </container>

          <static label="Update content" type="separator"/>
          <input menuId="targetIdForProperties" type="scriptEdit" xpath="@subject"/>
          <static label="Enables you to override the subject of the delivery action associated with the content."
                  type="help"/>
          <input label="Access to data from an XML feed" xpath="@activeTransform"/>
          <container type="visibleGroup" visibleIf="@activeTransform">
            <input menuId="workflowMenuBuilder" type="scriptEdit" xpath="@url"/>
            <static/>
            <input form="ncm:xslt" img="xtk:xslt.png" xpath="xslt">
              <sysFilter>
                <condition expr="@namespace NOT IN ('xtk', 'nl', 'nms', 'ncm', 'nis')"/>
              </sysFilter>
            </input>
            <static label="A style sheet can be used to transform the data from the XML feed."
                    type="help"/>
          </container>

          <static label="Action to perform" type="separator"/>
          <container>
            <input checkedValue="0" label="Save" type="RadioButton" xpath="@actionType"/>
            <input checkedValue="1" label="Generate" type="RadioButton" xpath="@actionType"/>
            <container type="visibleGroup" visibleIf="@actionType=1">
              <input xpath="@publishingDir"/>
              <static label="If the folder is not specified, the publication will be made to the default folder."
                      type="help"/>
            </container>
          </container>
          <container xpath="transitions/done">
            <static label="Transition" type="separator"/>
            <input label="Generate an outbound transition" xpath="@enabled"/>
            <container type="visibleGroup" visibleIf="@enabled">
              <input xpath="@label"/>
            </container>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:localValidation-->
      <form name="localValidation" type="notebook">
        <enter>
          <set value="0" xpath="/ignored/@addReminder"/>
        </enter>

        <container colcount="2" img="nms:miniatures/mini-localValidation.png">
          <input colspan="2" xpath="@label"/>

          <static colspan="2" label="Action to perform" type="separator"/>
          <input checkedValue="0" colspan="2" label="Target approval notification"
                 type="radioButton" xpath="@distributionAction"/>
          <input checkedValue="1" colspan="2" label="Delivery feedback report" type="radioButton"
                 xpath="@distributionAction"/>

          <container colspan="2" type="visibleGroup" visibleIf="EV(@distributionAction, 'report')">
            <static label="Delivery" type="separator"/>
            <input checkedValue="0" label="Specified in the transition" type="radioButton"
                   xpath="@deliverySel"/>
            <input checkedValue="1" label="Explicit" type="radioButton" xpath="@deliverySel"/>
            <container type="visibleGroup" visibleIf="@deliverySel=1">
              <input createMode="none" folderFilterChoice="@model like 'nmsDelivery%'"
                     img="nms:email.png" noAutoComplete="true" xpath="delivery">
                <sysFilter>
                  <condition expr="@isModel = 0"/>
                </sysFilter>
                <orderBy>
                  <node expr="@lastModified" sortDesc="true"/>
                </orderBy>
              </input>
            </container>
          </container>

          <container colspan="2" type="visibleGroup" visibleIf="EV(@distributionAction, 'notif')">
            <static label="Distribution context" type="separator"/>
            <input checkedValue="0" label="Specified in the transition" type="radioButton"
                   xpath="@distributionSel"/>
            <input checkedValue="1" label="Explicit" type="radioButton" xpath="@distributionSel"/>
            <container type="visibleGroup" visibleIf="EV(@distributionSel, 'explicit')">
              <input createMode="none" img="nms:localDistribution.png" xpath="localDistribution"/>
            </container>
          </container>
          <container colcount="2" colspan="2" type="visibleGroup" visibleIf="EV(@distributionAction, 'notif')">
            <static colspan="2" label="Approval management" type="separator"/>
            <input colspan="2" xpath="@earlyValidation"/>
            <input xpath="validation/@type"/>
            <container type="visibleGroup" visibleIf="EV([validation/@type], 'delay')">
              <input xpath="validation/@delay"/>
            </container>
            <container type="visibleGroup" visibleIf="EV([validation/@type], 'date')">
              <input xpath="validation/@date"/>
            </container>
          </container>
          <input colspan="2" createMode="none" folderFilterChoice="@model = 'nmsDeliveryModel'"
                 img="nms:deliveryModel.png" xpath="deliveryModel">
            <sysFilter>
              <condition expr="@isModel = 1"/>
            </sysFilter>
          </input>
          <container colspan="2" type="visibleGroup" visibleIf="[@deliveryModel-id]!=0">
            <input colspan="2" menuId="workflowMenuBuilder" type="scriptEdit" xpath="@subject"/>
            <container colspan="2" type="visibleGroup" visibleIf="EV(@distributionAction, 'notif')">
              <input nolabel="false" xpath="description"/>
            </container>
          </container>

          <container colspan="2" type="visibleGroup" visibleIf="EV(@distributionAction, 'notif')">
            <container colspan="2" ref="nms:operation:lib/reminder"/>
            <static label="Complement" type="separator"/>
            <input xpath="transitions/remainder/@enabled"/>
            <container type="visibleGroup" visibleIf="[transitions/remainder/@enabled]">
              <input xpath="transitions/remainder/@label"/>
            </container>
            <static type="help">If this option is checked, non approved targets are saved in a second set.</static>
          </container>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>

        <leave>
          <check expr="EV(@distributionSel, 'event') or [@localDistribution-id] != 0">
            <error>You must correctly specify the data.</error>
          </check>
          <if expr="@earlyValidation=1">
            <soapCall name="WakeupTask" service="xtk:workflow">
              <param exprIn="'operationMgt'" type="string"/>
              <param exprIn="''" type="string"/>
              <param exprIn="'scheduler'" type="string"/>
            </soapCall>
          </if>
        </leave>
      </form>
<!--[cf]-->
<!--[of]:offer-->
      <form name="offer" type="notebook">
        <container colcount="2" img="nms:miniatures/mini-offer.png">

          <input colspan="2" xpath="@label"/>
          <static colspan="2" label="Lets you favor an offer for a defined population for a given period."
                  type="help"/>

          <container colcount="2" colspan="2" label="Offer conditions" type="frame">
            <input colspan="2" createMode="none" img="nms:offer.png" required="true"
                   xpath="offer"/>
            <container colcount="2" colspan="2" type="visibleGroup" visibleIf="[@offer-id]!=0">
              <input xpath="@startDate"/>
              <input xpath="@endDate"/>
              <input choiceType="xpath" nolabel="false" type="pathEdit" useUnboundPath="false"
                     xpath="@weightExpr" xpathSchema="../filter/@schema"/>
              <static/>
            </container>
          </container>
          <input colspan="2" label="Generate an outbound transition" xpath="transitions/done/@enabled"/>
          <input colspan="2" label="Process errors" xpath="transitions/error[@name='error']/@enabled"/>
        </container>
<!--
  <container label="Réactions" propagateConstraints="false"
             img="xtk:miniatures/mini-clock.png">

    <input type="list"
      xpath="transitions/reaction"
      zoom      = "true"
      nolabel   = "true"
      toolbarCaption = "Evénements sur expiration de délais">
      <form label="Plannification">
        <input xpath="@label"/>
        <input xpath="@reply"/>
        <input type="scheduler" xpath="period"/>
      </form>
      <input xpath="@label"/>
      <input xpath="@reply"/>
    </input>
  </container>
-->

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:offerSelection-->
      <form name="offerSelection" type="notebook">
        <container img="nms:miniatures/mini-offer.png" maxLabelWidth="200">
          <input xpath="@label"/>
          <static type="help">Calls the engine to calculate the best offers that can be proposed to an inbound population. Generates an output table containing the population enriched with the best offers in columns. Does not generate history for the propositions.</static>
          <container colspan="2">
            <static label="Offers to consider" type="separator"/>
            <input createMode="none" img="nms:offerSpace.png" notifyPathList="@defaultCategory-id|/tmp/@defaultCategoryId,defaultCategory/@label|/tmp/@defaultCategoryCs,@defaultThemes|/tmp/@defaultThemes"
                   required="true" xpath="offerSpace">
              <enter name="onChange">
                <set expr="[/tmp/@defaultCategoryId]" xpath="/tmp/defaultCategory/@id"/>
                <set expr="[/tmp/@defaultCategoryCs]" xpath="/tmp/defaultCategory/@_cs"/>
                <set expr="[/tmp/@defaultCategoryId]" xpath="/tmp/defaultCategory"/>
                <set expr="[/tmp/@defaultThemes]" xpath="@offerThemes"/>
              </enter>
              <sysFilter>
                <condition expr="[env/@live]=true"/>
              </sysFilter>
            </input>
            <container type="visibleGroup" visibleIf="[@offerSpace-id]!=0">
              <input img="nms:offerCategory.png" xpath="offerCategory" xpathRefresh="/tmp/defaultCategory">
                <sysFilter>
                  <condition expr="@model = 'nmsOfferCategory' or @model = 'nmsOfferEnv'"/>
                </sysFilter>
              </input>
              <input xpath="@offerThemes"/>
              <input xpath="@maxPropositionCount"/>
              <input xpath="@contactDate"/>
            </container>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[of]:task-->
      <form name="task" type="notebook">
  <!-- This control editTargetProperties is just used as an indirection to the real form -->
        <container editFormTarget="nms:task" name="editTargetProperties" newFormTarget="nms:task"
                   notifyPathList="@type|/tmp/@taskType" propagateXPathToCtx="/tmp/@newFromWorkflow,../../@id|/tmp/@workflowId"
                   propagateXPathToCtxOnAdd="/tmp/@newTask,/tmp/@operationId,../../@id|/tmp/@workflowId,/tmp/@newFromWorkflow,../../@isModel|/operation/@isModel"
                   targetMenuLabel="Edit the task..." type="visibleGroup" visibleIf="false">
          <enter>
            <set value="1" xpath="/tmp/@newTask"/>
            <set expr="[/tmp/@parentId]" xpath="/tmp/@operationId"/>
            <set value="1" xpath="/tmp/@newFromWorkflow"/>
          </enter>
          <leave>
      <!-- Enable/disable event according to task type -->
            <if expr="([transitions/refused/@enabled] and [/tmp/@taskType]=3) or ([transitions/refused/@enabled]=false and [/tmp/@taskType]!=3)">
              <set expr="iif ([/tmp/@taskType]=3, false, true)" xpath="transitions/refused/@enabled"/>
              <set expr="iif ([/tmp/@taskType]=3, 'nms:activities/alert.png', 'nms:activities/task.png')"
                   xpath="@img"/>
            </if>
          </leave>
        </container>

        <container img="nms:miniatures/mini-tak.png">
          <input xpath="@label"/>
        </container>

        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
<!--[cf]-->
<!--[of]:Crm-->
<!--[of]:mscrm-->
      <form name="mscrmWorkflow" ref="crm:workflow:mscrmWorkflow"/>
<!--[cf]-->
<!--[of]:sfdc-->
      <form name="sfdcWorkflow" ref="crm:workflow:sfdcWorkflow"/>
<!--[cf]-->
<!--[of]:crmDataMgt-->
      <form name="crmConnectorDataMgt" ref="crm:workflow:crmConnectorDataMgt"/>
<!--[cf]-->
<!--[of]:crmWebEx-->
      <form name="crmWebex" ref="crm:workflow:crmWebex"/>
<!--[cf]-->
<!--[of]:changeDataSource-->
      <form name="changeDataSource" type="notebook">
        <enter>
          <set expr="wkfTargetSchema(wkfSourceActivity(@name), wkfTransitionName(wkfSourceActivity(@name), @name), 1)"
               xpath="/ignored/@orgSchema"/>
        </enter>
        <container img="nms:miniatures/mini-changeDataSource.png">
          <input xpath="@label"/>
          <container colspan="2" type="visibleGroup" visibleIf="[/ignored/@orgSchema]==''">
            <static type="warning">This activity requires a unique inbound population.</static>
          </container>
          <container label="Outbound Data Source" type="visibleGroup" visibleIf="[/ignored/@orgSchema]!=''">
            <input checkedValue="0" label="Default data source" nolabel="false" type="radioButton"
                   xpath="configuration/@outboundDataSource"/>
            <input checkedValue="1" label="Active FDA external account" nolabel="false"
                   type="radioButton" xpath="configuration/@outboundDataSource"/>
            <container type="visibleGroup" visibleIf="[configuration/@outboundDataSource]==1">
              <input img="nms:extAccount.png" noAutoComplete="true" nolabel="true"
                     notifyPathList="@name" xpath="extAccount">
                <sysFilter>
                  <condition expr="@type = 7"/>
                  <condition boolOperator="AND" expr="@active = 1"/>
                </sysFilter>
              </input>
            </container>
          </container>
          <static type="help">The activity cannot accept more than maxNbOfInboundRows inbound records, defined in serverConf.xml</static>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
        <leave>
          <set expr="'nms:extAccount:'+ [extAccount/@name]" xpath="configuration/@dataSource"/>
        </leave>
      </form>
<!--[cf]-->
<!--[cf]-->
<!--[of]:buildAggregate-->
      <form name="buildAggregate" type="notebook">
        <enter>
          <set value="0" xpath="/ignored/@updateType"/>
          <if expr="NodeCount([where/condition])!=0">
            <set value="1" xpath="/ignored/@updateType"/>
          </if>
        </enter>

        <container img="xtk:miniatures/mini-buildAggregate.png">
          <input xpath="@label"/>
          <input choiceButton="true" createMode="none" img="xtk:olapCube.png" xpath="cube"/>
          <container type="visibleGroup" visibleIf="[@cube-id] &gt; 0">
            <input choiceButton="true" createMode="none" img="xtk:olapAggregate.png"
                   xpath="aggregate">
              <sysFilter>
                <condition expr="[@cube-id]=$(@cube-id)"/>
              </sysFilter>
            </input>
          </container>
          <container type="visibleGroup" visibleIf="[@cube-id] &gt; 0 AND [@aggregate-id] &gt; 0">
            <static label="Aggregate update" type="separator"/>
            <input checkedValue="0" label="Full update" type="RadioButton" xpath="/ignored/@updateType"/>
            <input checkedValue="1" label="Partial update" type="RadioButton" xpath="/ignored/@updateType"/>
            <container type="visibleGroup" visibleIf="[/ignored/@updateType]=1">
              <input label="Edit the update condition..." nolabel="false" type="subformlink"
                     xpath=".">
                <form label="Editing the update condition">
                  <enter>
                    <soapCall name="GetAggregateSchema" service="xtk:olapCube">
                      <param exprIn="." type="DOMElement"/>
                      <param type="DOMElement" xpathOut="/tmp/tempSchemas"/>
                    </soapCall>
                    <copyElement xpathDst="tempSchemas/schema" xpathSrc="/tmp/tempSchemas"/>
                    <set expr="LoadSchema('tempSchemas/schema')" xpath="@schema"/>
                  </enter>
                  <container type="visibleGroup" visibleIf="@schema != ''">
                    <container img="xtk:filter.png" label="Filter" type="queryWhereContainer">
                      <input nolabel="true" toolbarAlign="horizontal" toolbarCaption="Filter conditions"
                             type="conditionList" xpath="where" xpathHelp="/@helpCond">
                        <input colSize="15" label=" " xpath="/@bool-operator"/>
                        <input colSize="30" label="Expression" xpath="/@leftExpr"/>
                        <input colSize="15" label="Operator" xpath="/@operator"/>
                        <input colSize="30" label="Value" xpath="/@rightExpr"/>
                        <input colSize="30" label="Taken into account if" xpath="/@enabledIf"/>
                      </input>
                      <input fontBold="true" lineCount="4" noBorder="true" nolabel="true"
                             readOnly="true" type="edit" xpath="/@helpCond"/>
                    </container>
                  </container>
                  <leave>
                    <set value="" xpath="@schema"/>
                  </leave>
                </form>
              </input>
        <!--container type="visibleGroup" visibleIf="[fact/where/@displayFilter]!=''">
          <input type="memo" xpath="fact/where/@displayFilter" fontBold="true" label=" "
                 noBorder="true" readOnly="true" lineCount="4"/>
        </container-->
            </container>
          </container>
        </container>
        <container ref="xtk:workflow:lib/tabs/advancedActivityPage"/>
      </form>
<!--[cf]-->
    </container>
<!--[cf]-->
  </container>
<!--[cf]-->

<!--[of]:Diagramme-->
  <container colcount="2" img="xtk:workflow.png" label="Diagram" name="diagram">
  <!--
    the menu builder must be set only once for all customize buttons
    (set as a controller resource)
  -->
    <container menuId="workflowMenuBuilder" type="workflowMenuBuilder"/>
    <container menuId="wfDeliveryMenuBuilder" type="wfDeliveryMenuBuilder"/>
    <container menuId="wfSubWorkflowMenuBuilder" type="wfSubWorkflowMenuBuilder"/>
    <container menuId="wfImportMenuBuilder" type="wfImportMenuBuilder"/>
    <container menuId="wfExportMenuBuilder" type="wfExportMenuBuilder"/>
    <container menuId="wfInSmsMenuBuilder" type="wfInSmsMenuBuilder"/>

    <container colcount="2" colspan="2" type="visibleGroup" visibleIf="@isModel">
      <input xpath="@label"/>
      <input xpath="@internalName"/>
    </container>

    <container colcount="2" colspan="2" type="visibleGroup" visibleIf="!@isModel">
      <input xpath="@label"/>
      <container type="visibleGroup" visibleIf="[/ignored/operationCtx]=false">
        <input readOnly="true" xpath="@state"/>
      </container>
      <container applicableIf="HasPackage('nms:campaign')" type="visibleGroup" visibleIf="[/ignored/operationCtx]=true">
        <input readOnly="true" xpath="process/@processState"/>
      </container>
    </container>

    <container colspan="2" name="diagram">
<!--[of]:  Diagram-->
      <input hideEditButtonsExpr="HasNamedRight('workflow')=false or @isModel or [/ignored/@hideEditButtons]='true' or [/ignored/@hideEditButtons]='1'"
             type="workflowedit" xpath="." xpathHidePalette="/ignored/@hidePalette"
             xpathSelectedActivity="/ignored/@selectedActivity" xpathStartButtonCmd="/ignored/@startButtonCmd"
             xpathStartButtonEnable="/ignored/@startButtonEnable" xpathStartButtonImg="/ignored/@startButtonImg">
        <enter name="duplicate">

          <set expr="NormalizeXPath(NodePath([.]))" xpath="/tmp/elemDup/@path"/>
          <set expr="'$(entityPath)'+'/'" xpath="/tmp/elemDup/@entitypath"/>
          <set expr="Iif( StartWith([/tmp/elemDup/@path],[/tmp/elemDup/@entitypath]) , SubString([/tmp/elemDup/@path],StrLen([/tmp/elemDup/@entitypath])) , '')"
               xpath="/tmp/elemDup/@relativepath"/>

          <if expr="GetLinkSchema('xtk:workflow',[/tmp/elemDup/@relativepath])=='nms:delivery'">
            <set expr="[$(entityPath)/@operation-id]" xpath="@operation-id"/>
            <set expr="[$(entityPath)/@id]" xpath="@workflow-id"/>
            <set expr="[@folderProcess-id]" xpath="folderProcess/@id"/>

            <reset xpath="/ignored/queryDefDup"/>
            <set value="xtk:folder" xpath="/ignored/queryDefDup/@schema"/>
            <set value="select" xpath="/ignored/queryDefDup/@operation"/>
            <set value="@id" xpath="/ignored/queryDefDup/select/node[1]/@expr"/>
            <set value="@label" xpath="/ignored/queryDefDup/select/node[2]/@expr"/>

            <if expr="[@folder-id]!=0">
              <set expr="'@id=' + [@folder-id] + ' OR @id=' + [@folderProcess-id] +''"
                   xpath="/ignored/queryDefDup/where/condition/@expr"/>
              <soapCall name="ExecuteQuery" service="xtk:queryDef">
                <param exprIn="[/ignored/queryDefDup]" type="DOMDocument"/>
                <param type="DOMDocument" xpathOut="/tmp/queryDefDup"/>
              </soapCall>
              <if expr="[/tmp/queryDefDup/folder[1]/@id]==[@folder-id]">
                <set expr="[/tmp/queryDefDup/folder[1]/@label]" xpath="folder/@_cs"/>
                <set expr="[/tmp/queryDefDup/folder[2]/@label]" xpath="folderProcess/@_cs"/>
              </if>
              <if expr="[/tmp/queryDefDup/folder[2]/@id]==[@folder-id]">
                <set expr="[/tmp/queryDefDup/folder[2]/@label]" xpath="folder/@_cs"/>
                <set expr="[/tmp/queryDefDup/folder[1]/@label]" xpath="folderProcess/@_cs"/>
              </if>
            </if>

          </if>
        </enter>
<!--[of]:  Properties-->
        <input type="separator"/>
        <input enabledIf="[/workflow/@id] != 0" img="xtk:properties.png" label="Properties"
               type="flatSubFormButton">
          <form label="Workflow properties" type="notebook" xpathsToLoadOpt="operation/@type">
            <enter>
              <set value="0" xpath="/tmp/@acceptTempSchema"/>
            </enter>
  <!--[of]:  General-->
            <container colcount="2" label="General">
              <input xpath="@label"/>
              <input xpath="@internalName"/>

              <container applicableIf="HasPackage('nms:campaign')" colspan="2" type="visibleGroup"
                         visibleIf="[@operation-id]!=0">
                <input xpath="folder">
                  <sysFilter>
                    <condition enabledIf="$(@isModel)" expr="@model = 'xtkWorkflowModel'"/>
                    <condition enabledIf="$(@isModel)=false" expr="@model = 'xtkWorkflow'"/>
                  </sysFilter>
                </input>
              </container>

              <container colspan="2" type="visibleGroup" visibleIf="@isModel">
                <input img="xtk:workflow.png" xpath="folderProcess">
                  <sysFilter>
                    <condition expr="@model = 'xtkWorkflow'"/>
                  </sysFilter>
                </input>
              </container>

              <container applicableIf="HasPackage('nms:campaign')" colspan="2" type="visibleGroup"
                         visibleIf="[@operation-id]!=0 and @recurrentMdl and @isModel=false">
                <input img="xtk:workflow.png" xpath="folderProcess">
                  <sysFilter>
                    <condition expr="@model = 'xtkWorkflow'"/>
                  </sysFilter>
                </input>
              </container>

              <input colspan="2" xpath="@timezone"/>

              <input colspan="2" createMode="none" noZoom="true" xpath="supervisor">
                <sysFilter>
                  <condition expr="@type = 1"/>
                </sysFilter>
              </input>

              <container colspan="2" label="Segmentation" type="frame">
                <input useDesc="true" xpath="@keepResult"/>
                <static nolabel="true" type="help">This enables you to perform analysis on intermediate populations generated by the workflow and on the final populations even if the workflow is finished (until these populations are purged by the cleanup task).</static>
                <container ref="xtk:workflow:lib/tabs/schemaSelector"/>
                <static type="help">Targeting and filtering dimensions used by default in query-related activities (query, split...).</static>
              </container>
              <static colspan="2" label="Description" type="separator"/>
              <input colspan="2" nolabel="true" xpath="desc"/>
            </container>
  <!--[cf]-->
  <!--[of]:  Execution-->
            <container label="Execution">

              <container applicableIf="HasPackage('nms:campaign')" label="Execution"
                         type="visibleGroup" visibleIf="[@operation-id]!=0">
                <container label="Scheduler" type="frame">
                  <input xpath="process/@priority"/>
                  <input useDesc="true" xpath="process/@forecasted"/>
                  <container type="visibleGroup" visibleIf="EV([operation/@type], 'recurrent')">
                    <input xpath="@recurrentMdl"/>
                  </container>
                </container>
              </container>

              <container label="Execution" type="frame">
                <input xpath="@affinity"/>
                <container applicableIf="HasPackage('nms:snowflake') AND !HasPackage('xxl:fullfdaCommon')"
                           type="visibleGroup" visibleIf="true">
                  <input xpath="@warehouse"/>
                </container>
                <container applicableIf="HasPackage('xxl:fullfdaCommon')" type="visibleGroup"
                           visibleIf="true">
                  <container type="visibleGroup" visibleIf="@builtIn = 1">
                    <input defaultIfInvalid="system" enum="nms:workloadType:ootbWorkloadTypes"
                           noInvalidErr="true" xpath="@warehouse"/>
                  </container>
                  <container type="visibleGroup" visibleIf="@builtIn != 1">
                    <input defaultIfInvalid="campaign" enum="nms:workloadType:customWorkloadTypes"
                           noInvalidErr="true" xpath="@warehouse"/>
                  </container>
                </container>
                <input xpath="@history"/>
                <input nolabel="false" xpath="@showSQL"/>
                <input label="Execute in the engine (do not use in production)" xpath="@inProcess"/>
                <input xpath="@production"/>
              </container>

              <container label="Error management" type="frame">
                <input xpath="@onError"/>
                <container type="visibleGroup" visibleIf="@onError=1">
                  <input xpath="@errorLimit"/>
                  <static type="help">If the number of consecutive errors is not equal to zero, the process will be suspended after this number of consecutive errors on a given task.</static>
                </container>
                <input boldLineExpr="@builtIn = 1" folderFilterChoice="@model = 'nmsDeliveryModel'"
                       form="nms:delivery" xpath="scenario">
                  <sysFilter>
                    <condition expr="@isModel = 1"/>
                  </sysFilter>
                  <orderBy>
                    <node expr="@builtIn" sortDesc="true"/>
                    <node expr="@label"/>
                  </orderBy>
                </input>
              </container>

            </container>

  <!--[cf]-->
  <!--[of]:  SQL-->
            <container img=" " label="SQL logs" ref="xtk:workflow:sql"/>

  <!--[cf]-->
  <!--[of]:  Script-->
            <container label="Script">
              <input nolabel="true" xpath="script"/>
            </container>
  <!--[cf]-->
  <!--[of]:  Advanced-->
            <container colcount="2" label="Advanced">
              <static colspan="2" label="Background image" type="separator"/>
              <input colspan="2" hideImage="true" noPropagateImg="true" schema="xtk:image"
                     type="linkedit" xpath="@background"/>

              <static colspan="2" label="Audit" type="separator"/>
              <input noZoom="true" readOnly="true" xpath="createdBy"/>
              <value xpath="@created"/>
              <input noZoom="true" readOnly="true" xpath="modifiedBy"/>
              <value xpath="@lastModified"/>

            </container>
  <!--[cf]-->
  <!--[of]:  Variables-->
            <container label="Variables">
              <static label="Variables" type="separator"/>
              <input colspan="2" nolabel="true" type="sourceEdit" xpath="variables"/>
            </container>
  <!--[cf]-->

          </form>
        </input>
<!--[cf]-->
      </input>
<!--[cf]-->
<!--[of]:Detail-->
      <container name="detail" type="visibleGroup" visibleIf="[/tmp/@taskState]">
        <container name="noteBook" type="notebook">
<!--[of]:Tasks-->
          <container label="Tasks">
            <input enumImage="@status" hideEditButtons="true" lineCount="10" nolabel="true"
                   refresh="true" toolbarCaption="Tasks for the selected activity"
                   type="linkList" xpath="task" xpathObjectId="@objectId" xpathObjectSchema="@objectSchema"
                   xpathRefresh="/ignored/@selectedActivity" zoom="true">
              <sysFilter>
                <condition enabledIf="$(/ignored/@selectedActivity) !='' " expr="@activity = $(/ignored/@selectedActivity)"/>
              </sysFilter>

              <input xpath="@creationDate"/>
              <input xpath="@status"/>
              <input xpath="@activity"/>
              <input xpath="@duration"/>
              <input xpath="@nextProcessingDate"/>
              <orderBy>
                <node expr="@creationDate" sortDesc="true"/>
              </orderBy>
            </input>
          </container>
<!--[cf]-->
<!--[of]:Logs-->
<!-- Logs -->
          <container label="Journal">
            <input enumImage="@logType" hideEditButtons="true" img="xtk:logs.png"
                   lineCount="10" nolabel="true" refresh="true" toolbarCaption="Messages in the journal of the selected activity"
                   type="linkList" xpath="log" xpathRefresh="/ignored/@selectedActivity">
              <input xpath="@logDate"/>
              <input xpath="@message"/>
              <sysFilter>
                <condition enabledIf="$(/ignored/@selectedActivity) !='' " expr="@activity = $(/ignored/@selectedActivity)"/>
              </sysFilter>
              <orderBy>
                <node expr="@logDate" sortDesc="true"/>
                <node expr="@id"/>
              </orderBy>
            </input>
          </container>
<!--[cf]-->
        </container>
      </container>
<!--[cf]-->
    </container>
  </container>
<!--[cf]-->
<!--[of]:Journal-->
  <container img="xtk:logs.png" label="Audit" name="log" visibleIf="!@isModel">
    <input enumImage="@logType" hideEditButtons="true" img="xtk:logs.png" nolabel="true"
           refresh="true" toolbarCaption="Messages in the journal" type="linkList"
           xpath="log">
      <input xpath="@logDate"/>
      <input xpath="@activity"/>
      <input xpath="@message"/>
      <orderBy>
        <node expr="@logDate" sortDesc="true"/>
        <node expr="@id"/>
      </orderBy>
    </input>
  </container>
<!--[cf]-->
<!--[of]:SQL-->
  <container img="xtk:sql.png" label="SQL logs" name="sql" visibleIf="@showSQL">
    <input nolabel="true" readOnly="true" type="wkfJobLogSQLEdit" xpath="@id"/>
  </container>

<!--[cf]-->

</form>
